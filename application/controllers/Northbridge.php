<?php header('Access-Control-Allow-Origin: *'); ?>
<?php 
	class Northbridge extends CI_Controller{
		public function __construct(){
			parent::__construct();
		  	$this->load->helper('url');
		  	$this->load->model('northbridge_model');
	        $this->load->helper('form');
			$this->load->library('form_validation');
			$this->load->helper('url_helper');
			$this->load->library('email');
			$this->load->library('phpmailer_lib');
			if($_SERVER['SERVER_NAME'] == "localhost"){
				$this->load->library('paystack', ['secret_key'=>'sk_test_2abcc11086fd6ab400dd666ea362752ed75c16a6', 'public_key'=>'pk_test_5f699ccdca560cace897741fcb06808d0ad8e839']);
			}else{
				$this->load->library('paystack', ['secret_key'=>'sk_live_82b42e494e55a2f3bf8f458ebf01070a50a7e668', 'public_key'=>'pk_live_3236f0c8c77516e86230ba8754bea2aa3016755c']);
			}

			if($_SERVER['SERVER_NAME'] == "localhost"){
				$monnify_base_url = "https://api.monnify.com";
			}else{
				$monnify_base_url = "https://api.monnify.com";
			}
			
			$config['upload_path'] = './assets/images';
			$config['allowed_types'] = 'gif|jpg|png|jpeg';
			// $config['max_size']     = '1000';
			// $config['max_width'] = '1400';
			// $config['max_height'] = '1400';
			$config['encrypt_name'] = true;
			$this->load->library('upload', $config);
			$this->load->library('pagination');
			$this->load->library('encryption');
			$this->load->library('ftp');
			
			$this->load->helper('string');
			$this->load->helper('cookie');
			$this->load->helper('text');
			$this->load->helper('file');
			$config['overwrite'] = false;
		}

		public function _auth($datas = null)
	    {
	        // Here you can verify everything you want to perform user login.
	        // However, method must return integer (client ID) if auth succedeed and false if not.
	        return (!empty($datas->user_id)) ? $datas->user_id : false;
	    }

	    public function _event($datas = null)
	    {
	        // Here you can do everyting you want, each time message is received
	        echo 'Hey ! I\'m an EVENT callback'.PHP_EOL.'this is data from client';
	        print_r($datas);
	    }


	    public function _usernameRegex($userName) {
		  if (preg_match('/^\S*$/', $userName ) ) 
		  {
		    return TRUE;
		  } 
		  else 
		  {
		  	$this->form_validation->set_message('_usernameRegex', 'Sorry The UserName You Entered Contains Disallowed Characters');
		    return FALSE;
		  }
		}

	    public function phone_unique($phone){
	    	$ip_address = $this->input->ip_address();
			if($ip_address == "::1"){
				$ip_address = "197.211.60.81";
			}
	
			
			// if($this->input->valid_ip($ip_address)){
			// 	$location_info = $this->northbridge_model->custom_curl("http://api.ipstack.com/" . $ip_address . "?access_key=04b8933ab2331d1a31e653053f909b43",TRUE);
				
			// 	$location_info = json_decode($location_info);
			// 	if(is_object($location_info)){
					
					// $calling_code = $location_info->location->calling_code;
					// $country_id = $this->northbridge_model->getCountryIdByCountryCode(strtolower($location_info->country_code));
					
					
				// }else{
					$calling_code = "234";
					
				// }
				$phone = substr($phone,1);
				
				if($this->northbridge_model->checkIfThisNumberHasBeenUsed($phone,$calling_code)){
					$this->form_validation->set_message('phone_unique', 'Sorry This Phone Number Has Been Used Before');
					return FALSE;
				}else{

					return TRUE;
				}
			// }	
	    }

	    public function phone_unique_edit_profile($phone,$user_id){
	    	$ip_address = $this->input->ip_address();
			if($ip_address == "::1"){
				$ip_address = "197.211.60.81";
			}
	
			
			// if($this->input->valid_ip($ip_address)){
				// $location_info = $this->northbridge_model->custom_curl("http://api.ipstack.com/" . $ip_address . "?access_key=04b8933ab2331d1a31e653053f909b43",TRUE);
				
				// $location_info = json_decode($location_info);
				// if(is_object($location_info)){
					
				// 	$calling_code = $location_info->location->calling_code;
				// 	$country_id = $this->northbridge_model->getCountryIdByCountryCode(strtolower($location_info->country_code));
					
					
				// }else{
					$calling_code = "234";
					
				// }
				$phone = substr($phone,1);

				if($this->northbridge_model->getUserParamById("phone",$user_id) == $phone && $this->northbridge_model->getUserParamById("phone_code",$user_id) == $calling_code){
					return TRUE;
				}else{
				
					if($this->northbridge_model->checkIfThisNumberHasBeenUsed($phone,$calling_code)){
						$this->form_validation->set_message('phone_unique_edit_profile', 'Sorry This Phone Number Has Been Used Before');
						return FALSE;
					}else{

						return TRUE;
					}
				}
			// }	
	    }

	    public function sponsor_user_name_is_valid($sponsor_user_name){
			if(!$this->northbridge_model->checkIfUserNameExists($sponsor_user_name)){
				$this->form_validation->set_message('sponsor_user_name_is_valid', 'This Username Does Not Exist');
				return FALSE;
			}else{
				return TRUE;
			}
	    }

	    public function placement_user_name_is_valid($placement_user_name){
	    	if($placement_user_name != ""){
				if(!$this->northbridge_model->checkIfUserNameExists($placement_user_name)){
					$this->form_validation->set_message('placement_user_name_is_valid', 'This Username Does Not Exist');
					return FALSE;
				}else{
					return TRUE;
				}
			}else{
				return TRUE;
			}
	    }

	    public function email_unique($email){
			$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
			
			if($this->northbridge_model->checkIfEmailIsInId($email,$user_id)){
				return TRUE;
			}else{
				if($this->northbridge_model->checkIfEmailExists($email)){
					$this->form_validation->set_message('email_unique', 'Email Used By Another User');
					 return FALSE;
				}else{
					return TRUE;
				}
			}

		}

		public function email_unique_edit_profile($email,$user_id){
			
			if($this->northbridge_model->checkIfEmailIsInId($email,$user_id)){
				return TRUE;
			}else{
				if($this->northbridge_model->checkIfEmailExists($email)){
					$this->form_validation->set_message('email_unique_edit_profile', 'Email Used By Another User');
					 return FALSE;
				}else{
					return TRUE;
				}
			}

		}
		

		public function index($addition = NULL , $second_addition = NULL,$third_addition = NULL,$fourth_addition = NULL,$fivth_addition = NULL,$sixth_addition = NULL,$seventh_addition = NULL){
			// echo $second_addition;
			// echo $addition;
			// echo $this->northbridge_model->getFacilityBySlug($addition);
			$data['one'] = 1;
			$data['addition'] = $addition;

			$client_secret = "8CAARSR6YV8GUEZTMWHCYH6T82ELHEU8";

			if($this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$this->northbridge_model->updateUserLastActivity($user_id);
				$data['user_id'] = $user_id;
				$data['title'] = "northbridge";

				// if($this->northbridge_model->checkIfUserIsAdmin()){
				// $this->northbridge_model->performAutomaticResubscription();
				// }
				
				$data['user_name'] = $this->northbridge_model->getUserNameById($user_id);
				$data['logo']  = $this->northbridge_model->getUserLogoById1($user_id);
				// $this->northbridge_model->performAutomaticRemovalOfDispatchRequestsMiniImportationOrders();

				//Check All Basic Accounts Of This User And Change To Business If Its Up to 6500

				

				//Perform Monthly Subscription On business Accounts
				// $this->northbridge_model->performMonthlySubscriptionOnBusinessAccounts();				
			}

			
			if(is_null($addition)){
				
				$data['test'] = true;
				if($this->northbridge_model->confirmLoggedIn()){
					$data['logged_in'] = true;
				}else{
					$data['logged_in'] = false;
				}

				$email = array("ikechukwunwogo@gmail.com");
				$otp = 12345;

				// if($this->northbridge_model->sendOtpEmail($email,$otp)){
				// 	echo "email sent successfully";
				// }else{
				// 	echo "something went wrong";
				// }
				$this->load->view('includes/home_header',$data);
				$this->load->view('pages/index',$data);
				$this->load->view('includes/home_footer',$data);
				
			}

			elseif($addition == "products" &&  $second_addition == "access_control_systems" && $third_addition == "remote_controlled_boom_barrier" && is_null($fourth_addition)){
				$data['page_title'] = "Access Control Systems | Remote Controlled Boom Barrier";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/remote_controlled_boom_barrier',$data);
				
				$this->load->view('includes/home_footer',$data);
			}


			elseif($addition == "products" &&  $second_addition == "access_control_systems" && $third_addition == "automatic_hydraulic_rising_bollards" && is_null($fourth_addition)){
				$data['page_title'] = "Access Control Systems | Automatic Hydraulic Rising Bollards";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/automatic_hydraulic_rising_bollards',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "access_control_systems" && $third_addition == "rising_kerb_road_blocker" && is_null($fourth_addition)){
				$data['page_title'] = "Access Control Systems | Rising Kerb Road Blocker";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/rising_kerb_road_blocker',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "access_control_systems" && $third_addition == "tire_kiler_road_spike" && is_null($fourth_addition)){
				$data['page_title'] = "Access Control Systems | Tire Killer Road Spike";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/tire_kiler_road_spike',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "access_control_systems" && $third_addition == "waist_height_tripod" && is_null($fourth_addition)){
				$data['page_title'] = "Access Control Systems | Waist Height Tripod Turnstile";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/waist_height_tripod',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "access_control_systems" && $third_addition == "wall_reader" && is_null($fourth_addition)){
				$data['page_title'] = "Access Control Systems | Wall Reader";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/wall_reader',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "access_control_systems" && $third_addition == "personal_effects_lockers" && is_null($fourth_addition)){
				$data['page_title'] = "Access Control Systems | Personal Effects Lockers";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/personal_effects_lockers',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "access_control_systems" && $third_addition == "stanchion_queue_barrier" && is_null($fourth_addition)){
				$data['page_title'] = "Access Control Systems | Stanchion Queue Barrier";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/stanchion_queue_barrier',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "access_control_systems" &&  is_null($third_addition)){
				$data['page_title'] = "Access Control Systems";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/access_control_systems',$data);
				
				$this->load->view('includes/home_footer',$data);
			}


			elseif($addition == "clients"){
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/clients',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_trucks" && $third_addition == "special_vehicles" && $fourth_addition == "air_and_light_support_unit" && is_null($fivth_addition)){
				$data['page_title'] = "Fire Trucks | Mobile Clinic | Blood Donation Unit";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/air_and_light_support_unit',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_trucks" && $third_addition == "special_vehicles" && $fourth_addition == "mobile_workshop" && is_null($fivth_addition)){
				$data['page_title'] = "Fire Trucks | Mobile Workshop";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/mobile_workshop',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_trucks" && $third_addition == "special_vehicles" && $fourth_addition == "explosion_ordnance_device" && is_null($fivth_addition)){
				$data['page_title'] = "Fire Trucks | Explosion Ordnance Device (EOD) | Csi Unit";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/explosion_ordnance_device',$data);
				
				$this->load->view('includes/home_footer',$data);
			}


			elseif($addition == "products" &&  $second_addition == "fire_trucks" && $third_addition == "special_vehicles" && $fourth_addition == "extendable" && is_null($fivth_addition)){
				$data['page_title'] = "Fire Trucks | Extendable Units";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/extendable',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_trucks" && $third_addition == "special_vehicles" && $fourth_addition == "mobile_clinic_blood_donation_unit" && is_null($fivth_addition)){
				$data['page_title'] = "Fire Trucks | Mobile Clinic | Blood Donation Unit";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/mobile_clinic_blood_donation_unit',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_trucks" && $third_addition == "special_vehicles" &&  is_null($fourth_addition)){
				$data['page_title'] = "Fire Trucks | Ambulances";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/special_vehicles',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_trucks" && $third_addition == "ambulances" && $fourth_addition == "high_roof_ambulance" && is_null($fivth_addition)){
				$data['page_title'] = "Fire Trucks | Ambulances | High Roof Ambulance";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/high_roof_ambulance',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_trucks" && $third_addition == "ambulances" && $fourth_addition == "box_typ_ambulance" && is_null($fivth_addition)){
				$data['page_title'] = "Fire Trucks | Ambulances | Box Type Ambulance";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/box_typ_ambulance',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_trucks" && $third_addition == "ambulances" && $fourth_addition == "first_responder" && is_null($fivth_addition)){
				$data['page_title'] = "Fire Trucks | Ambulances | First Responder";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/first_responder',$data);
				
				$this->load->view('includes/home_footer',$data);
			}


			elseif($addition == "products" &&  $second_addition == "fire_trucks" && $third_addition == "ambulances" && $fourth_addition == "en_1789_certified_ambulance" && is_null($fivth_addition)){
				$data['page_title'] = "Fire Trucks | Ambulances | EN 1789 CERTIFIED AMBULANCE";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/en_1789_certified_ambulance',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_trucks" && $third_addition == "ambulances" && $fourth_addition == "type_i_type_iii_ambulances" && is_null($fivth_addition)){
				$data['page_title'] = "Fire Trucks | Ambulances | Type I | Type III Ambulances";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/type_i_type_iii_ambulances',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_trucks" && $third_addition == "ambulances" && $fourth_addition == "hearse_golf_club_ambulances" && is_null($fivth_addition)){
				$data['page_title'] = "Fire Trucks | Ambulances | Hearse | Golf Club Ambulances";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/hearse_golf_club_ambulances',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_trucks" && $third_addition == "ambulances" && $fourth_addition == "type_ii_ambulance" && is_null($fivth_addition)){
				$data['page_title'] = "Fire Trucks | Ambulances | Type II Ambulance";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/type_ii_ambulance',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_trucks" && $third_addition == "ambulances" &&  is_null($fourth_addition)){
				$data['page_title'] = "Fire Trucks | Ambulances";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/ambulances',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_trucks" && $third_addition == "fire_fighting_vehicles" && $fourth_addition == "port_firefighting_truck" && is_null($fivth_addition)){
				$data['page_title'] = "Fire Trucks | Firefighting Vehicles | High Flow Industrial Firefighting Truck";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/port_firefighting_truck',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_trucks" && $third_addition == "fire_fighting_vehicles" && $fourth_addition == "high_flow_industrial_firefighting_truck" && is_null($fivth_addition)){
				$data['page_title'] = "Fire Trucks | Firefighting Vehicles | High Flow Industrial Firefighting Truck";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/high_flow_industrial_firefighting_truck',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_trucks" && $third_addition == "fire_fighting_vehicles" && $fourth_addition == "bronto_skylift" && is_null($fivth_addition)){
				$data['page_title'] = "Fire Trucks | Firefighting Vehicles | Bronto Skylift";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/bronto_skylift',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_trucks" && $third_addition == "fire_fighting_vehicles" && $fourth_addition == "rapid_response_vehicle" && is_null($fivth_addition)){
				$data['page_title'] = "Fire Trucks | Firefighting Vehicles | First Response Vehicle";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/rapid_response_vehicle',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_trucks" && $third_addition == "fire_fighting_vehicles" && $fourth_addition == "rapid_intervention_vehicles" && is_null($fivth_addition)){
				$data['page_title'] = "Fire Trucks | Firefighting Vehicles | Rapid Intervention Vehicles";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/rapid_intervention_vehicles',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_trucks" && $third_addition == "fire_fighting_vehicles" && $fourth_addition == "water_tanker" && is_null($fivth_addition)){
				$data['page_title'] = "Fire Trucks | Firefighting Vehicles | Water Tanker";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/water_tanker',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_trucks" && $third_addition == "fire_fighting_vehicles" && $fourth_addition == "foam_logistic_transport" && is_null($fivth_addition)){
				$data['page_title'] = "Fire Trucks | Firefighting Vehicles | Water | Foam Support Vehicle | Trailer";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/foam_logistic_transport',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_trucks" && $third_addition == "fire_fighting_vehicles" && $fourth_addition == "oil_and_gas_fire_trucks" && is_null($fivth_addition)){
				$data['page_title'] = "Fire Trucks | Firefighting Vehicles | Oil and Gas Fire Trucks";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/oil_and_gas_fire_trucks',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_trucks" && $third_addition == "fire_fighting_vehicles" &&  is_null($fourth_addition)){
				$data['page_title'] = "Fire Trucks | Firefighting Vehicles";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/fire_fighting_vehicles',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_trucks"&&  is_null($third_addition)){
				$data['page_title'] = "Fire Trucks";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/fire_trucks',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "passive_fire_protection" && $third_addition == "hardware" &&  is_null($fourth_addition)){
				$data['page_title'] = "Passive Fire Doors | HARDWARE";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/passive_fire_protection_hardware',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "passive_fire_protection" && $third_addition == "vision_panels" &&  is_null($fourth_addition)){
				$data['page_title'] = "FIRE DOORS | Vision Panel";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/passive_fire_protection_vision_panels',$data);
				
				$this->load->view('includes/home_footer',$data);
			}


			elseif($addition == "products" &&  $second_addition == "passive_fire_protection" && $third_addition == "louvers" &&  is_null($fourth_addition)){
				$data['page_title'] = "Passive Fire Doors | FIRE DOORS | LOUVER";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/passive_fire_protection_louvers',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "passive_fire_protection" && $third_addition == "access_panel_door" &&  is_null($fourth_addition)){
				$data['page_title'] = "PASSIVE FIRE PROTECTION | FIRE DOORS | ACCESS PANEL DOOR";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/passive_fire_protection_access_panel_door',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "passive_fire_protection" && $third_addition == "glazed_doors" &&  is_null($fourth_addition)){
				$data['page_title'] = "FIRE DOORS | GLAZED DOORS";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/passive_fire_protection_glazed_doors',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "passive_fire_protection" && $third_addition == "steel_fire_rated_doors" && $fourth_addition == "rockwool_core" &&  is_null($fivth_addition)){
				$data['page_title'] = "FIRE DOORS | ROCKWOOL CORE";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/passive_fire_protection_steel_fire_rated_doors_rockwool_core',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "passive_fire_protection" && $third_addition == "steel_fire_rated_doors" && $fourth_addition == "honeycomb_fire_rated_doors" &&  is_null($fivth_addition)){
				$data['page_title'] = "FIRE DOORS | HONEYCOMB FIRE RATED DOORS";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/passive_fire_protection_steel_fire_rated_doors_honeycomb_fire_rated_doors',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "passive_fire_protection" && $third_addition == "steel_fire_rated_doors" &&  is_null($fourth_addition)){
				$data['page_title'] = "FIRE DOORS | STEEL FIRE RATED DOORS";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/passive_fire_protection_steel_fire_rated_doors',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "passive_fire_protection"&&  is_null($third_addition)){
				$data['page_title'] = "PASSIVE FIRE PROTECTION";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/passive_fire_protection',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_pumps" && $third_addition == "accessories" && $fourth_addition == "fuel_tanks" &&  is_null($fivth_addition)){
				$data['page_title'] = "Fire Pumps | FuelTank";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/fire_pumps_accessories_fuel_tanks',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_pumps" && $third_addition == "accessories" && $fourth_addition == "miscellaneous" &&  is_null($fivth_addition)){
				$data['page_title'] = "Fire Pumps | Miscellaneous | Accessories";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/fire_pumps_accessories_miscellaneous',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_pumps" && $third_addition == "accessories" &&  is_null($fourth_addition)){
				$data['page_title'] = "Fire Pumps | Miscellaneous";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/fire_pumps_accessories',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_pumps" && $third_addition == "containerized_fire_pumps" &&  is_null($fourth_addition)){
				$data['page_title'] = "Fire Pumps | Containerized Fire Pumps";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/fire_pumps_containerized_fire_pumps',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_pumps" && $third_addition == "fire_pump_packages" &&  is_null($fourth_addition)){
				$data['page_title'] = "Fire Pumps | Fire Pump Packages";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/fire_pumps_fire_pump_packages',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_pumps" && $third_addition == "vertical_turbine" &&  is_null($fourth_addition)){
				$data['page_title'] = "Fire Pumps | Vertical Turbine";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/fire_pumps_vertical_turbine',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_pumps" && $third_addition == "horizontal_split_case" &&  is_null($fourth_addition)){
				$data['page_title'] = "Fire Pumps | Horizontal Split Case";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/fire_pumps_horizontal_split_case',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_pumps" && $third_addition == "end_suction" &&  is_null($fourth_addition)){
				$data['page_title'] = "Fire Pumps | End Suction";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/fire_pumps_end_suction',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_pumps"&&  is_null($third_addition)){
				$data['page_title'] = "Fire Pumps";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/fire_pumps',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_hydrants"&&  is_null($third_addition)){
				$data['page_title'] = "FIRE HYDRANT | PILLAR HYDRANT";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/fire_hydrants',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_valves" && $third_addition == "y_strainer" &&  is_null($fourth_addition)){
				$data['page_title'] = "FIRE PROTECTION VALVES | Y-STRAINER";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/fire_valves_y_strainer',$data);
				
				$this->load->view('includes/home_footer',$data);
			}


			elseif($addition == "products" &&  $second_addition == "fire_valves" && $third_addition == "butterfly_valves" &&  is_null($fourth_addition)){
				$data['page_title'] = "FIRE PROTECTION VALVES | BUTTERFLY VALVE ";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/fire_valves_butterfly_valves',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_valves" && $third_addition == "check_valves" &&  is_null($fourth_addition)){
				$data['page_title'] = "FIRE PROTECTION VALVES | CHECK VALVE";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/fire_valves_check_valves',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_valves" && $third_addition == "gate_valves" &&  is_null($fourth_addition)){
				$data['page_title'] = "FIRE PROTECTION VALVES | GATE VALVE";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/fire_valves_gate_valves',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_valves" && is_null($third_addition)){
				$data['page_title'] = "FIRE PROTECTION VALVES";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/fire_valves',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_alarms" && $third_addition == "addressable_fdas_adx" &&  is_null($fourth_addition)){
				$data['page_title'] = "Fire Alarms | addressable-fdas-adx";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/fire_alarms_addressable_fdas_adx',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_alarms" && $third_addition == "addressable_fdas_ign" &&  is_null($fourth_addition)){
				$data['page_title'] = "FIRE DETECTION & ALARM SYSTEMS | IGN SERIES ADDRESSABLE";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/fire_alarms_addressable_fdas_ign',$data);
				
				$this->load->view('includes/home_footer',$data);
			}


			elseif($addition == "products" &&  $second_addition == "fire_alarms" && $third_addition == "conventional_fdas" &&  is_null($fourth_addition)){
				$data['page_title'] = "FIRE DETECTION & ALARM SYSTEMS | CONVENTIONAL";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/fire_alarms_conventional_fdas',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_alarms" && is_null($third_addition)){
				$data['page_title'] = "FIRE DETECTION & ALARM SYSTEMS";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/fire_alarms',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_protection_systems" && $third_addition == "clean_agent_system" &&  is_null($fourth_addition)){
				$data['page_title'] = "FIRE PROTECTION SYSTEM | CLEAN AGENT SYSTEM";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/fire_protection_systems_clean_agent_system',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_protection_systems" && $third_addition == "foam_system" &&  is_null($fourth_addition)){
				$data['page_title'] = "FIRE PROTECTION SYSTEM | CLEAN AGENT SYSTEM";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/fire_protection_systems_foam_system',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_protection_systems" && $third_addition == "sprinkler_system" &&  is_null($fourth_addition)){
				$data['page_title'] = "FIRE PROTECTION SYSTEM | SPRINKLER SYSTEM";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/fire_protection_systems_sprinkler_system',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_protection_systems" && is_null($third_addition)){
				$data['page_title'] = "FIRE PROTECTION SYSTEMS";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/fire_protection_systems',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_fighting_equipment" && $third_addition == "breeching_inlet" &&  is_null($fourth_addition)){
				$data['page_title'] = "FIREFIGHTING EQUIPMENT | BREECHING INLET";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/fire_fighting_equipment_breeching_inlet',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_fighting_equipment" && $third_addition == "landing_valve" &&  is_null($fourth_addition)){
				$data['page_title'] = "FIREFIGHTING EQUIPMENT | LANDING VALVE";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/fire_fighting_equipment_landing_valve',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_fighting_equipment" && $third_addition == "fire_hose" &&  is_null($fourth_addition)){
				$data['page_title'] = "FIREFIGHTING EQUIPMENT | FIRE HOSE";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/fire_fighting_equipment_fire_hose',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_fighting_equipment" && $third_addition == "fire_hose_reel" &&  is_null($fourth_addition)){
				$data['page_title'] = "FIREFIGHTING EQUIPMENT | FIRE HOSE REEL";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/fire_fighting_equipment_fire_hose_reel',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_fighting_equipment" && is_null($third_addition)){
				$data['page_title'] = "FIREFIGHTING EQUIPMENT";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/fire_fighting_equipment',$data);
				
				$this->load->view('includes/home_footer',$data);
			}


			elseif($addition == "products" &&  $second_addition == "fire_extinguishers" && $third_addition == "wet_chemical" &&  is_null($fourth_addition)){
				$data['page_title'] = "FIRE EXTINGUISHER | WET CHEMICAL";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/fire_extinguisher_wet_chemical',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_extinguishers" && $third_addition == "water" &&  is_null($fourth_addition)){
				$data['page_title'] = "FIRE EXTINGUISHER | WATER";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/fire_extinguisher_water',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_extinguishers" && $third_addition == "foam" &&  is_null($fourth_addition)){
				$data['page_title'] = "FIRE EXTINGUISHER | FOAM";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/fire_extinguisher_foam',$data);
				
				$this->load->view('includes/home_footer',$data);
			}


			elseif($addition == "products" &&  $second_addition == "fire_extinguishers" && $third_addition == "co2" &&  is_null($fourth_addition)){
				$data['page_title'] = "FIRE EXTINGUISHER | CARBON DIOXIDE";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/fire_extinguisher_co2',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_extinguishers" && $third_addition == "dry_chemical" &&  is_null($fourth_addition)){
				$data['page_title'] = "FIRE EXTINGUISHER | DRY CHEMICAL POWDER";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/fire_extinguisher_dry_chemical',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products" &&  $second_addition == "fire_extinguishers" && is_null($third_addition)){
				$data['page_title'] = "FIRE EXTINGUISHERS";
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/fire_extinguishers',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "about_us"){
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/about_us',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "products"){
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/products',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "projects"){
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/projects',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "news"){
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/news',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "careers"){
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/careers',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "contact"){
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/contact',$data);
				
				$this->load->view('includes/home_footer',$data);
			}




			elseif($addition == "carousel-img"){
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/carousel_img_page',$data);
				
				$this->load->view('includes/home_footer',$data);
			}

			elseif($addition == "submit_contact_form" && is_null($second_addition)){
				
					$date = date("j M Y");
					$time = date("h:i:sa");

					
						
					$response_arr = array('success' => false,'messages' => '');

					$this->form_validation->set_rules('contact_name','Contact Name','trim|required|max_length[75]');
					$this->form_validation->set_rules('contact_email','Contact Email','trim|required|valid_email|max_length[100]');
					$this->form_validation->set_rules('contact_phone','Contact Phone','trim|required|numeric|max_length[20]');
					$this->form_validation->set_rules('contact_subject','Contact Subject','trim|required|max_length[300]');
					$this->form_validation->set_rules('contact_services','Contact Services','trim|required|in_list[fire_extinguishers,fire_equipment,fire_protection_systems,fire_alarms,fire_valves,fire_hydrants,fire_pumps,passive_fire_protection,fire_trucks,access_control_systems]');
					$this->form_validation->set_rules('contact_message','Message','trim|required|max_length[2500]');
					
					$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
					if($this->form_validation->run() == FALSE){
						// redirect('northbridge/account_created');
						foreach($_POST as $key => $value){
							$response_arr['messages'][$key] = form_error($key);
						}
					}else{

						$contact_name = $this->input->post('contact_name');
						$email = $this->input->post('email');
						$contact_phone = $this->input->post('contact_phone');
						$contact_subject = $this->input->post('contact_subject');
						$contact_services = $this->input->post('contact_services');
						$contact_message = $this->input->post('contact_message');
						

						$form_array = array(
							'contact_name' => $contact_name,
							'email' => $email,
							'contact_phone' => $contact_phone,
							'contact_subject' => $contact_subject,
							'contact_services' => $contact_services,
							'contact_message' => $contact_message
						);

						if($this->northbridge_model->sendContactEmail($form_array)){
							$response_arr['success'] = true;
						}
					}

					echo json_encode($response_arr);
					

					
			}


			elseif($addition == "track_package"){
				$response_arr = array('success' => false,'messages' => "",'invalid_tracking_id' => true);

				if($this->input->post('tracking_id')){
					$tracking_id = $this->input->post('tracking_id');
					if($this->northbridge_model->checkIfTrackingIdIsValid($tracking_id)){
						$response_arr['invalid_tracking_id'] = false;

						$package_info = $this->northbridge_model->getPackageInfoByTrackingId($tracking_id);
						if(is_array($package_info)){
							$response_arr['success'] = true;
							$response_arr['messages'] .= '<div class="row">';
							foreach($package_info as $row){
								$package_id = $row->id;
		                        $package_name = $row->package_name;
		                        $tracking_id = $row->tracking_id;
		                        $length = $row->length;
		                        $height = $row->height;
		                        $width = $row->width;
		                        $weight = $row->weight;
		                        $origin_location = $row->origin_location;
		                        $destination_location = $row->destination_location;
		                        $package_owners_name = $row->package_owners_name;
		                        $delivered = $row->delivered;
		                        $date = $row->date;
		                        $time = $row->time;
		                        $delivered_date = $row->delivered_date;
		                        $delivered_time = $row->delivered_time;

		                        $status = "";
		                        if($delivered == 0){
		                          $status = "In Transit";
		                        }else if($delivered == 1){
		                          $status = "Delivered";
		                        }

		                        $date_time = $date . " " . $time;
		                        $delivered_date_time = $delivered_date . " " . $delivered_time;


		                        $response_arr['messages'] .= '<h4 class="col-6">Package Name</h4>';
		                        $response_arr['messages'] .= '<h5 class="col-6"><em>'.$package_name.'</em></h5>';

		                        $response_arr['messages'] .= '<h4 class="col-6">Status</h4>';
		                        $response_arr['messages'] .= '<h5 class="col-6"><em>'.$status.'</em></h5>';

		                        $response_arr['messages'] .= '<h4 class="col-6">Length (cm)</h4>';
		                        $response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">'.number_format($length,2).'</em></h5>';

		                        $response_arr['messages'] .= '<h4 class="col-6">Height (cm)</h4>';
		                        $response_arr['messages'] .= '<h5 class="col-6"><em>'.number_format($height,2).'</em></h5>';

		                        $response_arr['messages'] .= '<h4 class="col-6">Width (cm)</h4>';
		                        $response_arr['messages'] .= '<h5 class="col-6"><em>'.number_format($width,2).'</em></h5>';

		                        $response_arr['messages'] .= '<h4 class="col-6">Weight (kg)</h4>';
		                        $response_arr['messages'] .= '<h5 class="col-6"><em>'.number_format($weight,2).'</em></h5>';

		                        $response_arr['messages'] .= '<h4 class="col-6">Origin Location</h4>';
		                        $response_arr['messages'] .= '<h5 class="col-6"><em>'.$origin_location.'</em></h5>';

		                        $response_arr['messages'] .= '<h4 class="col-6">Destination Location</h4>';
		                        $response_arr['messages'] .= '<h5 class="col-6"><em>'.$destination_location.'</em></h5>';

		                        $response_arr['messages'] .= '<h4 class="col-6">Package Owners Name</h4>';
		                        $response_arr['messages'] .= '<h5 class="col-6"><em>'.$package_owners_name.'</em></h5>';

		                        if($delivered == 1){
		                        	$response_arr['messages'] .= '<h4 class="col-6">Delivered Date/Time</h4>';
		                        	$response_arr['messages'] .= '<h5 class="col-6"><em>'.$delivered_date_time.'</em></h5>';
		                        }



							}
							$response_arr['messages'] .= '</div>';


							$package_statuses = $this->northbridge_model->getPackageStatusesByPackageId($package_id);

							if(is_array($package_statuses)){
								$response_arr['messages'] .= '<h4 class="text-center" style="margin-top: 40px;">Package Status</h4>';

								$i = 0;

								
				        		$response_arr['messages'] .= '<table class="table table-striped table-bordered wrap hover display" id="package-statuses-table" cellspacing="0" width="100%" style="width:100%">';
				        		$response_arr['messages'] .= '<thead>';
				        		$response_arr['messages'] .= '<tr>';
				        		$response_arr['messages'] .= '<th>#</th>';
				        		
				        		$response_arr['messages'] .= '<th>Status</th>';
				        		$response_arr['messages'] .= '<th>Date / Time</th>';
				        		
				        		$response_arr['messages'] .= '</tr>';
				        		$response_arr['messages'] .= '</thead>';
				        		$response_arr['messages'] .= '<tbody>';

				        		foreach($package_statuses as $row){
				        			$i++;
				        			$id = $row->id;
				        			$package_id = $row->package_id;
				        			$status = $row->status;
				        			$date_time = $row->date_time;
				        			

				        			$response_arr['messages'] .= '<tr>';

				        			$response_arr['messages'] .= '<td>'.$i.'</td>';
				        			$response_arr['messages'] .= '<td style="white-space: pre-line;">'.$status.'</td>';
				        			
				        			
				        			$response_arr['messages'] .= '<td>'.$date_time .'</td>';
				        			


				        			$response_arr['messages'] .= '</tr>';

				        		}

				        		$response_arr['messages'] .= '</tbody>';
				        		$response_arr['messages'] .= '</table>';
							}
						}

					}
				}
				
				echo json_encode($response_arr);
			}

			elseif($addition == "edit_package_status" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}

					$date = date("j M Y");
					$time = date("h:i:sa");

					if($this->input->post('package_status_id')){
						$package_status_id = $this->input->post('package_status_id');
						$response_arr = array('success' => false);

						$this->form_validation->set_rules('status','Status','trim|required');
						$this->form_validation->set_rules('date_time','Date Time','trim|required');
						
						$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
						if($this->form_validation->run() == FALSE){
							// redirect('northbridge/account_created');
							foreach($_POST as $key => $value){
								$response_arr['messages'][$key] = form_error($key);
							}
						}else{

							$status = $this->input->post('status');
							$date_time = $this->input->post('date_time');
							$date_time = date("j M Y h:i:sa", strtotime($date_time));  


							$form_array = array(
								'status' => $status,
								'date_time' => $date_time
							);

							if($this->northbridge_model->editThisPackageStatus($form_array,$package_status_id)){
								$response_arr['success'] = true;
								
							}
						}

						echo json_encode($response_arr);
					}

				}	
			}


			elseif($addition == "get_package_status_info_by_id" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}
					$response_arr = array('success' => false);

					if($this->input->post('show_records') && $this->input->post('package_status_id')){
						$package_status_id = $this->input->post('package_status_id');
						$package_status_info = $this->northbridge_model->getPackageStatusInfoById($package_status_id);
						if(is_array($package_status_info)){
							
							foreach($package_status_info as $key => $value){

								$response_arr[$key] = $value;
							}
							// if($key == "date_time"){
							// 	var_dump($value);
							// 	$key = strtotime($value);
							// }
							// $response_arr[0]->date_time = strtotime($response_arr[0]->date_time);
							$response_arr[0]->date_time =  date("m d Y h:i:s a", strtotime($response_arr[0]->date_time));  
							$response_arr['success'] = true;
						}
					}

					echo json_encode($response_arr);
				}	
			}

			elseif($addition == "delete_package_status" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}

					$date = date("j M Y");
					$time = date("h:i:sa");

					if($this->input->post('package_status_id')){
						$response_arr = array('success' => false);
						$package_status_id = $this->input->post('package_status_id');
						
						if($this->northbridge_model->deletePackageStatus($package_status_id)){
							$response_arr['success'] = true;
							
						}
						

						echo json_encode($response_arr);
					}

				}	
			}


			elseif($addition == "add_new_package_status" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}

					$date = date("j M Y");
					$time = date("h:i:sa");

					if($this->input->post('package_id')){
						$package_id = $this->input->post('package_id');
						$response_arr = array('success' => false);

						$this->form_validation->set_rules('status','Status','trim|required');
						
						$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
						if($this->form_validation->run() == FALSE){
							// redirect('northbridge/account_created');
							foreach($_POST as $key => $value){
								$response_arr['messages'][$key] = form_error($key);
							}
						}else{

							$status = $this->input->post('status');
							


							$form_array = array(
								'status' => $status,
								'date_time' => $date . " " . $time,
								'package_id' => $package_id
							);

							if($this->northbridge_model->addThisPackageStatus($form_array)){
								$response_arr['success'] = true;
								
							}
						}

						echo json_encode($response_arr);
					}

				}	
			}


			elseif($addition == "view_package_statuses_by_package_id" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}

					$date = date("j M Y");
					$time = date("h:i:sa");

					if($this->input->post('package_id')){
						$package_id = $this->input->post('package_id');
						$response_arr = array('success' => true,'messages' => '','tracking_id' => '');
							
						$tracking_id = $this->northbridge_model->getPackageParamById("tracking_id",$package_id);
						$response_arr['tracking_id'] = $tracking_id;

						$package_statuses = $this->northbridge_model->getPackageStatusesByPackageId($package_id);

						if(is_array($package_statuses)){
							$i = 0;

							$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="margin-top: 40px;">';
			        		$response_arr['messages'] .= '<table class="table table-striped table-bordered wrap hover display" id="package-statuses-table" cellspacing="0" width="100%" style="width:100%">';
			        		$response_arr['messages'] .= '<thead>';
			        		$response_arr['messages'] .= '<tr>';
			        		$response_arr['messages'] .= '<th>#</th>';
			        		$response_arr['messages'] .= '<th>Actions</th>';
			        		$response_arr['messages'] .= '<th>Status</th>';
			        		$response_arr['messages'] .= '<th>Date / Time</th>';
			        		
			        		$response_arr['messages'] .= '</tr>';
			        		$response_arr['messages'] .= '</thead>';
			        		$response_arr['messages'] .= '<tbody>';

			        		foreach($package_statuses as $row){
			        			$i++;
			        			$id = $row->id;
			        			$package_id = $row->package_id;
			        			$status = $row->status;
			        			$date_time = $row->date_time;
			        			

			        			$response_arr['messages'] .= '<tr>';

			        			$response_arr['messages'] .= '<td>'.$i.'</td>';

			        			$response_arr['messages'] .= '<td class="td-actions text-center">';
			                   	$response_arr['messages'] .= '<button onclick="editPackageStatus(this,event,'.$id.')" type="button" rel="tooltip" title="Edit This Status" class="btn btn-primary">';
			                   	$response_arr['messages'] .= '<i class="fas fa-edit"></i>';
			                    $response_arr['messages'] .= '<div class="ripple-container"></div>';
			                    $response_arr['messages'] .= '</button>';

			                    $response_arr['messages'] .= '<button onclick="deletePackageStatus(this,event,'.$id.')" type="button" rel="tooltip" title="Delete This Status" class="btn btn-danger">';
			                   	$response_arr['messages'] .= '<i class="fas fa-trash-alt"></i>';
			                    $response_arr['messages'] .= '<div class="ripple-container"></div>';
			                    $response_arr['messages'] .= '</button>';
			                    $response_arr['messages'] .= '</td>';

			        			$response_arr['messages'] .= '<td style="white-space: pre-line;">'.$status.'</td>';
			        			
			        			
			        			$response_arr['messages'] .= '<td>'.$date_time .'</td>';
			        			


			        			$response_arr['messages'] .= '</tr>';

			        		}

			        		$response_arr['messages'] .= '</tbody>';
			        		$response_arr['messages'] .= '</table>';

						}else{
							$response_arr['messages'] .= '<h4 class="text-warning">No Status Entered For This Package. Click The Add Button To Add Status.</h4>';
						}
						

						echo json_encode($response_arr);
					}

				}	
			}

			elseif($addition == "mark_package_as_undelivered" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}

					$date = date("j M Y");
					$time = date("h:i:sa");

					if($this->input->post('package_id')){
						$package_id = $this->input->post('package_id');
						$response_arr = array('success' => false);
							
						$form_array = array(
							'delivered' => 0,
							'delivered_date' => "",
							'delivered_time' => ""
						);
						if($this->northbridge_model->updatePackage($form_array,$package_id)){
							$response_arr['success'] = true;
						}
						

						echo json_encode($response_arr);
					}

				}	
			}

			elseif($addition == "mark_package_as_delivered" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}

					$date = date("j M Y");
					$time = date("h:i:sa");

					if($this->input->post('package_id')){
						$package_id = $this->input->post('package_id');
						$response_arr = array('success' => false);
							
						$form_array = array(
							'delivered' => 1,
							'delivered_date' => $date,
							'delivered_time' => $time
						);
						if($this->northbridge_model->updatePackage($form_array,$package_id)){
							$response_arr['success'] = true;
						}
						

						echo json_encode($response_arr);
					}

				}	
			}

			elseif($addition == "delete_package" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}

					$date = date("j M Y");
					$time = date("h:i:sa");

					if($this->input->post('package_id')){
						$package_id = $this->input->post('package_id');
						$response_arr = array('success' => false);
						
						if($this->northbridge_model->deleteThisPackage($package_id)){
							$response_arr['success'] = true;
							
						}
						

						echo json_encode($response_arr);
					}

				}	
			}

			elseif($addition == "edit_this_package" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}

					$date = date("j M Y");
					$time = date("h:i:sa");

					if($this->input->post('package_id')){
						$package_id = $this->input->post('package_id');
						$response_arr = array('success' => false);

						$this->form_validation->set_rules('package_name','Package Name','trim|max_length[300]');
						$this->form_validation->set_rules('length','Length','trim|numeric');					
						$this->form_validation->set_rules('height','Height','trim|numeric');					
						$this->form_validation->set_rules('width','Width','trim|numeric');					
						$this->form_validation->set_rules('weight','Weight','trim|numeric');						
						$this->form_validation->set_rules('origin_location','Origin Location','trim|required|max_length[400]');	
						$this->form_validation->set_rules('destination_location','Destination Location','trim|required|max_length[400]');	
						$this->form_validation->set_rules('package_owners_name','Package Owners Name','trim|required|max_length[300]');	
						
						
						$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
						if($this->form_validation->run() == FALSE){
							// redirect('northbridge/account_created');
							foreach($_POST as $key => $value){
								$response_arr['messages'][$key] = form_error($key);
							}
						}else{

							$package_name = $this->input->post('package_name');
							$length = $this->input->post('length');
							$height = $this->input->post('height');
							$width = $this->input->post('width');
							$weight = $this->input->post('weight');
							$origin_location = $this->input->post('origin_location');
							$destination_location = $this->input->post('destination_location');
							$package_owners_name = $this->input->post('package_owners_name');


							$form_array = array(
								'package_name' => $package_name,
								'length' => $length,
								'height' => $height,
								'width' => $width,
								'weight' => $weight,
								'origin_location' => $origin_location,
								'destination_location' => $destination_location,
								'package_owners_name' => $package_owners_name
							);

							if($this->northbridge_model->editThisPackage($form_array,$package_id)){
								$response_arr['success'] = true;
								
							}
						}

						echo json_encode($response_arr);
					}

				}	
			}


			elseif($addition == "get_package_info_by_id" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}
					$response_arr = array('success' => false);

					if($this->input->post('show_records') && $this->input->post('package_id')){
						$package_id = $this->input->post('package_id');
						$package_info = $this->northbridge_model->getPackageInfoByUserId($package_id);
						if(is_array($package_info)){
							
							foreach($package_info as $key => $value){
								$response_arr[$key] = $value;
							}
							$response_arr['success'] = true;
						}
					}

					echo json_encode($response_arr);
				}	
			}

			elseif($addition == "add_new_package" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}

					$date = date("j M Y");
					$time = date("h:i:sa");

					$response_arr = array('success' => false,'tracking_id' => '');

					$this->form_validation->set_rules('package_name','Package Name','trim|max_length[300]');
					$this->form_validation->set_rules('length','Length','trim|numeric');					
					$this->form_validation->set_rules('height','Height','trim|numeric');					
					$this->form_validation->set_rules('width','Width','trim|numeric');					
					$this->form_validation->set_rules('weight','Weight','trim|numeric');						
					$this->form_validation->set_rules('origin_location','Origin Location','trim|required|max_length[400]');	
					$this->form_validation->set_rules('destination_location','Destination Location','trim|required|max_length[400]');	
					$this->form_validation->set_rules('package_owners_name','Package Owners Name','trim|required|max_length[300]');	
					
					
					$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
					if($this->form_validation->run() == FALSE){
						// redirect('northbridge/account_created');
						foreach($_POST as $key => $value){
							$response_arr['messages'][$key] = form_error($key);
						}
					}else{

						$package_name = $this->input->post('package_name');
						$length = $this->input->post('length');
						$height = $this->input->post('height');
						$width = $this->input->post('width');
						$weight = $this->input->post('weight');
						$origin_location = $this->input->post('origin_location');
						$destination_location = $this->input->post('destination_location');
						$package_owners_name = $this->input->post('package_owners_name');

						$tracking_id = $this->northbridge_model->generateNewTrackingId();

						$form_array = array(
							'package_name' => $package_name,
							'tracking_id' => $tracking_id,
							'length' => $length,
							'height' => $height,
							'width' => $width,
							'weight' => $weight,
							'origin_location' => $origin_location,
							'destination_location' => $destination_location,
							'package_owners_name' => $package_owners_name,
							'date' => $date,
							'time' => $time
						);

						if($this->northbridge_model->addNewPackage($form_array)){
							$response_arr['success'] = true;
							$response_arr['tracking_id'] = $tracking_id;
						}
					}

					echo json_encode($response_arr);

				}	
			}


			elseif($addition == "admin" && is_null($third_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}

					// $data['page_title'] = "Complaints";

					// $data['active'] = "complaints";

					$get_vars = $_GET;
					$config['base_url'] = site_url('northbridge/index/admin');

					$config['total_rows'] = $this->northbridge_model->getAllPackagesByPaginationNum($get_vars);
					$data['total_rows'] = $config['total_rows'];
					
	        		

	        		$config['per_page'] = 10;
	        		// $config['uri_segment'] = 3;

					$config['reuse_query_string'] = TRUE;
					$config['use_page_numbers'] = TRUE;
					$config['next_link'] = 'Next';
					$config['first_link'] = 'First';
					$config['last_link'] = 'Last';
					$config['full_tag_open'] = "<ul class='pagination'>";
					$config['full_tag_close'] ="</ul>";
					$config['num_tag_open'] = '<li>';
					$config['num_tag_close'] = '</li>';
					$config['cur_tag_open'] = "<li class='disabled'><li class='active'><a href='#'>";
					$config['cur_tag_close'] = "<span class='sr-only'></span></a></li>";
					$config['next_tag_open'] = "<li>";
					$config['next_tagl_close'] = "</li>";
					$config['prev_tag_open'] = "<li>";
					$config['prev_tagl_close'] = "</li>";
					$config['first_tag_open'] = "<li>";
					$config['first_tagl_close'] = "</li>";
					$config['last_tag_open'] = "<li>";
					$config['last_tagl_close'] = "</li>";

					// By clicking on performing PREVIOUS pagination.
					$config['prev_link'] = 'Previous';



					if(!is_null($second_addition)){
						$page = $second_addition;
					}else{
						$page = 1;
					}
					
					$page = $page - 1;


	        		
	        		$data['rows'] = $this->northbridge_model->getAllPackagesByPagination($page,$get_vars);
	        		

					$this->pagination->initialize($config);

					$data['str_links'] = $this->pagination->create_links();

				
					$this->load->view('includes/admin_header',$data);
					$this->load->view('pages/admin_home_page',$data);
					$this->load->view('includes/admin_footer',$data);
				}	
			}


			elseif($addition == "about_us"){
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;

				if($this->northbridge_model->confirmLoggedIn()){
					$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
					$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
					$data['user_id'] = $user_id;
					
					if(is_array($user_info)){
						foreach($user_info as $user){
							$data['user_name'] = $user->user_name;
							$data['full_name'] = $user->full_name;
							$data['phone'] = $user->phone;
							$data['email'] = $user->email;
							$data['user_phone'] = $user->phone;
							$data['country_id'] = $user->country_id;
							$data['state_id'] = $user->state_id;
							$data['address'] = $user->address;
							$data['user_slug'] = $user->slug;
							$data['date'] = $user->date;
							$data['time'] = $user->time;
							$data['logo'] = $user->logo;
							$data['cover_photo'] = $user->cover_photo;
							$data['bio'] = $user->bio;
							$data['dob'] = $user->dob;
							$data['super_forex_account_number'] = $user->super_forex_account_number;
						}
					}
				}

				
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/about_us',$data);
				
				$this->load->view('includes/home_footer',$data);
			}


			//Get All Users Json
			elseif($addition == "get_all_users_json" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}
					$response_arr = array('success' => false,'users_json' => array());
					
					if($this->input->post('get_users')){
						$users_json = $this->northbridge_model->getAllUsersInfoJson();
						if($users_json){
							$response_arr['success'] = true;
							$response_arr['users_json'] = $users_json;
						}
					}

					echo json_encode($response_arr);
				}	
			}


			elseif($addition == "admin" && $second_addition == "send_email" && is_null($fourth_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}
					$this->load->view('includes/admin_header',$data);
		            $this->load->view('pages/send_email',$data);
		            $this->load->view('includes/admin_footer',$data);	
				}	
			}



			elseif($addition == "admin" && $second_addition == "view_approved_sabi_account_manager_requests" && is_null($fourth_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}



					$get_vars = $_GET;
					$config['base_url'] = site_url('northbridge/index/admin/view_approved_sabi_account_manager_requests');

					$config['total_rows'] = $this->northbridge_model->getApprovedSabiAcccountManagerRequestsByPaginationNum($get_vars);
					$data['total_rows'] = $config['total_rows'];
					
	        		

	        		$config['per_page'] = 10;

					$config['reuse_query_string'] = TRUE;
					$config['use_page_numbers'] = TRUE;
					$config['next_link'] = 'Next';
					$config['first_link'] = 'First';
					$config['last_link'] = 'Last';
					$config['full_tag_open'] = "<ul class='pagination'>";
					$config['full_tag_close'] ="</ul>";
					$config['num_tag_open'] = '<li>';
					$config['num_tag_close'] = '</li>';
					$config['cur_tag_open'] = "<li class='disabled'><li class='active'><a href='#'>";
					$config['cur_tag_close'] = "<span class='sr-only'></span></a></li>";
					$config['next_tag_open'] = "<li>";
					$config['next_tagl_close'] = "</li>";
					$config['prev_tag_open'] = "<li>";
					$config['prev_tagl_close'] = "</li>";
					$config['first_tag_open'] = "<li>";
					$config['first_tagl_close'] = "</li>";
					$config['last_tag_open'] = "<li>";
					$config['last_tagl_close'] = "</li>";
					// $config['uri_segment'] = 2;

					// By clicking on performing PREVIOUS pagination.
					$config['prev_link'] = 'Previous';



					if(!is_null($third_addition)){
						$page = $third_addition;
					}else{
						$page = 1;
					}
					
					$page = $page - 1;


	        		
	        		$data['rows'] = $this->northbridge_model->getApprovedSabiAcccountManagerRequestsByPagination($page,$get_vars);
	        		

					$this->pagination->initialize($config);

					$data['str_links'] = $this->pagination->create_links();

					
					
					$this->load->view('includes/admin_header',$data);
					
		            $this->load->view('pages/view_approved_sabi_account_manager_requests',$data);
		            $this->load->view('includes/admin_footer',$data);	
				
				}	
			}


			elseif($addition == "admin" && $second_addition == "decline_sabi_acccount_manager_request" && is_null($fourth_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}

					if($this->input->post('id')){
						$id = $this->input->post('id');
						$response_arr = array('success' => false);

						if($this->northbridge_model->declineSabiAccountManagerRequest($id)){
							$response_arr['success'] = true;
						}

						echo json_encode($response_arr);
					}

					
				}	
			}


			elseif($addition == "admin" && $second_addition == "approve_sabi_account_manager_request" && is_null($fourth_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}

					if($this->input->post('id')){
						$id = $this->input->post('id');
						$response_arr = array('success' => false);

						if($this->northbridge_model->approveSabiAccountManagerRequest($id)){
							$response_arr['success'] = true;
						}

						echo json_encode($response_arr);
					}

					
				}	
			}


			elseif($addition == "admin" && $second_addition == "view_sabi_account_manager_requests" && is_null($fourth_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}



					$get_vars = $_GET;
					$config['base_url'] = site_url('northbridge/index/admin/view_sabi_account_manager_requests');

					$config['total_rows'] = $this->northbridge_model->getPendingSabiAcccountManagerRequestsByPaginationNum($get_vars);
					$data['total_rows'] = $config['total_rows'];
					
	        		

	        		$config['per_page'] = 10;

					$config['reuse_query_string'] = TRUE;
					$config['use_page_numbers'] = TRUE;
					$config['next_link'] = 'Next';
					$config['first_link'] = 'First';
					$config['last_link'] = 'Last';
					$config['full_tag_open'] = "<ul class='pagination'>";
					$config['full_tag_close'] ="</ul>";
					$config['num_tag_open'] = '<li>';
					$config['num_tag_close'] = '</li>';
					$config['cur_tag_open'] = "<li class='disabled'><li class='active'><a href='#'>";
					$config['cur_tag_close'] = "<span class='sr-only'></span></a></li>";
					$config['next_tag_open'] = "<li>";
					$config['next_tagl_close'] = "</li>";
					$config['prev_tag_open'] = "<li>";
					$config['prev_tagl_close'] = "</li>";
					$config['first_tag_open'] = "<li>";
					$config['first_tagl_close'] = "</li>";
					$config['last_tag_open'] = "<li>";
					$config['last_tagl_close'] = "</li>";
					// $config['uri_segment'] = 2;

					// By clicking on performing PREVIOUS pagination.
					$config['prev_link'] = 'Previous';



					if(!is_null($third_addition)){
						$page = $third_addition;
					}else{
						$page = 1;
					}
					
					$page = $page - 1;


	        		
	        		$data['rows'] = $this->northbridge_model->getPendingSabiAcccountManagerRequestsByPagination($page,$get_vars);
	        		

					$this->pagination->initialize($config);

					$data['str_links'] = $this->pagination->create_links();

					
					
					$this->load->view('includes/admin_header',$data);
					
		            $this->load->view('pages/view_sabi_account_manager_requests',$data);
		            $this->load->view('includes/admin_footer',$data);	
				
				}	
			}


			elseif($addition == "process_sabi_account_manager_request" && is_null($second_addition)){
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;

				if($this->northbridge_model->confirmLoggedIn()){
					$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
					$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
					$data['user_id'] = $user_id;
					
					if(is_array($user_info)){
						foreach($user_info as $user){
							$data['user_name'] = $user->user_name;
							$data['full_name'] = $user->full_name;
							$data['phone'] = $user->phone;
							$data['email'] = $user->email;
							$data['user_phone'] = $user->phone;
							$data['country_id'] = $user->country_id;
							$data['state_id'] = $user->state_id;
							$data['address'] = $user->address;
							$data['user_slug'] = $user->slug;
							$data['date'] = $user->date;
							$data['time'] = $user->time;
							$data['logo'] = $user->logo;
							$data['cover_photo'] = $user->cover_photo;
							$data['bio'] = $user->bio;
							$data['dob'] = $user->dob;
							$data['super_forex_account_number'] = $user->super_forex_account_number;
						}
					}
				}

				$date = date("j M Y");
				$time = date("h:i:sa");
				
				$response_arr = array('success' => false,'messages' => "");
				
				$this->form_validation->set_rules('full_name','Full Name','trim|required|min_length[5]|max_length[100]');
				$this->form_validation->set_rules('phone','Phone Number','trim|required|numeric|max_length[15]');						
				$this->form_validation->set_rules('email','Email Address','trim|required|valid_email|max_length[40]');	
				$this->form_validation->set_rules('super_forex_account_number','SuperForex Account Number','trim|required|min_length[4]|max_length[20]');	
				$this->form_validation->set_rules('start_capital','Start Capital','trim|required|numeric');						
				
				
				$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
				if($this->form_validation->run() == FALSE){
					// redirect('northbridge/account_created');
					foreach($_POST as $key => $value){
						$response_arr['messages'][$key] = form_error($key);
					}
				}else{
					
					$full_name = $this->input->post('full_name');
					$phone = $this->input->post('phone');
					$email = $this->input->post('email');
					
					$super_forex_account_number = $this->input->post('super_forex_account_number');
					$start_capital = $this->input->post('start_capital');
						
				
					$form_array = array(
						'full_name' => $full_name,
						'phone' => $phone,
						'email' => $email,
						'super_forex_account_number' => $super_forex_account_number,
						'start_capital' => $start_capital,
						'date' => $date,
						'time' => $time
					);
					if($this->northbridge_model->makeSabiAccountManagerRequest($form_array)){

						$response_arr['success'] = true;
					}
						
				}
					
				echo json_encode($response_arr);
					
			}


			elseif($addition == "sabi_account_manager_page" && is_null($second_addition) ){
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;

				if($this->northbridge_model->confirmLoggedIn()){
					$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
					$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
					$data['user_id'] = $user_id;
					
					if(is_array($user_info)){
						foreach($user_info as $user){
							$data['user_name'] = $user->user_name;
							$data['full_name'] = $user->full_name;
							$data['phone'] = $user->phone;
							$data['email'] = $user->email;
							$data['user_phone'] = $user->phone;
							$data['country_id'] = $user->country_id;
							$data['state_id'] = $user->state_id;
							$data['address'] = $user->address;
							$data['user_slug'] = $user->slug;
							$data['date'] = $user->date;
							$data['time'] = $user->time;
							$data['logo'] = $user->logo;
							$data['cover_photo'] = $user->cover_photo;
							$data['bio'] = $user->bio;
							$data['dob'] = $user->dob;
							$data['super_forex_account_number'] = $user->super_forex_account_number;
						}
					}
				}
				
				$this->load->view('includes/home_header',$data);
				$this->load->view('pages/sabi_account_manager_page',$data);
				$this->load->view('includes/home_footer',$data);
					
			}


			elseif($addition == "check_if_email_is_valid" && is_null($second_addition) ){
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;

				
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}
				}
			

				$date = date("j M Y");
				$time = date("h:i:sa");

				if($this->input->post('email')){

					$email = $this->input->post('email');

					$response_arr = array('success' => false);

					if($this->northbridge_model->checkIfEmailExists($email)){
						$response_arr['success'] = true;
					}

					echo json_encode($response_arr);
				}
				
			}


			elseif($addition == "admin" && $second_addition == "edit_this_signal" && is_null($third_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
						$data['fund_exchange_rate'] = $user->fund_exchange_rate;
						$data['withdraw_exchange_rate'] = $user->withdraw_exchange_rate;
						
					}

					$date = date("j M Y");
					$time = date("h:i:sa");

					if($this->input->post('id')){

						$id = $this->input->post('id');

						$response_arr = array('success' => false,'messages' => '');

						$this->form_validation->set_rules('currency_pair','Currency Pair','trim|required');
						$this->form_validation->set_rules('buy_val','Buy Value','trim|required|numeric');					
						$this->form_validation->set_rules('buy_tp','Buy TP','trim|required|numeric');					
						$this->form_validation->set_rules('buy_sl','Buy SL','trim|required|numeric');					
						$this->form_validation->set_rules('sell_val','Sell Value','trim|required|numeric');					
						$this->form_validation->set_rules('sell_tp','Sell TP','trim|required|numeric');					
						$this->form_validation->set_rules('sell_sl','Sell SL','trim|required|numeric');					
						
						$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
						if($this->form_validation->run() == FALSE){
							// redirect('northbridge/account_created');
							foreach($_POST as $key => $value){
								$response_arr['messages'][$key] = form_error($key);
							}
						}else{
							$currency_pair = $this->input->post('currency_pair');
							$buy_val = $this->input->post('buy_val');
							$buy_tp = $this->input->post('buy_tp');
							$buy_sl = $this->input->post('buy_sl');
							$sell_val = $this->input->post('sell_val');
							$sell_tp = $this->input->post('sell_tp');
							$sell_sl = $this->input->post('sell_sl');


							$form_array = array(
								'currency_pair' => $currency_pair,
								'buy_val' => $buy_val,
								'buy_tp' => $buy_tp,
								'buy_sl' => $buy_sl,
								'sell_val' => $sell_val,
								'sell_tp' => $sell_tp,
								'sell_sl' => $sell_sl
							);


							if($this->northbridge_model->updateThisSignal($form_array,$id)){
								$response_arr['success'] = true;
							}
						}

						echo json_encode($response_arr);
					}
				}
			}



			elseif($addition == "admin" && $second_addition == "get_edit_signal_form" && is_null($third_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
						$data['fund_exchange_rate'] = $user->fund_exchange_rate;
						$data['withdraw_exchange_rate'] = $user->withdraw_exchange_rate;
						
					}

					$date = date("j M Y");
					$time = date("h:i:sa");

					$response_arr = array('success' => false,'messages' => '');

					$id = $this->input->post('id');
					
					$signal_info = $this->northbridge_model->getSuperforexSignalInfoById($id);
					if(is_array($signal_info)){
						$response_arr['success'] = true;

						foreach($signal_info as $row){
	                        
	                        
	                        $id = $row->id;
	                        
	                        $currency_pair = $row->currency_pair;
	                        $buy_val = $row->buy_val;
	                        $buy_tp = $row->buy_tp;
	                        $buy_sl = $row->buy_sl;

	                        $sell_val = $row->sell_val;
	                        $sell_tp = $row->sell_tp;
	                        $sell_sl = $row->sell_sl;
	                        $date = $row->date;
	                        $time = $row->time;
	                    }

	                    $response_arr['messages'] .= '<input type="hidden" name="id" id="id" value="'.$id.'">';

		                $response_arr['messages'] .= '<div class="form-group">';
		                $response_arr['messages'] .= '<label for="currency_pair">Currency Pair: </label>';
		                $response_arr['messages'] .= '<input type="text" name="currency_pair" id="currency_pair" class="form-control" value="'.$currency_pair.'">';
		                $response_arr['messages'] .= '<span class="form-error"></span>';
		                $response_arr['messages'] .= '</div>';


		                $response_arr['messages'] .= '<div class="form-group">';
		                $response_arr['messages'] .= '<label for="buy_val">Buy: </label>';
		                $response_arr['messages'] .= '<input type="number" name="buy_val" id="buy_val" class="form-control" step="any" value="'.$buy_val.'">';
		                $response_arr['messages'] .= '<span class="form-error"></span>';
		                $response_arr['messages'] .= '</div>';


		                $response_arr['messages'] .= '<div class="form-group">';
		                $response_arr['messages'] .= '<label for="buy_tp">Buy TP: </label>';
		                $response_arr['messages'] .= '<input type="number" name="buy_tp" id="buy_tp" class="form-control" step="any" value="'.$buy_tp.'">';
		                $response_arr['messages'] .= '<span class="form-error"></span>';
		                $response_arr['messages'] .= '</div>';

		                $response_arr['messages'] .= '<div class="form-group">';
		                $response_arr['messages'] .= '<label for="buy_sl">Buy SL: </label>';
		                $response_arr['messages'] .= '<input type="number" name="buy_sl" id="buy_sl" class="form-control" step="any" value="'.$buy_sl.'">';
		                $response_arr['messages'] .= '<span class="form-error"></span>';
		                $response_arr['messages'] .= '</div>';

		                $response_arr['messages'] .= '<div class="form-group">';
		                $response_arr['messages'] .= '<label for="sell_val">Sell: </label>';
		                $response_arr['messages'] .= '<input type="number" name="sell_val" id="sell_val" class="form-control" step="any" value="'.$sell_val.'">';
		                $response_arr['messages'] .= '<span class="form-error"></span>';
		                $response_arr['messages'] .= '</div>';


		                $response_arr['messages'] .= '<div class="form-group">';
		                $response_arr['messages'] .= '<label for="sell_tp">Sell TP: </label>';
		                $response_arr['messages'] .= '<input type="number" name="sell_tp" id="sell_tp" class="form-control" step="any" value="'.$sell_tp.'">';
		                $response_arr['messages'] .= '<span class="form-error"></span>';
		                $response_arr['messages'] .= '</div>';


		                $response_arr['messages'] .= '<div class="form-group">';
		                $response_arr['messages'] .= '<label for="sell_sl">Sell SL: </label>';
		                $response_arr['messages'] .= '<input type="number" name="sell_sl" id="sell_sl" class="form-control" step="any" value="'.$sell_sl.'">';
		                $response_arr['messages'] .= '<span class="form-error"></span>';
		                $response_arr['messages'] .= '</div>';



		                $response_arr['messages'] .= '<input type="submit" class="btn btn-primary col-12" value="Submit">';
		                $response_arr['messages'] .= '</form>';

					}

					echo json_encode($response_arr);
				}
			}


			elseif($addition == "admin" && $second_addition == "delete_this_signal" && is_null($third_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
						$data['fund_exchange_rate'] = $user->fund_exchange_rate;
						$data['withdraw_exchange_rate'] = $user->withdraw_exchange_rate;
						
					}

					$date = date("j M Y");
					$time = date("h:i:sa");

					$response_arr = array('success' => false,'messages' => '');

					$id = $this->input->post('id');
					if($this->northbridge_model->deleteThisSignal($id)){
						$response_arr['success'] = true;
					}

					echo json_encode($response_arr);
				}
			}

			elseif($addition == "admin" && $second_addition == "upload_new_signal" && is_null($third_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
						$data['fund_exchange_rate'] = $user->fund_exchange_rate;
						$data['withdraw_exchange_rate'] = $user->withdraw_exchange_rate;
						
					}

					$date = date("j M Y");
					$time = date("h:i:sa");

					$response_arr = array('success' => false,'messages' => '');

					$this->form_validation->set_rules('currency_pair','Currency Pair','trim|required');
					$this->form_validation->set_rules('buy_val','Buy Value','trim|required|numeric');					
					$this->form_validation->set_rules('buy_tp','Buy TP','trim|required|numeric');					
					$this->form_validation->set_rules('buy_sl','Buy SL','trim|required|numeric');					
					$this->form_validation->set_rules('sell_val','Sell Value','trim|required|numeric');					
					$this->form_validation->set_rules('sell_tp','Sell TP','trim|required|numeric');					
					$this->form_validation->set_rules('sell_sl','Sell SL','trim|required|numeric');					
					
					$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
					if($this->form_validation->run() == FALSE){
						// redirect('northbridge/account_created');
						foreach($_POST as $key => $value){
							$response_arr['messages'][$key] = form_error($key);
						}
					}else{
						$currency_pair = $this->input->post('currency_pair');
						$buy_val = $this->input->post('buy_val');
						$buy_tp = $this->input->post('buy_tp');
						$buy_sl = $this->input->post('buy_sl');
						$sell_val = $this->input->post('sell_val');
						$sell_tp = $this->input->post('sell_tp');
						$sell_sl = $this->input->post('sell_sl');


						$form_array = array(
							'currency_pair' => $currency_pair,
							'buy_val' => $buy_val,
							'buy_tp' => $buy_tp,
							'buy_sl' => $buy_sl,
							'sell_val' => $sell_val,
							'sell_tp' => $sell_tp,
							'sell_sl' => $sell_sl,
							'date' => $date,
							'time' => $time
						);


						if($this->northbridge_model->uploadNewSignal($form_array)){
							$response_arr['success'] = true;
						}
					}

					echo json_encode($response_arr);
				}
			}

			elseif($addition == "admin" && $second_addition == "upload_signals" && is_null($third_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
						$data['fund_exchange_rate'] = $user->fund_exchange_rate;
						$data['withdraw_exchange_rate'] = $user->withdraw_exchange_rate;
						
					}

					$data['rows'] = $this->northbridge_model->getSuperforexSignalsForTheDay();

					$this->load->view('includes/admin_header',$data);
					$this->load->view('pages/upload_signals',$data);
					$this->load->view('includes/admin_footer',$data);
				}
			}


			elseif($addition == "signal_page"){
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;

				if($this->northbridge_model->confirmLoggedIn()){
					$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
					$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
					$data['user_id'] = $user_id;
					
					if(is_array($user_info)){
						foreach($user_info as $user){
							$data['user_name'] = $user->user_name;
							$data['full_name'] = $user->full_name;
							$data['phone'] = $user->phone;
							$data['email'] = $user->email;
							$data['user_phone'] = $user->phone;
							$data['country_id'] = $user->country_id;
							$data['state_id'] = $user->state_id;
							$data['address'] = $user->address;
							$data['user_slug'] = $user->slug;
							$data['date'] = $user->date;
							$data['time'] = $user->time;
							$data['logo'] = $user->logo;
							$data['cover_photo'] = $user->cover_photo;
							$data['bio'] = $user->bio;
							$data['dob'] = $user->dob;
							$data['super_forex_account_number'] = $user->super_forex_account_number;
						}
					}
				}

				$data['rows'] = $this->northbridge_model->getSuperforexSignalsForTheDay();
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/signal_page',$data);
				
				$this->load->view('includes/home_footer',$data);
			}


			elseif($addition == "admin" && $second_addition == "view_sabi_academy_requests" && is_null($fourth_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}



					$get_vars = $_GET;
					$config['base_url'] = site_url('northbridge/index/admin/view_sabi_academy_requests');

					$config['total_rows'] = $this->northbridge_model->getSabiAcademyRequestsByPaginationNum($get_vars);
					$data['total_rows'] = $config['total_rows'];
					
	        		

	        		$config['per_page'] = 10;

					$config['reuse_query_string'] = TRUE;
					$config['use_page_numbers'] = TRUE;
					$config['next_link'] = 'Next';
					$config['first_link'] = 'First';
					$config['last_link'] = 'Last';
					$config['full_tag_open'] = "<ul class='pagination'>";
					$config['full_tag_close'] ="</ul>";
					$config['num_tag_open'] = '<li>';
					$config['num_tag_close'] = '</li>';
					$config['cur_tag_open'] = "<li class='disabled'><li class='active'><a href='#'>";
					$config['cur_tag_close'] = "<span class='sr-only'></span></a></li>";
					$config['next_tag_open'] = "<li>";
					$config['next_tagl_close'] = "</li>";
					$config['prev_tag_open'] = "<li>";
					$config['prev_tagl_close'] = "</li>";
					$config['first_tag_open'] = "<li>";
					$config['first_tagl_close'] = "</li>";
					$config['last_tag_open'] = "<li>";
					$config['last_tagl_close'] = "</li>";
					// $config['uri_segment'] = 2;

					// By clicking on performing PREVIOUS pagination.
					$config['prev_link'] = 'Previous';



					if(!is_null($third_addition)){
						$page = $third_addition;
					}else{
						$page = 1;
					}
					
					$page = $page - 1;


	        		
	        		$data['rows'] = $this->northbridge_model->getSabiAcademyRequestsByPagination($page,$get_vars);
	        		

					$this->pagination->initialize($config);

					$data['str_links'] = $this->pagination->create_links();

					
					
					$this->load->view('includes/admin_header',$data);
					
		            $this->load->view('pages/view_sabi_academy_requests',$data);
		            $this->load->view('includes/admin_footer',$data);	
				
				}	
			}


			elseif($addition == "admin" && $second_addition == "clear_sabi_academy_request" && is_null($third_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}

					$date = date("j M Y");
					$time = date("h:i:sa");

					// $exchange_rate = $this->northbridge_model->getFundingExchangeRate();

				
					$response_arr = array('success' => false,'messages' => "");
					if($this->input->post('id')){
						$id = $this->input->post('id');
						
						if($this->northbridge_model->clearSabiAcademyRequest($id)){
							$response_arr['success'] = true;
						}
					}
					
					echo json_encode($response_arr);
				}	
			}


			elseif($addition == "submit_request_for_sabi_academy" && is_null($second_addition) ){
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;

				if($this->northbridge_model->confirmLoggedIn()){
					$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
					$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
					$data['user_id'] = $user_id;
					
					if(is_array($user_info)){
						foreach($user_info as $user){
							$data['user_name'] = $user->user_name;
							$data['full_name'] = $user->full_name;
							$data['phone'] = $user->phone;
							$data['email'] = $user->email;
							$data['user_phone'] = $user->phone;
							$data['country_id'] = $user->country_id;
							$data['state_id'] = $user->state_id;
							$data['address'] = $user->address;
							$data['user_slug'] = $user->slug;
							$data['date'] = $user->date;
							$data['time'] = $user->time;
							$data['logo'] = $user->logo;
							$data['cover_photo'] = $user->cover_photo;
							$data['bio'] = $user->bio;
							$data['dob'] = $user->dob;
						}
					}
				}

				$date = date("j M Y");
				$time = date("h:i:sa");


			
				$response_arr = array('success' => false,'messages' => "");

				
				$this->form_validation->set_rules('full_name','Full Name','trim|required|min_length[5]|max_length[100]');
				$this->form_validation->set_rules('super_forex_account_number','SuperForex Account Number','trim|required|max_length[50]');						
											
				$this->form_validation->set_rules('phone','Phone Number','trim|required|numeric|max_length[20]');						
				
				
				$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
				if($this->form_validation->run() == FALSE){
					// redirect('northbridge/account_created');
					foreach($_POST as $key => $value){
						$response_arr['messages'][$key] = form_error($key);
					}
				}else{
					
					
					$full_name = $this->input->post('full_name');
					$super_forex_account_number = $this->input->post('super_forex_account_number');
					$phone = $this->input->post('phone');
					
					
				
					$form_array = array(
						'date_time' => $date . " ". $time, 
						'full_name' => $full_name,
						'super_forex_account_number' => $super_forex_account_number,
						'phone' => $phone
						
					);
					if($this->northbridge_model->addRequestForSabiAcademy($form_array)){

						$response_arr['success'] = true;
					}
						
				}
					
				echo json_encode($response_arr);
					
			}

			elseif($addition == "sabi_academy"){
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;

				if($this->northbridge_model->confirmLoggedIn()){
					$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
					$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
					$data['user_id'] = $user_id;
					
					if(is_array($user_info)){
						foreach($user_info as $user){
							$data['user_name'] = $user->user_name;
							$data['full_name'] = $user->full_name;
							$data['phone'] = $user->phone;
							$data['email'] = $user->email;
							$data['user_phone'] = $user->phone;
							$data['country_id'] = $user->country_id;
							$data['state_id'] = $user->state_id;
							$data['address'] = $user->address;
							$data['user_slug'] = $user->slug;
							$data['date'] = $user->date;
							$data['time'] = $user->time;
							$data['logo'] = $user->logo;
							$data['cover_photo'] = $user->cover_photo;
							$data['bio'] = $user->bio;
							$data['dob'] = $user->dob;
							$data['super_forex_account_number'] = $user->super_forex_account_number;
						}
					}
				}
				$this->load->view('includes/home_header',$data);
				
				$this->load->view('pages/sabi_academy',$data);
				
				$this->load->view('includes/home_footer',$data);
			}



			elseif($addition == "view_your_declined_superforex_withdrawal_requests" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}

					$date = date("j M Y");
					$time = date("h:i:sa");

					// $exchange_rate = $this->northbridge_model->getFundingExchangeRate();

				
					$response_arr = array('success' => true,'messages' => "");

					$pending_withdrawal_requests = $this->northbridge_model->getAllDeclinedSuperforexWithdrawalRequestsForUser($user_id);

					if(is_array($pending_withdrawal_requests)){
						$i = 0;

						$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="margin-top: 40px;">';
		        		$response_arr['messages'] .= '<table class="table table-striped table-bordered wrap hover display" id="view-declined-withdrawal-requests-table" cellspacing="0" width="100%" style="width:100%">';
		        		$response_arr['messages'] .= '<thead>';
		        		$response_arr['messages'] .= '<tr>';
		        		$response_arr['messages'] .= '<th>#</th>';
		        		$response_arr['messages'] .= '<th>Full Name</th>';
		        		$response_arr['messages'] .= '<th>Amount</th>';
		        		$response_arr['messages'] .= '<th>Exchange Rate</th>';
		        		$response_arr['messages'] .= '<th>SuperForex Acct. Number</th>';
		        		
		        		$response_arr['messages'] .= '<th>Declined Date / Time</th>';
		        		$response_arr['messages'] .= '<th>Reason</th>';
		        		$response_arr['messages'] .= '<th>Actions</th>';
		        		$response_arr['messages'] .= '</tr>';
		        		$response_arr['messages'] .= '<tbody>';

		        		foreach($pending_withdrawal_requests as $row){
		        			$i++;
		        			$id = $row->id;
		        			$user_id = $row->user_id;
		        			$full_name = $row->full_name;
		        			$amount = $row->amount;
		        			$exchange_rate = $row->exchange_rate;
		        			// $payment_proof = $row->payment_proof;
		        			$super_forex_account_number = $row->super_forex_account_number;
		        			$date_time = $row->date . " " . $row->time;
		        			$user_name = $this->northbridge_model->getUserNameById($user_id);
		        			$declined_date_time = $row->declined_date_time;
		        			$reason = $row->reason;

		        			$response_arr['messages'] .= '<tr data-full-name="'.$full_name.'">';

		        			$response_arr['messages'] .= '<td>'.$i.'</td>';
		        			$response_arr['messages'] .= '<td style="text-transform: capitalize;">'.$full_name.'</td>';
		        			$response_arr['messages'] .= '<td>$'.number_format($amount,2).'</td>';
		        			$response_arr['messages'] .= '<td>₦'.number_format($exchange_rate,2).'</td>';
		        			$response_arr['messages'] .= '<td><em class="text-primary">'.$super_forex_account_number.'</em></td>';
		        			// $response_arr['messages'] .= '<td><em class="text-primary">'.$user_name.'</em></td>';
		        			$response_arr['messages'] .= '<td>'.$declined_date_time.'</td>';
		        			$response_arr['messages'] .= '<td>'.$reason.'</td>';
		        			$response_arr['messages'] .= '<td class="td-actions text-center">';
		                   	$response_arr['messages'] .= '<button onclick="viewPaymentDetailsOfWithdrawalRequest(this,event,'.$id.')" type="button" rel="tooltip" title="View Payment Details" class="btn btn-success btn-link">';
		                   	$response_arr['messages'] .= '<i style="color: #fff;" class="fas fa-info-circle"></i>';
		                    $response_arr['messages'] .= '<div class="ripple-container"></div>';
		                    $response_arr['messages'] .= '</button>';
		                    $response_arr['messages'] .= '</td>';


		        			$response_arr['messages'] .= '</tr>';
		        		}
		        		$response_arr['messages'] .= '</tbody>';
		        		$response_arr['messages'] .= '</table>';
		        		$response_arr['messages'] .= '</div>';
					}else{
						$response_arr['messages'] .= '<h4 class="text-warning">No Data To Display.</h4>';
					}
					
					echo json_encode($response_arr);
				}	
			}


			elseif($addition == "view_your_approved_superforex_withdrawal_requests" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}

					$date = date("j M Y");
					$time = date("h:i:sa");

					// $exchange_rate = $this->northbridge_model->getFundingExchangeRate();

				
					$response_arr = array('success' => true,'messages' => "");

					$pending_withdrawal_requests = $this->northbridge_model->getAllApprovedSuperforexWithdrawalRequestsForUser($user_id);

					if(is_array($pending_withdrawal_requests)){
						$i = 0;

						$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="margin-top: 40px;">';
		        		$response_arr['messages'] .= '<table class="table table-striped table-bordered wrap hover display" id="view-approved-withdrawal-requests-table" cellspacing="0" width="100%" style="width:100%">';
		        		$response_arr['messages'] .= '<thead>';
		        		$response_arr['messages'] .= '<tr>';
		        		$response_arr['messages'] .= '<th>#</th>';
		        		$response_arr['messages'] .= '<th>Full Name</th>';
		        		$response_arr['messages'] .= '<th>Amount</th>';
		        		$response_arr['messages'] .= '<th>Exchange Rate</th>';
		        		$response_arr['messages'] .= '<th>SuperForex Acct. Number</th>';
		        		
		        		$response_arr['messages'] .= '<th>Approved Date / Time</th>';
		        		$response_arr['messages'] .= '<th>Actions</th>';
		        		$response_arr['messages'] .= '</tr>';
		        		$response_arr['messages'] .= '<tbody>';

		        		foreach($pending_withdrawal_requests as $row){
		        			$i++;
		        			$id = $row->id;
		        			$user_id = $row->user_id;
		        			$full_name = $row->full_name;
		        			$amount = $row->amount;
		        			$exchange_rate = $row->exchange_rate;
		        			// $payment_proof = $row->payment_proof;
		        			$super_forex_account_number = $row->super_forex_account_number;
		        			$date_time = $row->date . " " . $row->time;
		        			$user_name = $this->northbridge_model->getUserNameById($user_id);
		        			$approved_date_time = $row->approved_date_time;

		        			$response_arr['messages'] .= '<tr data-full-name="'.$full_name.'">';

		        			$response_arr['messages'] .= '<td>'.$i.'</td>';
		        			$response_arr['messages'] .= '<td style="text-transform: capitalize;">'.$full_name.'</td>';
		        			$response_arr['messages'] .= '<td>$'.number_format($amount,2).'</td>';
		        			$response_arr['messages'] .= '<td>₦'.number_format($exchange_rate,2).'</td>';
		        			$response_arr['messages'] .= '<td><em class="text-primary">'.$super_forex_account_number.'</em></td>';
		        			// $response_arr['messages'] .= '<td><em class="text-primary">'.$user_name.'</em></td>';
		        			$response_arr['messages'] .= '<td>'.$approved_date_time.'</td>';
		        			$response_arr['messages'] .= '<td class="td-actions text-center">';
		                   	$response_arr['messages'] .= '<button onclick="viewPaymentDetailsOfWithdrawalRequest(this,event,'.$id.')" type="button" rel="tooltip" title="View Payment Details" class="btn btn-success btn-link">';
		                   	$response_arr['messages'] .= '<i style="color: #fff;" class="fas fa-info-circle"></i>';
		                    $response_arr['messages'] .= '<div class="ripple-container"></div>';
		                    $response_arr['messages'] .= '</button>';
		                    $response_arr['messages'] .= '</td>';


		        			$response_arr['messages'] .= '</tr>';
		        		}
		        		$response_arr['messages'] .= '</tbody>';
		        		$response_arr['messages'] .= '</table>';
		        		$response_arr['messages'] .= '</div>';
					}else{
						$response_arr['messages'] .= '<h4 class="text-warning">No Data To Display.</h4>';
					}
					
					echo json_encode($response_arr);
				}	
			}


			elseif($addition == "view_payment_details_of_your_withdrawal_request" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}

					$date = date("j M Y");
					$time = date("h:i:sa");

					// $exchange_rate = $this->northbridge_model->getFundingExchangeRate();

				
					$response_arr = array('success' => false,'messages' => "");

					
					if($this->input->post('show_records') && $this->input->post('id')){
						$id = $this->input->post('id');
						if($this->northbridge_model->checkIfSuperForexWithdrawalRequestIdIsValidForUser($id,$user_id)){
							
							$approved = $this->northbridge_model->getSuperForexWithdrawalRequestParamById("approved",$id);
							$declined = $this->northbridge_model->getSuperForexWithdrawalRequestParamById("declined",$id);
							
							
							$pending_withdrawal_request_info = $this->northbridge_model->getPendingSuperforexWithdrawalRequestInfoById($id);

							$banks_arr = $this->paystack->curl("https://api.paystack.co/bank",FALSE);
			                $banks_arr = json_decode($banks_arr);

							if($banks_arr->status && $banks_arr->message == "Banks retrieved"){

								if(is_array($pending_withdrawal_request_info)){
									$response_arr['success'] = true;
									
									foreach($pending_withdrawal_request_info as $row){
					        			
					        			$id = $row->id;
					        			$user_id = $row->user_id;
					        			$full_name = $row->full_name;
					        			$amount = $row->amount;
					        			$exchange_rate = $row->exchange_rate;
					        			$user_bank_name = $row->bank_name;
					        			$account_number = $row->account_number;
					        			$super_forex_account_number = $row->super_forex_account_number;
					        			$date_time = $row->date . " " . $row->time;
					        			$user_name = $this->northbridge_model->getUserNameById($user_id);
					        			$approved_date_time = $row->approved_date_time;
					        			$declined_date_time = $row->declined_date_time;
					        			$reason = $row->reason;

					        			$amount_due = $amount * $exchange_rate;





				                        $bank_names = $banks_arr->data;


				                        foreach($bank_names as $row){
			                                $bank_name = $row->name;
			                                $code = $row->code;
			                                $long_code = $row->longcode;
			                                $active = $row->active;
			                                $is_deleted = $row->is_deleted;
			                                
				                        
				                        	
				                        	if($code == $user_bank_name){ 

				                        		$account_number_test = $this->paystack->curl("https://api.paystack.co/bank/resolve?account_number=".$account_number."&bank_code=".$user_bank_name,FALSE);

												$account_number_test = json_decode($account_number_test);
												if(is_object($account_number_test)){
													// echo "string";
													if($account_number_test->status == "true"){
														$response_arr['success'] = true;
								
														$account_name = $account_number_test->data->account_name;
				                        		
									        			$response_arr['messages'] .= '<div class="row">';


									        			$response_arr['messages'] .= '<h5 class="col-6">Bank Name: </h5>';
									        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">'.$bank_name.'</em></h5>';

									        			$response_arr['messages'] .= '<h5 class="col-6">Account Number: </h5>';
									        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">'.$account_number.'</em></h5>';

									        			$response_arr['messages'] .= '<h5 class="col-6">Account Name: </h5>';
									        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">'.$account_name.'</em></h5>';


									        			$response_arr['messages'] .= '</div>';

									        			
									        		}
									        	}
							        		}
							        	}
					        		}
									
								}
							}
							
						}
					}
					
					
					echo json_encode($response_arr);
				}	
			}

			elseif($addition == "view_your_pending_superforex_withdrawal_requests" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}

					$date = date("j M Y");
					$time = date("h:i:sa");

					// $exchange_rate = $this->northbridge_model->getFundingExchangeRate();

				
					$response_arr = array('success' => true,'messages' => "");

					$pending_withdrawal_requests = $this->northbridge_model->getAllPendingSuperforexWithdrawalsRequestsForUser($user_id);

					if(is_array($pending_withdrawal_requests)){
						$i = 0;

						$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="margin-top: 40px;">';
		        		$response_arr['messages'] .= '<table class="table table-striped table-bordered wrap hover display" id="view-pending-withdrawal-requests-table" cellspacing="0" width="100%" style="width:100%">';
		        		$response_arr['messages'] .= '<thead>';
		        		$response_arr['messages'] .= '<tr>';
		        		$response_arr['messages'] .= '<th>#</th>';
		        		$response_arr['messages'] .= '<th>Full Name</th>';
		        		$response_arr['messages'] .= '<th>Amount</th>';
		        		$response_arr['messages'] .= '<th>Exchange Rate</th>';
		        		$response_arr['messages'] .= '<th>SuperForex Acct. Number</th>';
		        		
		        		$response_arr['messages'] .= '<th>Date / Time</th>';
		        		$response_arr['messages'] .= '<th>Actions</th>';
		        		$response_arr['messages'] .= '</tr>';
		        		$response_arr['messages'] .= '<tbody>';

		        		foreach($pending_withdrawal_requests as $row){
		        			$i++;
		        			$id = $row->id;
		        			$user_id = $row->user_id;
		        			$full_name = $row->full_name;
		        			$amount = $row->amount;
		        			$exchange_rate = $row->exchange_rate;
		        			// $payment_proof = $row->payment_proof;
		        			$super_forex_account_number = $row->super_forex_account_number;
		        			$date_time = $row->date . " " . $row->time;
		        			$user_name = $this->northbridge_model->getUserNameById($user_id);


		        			$response_arr['messages'] .= '<tr data-full-name="'.$full_name.'">';

		        			$response_arr['messages'] .= '<td>'.$i.'</td>';
		        			$response_arr['messages'] .= '<td style="text-transform: capitalize;">'.$full_name.'</td>';
		        			$response_arr['messages'] .= '<td>$'.number_format($amount,2).'</td>';
		        			$response_arr['messages'] .= '<td>₦'.number_format($exchange_rate,2).'</td>';
		        			$response_arr['messages'] .= '<td><em class="text-primary">'.$super_forex_account_number.'</em></td>';
		        			// $response_arr['messages'] .= '<td><em class="text-primary">'.$user_name.'</em></td>';
		        			$response_arr['messages'] .= '<td>'.$date_time.'</td>';
		        			$response_arr['messages'] .= '<td class="td-actions text-center">';
		                   	$response_arr['messages'] .= '<button onclick="viewPaymentDetailsOfWithdrawalRequest(this,event,'.$id.')" type="button" rel="tooltip" title="View Payment Details" class="btn btn-success btn-link">';
		                   	$response_arr['messages'] .= '<i style="color: #fff;" class="fas fa-info-circle"></i>';
		                    $response_arr['messages'] .= '<div class="ripple-container"></div>';
		                    $response_arr['messages'] .= '</button>';
		                    $response_arr['messages'] .= '</td>';

		        			$response_arr['messages'] .= '</tr>';
		        		}
		        		$response_arr['messages'] .= '</tbody>';
		        		$response_arr['messages'] .= '</table>';
		        		$response_arr['messages'] .= '</div>';
					}else{
						$response_arr['messages'] .= '<h4 class="text-warning">No Data To Display.</h4>';
					}
					
					echo json_encode($response_arr);
				}	
			}

			elseif($addition == "admin" && $second_addition == "view_more_info_on_superforex_deposit_request_history" && is_null($third_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}

					$date = date("j M Y");
					$time = date("h:i:sa");

					// $exchange_rate = $this->northbridge_model->getFundingExchangeRate();

				
					$response_arr = array('success' => false,'messages' => "", 'action_already_taken' => true,'invalid_id' => true);
					if($this->input->post('show_records') && $this->input->post('id')){
						$id = $this->input->post('id');
						if($this->northbridge_model->checkIfSuperForexDepositRequestIdIsValid($id)){
							$response_arr['invalid_id'] = false;
							$approved = $this->northbridge_model->getSuperForexDepositRequestParamById("approved",$id);
							$declined = $this->northbridge_model->getSuperForexDepositRequestParamById("declined",$id);
							
							$response_arr['action_already_taken'] = false;
							$pending_deposit_request_info = $this->northbridge_model->getPendingSuperforexDepositRequestInfoById($id);

							if(is_array($pending_deposit_request_info)){
								$response_arr['success'] = true;
								
								foreach($pending_deposit_request_info as $row){
				        			
				        			$id = $row->id;
				        			$user_id = $row->user_id;
				        			$full_name = $row->full_name;
				        			$amount = $row->amount;
				        			$exchange_rate = $row->exchange_rate;
				        			$payment_proof = $row->payment_proof;
				        			$super_forex_account_number = $row->super_forex_account_number;
				        			$date_time = $row->date . " " . $row->time;
				        			$approved_date_time = $row->approved_date_time;
				        			$declined_date_time = $row->declined_date_time;
				        			$reason = $row->reason;

				        			$user_name = $this->northbridge_model->getUserNameById($user_id);

				        			$amount_due = $amount * $exchange_rate;


				        			$response_arr['messages'] .= '<div class="row">';

				        			

				        			$response_arr['messages'] .= '<h5 class="col-6">Full Name: </h5>';
				        			$response_arr['messages'] .= '<h5 class="col-6" style="text-transform: capitalize;"><em class="text-primary">'.$full_name.'</em></h5>';

				        			$response_arr['messages'] .= '<h5 class="col-6">Amount: </h5>';
				        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">$'.number_format($amount,2).'</em></h5>';


				        			$response_arr['messages'] .= '<h5 class="col-6">Exchange Rate: </h5>';
				        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">₦'.number_format($exchange_rate,2).'</em></h5>';

				        			$response_arr['messages'] .= '<h5 class="col-6">Amount Due: </h5>';
				        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">₦'.number_format($amount_due,2).'</em></h5>';

				        			$response_arr['messages'] .= '<h5 class="col-6">SuperForex Acct. Number: </h5>';
				        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">'.$super_forex_account_number.'</em></h5>';

				        			$response_arr['messages'] .= '<h5 class="col-6">Requested By User: </h5>';
				        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">'.$user_name.'</em></h5>';

				        			$response_arr['messages'] .= '<h5 class="col-6">Date / Time Of Request: </h5>';
				        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">'.$date_time.'</em></h5>';

				        			$response_arr['messages'] .= '<h5 class="col-12">Payment Proof: </h5>';
				        			$response_arr['messages'] .= '<img class="col-12" src="'.base_url('assets/images/'.$payment_proof).'">';


				        			$response_arr['messages'] .= '</div>';

				        			if($approved == 0 && $declined == 0){

					        			$response_arr['messages'] .= '<h4 style="margin-bottom: 60px; margin-top: 20px;">Choose Action: </h4>';

					        			$response_arr['messages'] .= '<button class="btn btn-success" onclick="approveRequest(this,event,'.$id.')">Approve Request </button>';

					        			$response_arr['messages'] .= '<button data-full-name="'.$full_name.'" class="btn btn-danger" onclick="declineRequest(this,event,'.$id.')">Decline Request</button>';
					        		}else if($approved == 1 && $declined == 0){
					        			$response_arr['messages'] .= '<h5 class="col-6">Approved Date/Time: </h5>';
				        				$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">'.$approved_date_time.'</em></h5>';
					        		}else if($approved == 0 && $declined == 1){
					        			$response_arr['messages'] .= '<h5 class="col-6">Declined Date/Time: </h5>';
				        				$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">'.$declined_date_time.'</em></h5>';

				        				$response_arr['messages'] .= '<h5 class="col-6">Reason: </h5>';
				        				$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">'.$reason.'</em></h5>';
					        		}
				        		}

								
							}
							
						}
					}
					
					echo json_encode($response_arr);
				}	
			}

			elseif($addition == "admin" && $second_addition == "view_more_info_on_superforex_withdrawal_request_history" && is_null($third_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}

					$date = date("j M Y");
					$time = date("h:i:sa");

					// $exchange_rate = $this->northbridge_model->getFundingExchangeRate();

				
					$response_arr = array('success' => false,'messages' => "",'invalid_id' => true);
					if($this->input->post('show_records') && $this->input->post('id')){
						$id = $this->input->post('id');
						if($this->northbridge_model->checkIfSuperForexWithdrawalRequestIdIsValid($id)){
							$response_arr['invalid_id'] = false;
							$approved = $this->northbridge_model->getSuperForexWithdrawalRequestParamById("approved",$id);
							$declined = $this->northbridge_model->getSuperForexWithdrawalRequestParamById("declined",$id);
							
							$response_arr['action_already_taken'] = false;
							$pending_withdrawal_request_info = $this->northbridge_model->getPendingSuperforexWithdrawalRequestInfoById($id);

							$banks_arr = $this->paystack->curl("https://api.paystack.co/bank",FALSE);
			                $banks_arr = json_decode($banks_arr);

							if($banks_arr->status && $banks_arr->message == "Banks retrieved"){

								if(is_array($pending_withdrawal_request_info)){
									$response_arr['success'] = true;
									
									foreach($pending_withdrawal_request_info as $row){
					        			
					        			$id = $row->id;
					        			$user_id = $row->user_id;
					        			$full_name = $row->full_name;
					        			$amount = $row->amount;
					        			$exchange_rate = $row->exchange_rate;
					        			$user_bank_name = $row->bank_name;
					        			$account_number = $row->account_number;
					        			$super_forex_account_number = $row->super_forex_account_number;
					        			$phone_password = $row->phone_password;
					        			$date_time = $row->date . " " . $row->time;
					        			$user_name = $this->northbridge_model->getUserNameById($user_id);
					        			$approved_date_time = $row->approved_date_time;
					        			$declined_date_time = $row->declined_date_time;

					        			$reason = $row->reason;

					        			$amount_due = $amount * $exchange_rate;





				                        $bank_names = $banks_arr->data;


				                        foreach($bank_names as $row){
			                                $bank_name = $row->name;
			                                $code = $row->code;
			                                $long_code = $row->longcode;
			                                $active = $row->active;
			                                $is_deleted = $row->is_deleted;
			                                
				                        
				                        	
				                        	if($code == $user_bank_name){ 

				                        		$account_number_test = $this->paystack->curl("https://api.paystack.co/bank/resolve?account_number=".$account_number."&bank_code=".$user_bank_name,FALSE);

												$account_number_test = json_decode($account_number_test);
												if(is_object($account_number_test)){
													// echo "string";
													if($account_number_test->status == "true"){
														$response_arr['success'] = true;
								
														$account_name = $account_number_test->data->account_name;
				                        		
									        			$response_arr['messages'] .= '<div class="row">';

									        			

									        			$response_arr['messages'] .= '<h5 class="col-6">Full Name: </h5>';
									        			$response_arr['messages'] .= '<h5 class="col-6" style="text-transform: capitalize;"><em class="text-primary">'.$full_name.'</em></h5>';

									        			$response_arr['messages'] .= '<h5 class="col-6">Amount: </h5>';
									        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">$'.number_format($amount,2).'</em></h5>';


									        			$response_arr['messages'] .= '<h5 class="col-6">Exchange Rate: </h5>';
									        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">₦'.number_format($exchange_rate,2).'</em></h5>';

									        			$response_arr['messages'] .= '<h5 class="col-6">Amount Due: </h5>';
									        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">₦'.number_format($amount_due,2).'</em></h5>';

									        			$response_arr['messages'] .= '<h5 class="col-6">SuperForex Acct. Number: </h5>';
									        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">'.$super_forex_account_number.'</em></h5>';


									        			$response_arr['messages'] .= '<h5 class="col-6">Phone Password: </h5>';
									        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">'.$phone_password.'</em></h5>';


									        			$response_arr['messages'] .= '<h5 class="col-6">Requested By User: </h5>';
									        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">'.$user_name.'</em></h5>';

									        			$response_arr['messages'] .= '<h5 class="col-6">Date / Time Of Request: </h5>';
									        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">'.$date_time.'</em></h5>';

									        			$response_arr['messages'] .= '<h4 class="col-12 text-center" style="margin-top: 30px; margin-bottom: 20px;">Payment Details: </h4>';

									        			$response_arr['messages'] .= '<h5 class="col-6">Bank Name: </h5>';
									        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">'.$bank_name.'</em></h5>';

									        			$response_arr['messages'] .= '<h5 class="col-6">Account Number: </h5>';
									        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">'.$account_number.'</em></h5>';

									        			$response_arr['messages'] .= '<h5 class="col-6">Account Name: </h5>';
									        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">'.$account_name.'</em></h5>';


									        			$response_arr['messages'] .= '</div>';

									        			if($approved == 0 && $declined == 0){

										        			$response_arr['messages'] .= '<h4 style="margin-bottom: 60px; margin-top: 20px;">Choose Action: </h4>';

										        			$response_arr['messages'] .= '<button class="btn btn-success" onclick="approveWithdrawalRequest(this,event,'.$id.')">Approve Request </button>';

										        			$response_arr['messages'] .= '<button data-full-name="'.$full_name.'" class="btn btn-danger" onclick="declineRequestWithdrawal(this,event,'.$id.')">Decline Request</button>';
										        		}else if($approved == 1 && $declined == 0){
										        			$response_arr['messages'] .= '<h5 class="col-6">Approved Date/Time: </h5>';
									        				$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">'.$approved_date_time.'</em></h5>';
										        		}else if($approved == 0 && $declined == 1){
										        			$response_arr['messages'] .= '<h5 class="col-6">Declined Date/Time: </h5>';
									        				$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">'.$declined_date_time.'</em></h5>';

									        				$response_arr['messages'] .= '<h5 class="col-6">Reason: </h5>';
									        				$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">'.$reason.'</em></h5>';
										        		}
									        		}
									        	}
							        		}
							        	}
					        		}
									
								}
							}
							
						}
					}
					
					echo json_encode($response_arr);
				}	
			}

			elseif($addition == "admin" && $second_addition == "view_account_withdrawal_history" && is_null($fourth_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}



					$get_vars = $_GET;
					$config['base_url'] = site_url('northbridge/index/admin/view_account_withdrawal_history');

					$config['total_rows'] = $this->northbridge_model->getWithdrawalHistoryForByPaginationNum($get_vars);
					$data['total_rows'] = $config['total_rows'];
					
	        		

	        		$config['per_page'] = 10;

					$config['reuse_query_string'] = TRUE;
					$config['use_page_numbers'] = TRUE;
					$config['next_link'] = 'Next';
					$config['first_link'] = 'First';
					$config['last_link'] = 'Last';
					$config['full_tag_open'] = "<ul class='pagination'>";
					$config['full_tag_close'] ="</ul>";
					$config['num_tag_open'] = '<li>';
					$config['num_tag_close'] = '</li>';
					$config['cur_tag_open'] = "<li class='disabled'><li class='active'><a href='#'>";
					$config['cur_tag_close'] = "<span class='sr-only'></span></a></li>";
					$config['next_tag_open'] = "<li>";
					$config['next_tagl_close'] = "</li>";
					$config['prev_tag_open'] = "<li>";
					$config['prev_tagl_close'] = "</li>";
					$config['first_tag_open'] = "<li>";
					$config['first_tagl_close'] = "</li>";
					$config['last_tag_open'] = "<li>";
					$config['last_tagl_close'] = "</li>";
					// $config['uri_segment'] = 2;

					// By clicking on performing PREVIOUS pagination.
					$config['prev_link'] = 'Previous';



					if(!is_null($third_addition)){
						$page = $third_addition;
					}else{
						$page = 1;
					}
					
					$page = $page - 1;


	        		
	        		$data['rows'] = $this->northbridge_model->getWithdrawalHistoryForByPagination($page,$get_vars);
	        		

					$this->pagination->initialize($config);

					$data['str_links'] = $this->pagination->create_links();

					
					
					$this->load->view('includes/admin_header',$data);
					
		            $this->load->view('pages/view_account_withdrawal_history',$data);
		            $this->load->view('includes/admin_footer',$data);	
				
				}	
			}




			elseif($addition == "admin" && $second_addition == "decline_superforex_withdrawal_request" && is_null($third_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}

					$date = date("j M Y");
					$time = date("h:i:sa");

					// $exchange_rate = $this->northbridge_model->getFundingExchangeRate();

				
					$response_arr = array('success' => false,'messages' => "", 'action_already_taken' => true,'invalid_id' => true);
					if($this->input->post('id')){
						$id = $this->input->post('id');
						if($this->northbridge_model->checkIfSuperForexWithdrawalRequestIdIsValid($id)){
							$response_arr['invalid_id'] = false;
							$approved = $this->northbridge_model->getSuperForexWithdrawalRequestParamById("approved",$id);
							$declined = $this->northbridge_model->getSuperForexWithdrawalRequestParamById("declined",$id);
							if($approved == 0 && $declined == 0){
								$response_arr['action_already_taken'] = false;
								$pending_withdrawal_request_info = $this->northbridge_model->getPendingSuperforexWithdrawalRequestInfoById($id);

								if(is_array($pending_withdrawal_request_info)){
									
									
									foreach($pending_withdrawal_request_info as $row){
					        			
					        			$id = $row->id;
					        			$user_id = $row->user_id;
					        			$full_name = $row->full_name;
					        			$amount = $row->amount;
					        			$exchange_rate = $row->exchange_rate;
					        			// $payment_proof = $row->payment_proof;
					        			$super_forex_account_number = $row->super_forex_account_number;
					        			$date_time = $row->date . " " . $row->time;
					        			$user_name = $this->northbridge_model->getUserNameById($user_id);

					        			$amount_due = $amount * $exchange_rate;

					        			$this->form_validation->set_rules('reason','Reason','trim|required');						
									
									
										$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
										if($this->form_validation->run() == FALSE){
											// redirect('northbridge/account_created');
											foreach($_POST as $key => $value){
												$response_arr['messages'][$key] = form_error($key);
											}
										}else{
											
											
											$reason = $this->input->post('reason');

											if($this->northbridge_model->declineSuperforexWithdrawalRequest($reason,$id,$user_id,$date,$time)){
												$response_arr['success'] = true;
											}
						        			
						        		}
						        	}
									
								}
							}
						}
					}
					
					echo json_encode($response_arr);
				}	
			}

			elseif($addition == "admin" && $second_addition == "approve_withdrawal_superforex_fund_request" && is_null($third_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}

					$date = date("j M Y");
					$time = date("h:i:sa");

					// $exchange_rate = $this->northbridge_model->getFundingExchangeRate();

				
					$response_arr = array('success' => false,'messages' => "", 'action_already_taken' => true,'invalid_id' => true);
					if($this->input->post('id')){
						$id = $this->input->post('id');
						if($this->northbridge_model->checkIfSuperForexWithdrawalRequestIdIsValid($id)){
							$response_arr['invalid_id'] = false;
							$approved = $this->northbridge_model->getSuperForexWithdrawalRequestParamById("approved",$id);
							$declined = $this->northbridge_model->getSuperForexWithdrawalRequestParamById("declined",$id);
							if($approved == 0 && $declined == 0){
								$response_arr['action_already_taken'] = false;
								$pending_withdrawal_request_info = $this->northbridge_model->getPendingSuperforexWithdrawalRequestInfoById($id);

								if(is_array($pending_withdrawal_request_info)){
									
									
									foreach($pending_withdrawal_request_info as $row){
					        			
					        			$id = $row->id;
					        			$user_id = $row->user_id;
					        			$full_name = $row->full_name;
					        			$amount = $row->amount;
					        			$exchange_rate = $row->exchange_rate;
					        			
					        			$super_forex_account_number = $row->super_forex_account_number;
					        			$date_time = $row->date . " " . $row->time;
					        			$user_name = $this->northbridge_model->getUserNameById($user_id);

					        			$amount_due = $amount * $exchange_rate;


										if($this->northbridge_model->approveSuperforexWithdrawalRequest($id,$user_id,$date,$time)){
											$response_arr['success'] = true;
										}
						        			
						        		
						        	}
									
								}
							}
						}
					}
					
					echo json_encode($response_arr);
				}	
			}


			elseif($addition == "admin" && $second_addition == "view_more_info_on_superforex_pending_withdrawal_request" && is_null($third_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}

					$date = date("j M Y");
					$time = date("h:i:sa");

					// $exchange_rate = $this->northbridge_model->getFundingExchangeRate();

				
					$response_arr = array('success' => false,'messages' => "", 'action_already_taken' => true,'invalid_id' => true);
					if($this->input->post('show_records') && $this->input->post('id')){
						$id = $this->input->post('id');
						if($this->northbridge_model->checkIfSuperForexWithdrawalRequestIdIsValid($id)){
							$response_arr['invalid_id'] = false;
							$approved = $this->northbridge_model->getSuperForexWithdrawalRequestParamById("approved",$id);
							$declined = $this->northbridge_model->getSuperForexWithdrawalRequestParamById("declined",$id);
							if($approved == 0 && $declined == 0){
								$response_arr['action_already_taken'] = false;
								$pending_withdrawal_request_info = $this->northbridge_model->getPendingSuperforexWithdrawalRequestInfoById($id);

								$banks_arr = $this->paystack->curl("https://api.paystack.co/bank",FALSE);
				                $banks_arr = json_decode($banks_arr);

								if($banks_arr->status && $banks_arr->message == "Banks retrieved"){

									if(is_array($pending_withdrawal_request_info)){
										$response_arr['success'] = true;
										
										foreach($pending_withdrawal_request_info as $row){
						        			
						        			$id = $row->id;
						        			$user_id = $row->user_id;
						        			$full_name = $row->full_name;
						        			$amount = $row->amount;
						        			$exchange_rate = $row->exchange_rate;
						        			$user_bank_name = $row->bank_name;
						        			$account_number = $row->account_number;
						        			$phone_password = $row->phone_password;
						        			$super_forex_account_number = $row->super_forex_account_number;
						        			$date_time = $row->date . " " . $row->time;
						        			$user_name = $this->northbridge_model->getUserNameById($user_id);

						        			$amount_due = $amount * $exchange_rate;





					                        $bank_names = $banks_arr->data;


					                        foreach($bank_names as $row){
				                                $bank_name = $row->name;
				                                $code = $row->code;
				                                $long_code = $row->longcode;
				                                $active = $row->active;
				                                $is_deleted = $row->is_deleted;
				                                
					                        
					                        	
					                        	if($code == $user_bank_name){ 

					                        		$account_number_test = $this->paystack->curl("https://api.paystack.co/bank/resolve?account_number=".$account_number."&bank_code=".$user_bank_name,FALSE);

													$account_number_test = json_decode($account_number_test);
													if(is_object($account_number_test)){
														// echo "string";
														if($account_number_test->status == "true"){
															$response_arr['success'] = true;
									
															$account_name = $account_number_test->data->account_name;
					                        		
										        			$response_arr['messages'] .= '<div class="row">';

										        			

										        			$response_arr['messages'] .= '<h5 class="col-6">Full Name: </h5>';
										        			$response_arr['messages'] .= '<h5 class="col-6" style="text-transform: capitalize;"><em class="text-primary">'.$full_name.'</em></h5>';

										        			$response_arr['messages'] .= '<h5 class="col-6">Amount: </h5>';
										        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">$'.number_format($amount,2).'</em></h5>';


										        			$response_arr['messages'] .= '<h5 class="col-6">Exchange Rate: </h5>';
										        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">₦'.number_format($exchange_rate,2).'</em></h5>';

										        			$response_arr['messages'] .= '<h5 class="col-6">Amount Due: </h5>';
										        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">₦'.number_format($amount_due,2).'</em></h5>';

										        			$response_arr['messages'] .= '<h5 class="col-6">SuperForex Acct. Number: </h5>';
										        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">'.$super_forex_account_number.'</em></h5>';


										        			$response_arr['messages'] .= '<h5 class="col-6">Phone Password</h5>';
										        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">'.$phone_password.'</em></h5>';


										        			$response_arr['messages'] .= '<h5 class="col-6">Requested By User: </h5>';
										        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">'.$user_name.'</em></h5>';

										        			$response_arr['messages'] .= '<h5 class="col-6">Date / Time Of Request: </h5>';
										        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">'.$date_time.'</em></h5>';

										        			$response_arr['messages'] .= '<h4 class="col-12 text-center" style="margin-top: 30px; margin-bottom: 20px;">Payment Details: </h4>';

										        			$response_arr['messages'] .= '<h5 class="col-6">Bank Name: </h5>';
										        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">'.$bank_name.'</em></h5>';

										        			$response_arr['messages'] .= '<h5 class="col-6">Account Number: </h5>';
										        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">'.$account_number.'</em></h5>';

										        			$response_arr['messages'] .= '<h5 class="col-6">Account Name: </h5>';
										        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">'.$account_name.'</em></h5>';


										        			$response_arr['messages'] .= '</div>';

										        			$response_arr['messages'] .= '<h4 style="margin-bottom: 60px; margin-top: 20px;">Choose Action: </h4>';

										        			$response_arr['messages'] .= '<button class="btn btn-success" onclick="approveWithdrawalRequest(this,event,'.$id.')">Approve Request </button>';

										        			$response_arr['messages'] .= '<button data-full-name="'.$full_name.'" class="btn btn-danger" onclick="declineRequestWithdrawal(this,event,'.$id.')">Decline Request</button>';
										        		}
										        	}
								        		}
								        	}
						        		}
										
									}
								}
							}
						}
					}
					
					echo json_encode($response_arr);
				}	
			}



			elseif($addition == "admin" && $second_addition == "view_superforex_pending_withdrawal_requests" && is_null($third_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}

					$date = date("j M Y");
					$time = date("h:i:sa");

					// $exchange_rate = $this->northbridge_model->getFundingExchangeRate();

				
					$response_arr = array('success' => true,'messages' => "");

					$pending_withdrawal_requests = $this->northbridge_model->getPendingSuperforexWithdrawalRequests();

					if(is_array($pending_withdrawal_requests)){
						$i = 0;

						$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="margin-top: 40px;">';
		        		$response_arr['messages'] .= '<table class="table table-striped table-bordered wrap hover display" id="view-withdrawal-requests-table" cellspacing="0" width="100%" style="width:100%">';
		        		$response_arr['messages'] .= '<thead>';
		        		$response_arr['messages'] .= '<tr>';
		        		$response_arr['messages'] .= '<th>#</th>';
		        		$response_arr['messages'] .= '<th>Full Name</th>';
		        		$response_arr['messages'] .= '<th>Amount</th>';
		        		$response_arr['messages'] .= '<th>Exchange Rate</th>';
		        		$response_arr['messages'] .= '<th>SuperForex Acct. Number</th>';
		        		$response_arr['messages'] .= '<th>Phone Password</th>';
		        		$response_arr['messages'] .= '<th>Requested By</th>';
		        		$response_arr['messages'] .= '<th>Date / Time</th>';
		        		$response_arr['messages'] .= '</tr>';
		        		$response_arr['messages'] .= '<tbody>';

		        		foreach($pending_withdrawal_requests as $row){
		        			$i++;
		        			$id = $row->id;
		        			$user_id = $row->user_id;
		        			$full_name = $row->full_name;
		        			$amount = $row->amount;
		        			$exchange_rate = $row->exchange_rate;
		        			$phone_password = $row->phone_password;
		        			$super_forex_account_number = $row->super_forex_account_number;
		        			$date_time = $row->date . " " . $row->time;
		        			$user_name = $this->northbridge_model->getUserNameById($user_id);


		        			$response_arr['messages'] .= '<tr data-full-name="'.$full_name.'" onclick="performActionOnWithdrawalRequest(this,event,'.$id.')">';

		        			$response_arr['messages'] .= '<td>'.$i.'</td>';
		        			$response_arr['messages'] .= '<td style="text-transform: capitalize;">'.$full_name.'</td>';
		        			$response_arr['messages'] .= '<td>$'.number_format($amount,2).'</td>';
		        			$response_arr['messages'] .= '<td>₦'.number_format($exchange_rate,2).'</td>';
		        			$response_arr['messages'] .= '<td><em class="text-primary">'.$super_forex_account_number.'</em></td>';
		        			$response_arr['messages'] .= '<td><em class="text-primary">'.$phone_password.'</em></td>';
		        			$response_arr['messages'] .= '<td><em class="text-primary">'.$user_name.'</em></td>';
		        			$response_arr['messages'] .= '<td>'.$date_time.'</td>';

		        			$response_arr['messages'] .= '</tr>';
		        		}
		        		$response_arr['messages'] .= '</tbody>';
		        		$response_arr['messages'] .= '</table>';
		        		$response_arr['messages'] .= '</div>';
					}else{
						$response_arr['messages'] .= '<h4 class="text-warning">No Data To Display.</h4>';
					}
					
					echo json_encode($response_arr);
				}	
			}


			elseif($addition == "withdraw_from_your_superforex_account" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
						$bank_name = $user->bank_name;
						$account_number = $user->account_number;
					}

					$date = date("j M Y");
					$time = date("h:i:sa");

					$exchange_rate = $this->northbridge_model->getWithdrawExchangeRate();

				
					$response_arr = array('success' => false,'messages' => "");

					
					$this->form_validation->set_rules('full_name','Full Name','trim|required|min_length[5]|max_length[100]');
					$this->form_validation->set_rules('super_forex_account_number','SuperForex Account Number','trim|required|max_length[50]');						
					$this->form_validation->set_rules('phone_password','Phone Password','trim|required|max_length[50]');							
					$this->form_validation->set_rules('amount','Amount','trim|required|numeric');						
					
					
					$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
					if($this->form_validation->run() == FALSE){
						// redirect('northbridge/account_created');
						foreach($_POST as $key => $value){
							$response_arr['messages'][$key] = form_error($key);
						}
					}else{
						
						
						$full_name = $this->input->post('full_name');
						$super_forex_account_number = $this->input->post('super_forex_account_number');
						$amount = $this->input->post('amount');
						$phone_password = $this->input->post('phone_password');
						
					
						$form_array = array(
							'date' => $date,
							'time' => $time,
							'user_id' => $user_id,
							'full_name' => $full_name,
							'super_forex_account_number' => $super_forex_account_number,
							'amount' => $amount,
							'exchange_rate' => $exchange_rate,
							'bank_name' => $bank_name,
							'account_number' => $account_number,
							'phone_password' => $phone_password
							
						);
						if($this->northbridge_model->addRequestToWithdrawFromSuperForexAccount($form_array)){

							$response_arr['success'] = true;
						}
							
					}
					
					echo json_encode($response_arr);
				}	
			}


			elseif($addition == "withdraw_superforex_account" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
						$data['super_forex_account_number'] = $user->super_forex_account_number;
					}
				
					$this->load->view('includes/home_header',$data);
					$this->load->view('pages/withdraw_superforex_account',$data);
					$this->load->view('includes/home_footer',$data);
				}	
			}



			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "process_edit_payment_details" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				
				if(is_array($user_info)){
					foreach($user_info as $row){
						$id = $row->id;
						$created = $row->created;
						$created_date = $row->created_date;
						$created_time = $row->created_time;
						$sms_enabled = $row->sms_enabled;
						$notif_enabled = $row->notif_enabled;
						$email_enabled = $row->email_enabled;
						$admin_sms_enabled = $row->admin_sms_enabled;
						$admin_email_enabled = $row->admin_email_enabled;
						$followers = $row->followers;
						$following = $row->following;
						$user_name = $row->user_name;
						$sponsor_income = $row->sponsor_income;
						$withdrawn = $row->withdrawn;
						$admin_vat_total = $row->admin_vat_total;
						$total_basic_withdrawn = $row->total_basic_withdrawn;
						$total_basic_income = $row->total_basic_income;
						$total_business_income = $row->total_business_income;
						$total_business_withdrawn = $row->total_business_withdrawn;
						$total_income = $row->total_income;
						$admin_mlm_withdrawn = $row->admin_mlm_withdrawn;
						$last_activity = $row->last_activity;
						$full_name = $row->full_name;
						$hashed = $row->hashed;
						$token = $row->token;
						$email = $row->email;
						$phone = $row->phone;
						$phone_code = $row->phone_code;
						$logo = $row->logo;
						$cover_photo = $row->cover_photo;
						$bio = $row->bio;
						$country_id = $row->country_id;
						$state_id = $row->state_id;
						$local_government = $row->local_government;
						$city = $row->city;
						$address = $row->address;
						$place_of_use = $row->place_of_use;
						$whatsapp_user = $row->whatsapp_user;
						$center_leader = $row->center_leader;
						$slug = $row->slug;
						$register = $row->register;
						$is_admin = $row->is_admin;
						$date = $row->date;
						$time = $row->time;
						$user_bank_name = $row->bank_name;
						$account_number = $row->account_number;
						$recepient_code = $row->recepient_code;
						$referred_by = $row->referred_by;
						$dispatcher = $row->dispatcher;
						$center_leader_selection_income = $row->center_leader_selection_income;
						$admin_center_leader_selection_income = $row->admin_center_leader_selection_income;
						$mlm_withdrawn = $row->mlm_withdrawn;
					}
					
					$data = array('success' => false,'messages' => '','bank_details' => "",'account_name' => '','invalid_account' => false);
					
					$this->form_validation->set_rules('bank_name','Bank Name','trim|required|numeric',array('required' => 'This Field Is Required'));
					$this->form_validation->set_rules('account_number','Account Number','trim|required|numeric',array('required' => 'This Field Is Required'));
					$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
					if($this->form_validation->run() == TRUE){
						
						$bank_name = $this->input->post('bank_name');
						$account_number = $this->input->post('account_number');
						
						$account_number_test = $this->paystack->curl("https://api.paystack.co/bank/resolve?account_number=".$account_number."&bank_code=".$bank_name,FALSE);

						$account_number_test = json_decode($account_number_test);
						if(is_object($account_number_test)){
							// echo "string";
							if($account_number_test->status == "true"){
								$post_data = [
									"type" =>  "nuban",
						             "name" => $full_name,
						             // "description" => "Payment For ".$health_facility_name,
						             "account_number" => $account_number,
						             "bank_code" => $bank_name,
						             "currency" => "NGN"
								];

								$create_transfer_recipient = $this->paystack->curl("https://api.paystack.co/transferrecipient",TRUE,$post_data);
								$create_transfer_recipient = json_decode($create_transfer_recipient);
								if(is_object($create_transfer_recipient)){
									
									if($create_transfer_recipient->status == TRUE){

										$recepient_code = $create_transfer_recipient->data->recipient_code;
										$form_array = array(
											'bank_name' => $bank_name,
											'account_number' => $account_number,
											'recepient_code' => $recepient_code
										);
										if($this->northbridge_model->updateUserTable($form_array,$user_id)){
											$data['account_name'] = $account_number_test->data->account_name;
											$data['success'] = true;
										}
									}
								}	
							}else{
								$data['invalid_account'] = true;
							}
						}
						
					}else{
						foreach($_POST as $key => $value){
							$data['messages'][$key] = form_error($key);
						}
					}
					echo json_encode($data);					
							
			    }
			} 


			elseif($addition == "get_edit_payment_details_form_for_user" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $row){
						$id = $row->id;
						$created = $row->created;
						$created_date = $row->created_date;
						$created_time = $row->created_time;
						$sms_enabled = $row->sms_enabled;
						$notif_enabled = $row->notif_enabled;
						$email_enabled = $row->email_enabled;
						$admin_sms_enabled = $row->admin_sms_enabled;
						$admin_email_enabled = $row->admin_email_enabled;
						$followers = $row->followers;
						$following = $row->following;
						$user_name = $row->user_name;
						$sponsor_income = $row->sponsor_income;
						$withdrawn = $row->withdrawn;
						$admin_vat_total = $row->admin_vat_total;
						$total_basic_withdrawn = $row->total_basic_withdrawn;
						$total_basic_income = $row->total_basic_income;
						$total_business_income = $row->total_business_income;
						$total_business_withdrawn = $row->total_business_withdrawn;
						$total_income = $row->total_income;
						$admin_mlm_withdrawn = $row->admin_mlm_withdrawn;
						$last_activity = $row->last_activity;
						$full_name = $row->full_name;
						$hashed = $row->hashed;
						$token = $row->token;
						$email = $row->email;
						$phone = $row->phone;
						$phone_code = $row->phone_code;
						$logo = $row->logo;
						$cover_photo = $row->cover_photo;
						$bio = $row->bio;
						$country_id = $row->country_id;
						$state_id = $row->state_id;
						$local_government = $row->local_government;
						$city = $row->city;
						$address = $row->address;
						$place_of_use = $row->place_of_use;
						$whatsapp_user = $row->whatsapp_user;
						$center_leader = $row->center_leader;
						$slug = $row->slug;
						$register = $row->register;
						$is_admin = $row->is_admin;
						$date = $row->date;
						$time = $row->time;
						$user_bank_name = $row->bank_name;
						$account_number = $row->account_number;
						$recepient_code = $row->recepient_code;
						$referred_by = $row->referred_by;
						$dispatcher = $row->dispatcher;
						$center_leader_selection_income = $row->center_leader_selection_income;
						$admin_center_leader_selection_income = $row->admin_center_leader_selection_income;
						$mlm_withdrawn = $row->mlm_withdrawn;
					}
				
					if($this->input->post('show_records')){
						$response_arr = array('success' => false,'messages' => '');
						$banks_arr = $this->paystack->curl("https://api.paystack.co/bank",FALSE);
		                $banks_arr = json_decode($banks_arr);

						if($banks_arr->status && $banks_arr->message == "Banks retrieved"){
	                    	$response_arr['success'] = true;
	                        $bank_names = $banks_arr->data;


		                    $attr = array('id' => 'edit-bank-details-form','onsubmit' => 'submitBankDetailsForm(this,event)');
		                    $response_arr['messages'] .= form_open("",$attr);
		                  
		                    $response_arr['messages'] .= '<div class="form-group col-sm-12">';
		                    $response_arr['messages'] .= '<label for="bank_name">Select Bank Name: </label>';
		                    $response_arr['messages'] .= '<select name="bank_name" id="bank_name" class="form-control selectpicker" data-style="btn btn-link" required>';
		                        
		                    
	                          

	                        foreach($bank_names as $row){
                                $bank_name = $row->name;
                                $code = $row->code;
                                $long_code = $row->longcode;
                                $active = $row->active;
                                $is_deleted = $row->is_deleted;
                                $id = $row->id;
	                        
	                        	$response_arr['messages'] .= '<option value="'.$code.'"';
	                        	if($code == $user_bank_name){ 
	                        		$response_arr['messages'] .= "selected"; 
	                        	} 
	                        	$response_arr['messages'] .= '>';
	                        	$response_arr['messages'] .= $bank_name; 
	                        	$response_arr['messages'] .= '</option>';
	                        }
	                        $response_arr['messages'] .= '</select>';
		                    $response_arr['messages'] .= '<span class="form-error"></span>';
		                    $response_arr['messages'] .= '</div>';

		                    $response_arr['messages'] .= '<div class="form-group col-sm-12">';
		                    $response_arr['messages'] .= '<label for="account_number">Enter Account Number: </label>';
		                    $response_arr['messages'] .= '<input type="number" class="form-control" name="account_number" id="account_number" value="';
		                    if($account_number !== 0){ 
		                    	$response_arr['messages'] .= $account_number; 
		                    } 
		                    $response_arr['messages'] .= '" required>';
		                    $response_arr['messages'] .= '<span class="form-error"></span>';
		                    $response_arr['messages'] .= '</div>';

		                    $response_arr['messages'] .= '<div class="form-group col-sm-12">';
		                    $response_arr['messages'] .= '<input type="submit" class="btn btn-submit col-12">';
		                    $response_arr['messages'] .= '</div>';
		    
		                  	$response_arr['messages'] .= '</form>';

		                  	$attr = array('id' => 'enter-amount-to-withdraw-form','style' => 'display: none;','onsubmit' => 'submitAmountToWithdrawForm(this,event)');
		                    $response_arr['messages'] .= form_open("",$attr);

		                    $response_arr['messages'] .= '<div class="form-group">';
		                    $response_arr['messages'] .= '<input type="number" class="form-control" id="amount" name="amount" placeholder="Enter Amount" max="" min="200" required>';
		                    $response_arr['messages'] .= '</div>';
		                    $response_arr['messages'] .= '<input type="submit" class="btn btn-primary">';
		                  	$response_arr['messages'] .= '</form>';
	                    }
	                    
						echo json_encode($response_arr);
					}
				}	
			}

			elseif($addition == "admin" && $second_addition == "view_more_info_on_superforex_deposit_request" && is_null($third_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}

					$date = date("j M Y");
					$time = date("h:i:sa");

					// $exchange_rate = $this->northbridge_model->getFundingExchangeRate();

				
					$response_arr = array('success' => false,'messages' => "");
					if($this->input->post('show_records') && $this->input->post('id')){
						$id = $this->input->post('id');
						if($this->northbridge_model->checkIfSuperForexDepositRequestIdIsValid($id)){
							
							$deposit_request_info = $this->northbridge_model->getPendingSuperforexDepositRequestInfoById($id);

							if(is_array($deposit_request_info)){
								$response_arr['success'] = true;
								
								foreach($deposit_request_info as $row){
				        			
				        			$id = $row->id;
			                        $user_id = $row->user_id;
			                        $full_name = $row->full_name;
			                        $super_forex_account_number = $row->super_forex_account_number;
			                        $amount = $row->amount;
			                        $payment_proof = $row->payment_proof;
			                        $exchange_rate = $row->exchange_rate;
			                        $reason = $row->reason;
			                        $approved = $row->approved;
			                        $declined = $row->declined;
			                        $date = $row->date;
			                        $time = $row->time;
			                        $approved_date_time = $row->approved_date_time;
			                        $declined_date_time = $row->declined_date_time;

			                        $user_name = $this->northbridge_model->getUserParamById("user_name",$user_id);
			                        $user_slug = $this->northbridge_model->getUserParamById("slug",$user_id);

			                        if($approved == 1){
			                          $status = "<em class='text-primary'>Approved</em>";
			                        }else if($declined == 1){
			                          $status = "<em class='text-danger'>Declined</em>";
			                        }else{
			                          $status = "<em>Pending</em>";
			                        }

			                        $date_time = $date . " " . $time;

				        			$amount_due = $amount * $exchange_rate;


				        			$response_arr['messages'] .= '<div class="row">';

				        			

				        			$response_arr['messages'] .= '<h5 class="col-6">Full Name: </h5>';
				        			$response_arr['messages'] .= '<h5 class="col-6" style="text-transform: capitalize;"><em class="text-primary">'.$full_name.'</em></h5>';

				        			$response_arr['messages'] .= '<h5 class="col-6">Amount: </h5>';
				        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">$'.number_format($amount,2).'</em></h5>';


				        			$response_arr['messages'] .= '<h5 class="col-6">Exchange Rate: </h5>';
				        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">₦'.number_format($exchange_rate,2).'</em></h5>';

				        			$response_arr['messages'] .= '<h5 class="col-6">Amount Due: </h5>';
				        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">₦'.number_format($amount_due,2).'</em></h5>';

				        			$response_arr['messages'] .= '<h5 class="col-6">SuperForex Acct. Number: </h5>';
				        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">'.$super_forex_account_number.'</em></h5>';

				        			$response_arr['messages'] .= '<h5 class="col-6">Requested By User: </h5>';
				        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">'.$user_name.'</em></h5>';

				        			$response_arr['messages'] .= '<h5 class="col-6">Status: </h5>';
				        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">'.$status.'</em></h5>';

				        			

				        			$response_arr['messages'] .= '<h5 class="col-6">Date / Time Of Request: </h5>';
				        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">'.$date_time.'</em></h5>';

				        			$response_arr['messages'] .= '<h5 class="col-12">Payment Proof: </h5>';
				        			$response_arr['messages'] .= '<img class="col-12" src="'.base_url('assets/images/'.$payment_proof).'">';


				        			if($status == "<em class='text-danger'>Declined</em>"){
				        				$response_arr['messages'] .= '<h5 class="col-6">Reason: </h5>';
				        				$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">'.$reason.'</em></h5>';
				        			}


				        			$response_arr['messages'] .= '</div>';

				        		}

								
							}
						}
					}
					
					echo json_encode($response_arr);
				}	
			}


			elseif($addition == "admin" && $second_addition == "view_account_funding_history" && is_null($fourth_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}



					$get_vars = $_GET;
					$config['base_url'] = site_url('northbridge/index/admin/view_account_funding_history');

					$config['total_rows'] = $this->northbridge_model->getAccountFundingHistoryForByPaginationNum($get_vars);
					$data['total_rows'] = $config['total_rows'];
					
	        		

	        		$config['per_page'] = 10;

					$config['reuse_query_string'] = TRUE;
					$config['use_page_numbers'] = TRUE;
					$config['next_link'] = 'Next';
					$config['first_link'] = 'First';
					$config['last_link'] = 'Last';
					$config['full_tag_open'] = "<ul class='pagination'>";
					$config['full_tag_close'] ="</ul>";
					$config['num_tag_open'] = '<li>';
					$config['num_tag_close'] = '</li>';
					$config['cur_tag_open'] = "<li class='disabled'><li class='active'><a href='#'>";
					$config['cur_tag_close'] = "<span class='sr-only'></span></a></li>";
					$config['next_tag_open'] = "<li>";
					$config['next_tagl_close'] = "</li>";
					$config['prev_tag_open'] = "<li>";
					$config['prev_tagl_close'] = "</li>";
					$config['first_tag_open'] = "<li>";
					$config['first_tagl_close'] = "</li>";
					$config['last_tag_open'] = "<li>";
					$config['last_tagl_close'] = "</li>";
					// $config['uri_segment'] = 2;

					// By clicking on performing PREVIOUS pagination.
					$config['prev_link'] = 'Previous';



					if(!is_null($third_addition)){
						$page = $third_addition;
					}else{
						$page = 1;
					}
					
					$page = $page - 1;


	        		
	        		$data['rows'] = $this->northbridge_model->getAccountFundingHistoryForByPagination($page,$get_vars);
	        		

					$this->pagination->initialize($config);

					$data['str_links'] = $this->pagination->create_links();

					
					
					$this->load->view('includes/admin_header',$data);
					
		            $this->load->view('pages/view_account_funding_history',$data);
		            $this->load->view('includes/admin_footer',$data);	
				
				}	
			}



			elseif($addition == "view_your_declined_superforex_deposit_requests" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}

					$date = date("j M Y");
					$time = date("h:i:sa");

					// $exchange_rate = $this->northbridge_model->getFundingExchangeRate();

				
					$response_arr = array('success' => true,'messages' => "");

					$pending_deposit_requests = $this->northbridge_model->getAllDeclinedSuperforexDepositRequestsForUser($user_id);

					if(is_array($pending_deposit_requests)){
						$i = 0;

						$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="margin-top: 40px;">';
		        		$response_arr['messages'] .= '<table class="table table-striped table-bordered wrap hover display" id="view-declined-deposit-requests-table" cellspacing="0" width="100%" style="width:100%">';
		        		$response_arr['messages'] .= '<thead>';
		        		$response_arr['messages'] .= '<tr>';
		        		$response_arr['messages'] .= '<th>#</th>';
		        		$response_arr['messages'] .= '<th>Full Name</th>';
		        		$response_arr['messages'] .= '<th>Amount</th>';
		        		$response_arr['messages'] .= '<th>Exchange Rate</th>';
		        		$response_arr['messages'] .= '<th>SuperForex Acct. Number</th>';
		        		
		        		$response_arr['messages'] .= '<th>Declined Date / Time</th>';
		        		$response_arr['messages'] .= '<th>Reason</th>';
		        		$response_arr['messages'] .= '<th>Actions</th>';
		        		$response_arr['messages'] .= '</tr>';
		        		$response_arr['messages'] .= '<tbody>';

		        		foreach($pending_deposit_requests as $row){
		        			$i++;
		        			$id = $row->id;
		        			$user_id = $row->user_id;
		        			$full_name = $row->full_name;
		        			$amount = $row->amount;
		        			$exchange_rate = $row->exchange_rate;
		        			$payment_proof = $row->payment_proof;
		        			$super_forex_account_number = $row->super_forex_account_number;
		        			$date_time = $row->date . " " . $row->time;
		        			$user_name = $this->northbridge_model->getUserNameById($user_id);
		        			$declined_date_time = $row->declined_date_time;
		        			$reason = $row->reason;

		        			$response_arr['messages'] .= '<tr data-full-name="'.$full_name.'">';

		        			$response_arr['messages'] .= '<td>'.$i.'</td>';
		        			$response_arr['messages'] .= '<td style="text-transform: capitalize;">'.$full_name.'</td>';
		        			$response_arr['messages'] .= '<td>$'.number_format($amount,2).'</td>';
		        			$response_arr['messages'] .= '<td>₦'.number_format($exchange_rate,2).'</td>';
		        			$response_arr['messages'] .= '<td><em class="text-primary">'.$super_forex_account_number.'</em></td>';
		        			// $response_arr['messages'] .= '<td><em class="text-primary">'.$user_name.'</em></td>';
		        			$response_arr['messages'] .= '<td>'.$declined_date_time.'</td>';
		        			$response_arr['messages'] .= '<td>'.$reason.'</td>';
		        			$response_arr['messages'] .= '<td class="td-actions text-center">';
		                   	$response_arr['messages'] .= '<a target="_blank" href="'.base_url('assets/images/'.$payment_proof).'" type="button" rel="tooltip" title="View Payment Proof" class="btn btn-success btn-link">';
		                   	$response_arr['messages'] .= '<i class="far fa-image"></i>';
		                    $response_arr['messages'] .= '<div class="ripple-container"></div>';
		                    $response_arr['messages'] .= '</a>';
		                    $response_arr['messages'] .= '</td>';

		        			$response_arr['messages'] .= '</tr>';
		        		}
		        		$response_arr['messages'] .= '</tbody>';
		        		$response_arr['messages'] .= '</table>';
		        		$response_arr['messages'] .= '</div>';
					}else{
						$response_arr['messages'] .= '<h4 class="text-warning">No Data To Display.</h4>';
					}
					
					echo json_encode($response_arr);
				}	
			}


			elseif($addition == "view_your_approved_superforex_deposit_requests" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}

					$date = date("j M Y");
					$time = date("h:i:sa");

					// $exchange_rate = $this->northbridge_model->getFundingExchangeRate();

				
					$response_arr = array('success' => true,'messages' => "");

					$pending_deposit_requests = $this->northbridge_model->getAllApprovedSuperforexDepositRequestsForUser($user_id);

					if(is_array($pending_deposit_requests)){
						$i = 0;

						$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="margin-top: 40px;">';
		        		$response_arr['messages'] .= '<table class="table table-striped table-bordered wrap hover display" id="view-approved-deposit-requests-table" cellspacing="0" width="100%" style="width:100%">';
		        		$response_arr['messages'] .= '<thead>';
		        		$response_arr['messages'] .= '<tr>';
		        		$response_arr['messages'] .= '<th>#</th>';
		        		$response_arr['messages'] .= '<th>Full Name</th>';
		        		$response_arr['messages'] .= '<th>Amount</th>';
		        		$response_arr['messages'] .= '<th>Exchange Rate</th>';
		        		$response_arr['messages'] .= '<th>SuperForex Acct. Number</th>';
		        		
		        		$response_arr['messages'] .= '<th>Approved Date / Time</th>';
		        		$response_arr['messages'] .= '<th>Actions</th>';
		        		$response_arr['messages'] .= '</tr>';
		        		$response_arr['messages'] .= '<tbody>';

		        		foreach($pending_deposit_requests as $row){
		        			$i++;
		        			$id = $row->id;
		        			$user_id = $row->user_id;
		        			$full_name = $row->full_name;
		        			$amount = $row->amount;
		        			$exchange_rate = $row->exchange_rate;
		        			$payment_proof = $row->payment_proof;
		        			$super_forex_account_number = $row->super_forex_account_number;
		        			$date_time = $row->date . " " . $row->time;
		        			$user_name = $this->northbridge_model->getUserNameById($user_id);
		        			$approved_date_time = $row->approved_date_time;

		        			$response_arr['messages'] .= '<tr data-full-name="'.$full_name.'">';

		        			$response_arr['messages'] .= '<td>'.$i.'</td>';
		        			$response_arr['messages'] .= '<td style="text-transform: capitalize;">'.$full_name.'</td>';
		        			$response_arr['messages'] .= '<td>$'.number_format($amount,2).'</td>';
		        			$response_arr['messages'] .= '<td>₦'.number_format($exchange_rate,2).'</td>';
		        			$response_arr['messages'] .= '<td><em class="text-primary">'.$super_forex_account_number.'</em></td>';
		        			// $response_arr['messages'] .= '<td><em class="text-primary">'.$user_name.'</em></td>';
		        			$response_arr['messages'] .= '<td>'.$approved_date_time.'</td>';
		        			$response_arr['messages'] .= '<td class="td-actions text-center">';
		                   	$response_arr['messages'] .= '<a target="_blank" href="'.base_url('assets/images/'.$payment_proof).'" type="button" rel="tooltip" title="View Payment Proof" class="btn btn-success btn-link">';
		                   	$response_arr['messages'] .= '<i class="far fa-image"></i>';
		                    $response_arr['messages'] .= '<div class="ripple-container"></div>';
		                    $response_arr['messages'] .= '</a>';
		                    $response_arr['messages'] .= '</td>';

		        			$response_arr['messages'] .= '</tr>';
		        		}
		        		$response_arr['messages'] .= '</tbody>';
		        		$response_arr['messages'] .= '</table>';
		        		$response_arr['messages'] .= '</div>';
					}else{
						$response_arr['messages'] .= '<h4 class="text-warning">No Data To Display.</h4>';
					}
					
					echo json_encode($response_arr);
				}	
			}

			elseif($addition == "view_your_pending_superforex_deposit_requests" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}

					$date = date("j M Y");
					$time = date("h:i:sa");

					// $exchange_rate = $this->northbridge_model->getFundingExchangeRate();

				
					$response_arr = array('success' => true,'messages' => "");

					$pending_deposit_requests = $this->northbridge_model->getAllPendingSuperforexDepositRequestsForUser($user_id);

					if(is_array($pending_deposit_requests)){
						$i = 0;

						$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="margin-top: 40px;">';
		        		$response_arr['messages'] .= '<table class="table table-striped table-bordered wrap hover display" id="view-pending-deposit-requests-table" cellspacing="0" width="100%" style="width:100%">';
		        		$response_arr['messages'] .= '<thead>';
		        		$response_arr['messages'] .= '<tr>';
		        		$response_arr['messages'] .= '<th>#</th>';
		        		$response_arr['messages'] .= '<th>Full Name</th>';
		        		$response_arr['messages'] .= '<th>Amount</th>';
		        		$response_arr['messages'] .= '<th>Exchange Rate</th>';
		        		$response_arr['messages'] .= '<th>SuperForex Acct. Number</th>';
		        		
		        		$response_arr['messages'] .= '<th>Date / Time</th>';
		        		$response_arr['messages'] .= '<th>Actions</th>';
		        		$response_arr['messages'] .= '</tr>';
		        		$response_arr['messages'] .= '<tbody>';

		        		foreach($pending_deposit_requests as $row){
		        			$i++;
		        			$id = $row->id;
		        			$user_id = $row->user_id;
		        			$full_name = $row->full_name;
		        			$amount = $row->amount;
		        			$exchange_rate = $row->exchange_rate;
		        			$payment_proof = $row->payment_proof;
		        			$super_forex_account_number = $row->super_forex_account_number;
		        			$date_time = $row->date . " " . $row->time;
		        			$user_name = $this->northbridge_model->getUserNameById($user_id);


		        			$response_arr['messages'] .= '<tr data-full-name="'.$full_name.'">';

		        			$response_arr['messages'] .= '<td>'.$i.'</td>';
		        			$response_arr['messages'] .= '<td style="text-transform: capitalize;">'.$full_name.'</td>';
		        			$response_arr['messages'] .= '<td>$'.number_format($amount,2).'</td>';
		        			$response_arr['messages'] .= '<td>₦'.number_format($exchange_rate,2).'</td>';
		        			$response_arr['messages'] .= '<td><em class="text-primary">'.$super_forex_account_number.'</em></td>';
		        			// $response_arr['messages'] .= '<td><em class="text-primary">'.$user_name.'</em></td>';
		        			$response_arr['messages'] .= '<td>'.$date_time.'</td>';
		        			$response_arr['messages'] .= '<td class="td-actions text-center">';
		                   	$response_arr['messages'] .= '<a target="_blank" href="'.base_url('assets/images/'.$payment_proof).'" type="button" rel="tooltip" title="View Payment Proof" class="btn btn-success btn-link">';
		                   	$response_arr['messages'] .= '<i class="far fa-image"></i>';
		                    $response_arr['messages'] .= '<div class="ripple-container"></div>';
		                    $response_arr['messages'] .= '</a>';
		                    $response_arr['messages'] .= '</td>';

		        			$response_arr['messages'] .= '</tr>';
		        		}
		        		$response_arr['messages'] .= '</tbody>';
		        		$response_arr['messages'] .= '</table>';
		        		$response_arr['messages'] .= '</div>';
					}else{
						$response_arr['messages'] .= '<h4 class="text-warning">No Data To Display.</h4>';
					}
					
					echo json_encode($response_arr);
				}	
			}

			elseif($addition == "admin" && $second_addition == "approve_superforex_fund_request" && is_null($third_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}

					$date = date("j M Y");
					$time = date("h:i:sa");

					// $exchange_rate = $this->northbridge_model->getFundingExchangeRate();

				
					$response_arr = array('success' => false,'messages' => "", 'action_already_taken' => true,'invalid_id' => true);
					if($this->input->post('id')){
						$id = $this->input->post('id');
						if($this->northbridge_model->checkIfSuperForexDepositRequestIdIsValid($id)){
							$response_arr['invalid_id'] = false;
							$approved = $this->northbridge_model->getSuperForexDepositRequestParamById("approved",$id);
							$declined = $this->northbridge_model->getSuperForexDepositRequestParamById("declined",$id);
							if($approved == 0 && $declined == 0){
								$response_arr['action_already_taken'] = false;
								$pending_deposit_request_info = $this->northbridge_model->getPendingSuperforexDepositRequestInfoById($id);

								if(is_array($pending_deposit_request_info)){
									
									
									foreach($pending_deposit_request_info as $row){
					        			
					        			$id = $row->id;
					        			$user_id = $row->user_id;
					        			$full_name = $row->full_name;
					        			$amount = $row->amount;
					        			$exchange_rate = $row->exchange_rate;
					        			$payment_proof = $row->payment_proof;
					        			$super_forex_account_number = $row->super_forex_account_number;
					        			$date_time = $row->date . " " . $row->time;
					        			$user_name = $this->northbridge_model->getUserNameById($user_id);

					        			$amount_due = $amount * $exchange_rate;


										if($this->northbridge_model->approveSuperforexFundRequest($id,$user_id,$date,$time)){
											$response_arr['success'] = true;
										}
						        			
						        		
						        	}
									
								}
							}
						}
					}
					
					echo json_encode($response_arr);
				}	
			}

			elseif($addition == "admin" && $second_addition == "decline_superforex_fund_request" && is_null($third_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}

					$date = date("j M Y");
					$time = date("h:i:sa");

					// $exchange_rate = $this->northbridge_model->getFundingExchangeRate();

				
					$response_arr = array('success' => false,'messages' => "", 'action_already_taken' => true,'invalid_id' => true);
					if($this->input->post('id')){
						$id = $this->input->post('id');
						if($this->northbridge_model->checkIfSuperForexDepositRequestIdIsValid($id)){
							$response_arr['invalid_id'] = false;
							$approved = $this->northbridge_model->getSuperForexDepositRequestParamById("approved",$id);
							$declined = $this->northbridge_model->getSuperForexDepositRequestParamById("declined",$id);
							if($approved == 0 && $declined == 0){
								$response_arr['action_already_taken'] = false;
								$pending_deposit_request_info = $this->northbridge_model->getPendingSuperforexDepositRequestInfoById($id);

								if(is_array($pending_deposit_request_info)){
									
									
									foreach($pending_deposit_request_info as $row){
					        			
					        			$id = $row->id;
					        			$user_id = $row->user_id;
					        			$full_name = $row->full_name;
					        			$amount = $row->amount;
					        			$exchange_rate = $row->exchange_rate;
					        			$payment_proof = $row->payment_proof;
					        			$super_forex_account_number = $row->super_forex_account_number;
					        			$date_time = $row->date . " " . $row->time;
					        			$user_name = $this->northbridge_model->getUserNameById($user_id);

					        			$amount_due = $amount * $exchange_rate;

					        			$this->form_validation->set_rules('reason','Reason','trim|required');						
									
									
										$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
										if($this->form_validation->run() == FALSE){
											// redirect('northbridge/account_created');
											foreach($_POST as $key => $value){
												$response_arr['messages'][$key] = form_error($key);
											}
										}else{
											
											
											$reason = $this->input->post('reason');

											if($this->northbridge_model->declineSuperforexFundRequest($reason,$id,$user_id,$date,$time)){
												$response_arr['success'] = true;
											}
						        			
						        		}
						        	}
									
								}
							}
						}
					}
					
					echo json_encode($response_arr);
				}	
			}

			elseif($addition == "admin" && $second_addition == "view_more_info_on_superforex_pending_deposit_request" && is_null($third_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}

					$date = date("j M Y");
					$time = date("h:i:sa");

					// $exchange_rate = $this->northbridge_model->getFundingExchangeRate();

				
					$response_arr = array('success' => false,'messages' => "", 'action_already_taken' => true,'invalid_id' => true);
					if($this->input->post('show_records') && $this->input->post('id')){
						$id = $this->input->post('id');
						if($this->northbridge_model->checkIfSuperForexDepositRequestIdIsValid($id)){
							$response_arr['invalid_id'] = false;
							$approved = $this->northbridge_model->getSuperForexDepositRequestParamById("approved",$id);
							$declined = $this->northbridge_model->getSuperForexDepositRequestParamById("declined",$id);
							if($approved == 0 && $declined == 0){
								$response_arr['action_already_taken'] = false;
								$pending_deposit_request_info = $this->northbridge_model->getPendingSuperforexDepositRequestInfoById($id);

								if(is_array($pending_deposit_request_info)){
									$response_arr['success'] = true;
									
									foreach($pending_deposit_request_info as $row){
					        			
					        			$id = $row->id;
					        			$user_id = $row->user_id;
					        			$full_name = $row->full_name;
					        			$amount = $row->amount;
					        			$exchange_rate = $row->exchange_rate;
					        			$payment_proof = $row->payment_proof;
					        			$super_forex_account_number = $row->super_forex_account_number;
					        			$date_time = $row->date . " " . $row->time;
					        			$user_name = $this->northbridge_model->getUserNameById($user_id);

					        			$amount_due = $amount * $exchange_rate;


					        			$response_arr['messages'] .= '<div class="row">';

					        			

					        			$response_arr['messages'] .= '<h5 class="col-6">Full Name: </h5>';
					        			$response_arr['messages'] .= '<h5 class="col-6" style="text-transform: capitalize;"><em class="text-primary">'.$full_name.'</em></h5>';

					        			$response_arr['messages'] .= '<h5 class="col-6">Amount: </h5>';
					        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">$'.number_format($amount,2).'</em></h5>';


					        			$response_arr['messages'] .= '<h5 class="col-6">Exchange Rate: </h5>';
					        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">₦'.number_format($exchange_rate,2).'</em></h5>';

					        			$response_arr['messages'] .= '<h5 class="col-6">Amount Due: </h5>';
					        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">₦'.number_format($amount_due,2).'</em></h5>';

					        			$response_arr['messages'] .= '<h5 class="col-6">SuperForex Acct. Number: </h5>';
					        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">'.$super_forex_account_number.'</em></h5>';

					        			$response_arr['messages'] .= '<h5 class="col-6">Requested By User: </h5>';
					        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">'.$user_name.'</em></h5>';

					        			$response_arr['messages'] .= '<h5 class="col-6">Date / Time Of Request: </h5>';
					        			$response_arr['messages'] .= '<h5 class="col-6"><em class="text-primary">'.$date_time.'</em></h5>';

					        			$response_arr['messages'] .= '<h5 class="col-12">Payment Proof: </h5>';
					        			$response_arr['messages'] .= '<img class="col-12" src="'.base_url('assets/images/'.$payment_proof).'">';


					        			$response_arr['messages'] .= '</div>';

					        			$response_arr['messages'] .= '<h4 style="margin-bottom: 60px; margin-top: 20px;">Choose Action: </h4>';

					        			$response_arr['messages'] .= '<button class="btn btn-success" onclick="approveRequest(this,event,'.$id.')">Approve Request </button>';

					        			$response_arr['messages'] .= '<button data-full-name="'.$full_name.'" class="btn btn-danger" onclick="declineRequest(this,event,'.$id.')">Decline Request</button>';
					        		}

									
								}
							}
						}
					}
					
					echo json_encode($response_arr);
				}	
			}

			elseif($addition == "admin" && $second_addition == "view_superforex_pending_deposit_requests" && is_null($third_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}

					$date = date("j M Y");
					$time = date("h:i:sa");

					// $exchange_rate = $this->northbridge_model->getFundingExchangeRate();

				
					$response_arr = array('success' => true,'messages' => "");

					$pending_deposit_requests = $this->northbridge_model->getPendingSuperforexDepositRequests();

					if(is_array($pending_deposit_requests)){
						$i = 0;

						$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="margin-top: 40px;">';
		        		$response_arr['messages'] .= '<table class="table table-striped table-bordered wrap hover display" id="view-deposit-requests-table" cellspacing="0" width="100%" style="width:100%">';
		        		$response_arr['messages'] .= '<thead>';
		        		$response_arr['messages'] .= '<tr>';
		        		$response_arr['messages'] .= '<th>#</th>';
		        		$response_arr['messages'] .= '<th>Full Name</th>';
		        		$response_arr['messages'] .= '<th>Amount</th>';
		        		$response_arr['messages'] .= '<th>Exchange Rate</th>';
		        		$response_arr['messages'] .= '<th>SuperForex Acct. Number</th>';
		        		$response_arr['messages'] .= '<th>Requested By</th>';
		        		$response_arr['messages'] .= '<th>Date / Time</th>';
		        		$response_arr['messages'] .= '</tr>';
		        		$response_arr['messages'] .= '<tbody>';

		        		foreach($pending_deposit_requests as $row){
		        			$i++;
		        			$id = $row->id;
		        			$user_id = $row->user_id;
		        			$full_name = $row->full_name;
		        			$amount = $row->amount;
		        			$exchange_rate = $row->exchange_rate;
		        			$super_forex_account_number = $row->super_forex_account_number;
		        			$date_time = $row->date . " " . $row->time;
		        			$user_name = $this->northbridge_model->getUserNameById($user_id);


		        			$response_arr['messages'] .= '<tr data-full-name="'.$full_name.'" onclick="performActionOnDepositRequest(this,event,'.$id.')">';

		        			$response_arr['messages'] .= '<td>'.$i.'</td>';
		        			$response_arr['messages'] .= '<td style="text-transform: capitalize;">'.$full_name.'</td>';
		        			$response_arr['messages'] .= '<td>$'.number_format($amount,2).'</td>';
		        			$response_arr['messages'] .= '<td>₦'.number_format($exchange_rate,2).'</td>';
		        			$response_arr['messages'] .= '<td><em class="text-primary">'.$super_forex_account_number.'</em></td>';
		        			$response_arr['messages'] .= '<td><em class="text-primary">'.$user_name.'</em></td>';
		        			$response_arr['messages'] .= '<td>'.$date_time.'</td>';

		        			$response_arr['messages'] .= '</tr>';
		        		}
		        		$response_arr['messages'] .= '</tbody>';
		        		$response_arr['messages'] .= '</table>';
		        		$response_arr['messages'] .= '</div>';
					}else{
						$response_arr['messages'] .= '<h4 class="text-warning">No Data To Display.</h4>';
					}
					
					echo json_encode($response_arr);
				}	
			}


			elseif($addition == "admin" && $second_addition == "view_deposit_withdraw_request" && is_null($third_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
						$data['fund_exchange_rate'] = $user->fund_exchange_rate;
						$data['withdraw_exchange_rate'] = $user->withdraw_exchange_rate;
						
					}

					$this->load->view('includes/admin_header',$data);
					$this->load->view('pages/view_deposit_withdraw_request',$data);
					$this->load->view('includes/admin_footer',$data);
				}
			}


			elseif($addition == "fund_your_superforex_account" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email']= $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}

					$date = date("j M Y");
					$time = date("h:i:sa");

					$exchange_rate = $this->northbridge_model->getFundingExchangeRate();

				
					$response_arr = array('success' => false,'messages' => "","errors" => "","empty" => true,"only_one_image" => false);

					if(!empty($_FILES['image']['name'])){
		           		$response_arr['empty'] = false;
						$files_count = count($_FILES['image']['name']);
						
						if($files_count == 1){
							$response_arr['only_one_image'] = true;
							for($i = 0; $i < $files_count; $i++){
								$pos = $i + 1;
								$_FILES['file']['name']     = $_FILES['image']['name'][$i];
				                $_FILES['file']['type']     = $_FILES['image']['type'][$i];
				                $_FILES['file']['tmp_name'] = $_FILES['image']['tmp_name'][$i];
				                $_FILES['file']['error']     = $_FILES['image']['error'][$i];
				                $_FILES['file']['size']     = $_FILES['image']['size'][$i];

				                $config['encrypt_name'] = true;
				                $config['upload_path']  = './assets/images';
								$config['allowed_types'] = 'gif|jpg|png|jpeg';
								$config['max_size']     = '4000';
								
								$this->upload->initialize($config);
								if($this->upload->do_upload('image')){
									$new_image_name = $this->upload->data('file_name');

									$this->form_validation->set_rules('full_name','Full Name','trim|required|min_length[5]|max_length[100]');
									$this->form_validation->set_rules('super_forex_account_number','SuperForex Account Number','trim|required|max_length[50]');						
									$this->form_validation->set_rules('amount','Amount','trim|required|numeric');						
									
									
									$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
									if($this->form_validation->run() == FALSE){
										// redirect('northbridge/account_created');
										foreach($_POST as $key => $value){
											$response_arr['messages'][$key] = form_error($key);
										}
									}else{
										
										
										$full_name = $this->input->post('full_name');
										$super_forex_account_number = $this->input->post('super_forex_account_number');
										$amount = $this->input->post('amount');
										
									
										$form_array = array(
											'date' => $date,
											'time' => $time,
											'user_id' => $user_id,
											'full_name' => $full_name,
											'super_forex_account_number' => $super_forex_account_number,
											'amount' => $amount,
											'exchange_rate' => $exchange_rate,
											'payment_proof' => $new_image_name
											
										);
										if($this->northbridge_model->addRequestToFundSuperForexAccount($form_array)){

											$response_arr['success'] = true;
										}
											
									}
										
								}else{
									$response_arr['errors'] .= "Image unable to upload because: <span style='font-style:italic;' class='text-danger' >". $this->upload->display_errors() . "</span><br>";
										
									
								}
							}
						}
					}
					
					echo json_encode($response_arr);
				}	
			}


			elseif($addition == "fund_superforex_account" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
						$data['super_forex_account_number'] = $user->super_forex_account_number;
					}
				
					$this->load->view('includes/home_header',$data);
					$this->load->view('pages/fund_superforex_account',$data);
					$this->load->view('includes/home_footer',$data);
				}	
			}

			elseif($addition == "admin" && $second_addition == "process_edit_exchange_rate" && is_null($third_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}
				
					$response_arr = array('success' => false,'messages' => "");

					
					
					$this->form_validation->set_rules('fund_exchange_rate','Funding Exchange Rate','trim|required|numeric');		
					$this->form_validation->set_rules('withdraw_exchange_rate','Withdrawal Exchange Rate','trim|required|numeric');	
					$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
					if($this->form_validation->run() == FALSE){
						// redirect('northbridge/account_created');
						foreach($_POST as $key => $value){
							$response_arr['messages'][$key] = form_error($key);
						}
					}else{
						
						$fund_exchange_rate = $this->input->post('fund_exchange_rate');
						$withdraw_exchange_rate = $this->input->post('withdraw_exchange_rate');
						
						$form_array = array(
							'fund_exchange_rate' => $fund_exchange_rate,
							'withdraw_exchange_rate' => $withdraw_exchange_rate
						);
						if($this->northbridge_model->updateUserTable($form_array,$user_id)){

							$response_arr['success'] = true;
						}
							
					}
				
					
					echo json_encode($response_arr);
				}	
			}

			elseif($addition == "admin" && $second_addition == "edit_exchange_rate" && is_null($third_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
						$data['fund_exchange_rate'] = $user->fund_exchange_rate;
						$data['withdraw_exchange_rate'] = $user->withdraw_exchange_rate;
						
					}

					$this->load->view('includes/admin_header',$data);
					$this->load->view('pages/edit_exchange_rate',$data);
					$this->load->view('includes/admin_footer',$data);
				}
			}


			elseif($addition == "admin" && $second_addition == "live_account_requests" && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				$data['fourth_addition'] = $fourth_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
						
					}


					$config['base_url'] = site_url('northbridge/index/admin/live_account_requests');

					$config['total_rows'] = $this->northbridge_model->getUsersWhoRequestedForLiveAccountByOffsetNum();
					$data['total_rows'] = $config['total_rows'];
					
	        		

	        		$config['per_page'] = 10;

					$config['reuse_query_string'] = TRUE;
					$config['use_page_numbers'] = TRUE;
					$config['next_link'] = 'Next';
					$config['first_link'] = 'First';
					$config['last_link'] = 'Last';
					$config['full_tag_open'] = "<ul class='pagination'>";
					$config['full_tag_close'] ="</ul>";
					$config['num_tag_open'] = '<li>';
					$config['num_tag_close'] = '</li>';
					$config['cur_tag_open'] = "<li class='disabled'><li class='active'><a href='#'>";
					$config['cur_tag_close'] = "<span class='sr-only'></span></a></li>";
					$config['next_tag_open'] = "<li>";
					$config['next_tagl_close'] = "</li>";
					$config['prev_tag_open'] = "<li>";
					$config['prev_tagl_close'] = "</li>";
					$config['first_tag_open'] = "<li>";
					$config['first_tagl_close'] = "</li>";
					$config['last_tag_open'] = "<li>";
					$config['last_tagl_close'] = "</li>";


					// By clicking on performing PREVIOUS pagination.
					$config['prev_link'] = 'Previous';



					if(!is_null($third_addition)){
						$page = $third_addition;
					}else{
						$page = 1;
					}
					
					$page = $page - 1;


	        		
	        		$data['rows'] = $this->northbridge_model->getUsersWhoRequestedForLiveAccountByOffset($page);
	        		

					$this->pagination->initialize($config);

					$data['str_links'] = $this->pagination->create_links();

					$this->load->view('includes/admin_header',$data);
					$this->load->view('pages/live_account_requests',$data);
					$this->load->view('includes/admin_footer',$data);
				}
			}


			elseif($addition == "request_live_account" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
						$live_account_request = $user->live_account_request;
					}
				
					if($this->input->post('show_records')){
						$response_arr = array('success' => false);
						$date = date("j M Y");
						$time = date("h:i:sa");

						if($live_account_request == 0 && !$this->northbridge_model->checkIfUserHasRequestedLiveAccountBefore($user_id)){
							$form_array = array(
								'live_account_request' => 1,
								'live_account_request_date_time' => $date . " " . $time
							);

							if($this->northbridge_model->updateUserTable($form_array,$user_id)){
								$form_array = array(
									'user_id' => $user_id
								);
								if($this->northbridge_model->requestForLiveAccount($form_array)){
									$response_arr['success'] = true;
								}
							}
						}

						echo json_encode($response_arr);
					}
				}	
			}

			elseif($addition == "open_live_account" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}
				
					$this->load->view('includes/home_header',$data);
					$this->load->view('pages/open_live_account',$data);
					$this->load->view('includes/home_footer',$data);
				}	
			}

			

			elseif($addition == "test_login"){
				$this->load->view('pages/log_in');
			}

			elseif($addition == "login_page"){
				if($this->northbridge_model->confirmLoggedIn(true)){
					$this->session->set_flashdata('login',true);
					redirect("northbridge/admin");
				}
				$data['test'] = "";
				$this->load->view('includes/login_header',$data);
				$this->load->view("pages/admin_log_in",$data);
				$this->load->view('includes/login_footer',$data);
				
			}

			elseif($addition == "admin" && $second_addition == "view_members_genealogy_tree" && is_null($third_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
						
					}
					if($this->input->post('show_records') && $this->input->post('user_id')){
						$user_id = $this->input->post('user_id');
						$user_name = $this->northbridge_model->getUserParamById("user_name",$user_id);
						
						$mlm_db_id = $this->northbridge_model->getUsersFirstMlmDbId($user_id);
						$package1 = "basic";
						$response_arr = array('success' => false,'messages' => '');

						
						if($this->northbridge_model->checkIfMlmDbIdBelongsToUser($mlm_db_id,$user_id)){
							$response_arr['success'] = true;
							$response_arr['user_name'] = $user_name;

							$response_arr['messages'] .= '<div class="tf-tree example">';

							$level = 20;
							$parentID = $mlm_db_id;
							$stage = 4;

							// $left_num = $this->northbridge_model->getTotalNoOfMlmAccountsUnderUserLeft($mlm_db_id);

							$user_id = $this->northbridge_model->getMlmDbParamById("user_id",$parentID);
							$logo = $this->northbridge_model->getUserParamById("logo",$user_id);
					        $user_name = $this->northbridge_model->getUserParamById("user_name",$user_id);
					        $full_name = $this->northbridge_model->getUserParamById("full_name",$user_id);
					        $package = $this->northbridge_model->getMlmDbParamById("package",$parentID);
					        $index = $this->northbridge_model->getMlmIdsIndexNumber($mlm_db_id);
					        if(is_null($logo)){
					        	$logo = "avatar21.jpg";
					        }

					        if($package == 1){
					        	$package = "basic";
					        }else{
					        	$package = "business";
					        }
					        if(is_null($logo)){
					        	$logo = "avatar21.jpg";
					        }
							$response_arr['messages'] .= '<ul>';
						    $response_arr['messages'] .= '<li>';
					    	$response_arr['messages'] .= '<div class="tf-nc ' . $package . '">';
					    	$response_arr['messages'] .= '<img class="" src="'.base_url('assets/images/'.$logo).'" style="width: 100%; border-radius: 50%; height: 40%;" alt="">';
							$response_arr['messages'] .= '<p class="name">'.$full_name.'</p>';
							$response_arr['messages'] .= '<p class="user-name">'.$user_name. ' (' . $index . ')' . '</p>';
							$response_arr['messages'] .= '<p class="package">'.$package.'</p>';
							$response_arr['messages'] .= '<div class="icons-div">';
							

							if($package == "basic"){
								$response_arr['messages'] .= '<button  onclick="goDownMlm(this,event,'.$mlm_db_id.','.$mlm_db_id.')" style="margin-right: 10px;" data-package="'.$package1.'" class="btn  btn-success btn-fab btn-fab-mini btn-round">';
							}else{
								$response_arr['messages'] .= '<button  onclick="goDownMlm(this,event,'.$mlm_db_id.','.$mlm_db_id.')"  style="margin-right: 10px;" data-package="'.$package1.'" class="btn  btn-primary btn-fab btn-fab-mini btn-round">';
							}
							$response_arr['messages'] .= '<i class="fas fa-arrow-down"></i>';
							$response_arr['messages'] .= '</button>';
					        // echo '<span class="tf-nc">'.$currentID.'</span>';
					        $response_arr['messages'] .= '</div>';

					        // $response_arr['messages'] .= '<div class="">';
					        // $response_arr['messages'] .= '<p class="ratio">2  :  10</p>';
					        // $response_arr['messages'] .= '</div>';

					        $response_arr['messages'] .= '</div>';


									            
				            
							$response_arr['messages'] .= $this->northbridge_model->printTree($package1,$mlm_db_id,$level, $parentID,$stage);
							$response_arr['messages'] .= '</li>';
							$response_arr['messages'] .= '</ul>';

							$response_arr['messages'] .= '</div>';
						}
						echo json_encode($response_arr);
					}
				}
			}

			elseif($addition == "admin" && $second_addition == "approve_user_live_account_request" && is_null($third_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
						$super_forex_account_number = $user->super_forex_account_number;
                  		$live_account_request_approved = $user->live_account_request_approved;
					}
				
					$response_arr = array('success' => false,'messages' => "",'already_approved' => true);
					$date = date("j M Y");
					$time = date("h:i:sa");
					if($this->input->post('user_id')){
						if($super_forex_account_number == "" && $live_account_request_approved == 0){
							$response_arr['already_approved'] = false;
							$user_id = $this->input->post('user_id');
						
							$this->form_validation->set_rules('super_forex_account_number','Super Forex Account Number','trim|required');						
							
							
							$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
							if($this->form_validation->run() == FALSE){
								// redirect('northbridge/account_created');
								foreach($_POST as $key => $value){
									$response_arr['messages'][$key] = form_error($key);
								}
							}else{
								
								$super_forex_account_number = $this->input->post('super_forex_account_number');
								$form_array = array(
									'super_forex_account_number' => $super_forex_account_number,
									'live_account_request_approved' => 1,
									'live_account_request_approved_date_time' => $date . " " . $time
								);
								
								if($this->northbridge_model->updateUserTable($form_array,$user_id)){
									if($this->northbridge_model->updateUserLiveAccountRequestAsSuccessful($user_id,$date,$time)){

										$response_arr['success'] = true;
									}
								}
								
							}
						}
					}
					
					echo json_encode($response_arr);
				}	
			}

			elseif($addition == "admin" && $second_addition == "debit_user" && is_null($third_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
						
					}
				
					$response_arr = array('success' => false,'messages' => "",'max' => true);

					if($this->input->post('user_id')){
						$user_id = $this->input->post('user_id');
					
						$this->form_validation->set_rules('amount','Amount','trim|required|numeric');						
						
						
						$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
						if($this->form_validation->run() == FALSE){
							// redirect('northbridge/account_created');
							foreach($_POST as $key => $value){
								$response_arr['messages'][$key] = form_error($key);
							}
						}else{
							
							$amount = $this->input->post('amount');
							$total_income = $this->northbridge_model->getUserParamById("total_income",$user_id);
							$withdrawn = $this->northbridge_model->getUserParamById("withdrawn",$user_id);
						
							$wallet_balance = $total_income - $withdrawn;

							if($amount <= $wallet_balance){
								$response_arr['max'] = false;
							
								if($this->northbridge_model->debitUser($user_id,$amount)){

									$response_arr['success'] = true;
								}
							}else{
								$response_arr['wallet_balance'] = $wallet_balance;
								
						}
							}
					}
					
					echo json_encode($response_arr);
				}	
			}


			elseif($addition == "admin" && $second_addition == "credit_user" && is_null($third_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}
				
					$response_arr = array('success' => false,'messages' => "");

					if($this->input->post('user_id')){
						$user_id = $this->input->post('user_id');
					
						$this->form_validation->set_rules('amount','Amount','trim|required|numeric');						
						
						
						$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
						if($this->form_validation->run() == FALSE){
							// redirect('northbridge/account_created');
							foreach($_POST as $key => $value){
								$response_arr['messages'][$key] = form_error($key);
							}
						}else{
							
							$amount = $this->input->post('amount');
							
							if($this->northbridge_model->creditUser($user_id,$amount)){

								$response_arr['success'] = true;
							}
								
						}
					}
					
					echo json_encode($response_arr);
				}	
			}

			elseif($addition == "admin" && $second_addition == "activate_user" && is_null($third_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}
					$response_arr = array('success' => false,'already_activated' => true);

					if($this->input->post('show_records') && $this->input->post('user_id')){
						$user_id = $this->input->post('user_id');
						if($this->northbridge_model->checkIfUserIdIsValid($user_id)){
							$active = $this->northbridge_model->getUserParamById("active",$user_id);
							if($active == 0){
								$response_arr['already_activated'] = false;
								$user_array = array(
									'active' => 1
								);
								if($this->northbridge_model->updateUserTable($user_array,$user_id)){
									$response_arr['success'] = true;
								}
							}
						}
					}

					echo json_encode($response_arr);
				}	
			}

			elseif($addition == "admin" && $second_addition == "deactivate_user" && is_null($third_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}
					$response_arr = array('success' => false,'already_deactivated' => true);

					if($this->input->post('show_records') && $this->input->post('user_id')){
						$user_id = $this->input->post('user_id');
						if($this->northbridge_model->checkIfUserIdIsValid($user_id)){
							$active = $this->northbridge_model->getUserParamById("active",$user_id);
							if($active == 1){
								$response_arr['already_deactivated'] = false;
								$user_array = array(
									'active' => 0
								);
								if($this->northbridge_model->updateUserTable($user_array,$user_id)){
									$response_arr['success'] = true;
								}
							}
						}
					}

					echo json_encode($response_arr);
				}	
			}

			elseif($addition == "admin" && $second_addition == "process-edit-users-profile" && is_null($third_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}
				
					$response_arr = array('success' => false,'messages' => "");

					if($this->input->post('user_id')){
						$user_id = $this->input->post('user_id');
					
						$this->form_validation->set_rules('phone','Phone Number','trim|required|numeric|max_length[15]|callback_phone_unique_edit_profile['.$user_id.']');						
						$this->form_validation->set_rules('email','Email Address','trim|required|valid_email|max_length[50]|callback_email_unique_edit_profile['.$user_id.']');						
						$this->form_validation->set_rules('full_name','Full Name','trim|required|min_length[5]|max_length[100]');
						$this->form_validation->set_rules('address','Address','trim|required|min_length[15]|max_length[1000]');	
						$this->form_validation->set_rules('dob','Date Of Birth','trim|required');						
						
						
						$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
						if($this->form_validation->run() == FALSE){
							// redirect('northbridge/account_created');
							foreach($_POST as $key => $value){
								$response_arr['messages'][$key] = form_error($key);
							}
						}else{
							
							
							$phone = $this->input->post('phone');
							$email = $this->input->post('email');
							$full_name = $this->input->post('full_name');
							$address = $this->input->post('address');
							$dob = $this->input->post('dob');
							//Check If Mobile Number Changed
								
							$ip_address = $this->input->ip_address();
							if($ip_address == "::1"){
								$ip_address = "197.211.60.81";
							}
					
							
							// if($this->input->valid_ip($ip_address)){
							// 	$location_info = $this->northbridge_model->custom_curl("http://api.ipstack.com/" . $ip_address . "?access_key=04b8933ab2331d1a31e653053f909b43",TRUE);
								
							// 	$location_info = json_decode($location_info);
							// 	if(is_object($location_info)){									
							// 		$calling_code = $location_info->location->calling_code;
							// 		$country_id = $this->northbridge_model->getCountryIdByCountryCode($location_info->country_code);
							// 	}else{
									$calling_code = "234";									
									$country_id = 151;
							// 	}		
							// }
						
							$form_array = array(
								'phone' => $phone,
								'address' => $address,
								'phone_code' => $calling_code,
								'country_id' => $country_id,
								'email' => $email,
								'full_name' => $full_name,
								'dob' => $dob
							);
							if($this->northbridge_model->updateUserTable($form_array,$user_id)){

								$response_arr['success'] = true;
							}
								
						}
					}
					
					echo json_encode($response_arr);
				}	
			}

			elseif($addition == "admin" && $second_addition == "get_user_info_by_id" && is_null($third_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}
					$response_arr = array('success' => false);

					if($this->input->post('show_records') && $this->input->post('user_id')){
						$user_id = $this->input->post('user_id');
						$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
						if(is_array($user_info)){
							
							foreach($user_info as $key => $value){
								$response_arr[$key] = $value;
							}
							$response_arr['success'] = true;
						}
					}

					echo json_encode($response_arr);
				}	
			}

			elseif($addition == "admin" && $second_addition == "login_page" && is_null($third_addition)){
				if($this->northbridge_model->confirmLoggedIn(true)){
					$this->session->set_flashdata('login',true);
					redirect("northbridge/admin");
				}
				$data['test'] = "";
				$this->load->view('includes/login_header',$data);
				$this->load->view("pages/admin_log_in",$data);
				$this->load->view('includes/login_footer',$data);
				
			}

			elseif($addition == "admin" && $second_addition == "process_sign_in" && is_null($third_addition)){
				$response_arr = array('success' => false,'messages' => '','test' => 0,'user_exists' => true,'wrong_password' => false,'user_deactivated' => false,'user_info' => array());

				$this->form_validation->set_rules('user_name',"User Name","required|trim");
				$this->form_validation->set_rules('password','Password','required|trim');
				$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
				if($this->form_validation->run() == FALSE){

					foreach($_POST as $key => $value){
						$response_arr['messages'][$key] = form_error($key);
					}
				}else{

					$user_name = $this->input->post('user_name');
					$hashed = sha1($this->input->post('password'));
					if($this->northbridge_model->userExistsAdmin($user_name)){
						
						$response_arr['test'] = 1;
						if($this->northbridge_model->password_verify($user_name,$hashed)){
							
							$user_info = $this->northbridge_model->getUserInfoByUserName($user_name);
							if(is_array($user_info)){
								foreach($user_info as $user){
									$user_id = $user->id;
									$user_token = $user->token;
									$active = $user->active;
								}
								
									
								if($this->northbridge_model->onRegister($user_id,$user_token)){
									$this->northbridge_model->updateUserLastActivity($user_id);
									$this->session->set_flashdata('login',true);
									$response_arr['success'] = true;
									
									$response_arr['url'] = site_url("northbridge/admin");
									
									if(!is_null($this->input->post('android'))){
										$response_arr['user_info'] = $this->northbridge_model->getAllUserInfo($user_id);
									}									
								}
									
							}
						}else{
							$response_arr['wrong_password'] = true;
						}
					}else{
						$response_arr['user_exists'] = false;
					}
				}
				echo json_encode($response_arr);
			}

			

			elseif($addition == "admin" && $second_addition == "view_all_members" && is_null($third_addition) && $this->northbridge_model->confirmLoggedIn(true)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				$data['third_addition'] = $third_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}

					$get_vars = $_GET;
					$config['base_url'] = site_url('northbridge/index/admin/view_all_members');

					$config['total_rows'] = $this->northbridge_model->getUsersPaginationByOffsetNum($get_vars);
					$data['total_rows'] = $config['total_rows'];
					
	        		

	        		$config['per_page'] = 10;

					$config['reuse_query_string'] = TRUE;
					$config['use_page_numbers'] = TRUE;
					$config['next_link'] = 'Next';
					$config['first_link'] = 'First';
					$config['last_link'] = 'Last';
					$config['full_tag_open'] = "<ul class='pagination'>";
					$config['full_tag_close'] ="</ul>";
					$config['num_tag_open'] = '<li>';
					$config['num_tag_close'] = '</li>';
					$config['cur_tag_open'] = "<li class='disabled'><li class='active'><a href='#'>";
					$config['cur_tag_close'] = "<span class='sr-only'></span></a></li>";
					$config['next_tag_open'] = "<li>";
					$config['next_tagl_close'] = "</li>";
					$config['prev_tag_open'] = "<li>";
					$config['prev_tagl_close'] = "</li>";
					$config['first_tag_open'] = "<li>";
					$config['first_tagl_close'] = "</li>";
					$config['last_tag_open'] = "<li>";
					$config['last_tagl_close'] = "</li>";

					// By clicking on performing PREVIOUS pagination.
					$config['prev_link'] = 'Previous';



					if(!is_null($third_addition)){
						$page = $third_addition;
					}else{
						$page = 1;
					}
					
					$page = $page - 1;


	        		
	        		$data['rows'] = $this->northbridge_model->getUsersPaginationByOffset($page,$get_vars);
	        		

					$this->pagination->initialize($config);

					$data['str_links'] = $this->pagination->create_links();

					$this->load->view('includes/admin_header',$data);
					$this->load->view('pages/admin_view_all_members',$data);
					$this->load->view('includes/admin_footer',$data);
				}	
			}

			elseif($addition == "edit_profile" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}
				
					$this->load->view('includes/home_header',$data);
					$this->load->view('pages/edit_profile',$data);
					$this->load->view('includes/home_footer',$data);
				}	
			}

			elseif($addition == "network_tree" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}
				
					$this->load->view('includes/home_header',$data);
					$this->load->view('pages/network_tree',$data);
					$this->load->view('includes/home_footer',$data);
				}	
			}


			elseif($addition == "process-edit-profile" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}
				
					$response_arr = array('success' => false,'messages' => "");
					
					$this->form_validation->set_rules('phone','Phone Number','trim|required|numeric|max_length[15]|callback_phone_unique_edit_profile['.$user_id.']');						
					$this->form_validation->set_rules('email','Email Address','trim|required|valid_email|max_length[50]|callback_email_unique_edit_profile['.$user_id.']');						
					$this->form_validation->set_rules('full_name','Full Name','trim|required|min_length[5]|max_length[100]');
					$this->form_validation->set_rules('address','Address','trim|required|min_length[15]|max_length[1000]');	
					$this->form_validation->set_rules('dob','Date Of Birth','trim|required');						
					
					
					$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
					if($this->form_validation->run() == FALSE){
						// redirect('northbridge/account_created');
						foreach($_POST as $key => $value){
							$response_arr['messages'][$key] = form_error($key);
						}
					}else{
						
						
						$phone = $this->input->post('phone');
						$email = $this->input->post('email');
						$full_name = $this->input->post('full_name');
						$address = $this->input->post('address');
						$dob = $this->input->post('dob');
						//Check If Mobile Number Changed
							
						$ip_address = $this->input->ip_address();
						if($ip_address == "::1"){
							$ip_address = "197.211.60.81";
						}
				
						
						// if($this->input->valid_ip($ip_address)){
						// 	$location_info = $this->northbridge_model->custom_curl("http://api.ipstack.com/" . $ip_address . "?access_key=04b8933ab2331d1a31e653053f909b43",TRUE);
							
						// 	$location_info = json_decode($location_info);
						// 	if(is_object($location_info)){									
						// 		$calling_code = $location_info->location->calling_code;
						// 		$country_id = $this->northbridge_model->getCountryIdByCountryCode($location_info->country_code);
						// 	}else{
								$calling_code = "234";									
								$country_id = 151;
						// 	}		
						// }
					
						$form_array = array(
							'phone' => $phone,
							'address' => $address,
							'phone_code' => $calling_code,
							'country_id' => $country_id,
							'email' => $email,
							'full_name' => $full_name,
							'dob' => $dob
						);
						if($this->northbridge_model->updateUserTable($form_array,$user_id)){

							$response_arr['success'] = true;
						}
							
					}
					
					echo json_encode($response_arr);
				}	
			}


			else if($addition == "view_your_genealogy_tree" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data = array('success' => false);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['phone'] = $user->phone;
						$data['email'] = $user->email;
						$data['user_phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['dob'] = $user->dob;
					}

					if($this->input->post('show_records')){
						if($this->input->post('user_id')){
							$user_id = $this->input->post('user_id');
						}
						$mlm_db_id = $this->northbridge_model->getUsersFirstMlmDbId($user_id);
						$package1 = "basic";
						$response_arr = array('success' => false,'messages' => '');


						
						if($this->northbridge_model->checkIfMlmDbIdBelongsToUser($mlm_db_id,$user_id)){
							$response_arr['success'] = true;

							$response_arr['messages'] .= '<div class="tf-tree example">';

							$level = 20;
							$parentID = $mlm_db_id;
							$stage = 4;

							// $left_num = $this->northbridge_model->getTotalNoOfMlmAccountsUnderUserLeft($mlm_db_id);

							$user_id = $this->northbridge_model->getMlmDbParamById("user_id",$parentID);
							$logo = $this->northbridge_model->getUserParamById("logo",$user_id);
					        $user_name = $this->northbridge_model->getUserParamById("user_name",$user_id);
					        $full_name = $this->northbridge_model->getUserParamById("full_name",$user_id);
					        $package = $this->northbridge_model->getMlmDbParamById("package",$parentID);
					        $index = $this->northbridge_model->getMlmIdsIndexNumber($mlm_db_id);
					        if(is_null($logo)){
					        	$logo = "avatar21.jpg";
					        }

					        if($package == 1){
					        	$package = "basic";
					        }else{
					        	$package = "business";
					        }
					        if(is_null($logo)){
					        	$logo = "avatar21.jpg";
					        }
							$response_arr['messages'] .= '<ul>';
						    $response_arr['messages'] .= '<li>';
					    	$response_arr['messages'] .= '<div class="tf-nc ' . $package . '">';
					    	$response_arr['messages'] .= '<img class="" src="'.base_url('assets/images/'.$logo).'" style="width: 100%; border-radius: 50%; height: 40%;" alt="">';
							$response_arr['messages'] .= '<p class="name">'.$full_name.'</p>';
							$response_arr['messages'] .= '<p class="user-name">'.$user_name. ' (' . $index . ')' . '</p>';
							$response_arr['messages'] .= '<p class="package">'.$package.'</p>';
							$response_arr['messages'] .= '<div class="icons-div">';
							

							if($package == "basic"){
								$response_arr['messages'] .= '<button  onclick="goDownMlm(this,event,'.$mlm_db_id.','.$mlm_db_id.')" style="margin-right: 10px;" data-package="'.$package1.'" class="btn  btn-success btn-fab btn-fab-mini btn-round">';
							}else{
								$response_arr['messages'] .= '<button  onclick="goDownMlm(this,event,'.$mlm_db_id.','.$mlm_db_id.')"  style="margin-right: 10px;" data-package="'.$package1.'" class="btn  btn-primary btn-fab btn-fab-mini btn-round">';
							}
							$response_arr['messages'] .= '<i class="fas fa-arrow-down"></i>';
							$response_arr['messages'] .= '</button>';
					        // echo '<span class="tf-nc">'.$currentID.'</span>';
					        $response_arr['messages'] .= '</div>';

					        // $response_arr['messages'] .= '<div class="">';
					        // $response_arr['messages'] .= '<p class="ratio">2  :  10</p>';
					        // $response_arr['messages'] .= '</div>';

					        $response_arr['messages'] .= '</div>';


									            
				            
							$response_arr['messages'] .= $this->northbridge_model->printTree($package1,$mlm_db_id,$level, $parentID,$stage);
							$response_arr['messages'] .= '</li>';
							$response_arr['messages'] .= '</ul>';

							$response_arr['messages'] .= '</div>';
						}
						echo json_encode($response_arr);
					}
				}
			}

			else if($addition == "view_your_genealogy_tree_down" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){

				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data = array('success' => false);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['phone_code'] = $user->phone_code;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}


					if($this->input->post('show_records') && $this->input->post('mlm_db_id') && $this->input->post('your_mlm_db_id') && $this->input->post('package')){

						if($this->input->post('user_id')){
							$user_id = $this->input->post('user_id');
						}

						$mlm_db_id = $this->input->post('mlm_db_id');
						$package1 = $this->input->post('package');
						$your_mlm_db_id = $this->input->post('your_mlm_db_id');
						if($this->northbridge_model->checkIfMlmDbIdBelongsToUser($your_mlm_db_id,$user_id)){
							$response_arr = array('success' => false,'messages' => '');
							$downline_arr = $this->northbridge_model->getDownlineArr($your_mlm_db_id);
							// print_r($downline_arr);
							if((is_array($downline_arr)  && in_array($mlm_db_id, $downline_arr)) || $your_mlm_db_id == $mlm_db_id){
								$response_arr['success'] = true;

								$response_arr['messages'] .= '<div class="tf-tree example">';

								$level = 20;
								$parentID = $mlm_db_id;
								$stage = 4;
								$user_id = $this->northbridge_model->getMlmDbParamById("user_id",$parentID);
								$logo = $this->northbridge_model->getUserParamById("logo",$user_id);
						        $user_name = $this->northbridge_model->getUserParamById("user_name",$user_id);
						        $full_name = $this->northbridge_model->getUserParamById("full_name",$user_id);
						        $package = $this->northbridge_model->getMlmDbParamById("package",$parentID);
						        $index = $this->northbridge_model->getMlmIdsIndexNumber($mlm_db_id);
						        if(is_null($logo)){
						        	$logo = "avatar21.jpg";
						        }

						        if($package == 1){
						        	$package = "basic";
						        }else{
						        	$package = "business";
						        }
						        if(is_null($logo)){
						        	$logo = "avatar21.jpg";
						        }
								$response_arr['messages'] .= '<ul>';
							    $response_arr['messages'] .= '<li>';
						    	$response_arr['messages'] .= '<div class="tf-nc ' . $package . '">';
						    	$response_arr['messages'] .= '<img class="" src="'.base_url('assets/images/'.$logo).'" style="width: 100%; border-radius: 50%; height: 40%;" alt="">';
								$response_arr['messages'] .= '<p class="name">'.$full_name.'</p>';
								$response_arr['messages'] .= '<p class="user-name">'.$user_name. ' (' . $index . ') ' . '</p>';
								$response_arr['messages'] .= '<p class="package">'.$package.'</p>';
								$response_arr['messages'] .= '<div class="icons-div">';
								
								if($package == "basic"){
									$response_arr['messages'] .= '<button  onclick="goUpMlm(this,event,'.$mlm_db_id.','.$your_mlm_db_id.')" data-package="'.$package1.'" style="margin-right: 8px;" class="btn  btn-success btn-fab btn-fab-mini btn-round">';
								}else{
									$response_arr['messages'] .= '<button  onclick="goUpMlm(this,event,'.$mlm_db_id.','.$your_mlm_db_id.')" data-package="'.$package1.'" style="margin-right: 10px;" class="btn  btn-primary btn-fab btn-fab-mini btn-round">';
								}

								$response_arr['messages'] .= '<i class="fas fa-arrow-up"></i>';
								$response_arr['messages'] .= '</button>';

								if($package == "basic"){
									$response_arr['messages'] .= '<button  onclick="goDownMlm(this,event,'.$mlm_db_id.','.$your_mlm_db_id.')" data-package="'.$package1.'" style="margin-right: 8px;" class="btn  btn-success btn-fab btn-fab-mini btn-round">';
								}else{
									$response_arr['messages'] .= '<button  onclick="goDownMlm(this,event,'.$mlm_db_id.','.$your_mlm_db_id.')" data-package="'.$package1.'" style="margin-right: 8px;" class="btn  btn-primary btn-fab btn-fab-mini btn-round">';
								}
								$response_arr['messages'] .= '<i class="fas fa-arrow-down"></i>';
								$response_arr['messages'] .= '</button>';
						        // echo '<span class="tf-nc">'.$currentID.'</span>';
						        $response_arr['messages'] .= '</div>';
						        $response_arr['messages'] .= '</div>';


										            
					            
								$response_arr['messages'] .= $this->northbridge_model->printTree($package1,$your_mlm_db_id,$level, $parentID,$stage);
								$response_arr['messages'] .= '</li>';
								$response_arr['messages'] .= '</ul>';

								$response_arr['messages'] .= '</div>';
							}
							echo json_encode($response_arr);
						}
					}
				}
			}	
	


			elseif($addition == "test_file"){
				$this->load->view("pages/test_file.txt");
			}

			elseif($addition == "get_all_users_json"){
				$this->load->view('pages/data.json');
			}

			

			elseif($addition == "process_send_message"){
				$response_arr = array('success' => false,'messages' => "");
				$this->form_validation->set_rules('mobile','Mobile Number','trim|required|numeric|max_length[15]');						
				$this->form_validation->set_rules('name','Name','trim|required|max_length[100]');						
				$this->form_validation->set_rules('message','message','trim|required');						
				
				$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
				if($this->form_validation->run() == FALSE){
					// redirect('northbridge/account_created');
					foreach($_POST as $key => $value){
						$response_arr['messages'][$key] = form_error($key);
					}
				}else{
					$mobile = $this->input->post('mobile');
					$name = $this->input->post("name");
					$message = $this->input->post("message");
					$date = date("j M Y");
					$time = date("h:i:sa");

					$form_array = array(
						'mobile' => $mobile,
						'name' => $name,
						'message' => $message,
						'date' => $date,
						'time' => $time
					);

					if($this->northbridge_model->uploadFrontPageMessage($form_array)){
						$response_arr['success'] = true;
					}
				}
				echo json_encode($response_arr);
			}




			elseif($addition == "verify_otp_edit" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$user_phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
					$response_arr = array('success' => false,'expired' => false,'invalid' => false);
					$otp_entered = $this->input->post('otp');
					$otp = $this->session->otp;
					
					if(!is_null($this->session->otp)){
						if($otp_entered == $otp){					
							$user_name = $this->session->user_name;
							$phone = $this->session->phone;
							$phone_code = $this->session->phone_code;
							$email = $this->session->email;
							$bio = $this->session->bio;
							$address = $this->session->address;
							$user_array = array(							
								'phone' => $phone,
								'phone_code' => $phone_code,
								'email' => $email,
								'bio' => $bio,
								'address' => $address
							);
							if($this->northbridge_model->updateUserTable($user_array,$user_id)){
								$response_arr['success'] = true;								
							}	
						}else{
							$response_arr['invalid'] = true;
						}
					}else{
						$response_arr['expired'] = true;
					}
					echo json_encode($response_arr);
				}           
			}

			elseif($addition == "create_font_awesome_string_android" && is_null($second_addition)){
				$myfile = fopen("application/views/pages/fonts.json", "r") or die("Unable to open file!");
				$fonts_json = fread($myfile,filesize("application/views/pages/fonts.json"));
				fclose($myfile);
				// $fonts_json = (string) $fonts_json;
				$fonts_object = json_decode($fonts_json);
				$strings_xml_str = "";
				foreach($fonts_object as $row){
					$icon_name = $row->icon_name;
					$icon_code = $row->icon_code;
					$icon_name = str_replace("-", "_", $icon_name);
					$strings_xml_str .= "<string name='" . $icon_name . "'>&#x".$icon_code.";</string>";
				}
				echo $strings_xml_str;
			}

			elseif($addition == "process-edit-profile" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$user_phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
				
					$data = array('success' => false,'messages' => "");
					
					$this->form_validation->set_rules('address','Address','trim|required|max_length[1000]');						
					$this->form_validation->set_rules('bio','Bio','trim|max_length[500]');						
					
					$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
					if($this->form_validation->run() == FALSE){
						// redirect('northbridge/account_created');
						foreach($_POST as $key => $value){
							$data['messages'][$key] = form_error($key);
						}
					}else{
						
						
						$bio = $this->input->post('bio');
						$address = $this->input->post('address');
						//Check If Mobile Number Changed
							
						$ip_address = $this->input->ip_address();
						if($ip_address == "::1"){
							$ip_address = "197.211.60.81";
						}
				
						
						// if($this->input->valid_ip($ip_address)){
						// 	$location_info = $this->northbridge_model->custom_curl("http://api.ipstack.com/" . $ip_address . "?access_key=04b8933ab2331d1a31e653053f909b43",TRUE);
							
						// 	$location_info = json_decode($location_info);
						// 	if(is_object($location_info)){									
						// 		$calling_code = $location_info->location->calling_code;
						// 		$country_id = $this->northbridge_model->getCountryIdByCountryCode($location_info->country_code);
						// 	}else{
								$calling_code = "234";									
								$country_id = 151;
						// 	}		
						// }
					
						$form_array = array(
							'bio' => $bio,
							'address' => $address,
							'phone_code' => $calling_code,
							'country_id' => $country_id
						);
						if($this->northbridge_model->updateUserTable($form_array,$user_id)){

							$data['success'] = true;
						}
							
					}
					
					echo json_encode($data);
				}	
			}

			elseif($addition == "credit_user" && is_null($second_addition) && $this->northbridge_model->checkIfUserIsAdmin()){
				$date = date("j M Y");
				$time = date("h:i:sa");
				$response_arr = array('success' => false);
				if($this->input->post('credit_user') && $this->input->post('amount') && $this->input->post('user_id')&& $this->input->post('full_name')){
					$amount = $this->input->post('amount');
					$user_id = $this->input->post('user_id');
					$full_name = $this->input->post('full_name');
					if($this->northbridge_model->creditUser($user_id,$amount,$date,$time)){
						$this->session->set_userdata('credit_success',true);
						$this->session->set_userdata('amount',$amount);
						$this->session->set_userdata('full_name',$full_name);
						$this->northbridge_model->addAdminCreditHistory($user_id,$amount,$date,$time);
	           			$response_arr['success'] = true;
	           		}
				}				
				echo json_encode($response_arr);
			}  

			elseif($addition == "load_users_for_viewing_history"  && $this->northbridge_model->confirmLoggedIn() == TRUE && $this->northbridge_model->checkIfUserIsAdmin()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
					}
					if($this->input->post('show_records')){
						$response_arr = array('success' => true,'messages' => '');
						if($this->input->post('user_name')){
							$search_val = $this->input->post('user_name');
							$users = $this->northbridge_model->searchUsers($search_val);
						}else{
							$users = $this->northbridge_model->loadAllRegisteredUsers();
						}
					  
                      
	                    if(is_array($users)){
	                   		$j = 0;
                              
                     		if($this->input->post('user_name')){
	                      		$response_arr['messages'] .= '<h3 class="text-center" style="margin: 0;">Search Results For <span class="text-primary" style="font-style: italic;">'.$search_val.'</span></h3>';
	                      	}
	                      	$response_arr['messages'] .= '<em class="text-primary">Click Member To View His History</em>';
                      		$response_arr['messages'] .= '<div class="table-responsive">';
	                      	$response_arr['messages'] .= '<table class="table table-test table-striped table-bordered nowrap hover display" id="full-user-results-table" cellspacing="0" width="100%" style="width:100%">';
	                        $response_arr['messages'] .= '<thead>';
	                        $response_arr['messages'] .= '<tr>';
	                        $response_arr['messages'] .= '<th>#</th>';
	                        $response_arr['messages'] .= '<th>Profile Picture</th>';
	                        $response_arr['messages'] .= '<th>Username</th>';
	                        $response_arr['messages'] .= '<th>Full Name</th>';
	                        $response_arr['messages'] .= '<th>Account Balance</th>';
	                        $response_arr['messages'] .= '</tr>';
	                        $response_arr['messages'] .= '</thead>';
	                        $response_arr['messages'] .= '<tbody>';
	                          
	                        for($i = 0; $i < count($users); $i++){
	                            $j++;

	                            $user_id = $users[$i];

	                            $user_name = $this->northbridge_model->getUserParamById("user_name",$user_id);
	                            $slug = $this->northbridge_model->getUserParamById("slug",$user_id);
	                            $logo = $this->northbridge_model->getUserParamById("logo",$user_id);
	                            $full_name = $this->northbridge_model->getUserParamById("full_name",$user_id);
	                            $withdrawn = $this->northbridge_model->getUserParamById("withdrawn",$user_id);
	                            $total_income = $this->northbridge_model->getUserParamById("total_income",$user_id);

	                            $income = $total_income - $withdrawn;
	                              	
                                if(is_null($logo)){
                                  $logo = "avatar.jpg";
                                }

                                if($this->input->post('user_name')){
	                          
		                            $response_arr['messages'] .= '<tr style="cursor: pointer;" onclick="viewUserHistory(this,event,true)" data-user-name="'.$user_name.'" data-full-name="'.$full_name.'" data-user-id="'.$user_id.'">';
		                        }else{
		                        	$response_arr['messages'] .= '<tr style="cursor: pointer;" onclick="viewUserHistory(this,event)" data-user-name="'.$user_name.'" data-full-name="'.$full_name.'" data-user-id="'.$user_id.'">';
		                        }

	                            $response_arr['messages'] .= '<td>'.$j.'</td>';
	                            $response_arr['messages'] .= '<td><img src="'.base_url('assets/images/'.$logo).'" alt="" height="30" width="30" class="img-round"></td>';
	                            $response_arr['messages'] .= '<td><a target="_blank" href="'.site_url('northbridge/'.$slug).'">'.$this->northbridge_model->custom_echo($user_name,35).'</a></td>';
	                            $response_arr['messages'] .= '<td>'.$this->northbridge_model->custom_echo($full_name,35).'</td>';
	                             $response_arr['messages'] .= '<td>'.number_format($income,2).'</td>';
	                            $response_arr['messages'] .= '</tr>';
	                             
	                            
	                        }
	                        $response_arr['messages'] .= '</tbody>';
	                       
	                      	$response_arr['messages'] .= '</table>';
	                        
	                  		$response_arr['messages'] .= '</div>';
                      
                       	}else{
                       		if($this->input->post('user_name')){
                       			$response_arr['messages'] .= '<h4 class="text-warning">No Results Found For <em class="text-primary">'.$search_val.'</em></h4>';
                       		}else{
                       			$response_arr['messages'] .= '<h4 class="text-warning">No Users Present</h4>';
                       		}
                       	}

                       	echo json_encode($response_arr);
					}
				}
			}


			elseif($addition == "get_contact_details_edit_profile" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$user_phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
					
					if($this->input->post('show_records')){
						$phone_number = $this->northbridge_model->getFullMobileNoByUserName($user_name);
						$response_arr = array('success' => true,'email' => $email,'phone_number' => $phone_number);
						
						echo json_encode($response_arr);
					}
				}	
			}

			elseif($addition == "send_otp_for_contact_details_edit" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$user_phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
					
					if($this->input->post('show_records')){
						$phone_number = $this->northbridge_model->getFullMobileNoByUserName($user_name);
						$response_arr = array('success' => false,'email' => $email,'phone_number' => $phone_number);

						$otp = rand ( 10000 , 99999 );
						$email_arr = array($email);
						if($this->northbridge_model->sendOtpEmail($email_arr,$otp)){
							$this->session->set_userdata('otp',$otp);
							$this->session->set_userdata('edit_contact_details_first_step',$user_name);

							$response_arr['success'] = true;
							if($_SERVER['SERVER_NAME'] == "localhost"){
								$response_arr['otp'] = $otp;
							}
						}
						
						echo json_encode($response_arr);
					}
				}	
			}

			elseif($addition == "verify_otp_edit_profile" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$user_phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
					
					
						
					$response_arr = array('success' => false,'expired' => false,'incomplete_detais' => false,'incorrect_otp' => false);

					if(isset($_SESSION['otp']) && isset($_SESSION['edit_contact_details_first_step'])){
						$user_name = $_SESSION['edit_contact_details_first_step'];
						$session_otp = $_SESSION['otp'];

						if($this->northbridge_model->checkIfUserNameExists($user_name)){
							$user_id = $this->northbridge_model->getUserIdByName($user_name);

							if($this->input->post('otp')){
								
								$otp = $this->input->post('otp');
		
								if($otp == $session_otp){
							
									session_unset();
									$this->session->set_userdata('edit_contact_details_second_step',$user_name);
									$response_arr['success'] = true;
									$phone_number = $this->northbridge_model->getUserParamById("phone",$user_id);
									$email = $this->northbridge_model->getUserParamById("email",$user_id);
									$response_arr['phone_number'] = $phone_number;
									$response_arr['email'] = $email;
									
								}else{
									$response_arr['incorrect_otp'] = true;
								}
											
							}else{
								$response_arr['incomplete_detais'] = true;
							}
						}		
					}else{
						$response_arr['expired'] = true;
					}
											
					echo json_encode($response_arr);
					
				}	
			}

			elseif($addition == "edit_contact_details" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$user_phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
					
					
						
					$response_arr = array('success' => false,'expired' => false,'messages' => array());

					if(isset($_SESSION['edit_contact_details_second_step'])){
						$user_name = $_SESSION['edit_contact_details_second_step'];
						

						if($this->northbridge_model->checkIfUserNameExists($user_name)){
							$user_id = $this->northbridge_model->getUserIdByName($user_name);

							
							$this->form_validation->set_rules('phone_number','Phone Number','trim|required|numeric|max_length[15]|callback_phone_unique_edit_profile['.$user_id.']');
							$this->form_validation->set_rules('email','Email Address','trim|required|valid_email|max_length[50]');							
							$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
							if($this->form_validation->run()){

								$phone_number = $this->input->post('phone_number');
								$email = $this->input->post('email');

								$ip_address = $this->input->ip_address();
								if($ip_address == "::1"){
									$ip_address = "197.211.60.81";
								}
						
								
								// if($this->input->valid_ip($ip_address)){
								// 	$location_info = $this->northbridge_model->custom_curl("http://api.ipstack.com/" . $ip_address . "?access_key=04b8933ab2331d1a31e653053f909b43",TRUE);
									
								// 	$location_info = json_decode($location_info);
								// 	if(is_object($location_info)){
										
									// 	$calling_code = $location_info->location->calling_code;
									// 	$country_id = $this->northbridge_model->getCountryIdByCountryCode(strtolower($location_info->country_code));
										
										
									// }else{
										$calling_code = "234";
										
									// }

									$form_array = array(
										'phone_code' => $calling_code,
										'phone' => $phone_number,
										'email' => $email
									);

									if($this->northbridge_model->updateUserTable($form_array,$user_id)){
										$response_arr['success'] = true;

										session_unset();
									}
								// }
							}else{
								foreach($_POST as $key => $value){
									$response_arr['messages'][$key] = form_error($key);
								}	
							}
						}		
					}else{
						$response_arr['expired'] = true;
					}
											
					echo json_encode($response_arr);
					
				}	
			}

			elseif($addition == "get_user_posts" && is_null($second_addition)){
				$response_arr = array('success' => false,'no_post' => true,'messages' => array());
				if($this->input->post('user_id')){
					$response_arr['no_post'] = false;
					$user_id = $this->input->post('user_id');
					$posts_by_user = $this->northbridge_model->get_user_posts($user_id);
					if($posts_by_user){
						if(is_array($posts_by_user)){
							$response_arr['success'] = true;
							foreach($posts_by_user as $row){
								$post_id = $row->id;
								$content = $row->content;
								$slug = $row->slug;
								$images = $row->images;
								$likes = $row->likes;
								$likes = explode(",", $likes);
								$likes = count($likes);
								$date_time = $row->date . " " . $row->time;

								$ret_arr = array(
									'id' => $post_id,
									'content' => $content,
									'slug' => $slug,
									'images' => $images,
									'likes' => $likes,
									'date_time' => $date_time
								);

								$response_arr['messages'][] = $ret_arr;
							}
						}	
					}
				}
				echo json_encode($response_arr);
			}

			elseif($addition == "verify_user_name_and_password" && is_null($second_addition)){
				$response_arr = array('success' => false,'code' => '' ,'phone' => '','not_enough_money' => false,'user_exists' => true,'invalid_password' => false);
				if($this->input->post('user_name_login') && $this->input->post('password_login')){
					$user_name = $this->input->post('user_name_login');
					$password = $this->input->post('password_login');

					if($this->northbridge_model->checkIfUserNameExists($user_name)){
						$hashed = sha1($password);
						if($this->northbridge_model->password_verify($user_name,$hashed)){
							$user_id = $this->northbridge_model->getUserIdByName($user_name);
							$user_total_amount = $this->northbridge_model->getUserTotalAmountByUse($user_id);
							if($user_total_amount >= 3500){
								$code = $this->northbridge_model->getUserPhoneCodeByUserId($user_id);
								$phone = $this->northbridge_model->getUserPhoneNumberByUserId($user_id);
								$response_arr['success'] = true;
								$response_arr['code'] = $code;
								$response_arr['phone'] = $phone;
								$response_arr['user_name'] = $user_name;
							}else{
								$response_arr['not_enough_money'] = true;
							}
						}else{
							$response_arr['invalid_password'] = true;
						}
					}else{
						$response_arr['user_exists'] = false;
					}
				}
				echo json_encode($response_arr);
			}



			elseif($addition == "account_kit_test" && is_null($second_addition)){
				$this->load->view('pages/account_kit_test');
			}

			 elseif($addition == "account_kit_test_cont" && is_null($second_addition)){
			 	$app_id = '320429851941197';
				$secret = '7e3c153a0bebd2061377a09a3679a149';
				$version = 'v1.0'; // 'v1.1' for example

				// Method to send Get request to url
				

				// Exchange authorization code for access token
				$token_exchange_url = 'https://graph.accountkit.com/'.$version.'/access_token?'.
				  'grant_type=authorization_code'.
				  '&code='.$_POST['code'].
				  "&access_token=AA|$app_id|$secret";
				$data = json_decode($this->northbridge_model->curl($token_exchange_url,TRUE));
				$user_id = $data['id'];
				$user_access_token = $data['access_token'];
				$refresh_interval = $data['token_refresh_interval_sec'];

				// Get Account Kit information
				$me_endpoint_url = 'https://graph.accountkit.com/'.$version.'/me?'.
				  'access_token='.$user_access_token;
				$data = json_decode($this->northbridge_model->curl($me_endpoint_url,TRUE));
				$phone = isset($data['phone']) ? $data['phone']['number'] : '';
				$email = isset($data['email']) ? $data['email']['address'] : '';
				
				set_cookie('phone',$phone);

			 }
			elseif($addition == "test" && is_null($second_addition)){
				// $config['image_library'] = 'gd2';
				// $config['source_image'] = './assets/images/avatar.jpg';
				// $config['create_thumb'] = TRUE;
				// $config['maintain_ratio'] = TRUE;
				// $config['width']         = 400;
				// $config['height']       = 400;

				// $this->load->library('image_lib', $config);

				// if($this->image_lib->resize()){
				// 	echo "Image Resized";
				// }
				

				// $depts = $this->northbridge_model->getDepts();
				// if(is_array($depts)){
				// 	// print_r($depts);
				// 	foreach($depts as $dept){
				// 		$dept_id = $dept->id;
				// 		$dept_name = $dept->name;
				// 		$dept_slug = url_title($dept_name);
				// 		// echo $dept_slug;
				// 		$form_array = array(
				// 			'slug' => $dept_slug
				// 		);
				// 		if($this->northbridge_model->slugifyDept($form_array,$dept_id)){
				// 			echo "string";
				// 		}
				// 	}
				// }
				// session_unset();
				$data['arr'] = json_encode(array('one','two','three'));
				unset($_SESSION['northbridgerem']);
				// require_once(APPPATH.'libraries/paystack-php-master/src/Paystack.php');
				// $paystack = new Paystack('sk_test_825b7e4335009662e7518b31d4a98f4869415448');
				// $responseObj = $paystack->transaction->initialize([
				//      "reference"=>"7PVGX8MEk85tgeEpVDtD",
				//      "amount"=>500000,
				//      "email"=>"ikechukwunwogo@email.com",
				// ]);
				// $auth_url = $this->paystack->init("7PVGX8MEk85tgeEpVD", 50000, 'ikechukwunwogo@gmail.com',[
    //         'name'=>"Nwogo David",
            
    //         "Phone"=>"08127027321"
    //     ]);
				// redirect($auth_url);
				// echo $auth_url;
				
				// $ver_info = $this->paystack->verifyTransaction('7PVGX8MEk85tgeE');
				// print_r($ver_info);
				
				// $recepients = array('northbridgeresources@gmail.com','support@northbridgeissues.com','customercare@northbridgeissues.com','admin@northbridgeissues.com');
				// $subject = "Testing The Mail Service";
				// $message = "Hello World";
				// if($this->northbridge_model->sendEmail($recepients,$subject,$message)){
				// 	echo "successful";
				// }
				
				$this->load->view('pages/test_page.php',$data);
				$this->load->view('includes/admin_footer',$data);

			}

			elseif($addition == "chat_test" && is_null($second_addition)){
				$this->load->view('pages/chat_test');
			}

			elseif($addition == "process_users" && is_null($second_addition)){
				$this->load->view('pages/data.json');
			}

			elseif($addition == "test-ajax" && is_null($second_addition)){
				if($this->input->post('first_name') && $this->input->post('last_name') && $this->input->post('email')){
					$first_name = $this->input->post('first_name');
					$last_name = $this->input->post('last_name');
					$email = $this->input->post('email');
					$result = array();
					//Set other parameters as keys in the $postdata array

				}

			}

			elseif($this->northbridge_model->getUserBySlug($addition) == true && $second_addition == "change_user_cover_photo"  && $this->northbridge_model->confirmLoggedIn() == TRUE  && is_null($third_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$cover_photo =  $user->cover_photo;
					}
					
			            // print_r($this->input->post());
			            // print_r($_FILES);
			            $response_arr = array('success' => false,'errors' => '','new_image_name' => '','empty' => true);
			            if($data['user_name'] == $this->northbridge_model->getUserNameBySlug($addition)){
				           	if(!empty($_FILES['image']['name'])){
				           		$response_arr['empty'] = false;
								$files_count = count($_FILES['image']['name']);
								
								if($files_count == 1){
									for($i = 0; $i < $files_count; $i++){
										$pos = $i + 1;
										$_FILES['file']['name']     = $_FILES['image']['name'][$i];
						                $_FILES['file']['type']     = $_FILES['image']['type'][$i];
						                $_FILES['file']['tmp_name'] = $_FILES['image']['tmp_name'][$i];
						                $_FILES['file']['error']     = $_FILES['image']['error'][$i];
						                $_FILES['file']['size']     = $_FILES['image']['size'][$i];

						                $config['encrypt_name'] = true;
						                $config['upload_path']  = './assets/images';
										$config['allowed_types'] = 'gif|jpg|png|jpeg';
										$config['max_size']     = '4000';
										
										$this->upload->initialize($config);
										if($this->upload->do_upload('image')){
											$old_image_name = $cover_photo;
											$new_image_name = $this->upload->data('file_name');
											$form_array = array(
												'cover_photo' => $new_image_name
											);		
											if($this->northbridge_model->updateUserTable($form_array,$user_id)){
												if(!is_null($old_image_name)){

													unlink('./assets/images/'.$old_image_name);
												}
												$response_arr['success'] = true;
												$new_image_name = base_url('assets/images/'.$new_image_name);
												$response_arr['new_image_name'] = $new_image_name;
											}
										}else{
											$response_arr['errors'] .= "Image unable to upload because: <span style='font-style:italic;' class='text-danger' >". $this->upload->display_errors() . "</span><br>";
										}
									}
								}else{
									$response_arr['errors'] .= "Sorry You Must Select One Image";
								}
							}
						}
						echo json_encode($response_arr);			        
					    
				}
			}

			//Change User Logo

			elseif($this->northbridge_model->getUserBySlug($addition) == true && $second_addition == "change_user_logo"  && $this->northbridge_model->confirmLoggedIn() == TRUE  && is_null($third_addition)){

				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
					}
					$data['curr_health_facility_arr'] = $this->northbridge_model->getHealthFacilityInfoBySlug($addition);
					
		            $response_arr = array('success' => false,'errors' => '','new_image_name' => '','empty' => true);
		            if($data['user_name'] == $this->northbridge_model->getUserNameBySlug($addition)){
			           	if(!empty($_FILES['image']['name'])){
			           		$response_arr['empty'] = false;
							$files_count = count($_FILES['image']['name']);
							
							if($files_count == 1){
								for($i = 0; $i < $files_count; $i++){
									$pos = $i + 1;
									$_FILES['file']['name']     = $_FILES['image']['name'][$i];
					                $_FILES['file']['type']     = $_FILES['image']['type'][$i];
					                $_FILES['file']['tmp_name'] = $_FILES['image']['tmp_name'][$i];
					                $_FILES['file']['error']     = $_FILES['image']['error'][$i];
					                $_FILES['file']['size']     = $_FILES['image']['size'][$i];

					                $config['encrypt_name'] = true;
					                $config['upload_path']  = './assets/images';
									$config['allowed_types'] = 'jpg|png|jpeg';
									$config['max_size']     = '5000';
									
									$this->upload->initialize($config);
									$this->load->library('image_lib');
									if($this->upload->do_upload('image')){
										$old_image_name = $data['logo'];
										$new_image_name = $this->upload->data('file_name');
										$config['image_library'] = 'gd2';
									    $config['source_image'] = realpath('./assets/images/'.$new_image_name);
									    $config['create_thumb'] = TRUE;
									    // $config['maintain_ratio'] = TRUE;
									    $config['quality'] = '100%';
									    $config['width']     = 300;
									    $config['height']   = 300;

									    $this->image_lib->clear();
									    $this->image_lib->initialize($config);
									    if($this->image_lib->resize()){
									    	unlink(realpath('./assets/images/'.$new_image_name));
				                			$new_image_name = $this->upload->data('raw_name') .'_thumb' . $this->upload->data('file_ext');
											$form_array = array(
												'logo' => $new_image_name
											);		
											if($this->northbridge_model->updateUserTable($form_array,$user_id)){
												if(!is_null($old_image_name)){

													unlink('./assets/images/'.$old_image_name);
												}
												$response_arr['success'] = true;
												$new_image_name = base_url('assets/images/'.$new_image_name);
												$response_arr['new_image_name'] = $new_image_name;
											}
										}
									}else{
										$response_arr['errors'] .= "Image unable to upload because: <span style='font-style:italic;' class='text-danger' >". $this->upload->display_errors() . "</span><br>";
									}
								}
							}else{
								$response_arr['errors'] .= "Sorry You Must Select One Image";
							}
						}
					}
					echo json_encode($response_arr);			        
					
				}
			}

			//Change Health Facility Logo

			elseif($this->northbridge_model->getFacilityBySlug($addition) == true && $second_addition == "change_facility_logo"  && $this->northbridge_model->confirmLoggedIn() == TRUE  && is_null($third_addition)){

				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
					}
					$data['curr_health_facility_arr'] = $this->northbridge_model->getHealthFacilityInfoBySlug($addition);
					if(is_array($data['curr_health_facility_arr'])){
		              	foreach($data['curr_health_facility_arr'] as $row){
		              		$health_facility_id = $row->id;
		                	$health_facility_name = $row->name;
		               		$health_facility_logo = $row->logo;
		               		$health_facility_structure = $row->facility_structure;
			                $health_facility_email = $row->email;
			                $health_facility_phone = $row->phone;
			                $health_facility_country = $row->country;
			                $health_facility_state = $row->state;
			                $health_facility_address = $row->address;
			                $health_facility_table_name = $row->table_name;
			                $health_facility_date = $row->date;
			                $health_facility_time = $row->time;
			                $health_facility_slug = $row->slug;
			            }
			            // print_r($this->input->post());
			            // print_r($_FILES);
			            $response_arr = array('success' => false,'errors' => '','new_image_name' => '','empty' => true);
			           	if(!empty($_FILES['image']['name'])){
			           		$response_arr['empty'] = false;
							$files_count = count($_FILES['image']['name']);
							
							if($files_count == 1){
								for($i = 0; $i < $files_count; $i++){
									$pos = $i + 1;
									$_FILES['file']['name']     = $_FILES['image']['name'][$i];
					                $_FILES['file']['type']     = $_FILES['image']['type'][$i];
					                $_FILES['file']['tmp_name'] = $_FILES['image']['tmp_name'][$i];
					                $_FILES['file']['error']     = $_FILES['image']['error'][$i];
					                $_FILES['file']['size']     = $_FILES['image']['size'][$i];

					                $config['encrypt_name'] = true;
					                $config['upload_path']  = './assets/images';
									$config['allowed_types'] = 'gif|jpg|png|jpeg';
									$config['max_size']     = '100';
									$config['max_width'] = '300';
									$config['max_height'] = '300';
									$this->upload->initialize($config);
									if($this->upload->do_upload('image')){
										$old_image_name = $health_facility_logo;
										$new_image_name = $this->upload->data('file_name');
										$form_array = array(
											'logo' => $new_image_name
										);		
										if($this->northbridge_model->updateHealthFacility($form_array,$addition)){
											if(!is_null($old_image_name)){

												unlink('./assets/images/'.$old_image_name);
											}
											$response_arr['success'] = true;
											$new_image_name = base_url('assets/images/'.$new_image_name);
											$response_arr['new_image_name'] = $new_image_name;
										}
									}else{
										$response_arr['errors'] .= "Image unable to upload because: <span style='font-style:italic;' class='text-danger' >". $this->upload->display_errors() . "</span><br>";
									}
								}
							}else{
								$response_arr['errors'] .= "Sorry You Must Select One Image";
							}
						}
						echo json_encode($response_arr);			        
					}    
				}
			}

			//Change Cover Photo

			

			
			elseif($addition == 1 || $addition == 2 || $addition == 3 && $this->northbridge_model->confirmLoggedIn() == TRUE && is_null($second_addition)){
				$this->load->view('welcome_message', array('user_id' => $addition));
			}

			elseif($addition == "test_page" && is_null($second_addition)){
				$data['test'] = "";
				$this->load->view('pages/file_upload_test',$data);
				// $this->load->view('includes/admin_footer',$data);
			}

			elseif($addition == "post" && $this->northbridge_model->getIfPostIsValid($second_addition,$third_addition) && is_null($fourth_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				

				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
					$title = $this->northbridge_model->getPostTitleById($second_addition);
					$data['title'] = $title;
					$this->load->view('includes/admin_header',$data);
					$this->load->view('pages/view_post',$data);
					$this->load->view('includes/admin_footer',$data);
				}
			}



			elseif($addition == "get_forms_for_funds_withdrawal" && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $row){
						$id = $row->id;
						$created = $row->created;
						$created_date = $row->created_date;
						$created_time = $row->created_time;
						$sms_enabled = $row->sms_enabled;
						$notif_enabled = $row->notif_enabled;
						$email_enabled = $row->email_enabled;
						$admin_sms_enabled = $row->admin_sms_enabled;
						$admin_email_enabled = $row->admin_email_enabled;
						$followers = $row->followers;
						$following = $row->following;
						$user_name = $row->user_name;
						$sponsor_income = $row->sponsor_income;
						$withdrawn = $row->withdrawn;
						$admin_vat_total = $row->admin_vat_total;
						$total_basic_withdrawn = $row->total_basic_withdrawn;
						$total_basic_income = $row->total_basic_income;
						$total_business_income = $row->total_business_income;
						$total_business_withdrawn = $row->total_business_withdrawn;
						$total_income = $row->total_income;
						$admin_mlm_withdrawn = $row->admin_mlm_withdrawn;
						$last_activity = $row->last_activity;
						$full_name = $row->full_name;
						$hashed = $row->hashed;
						$token = $row->token;
						$email = $row->email;
						$phone = $row->phone;
						$phone_code = $row->phone_code;
						$logo = $row->logo;
						$cover_photo = $row->cover_photo;
						$bio = $row->bio;
						$country_id = $row->country_id;
						$state_id = $row->state_id;
						$local_government = $row->local_government;
						$city = $row->city;
						$address = $row->address;
						$place_of_use = $row->place_of_use;
						$whatsapp_user = $row->whatsapp_user;
						$center_leader = $row->center_leader;
						$slug = $row->slug;
						$register = $row->register;
						$is_admin = $row->is_admin;
						$date = $row->date;
						$time = $row->time;
						$user_bank_name = $row->bank_name;
						$account_number = $row->account_number;
						$recepient_code = $row->recepient_code;
						$referred_by = $row->referred_by;
						$dispatcher = $row->dispatcher;
						$center_leader_selection_income = $row->center_leader_selection_income;
						$admin_center_leader_selection_income = $row->admin_center_leader_selection_income;
						$mlm_withdrawn = $row->mlm_withdrawn;
					}

					if($this->input->post('show_records')){
						$response_arr = array('success' => false,'messages' => '');
						$banks_arr = $this->paystack->curl("https://api.paystack.co/bank",FALSE);
		                $banks_arr = json_decode($banks_arr);

						if($banks_arr->status && $banks_arr->message == "Banks retrieved"){
	                    	$response_arr['success'] = true;
	                        $bank_names = $banks_arr->data;


		                    $attr = array('id' => 'bank-details-form','onsubmit' => 'submitBankDetailsForm(this,event)');
		                    $response_arr['messages'] .= form_open("",$attr);
		                  
		                    $response_arr['messages'] .= '<div class="form-group col-sm-12">';
		                    $response_arr['messages'] .= '<label for="bank_name">Select Bank Name: </label>';
		                    $response_arr['messages'] .= '<select name="bank_name" id="bank_name" class="form-control selectpicker" data-style="btn btn-link" required>';
		                        
		                    
	                          

	                        foreach($bank_names as $row){
                                $bank_name = $row->name;
                                $code = $row->code;
                                $long_code = $row->longcode;
                                $active = $row->active;
                                $is_deleted = $row->is_deleted;
                                $id = $row->id;
	                        
	                        	$response_arr['messages'] .= '<option value="'.$code.'"';
	                        	if($code == $user_bank_name){ 
	                        		$response_arr['messages'] .= "selected"; 
	                        	} 
	                        	$response_arr['messages'] .= '>';
	                        	$response_arr['messages'] .= $bank_name; 
	                        	$response_arr['messages'] .= '</option>';
	                        }
	                        $response_arr['messages'] .= '</select>';
		                    $response_arr['messages'] .= '<span class="form-error"></span>';
		                    $response_arr['messages'] .= '</div>';

		                    $response_arr['messages'] .= '<div class="form-group col-sm-12">';
		                    $response_arr['messages'] .= '<label for="account_number">Enter Account Number: </label>';
		                    $response_arr['messages'] .= '<input type="number" class="form-control" name="account_number" id="account_number" value="';
		                    if($account_number !== 0){ 
		                    	$response_arr['messages'] .= $account_number; 
		                    } 
		                    $response_arr['messages'] .= '" required>';
		                    $response_arr['messages'] .= '<span class="form-error"></span>';
		                    $response_arr['messages'] .= '</div>';
		                    $response_arr['messages'] .= '<input type="submit" class="btn btn-primary">';
		    
		                  	$response_arr['messages'] .= '</form>';

		                  	$attr = array('id' => 'enter-amount-to-withdraw-form','style' => 'display: none;','onsubmit' => 'submitAmountToWithdrawForm(this,event)');
		                    $response_arr['messages'] .= form_open("",$attr);

		                    $response_arr['messages'] .= '<div class="form-group">';
		                    $response_arr['messages'] .= '<input type="number" class="form-control" id="amount" name="amount" placeholder="Enter Amount" max="" min="200" required>';
		                    $response_arr['messages'] .= '</div>';
		                    $response_arr['messages'] .= '<input type="submit" class="btn btn-primary">';
		                  	$response_arr['messages'] .= '</form>';
	                    }
	                    
						echo json_encode($response_arr);
					}
					
				}
			}

			elseif($addition == "enter_amount_withdraw_funds" && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $row){
						$id = $row->id;
						$created = $row->created;
						$created_date = $row->created_date;
						$created_time = $row->created_time;
						$sms_enabled = $row->sms_enabled;
						$notif_enabled = $row->notif_enabled;
						$email_enabled = $row->email_enabled;
						$admin_sms_enabled = $row->admin_sms_enabled;
						$admin_email_enabled = $row->admin_email_enabled;
						$followers = $row->followers;
						$following = $row->following;
						$user_name = $row->user_name;
						$sponsor_income = $row->sponsor_income;
						$withdrawn = $row->withdrawn;
						$admin_vat_total = $row->admin_vat_total;
						$total_basic_withdrawn = $row->total_basic_withdrawn;
						$total_basic_income = $row->total_basic_income;
						$total_business_income = $row->total_business_income;
						$total_business_withdrawn = $row->total_business_withdrawn;
						$total_income = $row->total_income;
						$admin_mlm_withdrawn = $row->admin_mlm_withdrawn;
						$last_activity = $row->last_activity;
						$full_name = $row->full_name;
						$hashed = $row->hashed;
						$token = $row->token;
						$email = $row->email;
						$phone = $row->phone;
						$phone_code = $row->phone_code;
						$logo = $row->logo;
						$cover_photo = $row->cover_photo;
						$bio = $row->bio;
						$country_id = $row->country_id;
						$state_id = $row->state_id;
						$local_government = $row->local_government;
						$city = $row->city;
						$address = $row->address;
						$place_of_use = $row->place_of_use;
						$whatsapp_user = $row->whatsapp_user;
						$center_leader = $row->center_leader;
						$slug = $row->slug;
						$register = $row->register;
						$is_admin = $row->is_admin;
						$date = $row->date;
						$time = $row->time;
						$user_bank_name = $row->bank_name;
						$account_number = $row->account_number;
						$recepient_code = $row->recepient_code;
						$referred_by = $row->referred_by;
						$dispatcher = $row->dispatcher;
						$center_leader_selection_income = $row->center_leader_selection_income;
						$admin_center_leader_selection_income = $row->admin_center_leader_selection_income;
						$mlm_withdrawn = $row->mlm_withdrawn;
					}

					if($this->input->post('amount')){
						$response_arr = array('success' => false,'not_bouyant' => false,'too_small' => false);
						$amount = $this->input->post("amount");
						if(is_numeric($amount)){
							if($amount >= 200){
								$available_income = $total_income - $withdrawn;
								if($amount <= $available_income){
									$response_arr['success'] = true;
									$response_arr['phone_number'] = $phone;
									$response_arr['code'] = $phone_code;
								}else{
									$response_arr['not_bouyant'] = true;
								}
							}else{
								$response_arr['too_small'] = true;
							}
						}
						echo json_encode($response_arr);
					}
					
				}
			}

			elseif($addition == "send_withdrwal_otp" && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $row){
						$id = $row->id;
						$created = $row->created;
						$created_date = $row->created_date;
						$created_time = $row->created_time;
						$sms_enabled = $row->sms_enabled;
						$notif_enabled = $row->notif_enabled;
						$email_enabled = $row->email_enabled;
						$admin_sms_enabled = $row->admin_sms_enabled;
						$admin_email_enabled = $row->admin_email_enabled;
						$followers = $row->followers;
						$following = $row->following;
						$user_name = $row->user_name;
						$sponsor_income = $row->sponsor_income;
						$withdrawn = $row->withdrawn;
						$admin_vat_total = $row->admin_vat_total;
						$total_basic_withdrawn = $row->total_basic_withdrawn;
						$total_basic_income = $row->total_basic_income;
						$total_business_income = $row->total_business_income;
						$total_business_withdrawn = $row->total_business_withdrawn;
						$total_income = $row->total_income;
						$admin_mlm_withdrawn = $row->admin_mlm_withdrawn;
						$last_activity = $row->last_activity;
						$full_name = $row->full_name;
						$hashed = $row->hashed;
						$token = $row->token;
						$email = $row->email;
						$phone = $row->phone;
						$phone_code = $row->phone_code;
						$logo = $row->logo;
						$cover_photo = $row->cover_photo;
						$bio = $row->bio;
						$country_id = $row->country_id;
						$state_id = $row->state_id;
						$local_government = $row->local_government;
						$city = $row->city;
						$address = $row->address;
						$place_of_use = $row->place_of_use;
						$whatsapp_user = $row->whatsapp_user;
						$center_leader = $row->center_leader;
						$slug = $row->slug;
						$register = $row->register;
						$is_admin = $row->is_admin;
						$date = $row->date;
						$time = $row->time;
						$user_bank_name = $row->bank_name;
						$account_number = $row->account_number;
						$recepient_code = $row->recepient_code;
						$referred_by = $row->referred_by;
						$dispatcher = $row->dispatcher;
						$center_leader_selection_income = $row->center_leader_selection_income;
						$admin_center_leader_selection_income = $row->admin_center_leader_selection_income;
						$mlm_withdrawn = $row->mlm_withdrawn;
					}

					if($this->input->post('amount')){
						$response_arr = array('success' => false,'messages' => '','not_bouyant' => false,'too_small' => false);
						$amount = $this->input->post("amount");
						if(is_numeric($amount)){
							if($amount >= 200){
								$available_income = $total_income - $withdrawn;
								if($amount <= $available_income){
									$otp = rand ( 10000 , 99999 );
									$email_arr = array($email);
									if($this->northbridge_model->sendOtpEmail($email_arr,$otp)){
										session_unset();
										$this->session->set_userdata('otp',$otp);
										$this->session->set_userdata('withdrawal_first_step',$user_name);
										
										$response_arr['success'] = true;
										//Change This Once In Development
										if($_SERVER['SERVER_NAME'] == "localhost"){
											$response_arr['otp'] = $otp;
										}
										$response_arr['phone_number'] = $phone;
										$response_arr['code'] = $phone_code;
										$response_arr['email'] = $email;

										$attr = array('id' => 'withdrawal-otp-form','onsubmit' => 'submitWithdrawalOtpForm(this,event)');
										$response_arr['messages'] .= form_open('northbridge/validate_withdrawal_otp',$attr);

										$response_arr['messages'] .= '<div class="form-group">';

										$response_arr['messages'] .= '<input name="otp" id="otp" class="form-control" placeholder="Enter OTP.....">';
										$response_arr['messages'] .= '<span class="form-error"></span>';

										$response_arr['messages'] .= '</div>';
										$response_arr['messages'] .= '</form>';
									}	
									
								}else{
									$response_arr['not_bouyant'] = true;
								}
							}else{
								$response_arr['too_small'] = true;
							}
						}
						echo json_encode($response_arr);
					}
					
				}
			}

			elseif($addition == "validate_withdrawal_otp" && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $row){
						$id = $row->id;
						$created = $row->created;
						$created_date = $row->created_date;
						$created_time = $row->created_time;
						$sms_enabled = $row->sms_enabled;
						$notif_enabled = $row->notif_enabled;
						$email_enabled = $row->email_enabled;
						$admin_sms_enabled = $row->admin_sms_enabled;
						$admin_email_enabled = $row->admin_email_enabled;
						$followers = $row->followers;
						$following = $row->following;
						$user_name = $row->user_name;
						$sponsor_income = $row->sponsor_income;
						$withdrawn = $row->withdrawn;
						$admin_vat_total = $row->admin_vat_total;
						$total_basic_withdrawn = $row->total_basic_withdrawn;
						$total_basic_income = $row->total_basic_income;
						$total_business_income = $row->total_business_income;
						$total_business_withdrawn = $row->total_business_withdrawn;
						$total_income = $row->total_income;
						$admin_mlm_withdrawn = $row->admin_mlm_withdrawn;
						$last_activity = $row->last_activity;
						$full_name = $row->full_name;
						$hashed = $row->hashed;
						$token = $row->token;
						$email = $row->email;
						$phone = $row->phone;
						$phone_code = $row->phone_code;
						$logo = $row->logo;
						$cover_photo = $row->cover_photo;
						$bio = $row->bio;
						$country_id = $row->country_id;
						$state_id = $row->state_id;
						$local_government = $row->local_government;
						$city = $row->city;
						$address = $row->address;
						$place_of_use = $row->place_of_use;
						$whatsapp_user = $row->whatsapp_user;
						$center_leader = $row->center_leader;
						$slug = $row->slug;
						$register = $row->register;
						$is_admin = $row->is_admin;
						$date = $row->date;
						$time = $row->time;
						$user_bank_name = $row->bank_name;
						$account_number = $row->account_number;
						$recepient_code = $row->recepient_code;
						$referred_by = $row->referred_by;
						$dispatcher = $row->dispatcher;
						$center_leader_selection_income = $row->center_leader_selection_income;
						$admin_center_leader_selection_income = $row->admin_center_leader_selection_income;
						$mlm_withdrawn = $row->mlm_withdrawn;
					}

					$response_arr = array('success' => false,'messages' => '','not_bouyant' => false,'too_small' => false,'expired' => false,'incomplete_detais' => false,'incorrect_otp' => false);

					if($this->input->post('amount')){
						
						
						if(isset($_SESSION['otp']) && isset($_SESSION['withdrawal_first_step'])){
							$user_name = $_SESSION['withdrawal_first_step'];
							$session_otp = $_SESSION['otp'];

							if($this->northbridge_model->checkIfUserNameExists($user_name)){
								$user_id = $this->northbridge_model->getUserIdByName($user_name);

								if($this->input->post('otp')){
									
									$otp = $this->input->post('otp');
			
									if($otp == $session_otp){
								
										
										$amount = $this->input->post("amount");
										if(is_numeric($amount)){
											if($amount >= 200){
												$total_income = $this->northbridge_model->getUserParamById("total_income",$user_id);
												$withdrawn = $this->northbridge_model->getUserParamById("withdrawn",$user_id);
												$recepient_code = $this->northbridge_model->getUserParamById("recepient_code",$user_id);
												$available_income = $total_income - $withdrawn;
												if($amount <= $available_income){
													
													$funds_amount = $amount - 100;
													$funds_amount = $funds_amount - (0.02 * $amount);
													
													$funds_amount = $funds_amount * 100;
												
													$response_arr['no_refer'] = false;
													$post_data = [
														'source' => 'balance',
														'reason' => 'Withdrawal Of Funds',
														'amount' => $funds_amount,
														'currency' => 'NGN',
														'recipient' => $recepient_code
													];
													$initiate_transfer = $this->paystack->curl("https://api.paystack.co/transfer",TRUE,$post_data);
				    
													$initiate_transfer = json_decode($initiate_transfer);
													if(is_object($initiate_transfer)){
														
														if($initiate_transfer->status == TRUE){
															if($this->northbridge_model->debitUser($user_id,$amount)){

																if($this->northbridge_model->addWithrawalHistory($user_id,$amount)){

																	$response_arr['success'] = true;
																	session_unset();
																}
															}
														}
													}
													
												}else{
													$response_arr['not_bouyant'] = true;
												}
											}else{
												$response_arr['too_small'] = true;
											}
										}
										
									}else{
										$response_arr['incorrect_otp'] = true;
									}
												
								}else{
									$response_arr['incomplete_detais'] = true;
								}
							}		
						}else{
							$response_arr['expired'] = true;
						}
									
								
						echo json_encode($response_arr);
					}
					
				}
			}			


			elseif($addition == "transfer_funds_to_user" && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $row){
						$id = $row->id;
						$created = $row->created;
						$created_date = $row->created_date;
						$created_time = $row->created_time;
						$sms_enabled = $row->sms_enabled;
						$notif_enabled = $row->notif_enabled;
						$email_enabled = $row->email_enabled;
						$admin_sms_enabled = $row->admin_sms_enabled;
						$admin_email_enabled = $row->admin_email_enabled;
						$followers = $row->followers;
						$following = $row->following;
						$user_name = $row->user_name;
						$sponsor_income = $row->sponsor_income;
						$withdrawn = $row->withdrawn;
						$admin_vat_total = $row->admin_vat_total;
						$total_basic_withdrawn = $row->total_basic_withdrawn;
						$total_basic_income = $row->total_basic_income;
						$total_business_income = $row->total_business_income;
						$total_business_withdrawn = $row->total_business_withdrawn;
						$total_income = $row->total_income;
						$admin_mlm_withdrawn = $row->admin_mlm_withdrawn;
						$last_activity = $row->last_activity;
						$full_name = $row->full_name;
						$hashed = $row->hashed;
						$token = $row->token;
						$email = $row->email;
						$phone = $row->phone;
						$phone_code = $row->phone_code;
						$logo = $row->logo;
						$cover_photo = $row->cover_photo;
						$bio = $row->bio;
						$country_id = $row->country_id;
						$state_id = $row->state_id;
						$local_government = $row->local_government;
						$city = $row->city;
						$address = $row->address;
						$place_of_use = $row->place_of_use;
						$whatsapp_user = $row->whatsapp_user;
						$center_leader = $row->center_leader;
						$slug = $row->slug;
						$register = $row->register;
						$is_admin = $row->is_admin;
						$date = $row->date;
						$time = $row->time;
						$user_bank_name = $row->bank_name;
						$account_number = $row->account_number;
						$recepient_code = $row->recepient_code;
						$referred_by = $row->referred_by;
						$dispatcher = $row->dispatcher;
						$center_leader_selection_income = $row->center_leader_selection_income;
						$admin_center_leader_selection_income = $row->admin_center_leader_selection_income;
						$mlm_withdrawn = $row->mlm_withdrawn;
					}

					if($this->input->post('amount') && $this->input->post('recepient_username')){
						$response_arr = array('success' => false,'not_bouyant' => false,'too_small' => false,'recepient_does_not_exist' => true,'recepient_fullname' => '','users_id' => '');
						$amount = $this->input->post("amount");
						$recepient_username = $this->input->post("recepient_username");
						if(is_numeric($amount)){
							if($amount >= 200){
								$available_income = $total_income - $withdrawn;
								if($amount <= $available_income){
									
									if($this->northbridge_model->checkIfUserNameExists($recepient_username)){
										$response_arr['success'] = true;
										$recepient_id = $this->northbridge_model->getUserIdByName($recepient_username);
										$response_arr['users_id'] = $recepient_id;
										$recepient_fullname = $this->northbridge_model->getUserFullNameByUserId($recepient_id);
										$response_arr['recepient_does_not_exist'] = false;
										$response_arr['phone_number'] = $phone;
										$response_arr['code'] = $phone_code;
										$response_arr['recepient_fullname'] = $recepient_fullname;
									}
									
								}else{
									$response_arr['not_bouyant'] = true;
								}
							}else{
								$response_arr['too_small'] = true;
							}
						}
						echo json_encode($response_arr);
					}
					
				}
			}

			// elseif($addition == "verify_transfer_otp" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
			// 	$date = date("j M Y");
			// 	$time = date("h:i:sa");
			// 	// echo "string";
			// 	if(isset($_POST["code"]) && isset($_POST["state"]) && isset($_POST['amount']) && isset($_POST['recepient_id'])){
					
			// 		$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
			// 		$session_phone = $this->northbridge_model->getUserPhoneNumberByUserId($user_id);
			// 		$session_phone_code = $this->northbridge_model->getUserPhoneCodeByUserId($user_id);
			// 		$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);


					
			// 		if(is_array($user_info)){
			// 			foreach($user_info as $row){
			// 				$id = $row->id;
			// 				$created = $row->created;
			// 				$created_date = $row->created_date;
			// 				$created_time = $row->created_time;
			// 				$sms_enabled = $row->sms_enabled;
			// 				$notif_enabled = $row->notif_enabled;
			// 				$email_enabled = $row->email_enabled;
			// 				$admin_sms_enabled = $row->admin_sms_enabled;
			// 				$admin_email_enabled = $row->admin_email_enabled;
			// 				$followers = $row->followers;
			// 				$following = $row->following;
			// 				$user_name = $row->user_name;
			// 				$sponsor_income = $row->sponsor_income;
			// 				$withdrawn = $row->withdrawn;
			// 				$admin_vat_total = $row->admin_vat_total;
			// 				$total_basic_withdrawn = $row->total_basic_withdrawn;
			// 				$total_basic_income = $row->total_basic_income;
			// 				$total_business_income = $row->total_business_income;
			// 				$total_business_withdrawn = $row->total_business_withdrawn;
			// 				$total_income = $row->total_income;
			// 				$admin_mlm_withdrawn = $row->admin_mlm_withdrawn;
			// 				$last_activity = $row->last_activity;
			// 				$full_name = $row->full_name;
			// 				$hashed = $row->hashed;
			// 				$token = $row->token;
			// 				$email = $row->email;
			// 				$phone = $row->phone;
			// 				$phone_code = $row->phone_code;
			// 				$logo = $row->logo;
			// 				$cover_photo = $row->cover_photo;
			// 				$bio = $row->bio;
			// 				$country_id = $row->country_id;
			// 				$state_id = $row->state_id;
			// 				$local_government = $row->local_government;
			// 				$city = $row->city;
			// 				$address = $row->address;
			// 				$place_of_use = $row->place_of_use;
			// 				$whatsapp_user = $row->whatsapp_user;
			// 				$center_leader = $row->center_leader;
			// 				$slug = $row->slug;
			// 				$register = $row->register;
			// 				$is_admin = $row->is_admin;
			// 				$date = $row->date;
			// 				$time = $row->time;
			// 				$user_bank_name = $row->bank_name;
			// 				$account_number = $row->account_number;
			// 				$recepient_code = $row->recepient_code;
			// 				$referred_by = $row->referred_by;
			// 				$dispatcher = $row->dispatcher;
			// 				$center_leader_selection_income = $row->center_leader_selection_income;
			// 				$admin_center_leader_selection_income = $row->admin_center_leader_selection_income;
			// 				$mlm_withdrawn = $row->mlm_withdrawn;
			// 			}
			// 			// echo $session_phone;
			// 			// echo $session_phone_code;
			// 			$response_arr = array('success' => false,'not_bouyant' => false,'too_small' => false);
			// 			$amount = $this->input->post("amount");
			// 		  // session_start();
			// 			$code = $_POST["code"];
			// 			$state = $_POST["state"];
			// 			$ch = curl_init();
			// 			// Set url elements
			// 			$fb_app_id = '320429851941197';
			// 			$ak_secret = '7e3c153a0bebd2061377a09a3679a149';
			// 			$token = 'AA|'.$fb_app_id.'|'.$ak_secret;
			// 			// Get access token
			// 			$url = 'https://graph.accountkit.com/v1.0/access_token?grant_type=authorization_code&code='.$_POST["code"].'&access_token='.$token;
			// 			curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
			// 			curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
			// 			curl_setopt($ch, CURLOPT_URL,$url);
			// 			$result=curl_exec($ch);
			// 			$info = json_decode($result);
			// 			// var_dump($info);
			// 			if(isset($info->access_token)){
							
			// 				// Get account information
			// 				$url = 'https://graph.accountkit.com/v1.0/me/?access_token='.$info->access_token;
			// 				curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
			// 				curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
			// 				curl_setopt($ch, CURLOPT_URL,$url);
			// 				$result=curl_exec($ch);
			// 				curl_close($ch);
			// 				$final = json_decode($result);  
			// 				// print_r($final);
			// 				// var_dump($final);
			// 				if(isset($final->phone->national_number)){
			// 					$phone_code = $final->phone->country_prefix;
			// 					$phone = $final->phone->national_number;
			// 					if($phone[0] == "0"){
			// 						$phone = substr($phone, 1);
			// 					}
			// 					$response_arr['phone'] = $phone;
			// 					$response_arr['phone_code'] = $phone_code;

			// 					$response_arr['session_phone'] = $session_phone;
			// 					$response_arr['session_phone_code'] = $session_phone_code;

			// 					if($phone == $session_phone && $phone_code == $session_phone_code){
			// 						$amount = $this->input->post("amount");
			// 						if(is_numeric($amount)){
			// 							if($amount >= 200){
			// 								$available_income = $total_income - $withdrawn;
			// 								if($amount <= $available_income){
												
												
			// 									$recepient_id = $this->input->post('recepient_id');
			// 									if($this->northbridge_model->checkIfUserIdIsValid($recepient_id)){
			// 										$date = date("j M Y");
			// 										$time = date("h:i:sa");
			// 										if($this->northbridge_model->transferFundsToUser($recepient_id,$amount,$date,$time)){
			// 											$response_arr['success'] = true;
			// 										}
			// 									}
			// 								}else{
			// 									$response_arr['not_bouyant'] = true;
			// 								}
			// 							}else{
			// 								$response_arr['too_small'] = true;
			// 							}
			// 						}
			// 					}else{
			// 						$response_arr['phone_change'] = true;
			// 					}
								
			// 				}else{
			// 					$response_arr['no_number'] = true;
			// 				}
			// 			}else{
			// 				$response_arr['access_token'] = false;
			// 			}
			// 		}	
			// 		echo json_encode($response_arr);
			// 	}
				
			// }

			elseif($addition == "verify_withdrawal_otp" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$date = date("j M Y");
				$time = date("h:i:sa");
				// echo "string";
				if(isset($_POST["code"]) && isset($_POST["state"]) && isset($_POST['amount'])){
					
					$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
					$session_phone = $this->northbridge_model->getUserPhoneNumberByUserId($user_id);
					$session_phone_code = $this->northbridge_model->getUserPhoneCodeByUserId($user_id);
					$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
					
					if(is_array($user_info)){
						foreach($user_info as $row){
							$id = $row->id;
							$created = $row->created;
							$created_date = $row->created_date;
							$created_time = $row->created_time;
							$sms_enabled = $row->sms_enabled;
							$notif_enabled = $row->notif_enabled;
							$email_enabled = $row->email_enabled;
							$admin_sms_enabled = $row->admin_sms_enabled;
							$admin_email_enabled = $row->admin_email_enabled;
							$followers = $row->followers;
							$following = $row->following;
							$user_name = $row->user_name;
							$sponsor_income = $row->sponsor_income;
							$withdrawn = $row->withdrawn;
							$admin_vat_total = $row->admin_vat_total;
							$total_basic_withdrawn = $row->total_basic_withdrawn;
							$total_basic_income = $row->total_basic_income;
							$total_business_income = $row->total_business_income;
							$total_business_withdrawn = $row->total_business_withdrawn;
							$total_income = $row->total_income;
							$admin_mlm_withdrawn = $row->admin_mlm_withdrawn;
							$last_activity = $row->last_activity;
							$full_name = $row->full_name;
							$hashed = $row->hashed;
							$token = $row->token;
							$email = $row->email;
							$phone = $row->phone;
							$phone_code = $row->phone_code;
							$logo = $row->logo;
							$cover_photo = $row->cover_photo;
							$bio = $row->bio;
							$country_id = $row->country_id;
							$state_id = $row->state_id;
							$local_government = $row->local_government;
							$city = $row->city;
							$address = $row->address;
							$place_of_use = $row->place_of_use;
							$whatsapp_user = $row->whatsapp_user;
							$center_leader = $row->center_leader;
							$slug = $row->slug;
							$register = $row->register;
							$is_admin = $row->is_admin;
							$date = $row->date;
							$time = $row->time;
							$user_bank_name = $row->bank_name;
							$account_number = $row->account_number;
							$recepient_code = $row->recepient_code;
							$referred_by = $row->referred_by;
							$dispatcher = $row->dispatcher;
							$center_leader_selection_income = $row->center_leader_selection_income;
							$admin_center_leader_selection_income = $row->admin_center_leader_selection_income;
							$mlm_withdrawn = $row->mlm_withdrawn;
						}
						// echo $session_phone;
						// echo $session_phone_code;
						$response_arr = array('success' => false,'not_bouyant' => false,'too_small' => false);
						$amount = $this->input->post("amount");
					  // session_start();
						$code = $_POST["code"];
						$state = $_POST["state"];
						$ch = curl_init();
						// Set url elements
						$fb_app_id = '320429851941197';
						$ak_secret = '7e3c153a0bebd2061377a09a3679a149';
						$token = 'AA|'.$fb_app_id.'|'.$ak_secret;
						// Get access token
						$url = 'https://graph.accountkit.com/v1.0/access_token?grant_type=authorization_code&code='.$_POST["code"].'&access_token='.$token;
						curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
						curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
						curl_setopt($ch, CURLOPT_URL,$url);
						$result=curl_exec($ch);
						$info = json_decode($result);
						// var_dump($info);
						if(isset($info->access_token)){
							
							// Get account information
							$url = 'https://graph.accountkit.com/v1.0/me/?access_token='.$info->access_token;
							curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
							curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
							curl_setopt($ch, CURLOPT_URL,$url);
							$result=curl_exec($ch);
							curl_close($ch);
							$final = json_decode($result);  
							// print_r($final);
							// var_dump($final);
							if(isset($final->phone->national_number)){
								$phone_code = $final->phone->country_prefix;
								$phone = $final->phone->national_number;
								if($phone[0] == "0"){
									$phone = substr($phone, 1);
								}
								$response_arr['phone'] = $phone;
								$response_arr['phone_code'] = $phone_code;

								$response_arr['session_phone'] = $session_phone;
								$response_arr['session_phone_code'] = $session_phone_code;

								if($phone == $session_phone && $phone_code == $session_phone_code){
									$amount = $this->input->post("amount");
									if(is_numeric($amount)){
										if($amount >= 200){
											$available_income = $total_income - $withdrawn;
											if($amount <= $available_income){
												$response_arr['success'] = true;
												$funds_amount = $amount - 100;
												$funds_amount = $funds_amount - (0.02 * $amount);
												
												$funds_amount = $funds_amount * 100;
											
												$response_arr['no_refer'] = false;
												$post_data = [
													'source' => 'balance',
													'reason' => 'Withdrawal Of Funds',
													'amount' => $funds_amount,
													'currency' => 'NGN',
													'recipient' => $recepient_code
												];
												$initiate_transfer = $this->paystack->curl("https://api.paystack.co/transfer",TRUE,$post_data);
											// 	echo $initiate_transfer;
			    
												$initiate_transfer = json_decode($initiate_transfer);
												if(is_object($initiate_transfer)){
													if($initiate_transfer->status == TRUE){
														if($this->northbridge_model->debitUser($user_id,$amount)){
															$data['success'] = true;
														}
													}
												}
												
											}else{
												$response_arr['not_bouyant'] = true;
											}
										}else{
											$response_arr['too_small'] = true;
										}
									}
								}else{
									$response_arr['phone_change'] = true;
								}
								
							}else{
								$response_arr['no_number'] = true;
							}
						}else{
							$response_arr['access_token'] = false;
						}
					}	
					echo json_encode($response_arr);
				}
				
			}

			elseif($addition == "health_post" && $this->northbridge_model->getIfPostIdIsValidHealth($second_addition,$third_addition) && is_null($fourth_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				

				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
					$title = $this->northbridge_model->getPostTitleByIdHealth($second_addition);
					$data['title'] = $title;
					$this->load->view('includes/admin_header',$data);
					$this->load->view('pages/view_post_health',$data);
					$this->load->view('includes/admin_footer',$data);
				}
			}


			elseif($addition == "get_users_email" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				

				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
					
					$response_arr = array('success' => false,'email' => '');

					if($this->input->post('show_records')){
						$response_arr['success'] = true;
						$email = $this->northbridge_model->getUserParamById("email",$user_id);
						$response_arr['email'] = $email;
					}

					echo json_encode($response_arr);
				}
			}

			elseif($addition == "send_transfer_otp" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				

				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
					
					$response_arr = array('success' => false,'email' => '');

					if($this->input->post('show_records')){
						
						$email = $this->northbridge_model->getUserParamById("email",$user_id);
						$response_arr['email'] = $email;

						$otp = rand ( 10000 , 99999 );
						$email_arr = array($email);
						if($this->northbridge_model->sendOtpEmail($email_arr,$otp)){
							$this->session->set_userdata('otp',$otp);
							$this->session->set_userdata('transfer_first_step',$user_name);
							//Change This Once In Development
							$response_arr['success'] = true;
							if($_SERVER['SERVER_NAME'] == "localhost"){
								$response_arr['otp'] = $otp;
							}
						}	
					}

					echo json_encode($response_arr);
				}
			}

			elseif($addition == "verify_transfer_otp" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;

					}
					
					$response_arr = array('success' => false,'messages' => array(),'expired' => false,'incomplete_detais' => false,'amount_not_numeric' => false,'amount_too_small' => false,'not_bouyant' => false,'invalid_recipient' => false,'incorrect_otp' => false);

					$this->form_validation->set_rules('transfer_otp','OTP','trim|required|numeric|exact_length[5]');
					$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
					if($this->form_validation->run()){
						if(isset($_SESSION['otp']) && isset($_SESSION['transfer_first_step'])){
							$user_name = $_SESSION['transfer_first_step'];
							$session_otp = $_SESSION['otp'];

							if($this->northbridge_model->checkIfUserNameExists($user_name)){
								$user_id = $this->northbridge_model->getUserIdByName($user_name);

								if($this->input->post('transfer_otp') && $this->input->post('amount') && $this->input->post('recepient_id')){
									$amount = $this->input->post('amount');
									$recepient_id = $this->input->post('recepient_id'); 
									$otp = $this->input->post('transfer_otp');

									if(is_numeric($amount)){
										if($amount >= 200){
											$total_income = $this->northbridge_model->getUserParamById("total_income",$user_id);
											$withdrawn = $this->northbridge_model->getUserParamById("withdrawn",$user_id);
											$available_income = $total_income - $withdrawn;
											if($amount <= $available_income){
												
												if($this->northbridge_model->checkIfUserIdIsValid($recepient_id)){
													
													if($otp == $session_otp){
												
														$date = date("j M Y");
														$time = date("h:i:sa");
														if($this->northbridge_model->transferFundsToUser($user_id,$recepient_id,$amount,$date,$time)){
															session_unset();
															$response_arr['success'] = true;
														}
													}else{
														$response_arr['incorrect_otp'] = true;
													}
											
												}else{
													$response_arr['invalid_recipient'] = true;
												}
											}else{
												$response_arr['not_bouyant'] = true;
											}
											
										}else{
											$response_arr['amount_too_small'] = true;
										}
									}else{
										$response_arr['amount_not_numeric'] = true;
									}
								}else{
									$response_arr['incomplete_detais'] = true;
								}
							}		
						}else{
							$response_arr['expired'] = true;
						}
						
					}else{
						foreach($_POST as $key => $value){
							$response_arr['messages'][$key] = form_error($key);
						}	
					}

					echo json_encode($response_arr);
				}
			}		
		

			elseif($addition == "upload_post_images" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
					$response_arr = array('success' => false,'messages' => '','post' => '','post_id' => '');
					$response_arr['post'] = $_POST;
					if($this->input->post('upload_image')){
						$response_arr['success'] = true;
						// // set_cookie('one',$one);
						$config['upload_path']          = './assets/images/';
		                $config['allowed_types']        = 'gif|jpg|png|jpeg';
		                
		                $this->load->library('upload', $config);
		                if ($this->upload->do_upload('qqfile')){
		                	$file_name = $this->upload->data('file_name');
		                	$this->load->library('image_lib');
							
							
							$config['image_library'] = 'gd2';
						    $config['source_image'] = realpath('./assets/images/'.$file_name);
						    $config['create_thumb'] = TRUE;
						    // $config['maintain_ratio'] = TRUE;
						    $config['quality'] = '100%';
						    $config['width']     = 500;
						    $config['height']   = 500;

						    $this->image_lib->clear();
						    $this->image_lib->initialize($config);
						    if($this->image_lib->resize()){

								$this->load->library('image_lib', $config);
								if($this->image_lib->resize()){
				                	
				                	$post_id = get_cookie('send_post_id',true);
				                	$response_arr['post_id'] = $post_id;
				                	unlink(realpath('./assets/images/'.$file_name));
				                	$file_name = $this->upload->data('raw_name') .'_thumb' . $this->upload->data('file_ext');

				                	if($this->northbridge_model->updatePostImages($file_name,$post_id,$user_id)){
					                	$response_arr['success'] = true;
					                }
					            }
					        }    
		                }else{
		                	$response_arr['messages'] = $this->upload->display_errors();
		                }
						
					}
					echo json_encode($response_arr);
				}		
			}

			elseif($addition == "upload_post_images_health" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
					$response_arr = array('success' => false,'messages' => '','post' => '','post_id' => '');
					$response_arr['post'] = $_POST;
					if($this->input->post('upload_image')){
						$response_arr['success'] = true;
						// // set_cookie('one',$one);
						$config['upload_path']          = './assets/images/';
		                $config['allowed_types']        = 'gif|jpg|png|jpeg';
		                
		                $this->load->library('upload', $config);
		                if ($this->upload->do_upload('qqfile')){
		                	$file_name = $this->upload->data('file_name');
		                	$this->load->library('image_lib');
							
							
							$config['image_library'] = 'gd2';
						    $config['source_image'] = realpath('./assets/images/'.$file_name);
						    $config['create_thumb'] = TRUE;
						    // $config['maintain_ratio'] = TRUE;
						    $config['quality'] = '100%';
						    $config['width']     = 500;
						    $config['height']   = 500;

						    $this->image_lib->clear();
						    $this->image_lib->initialize($config);
						    if($this->image_lib->resize()){

								$this->load->library('image_lib', $config);
								if($this->image_lib->resize()){
				                	
				                	$post_id = get_cookie('send_post_id',true);
				                	$response_arr['post_id'] = $post_id;
				                	unlink(realpath('./assets/images/'.$file_name));
				                	$file_name = $this->upload->data('raw_name') .'_thumb' . $this->upload->data('file_ext');

				                	if($this->northbridge_model->updatePostImagesHealth($file_name,$post_id,$user_id)){
					                	$response_arr['success'] = true;
					                }
					            }
					        }    
		                }else{
		                	$response_arr['messages'] = $this->upload->display_errors();
		                }
						
					}
					echo json_encode($response_arr);
				}		
			}

			elseif($addition == "messages"  && is_null($third_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
					}
					$this->load->library('pagination');

					$config['base_url'] = site_url('northbridge/index/messages');
					$config['total_rows'] = $this->northbridge_model->getConversationsNum($user_id);
					$config['per_page'] = 10;
					$config['use_page_numbers'] = TRUE;
					$config['next_link'] = 'Next';
					$config['first_link'] = FALSE;
					$config['last_link'] = FALSE;
					$config['full_tag_open'] = "<ul class='pagination'>";
					$config['full_tag_close'] ="</ul>";
					$config['num_tag_open'] = '<li>';
					$config['num_tag_close'] = '</li>';
					$config['cur_tag_open'] = "<li class='disabled'><li class='active'><a href='#'>";
					$config['cur_tag_close'] = "<span class='sr-only'></span></a></li>";
					$config['next_tag_open'] = "<li>";
					$config['next_tagl_close'] = "</li>";
					$config['prev_tag_open'] = "<li>";
					$config['prev_tagl_close'] = "</li>";
					$config['first_tag_open'] = "<li>";
					$config['first_tagl_close'] = "</li>";
					$config['last_tag_open'] = "<li>";
					$config['last_tagl_close'] = "</li>";

					// By clicking on performing PREVIOUS pagination.
					$config['prev_link'] = 'Previous';
					// $config['page_query_string'] = TRUE;

					$this->pagination->initialize($config);
					if(!is_null($second_addition)){
						$page = $second_addition;
					}else{
						$page = 1;
					}
					$data['page'] = $page;
					$data['str_links'] = $this->pagination->create_links();
					// $data["links"] = explode('&nbsp;',$data['str_links']);
					$this->load->view('includes/admin_header',$data);
		            $this->load->view('pages/messages',$data);
		            $this->load->view('includes/admin_footer',$data);	
				}		
			}

			elseif($addition == "notifications"  && is_null($third_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
					}
					$this->load->library('pagination');

					$config['base_url'] = site_url('northbridge/index/notifications');
					$config['total_rows'] = $this->northbridge_model->getAllNotifsCount($user_id);
					$config['per_page'] = 10;
					$config['use_page_numbers'] = TRUE;
					$config['next_link'] = 'Next';
					$config['first_link'] = FALSE;
					$config['last_link'] = FALSE;
					$config['full_tag_open'] = "<ul class='pagination'>";
					$config['full_tag_close'] ="</ul>";
					$config['num_tag_open'] = '<li>';
					$config['num_tag_close'] = '</li>';
					$config['cur_tag_open'] = "<li class='disabled'><li class='active'><a href='#'>";
					$config['cur_tag_close'] = "<span class='sr-only'></span></a></li>";
					$config['next_tag_open'] = "<li>";
					$config['next_tagl_close'] = "</li>";
					$config['prev_tag_open'] = "<li>";
					$config['prev_tagl_close'] = "</li>";
					$config['first_tag_open'] = "<li>";
					$config['first_tagl_close'] = "</li>";
					$config['last_tag_open'] = "<li>";
					$config['last_tagl_close'] = "</li>";

					// By clicking on performing PREVIOUS pagination.
					$config['prev_link'] = 'Previous';
					// $config['page_query_string'] = TRUE;

					$this->pagination->initialize($config);
					if(!is_null($second_addition)){
						$page = $second_addition;
					}else{
						$page = 1;
					}
					$data['page'] = $page;
					$data['str_links'] = $this->pagination->create_links();
					// $data["links"] = explode('&nbsp;',$data['str_links']);
					$this->load->view('includes/admin_header',$data);
		            $this->load->view('pages/notifications',$data);
		            $this->load->view('includes/admin_footer',$data);	
				}		
			}

			elseif($addition == "make_post" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
					$response_arr = array('success' => false,'messages' => '','noval' => false);			
					if($this->input->post('post')){
						$post = $this->input->post('post');
						$date = date("j M Y");
						$time = date("h:i:sa");
						$slug = strtolower(url_title(substr($post, 0,50)));
						$form_array = array(
							'content' => $post,
							'slug' => $slug,
							'sender' => $user_id,
							'date' => $date,
							'time' => $time
						);
						if($post !== ""){
							if($this->northbridge_model->makePost($form_array)){
								$response_arr['success'] = true;
							}
						}else{
							$response_arr['noval'] = true;
							$response_arr['messages'] = "You Must Enter Text In The Post Field";
						}
					}else{
						$response_arr['noval'] = true;
						$response_arr['messages'] = "You Must Enter Text In The Post Field";
					}
					echo json_encode($response_arr);
				}		
			}

			elseif($addition == "make_post_health" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
					$response_arr = array('success' => false,'messages' => '','noval' => false);			
					if($this->input->post('post')){
						$post = $this->input->post('post');
						$date = date("j M Y");
						$time = date("h:i:sa");
						$slug = strtolower(url_title(substr($post, 0,50)));
						$form_array = array(
							'content' => $post,
							'slug' => $slug,
							'sender' => $user_id,
							'date' => $date,
							'time' => $time
						);
						if($post !== ""){
							if($this->northbridge_model->makePostHealth($form_array)){
								$response_arr['success'] = true;
							}
						}else{
							$response_arr['noval'] = true;
							$response_arr['messages'] = "You Must Enter Text In The Post Field";
						}
					}else{
						$response_arr['noval'] = true;
						$response_arr['messages'] = "You Must Enter Text In The Post Field";
					}
					echo json_encode($response_arr);
				}		
			}

			elseif($addition == "load_more_posts" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
					$response_arr = array('success' => false,'messages' => '','last_batch' => false);			
					if($this->input->post('offset') && $this->input->post('this_user')){
						$offset = $this->input->post('offset');
						$this_user = $this->input->post('this_user');
						$is_admin = false;
						if($this->northbridge_model->checkIfPostIdIsValid($offset)){
							
							$posts_by_user = $this->northbridge_model->getSubsequentPostsUserProfile($this_user,$offset);
                            if(is_array($posts_by_user)){
                            	// $posts_by_user = array_reverse($posts_by_user); 
                            	$response_arr['success'] = true;
                              foreach($posts_by_user as $row){
                              	$date = $row->date;
                    			$time = $row->time;
                                $post_id = $row->id;
                                $post_content = $row->content;
                                $images = $row->images;
                                $image_arr = explode(",", $images);
                                $likes = $row->likes;
                                $slug = $row->slug;
                                $sender = $row->sender;
                                $sender_username = $this->northbridge_model->getUserNameById($sender);
                                $likes_num = 0;
                                if($likes !== ""){
                                  $likes_arr = explode(",", $likes);
                                  if(!empty($likes_arr)){
                                    $likes_arr = array_unique($likes_arr);
                                    $this->northbridge_model->updatePostLikes($likes_arr,$post_id);
                                    $likes_num = count($likes_arr);
                                  }
                                }
                               	
                               	if($sender == $user_id){

                               		$is_admin = true;
                               	}
                               	$new_post_id = $post_id . "-post";

                               	$response_arr['messages'] .= '<div class="row justify-content-center">';
                      
                      			$response_arr['messages'] .= '<div class="card post-card col-sm-7" id="'.$new_post_id.'">';
                        		$response_arr['messages'] .= '<div class="card-header text-left">';
                          		$response_arr['messages'] .= '<div class="text-left" style="display: inline-block;">';
                            	$response_arr['messages'] .= '<h4 class="card-title text-left"><img src="'.$this->northbridge_model->getUserLogoById($sender).'" alt="">';
                            	$response_arr['messages'] .= '<span>'.$sender_username.'</span></h4>';
                          		$response_arr['messages'] .= '</div>';
                          		// if($is_admin){ 
	                              	$response_arr['messages'] .=  "<div class='text-right float-right' onclick='moreButton(this,".$post_id.", \"" . str_replace('"', '\"', $slug) . "\")' style='cursor: pointer; display: inline-block;'>";
	                                $response_arr['messages'] .= '<i class="fas fa-ellipsis-h"></i>';
	                            	$response_arr['messages'] .= '</div>';
                                // }
                        		$response_arr['messages'] .= '</div>';
                        		$response_arr['messages'] .= '<div class="card-body" >';
                          		if(!empty($image_arr) && $images !== ""){ 
                          			$response_arr['messages'] .= '<div id="" class="owl-carousel owl-theme owl-demo">';
                            		for($i = 0; $i < count($image_arr); $i++){ 
                              			$current_image = $image_arr[$i];
                           
                            			$response_arr['messages'] .= '<div class="item"><img src="'.base_url('assets/images/'.$current_image).'" alt="'.$post_content.'"></div>';
                            
                             		} 
                           
                          			$response_arr['messages'] .= '</div>';
                          		}

                          		if($this->northbridge_model->checkIfUserHasAlreadyLikedPost($user_id,$post_id)){
                          			$like_str = 'likePost(this,'.$post_id.')'; 
                          		}else{ 
                          			$like_str = 'unlikePost(this,'.$post_id.')';
                          		}

                          		$liked_str = "";
                          		if(!$this->northbridge_model->checkIfUserHasAlreadyLikedPost($user_id,$post_id)){
                          			$liked_str = 'liked';
                          		}

                          		if($likes_num == 0){
                          			$likes_num_str = "No Likes"; 
                          		}
                          		else{ 
                          			if($likes_num == 1){
                          				$likes_num_str = $likes_num . ' like'; 
                          			}
                          			else{
                          				$likes_num_str = $likes_num . ' likes'; 
                          			}
                          		}  

                          		if(strlen($post_content) >= 60){ 

                          			$post_cont = '<span class="small-content">'.$this->northbridge_model->custom_echo($post_content,60).'</span><span class="hide big-content">'.$post_content.'</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="content-more-btn" onclick="getMorePostContent(this)">more</span>';
                          		}else{  
                          			$post_cont = '<span>'.$post_content.'</span>';
                          		}


                          		$response_arr['messages'] .= '<div class="action-buttons-panel text-left" style="">';
                            	$response_arr['messages'] .= '<div class="row">';
                              	$response_arr['messages'] .= '<div class="col-2 col-xs-2 like-btn" onclick="'.$like_str.'">';
                                $response_arr['messages'] .= '<i class="far fa-heart '.$liked_str.'"></i>';
                              	$response_arr['messages'] .= '</div>';
                              	$response_arr['messages'] .= '<div class="col-2 col-xs-2 comment-btn" onclick="comment(this)">';
                                $response_arr['messages'] .= '<i class="far fa-comment"></i>';
                              	$response_arr['messages'] .= '</div>';
                              	if($user_name !== $sender_username){
                              		$response_arr['messages'] .= '<div class="col-2 col-xs-2 share-btn" style="" onclick="sharePost(this,'.$post_id.')">';
                                    $response_arr['messages'] .= '<i class="far fa-share-square"></i>';
                              		$response_arr['messages'] .= '</div>';
                          		}
                            	$response_arr['messages'] .= '</div>';
                            	$response_arr['messages'] .= '<p class="likes-num text-left" onclick="showPostLikes(this,'.$post_id.')">'.$likes_num_str.'</p>';
                            	$response_arr['messages'] .= '<span class="post-likes-temp hide">'.$likes_num.'</span>';
                          		$response_arr['messages'] .= '</div>';
                          		$response_arr['messages'] .= '<div class="post-content text-left">';
                            	$response_arr['messages'] .= '<h6><a style="text-transform: lowercase;" href="'.site_url('northbridge/index/'.$sender_username).'" style="font-size: 14px; font-weight: 600;">'.$sender_username.'</a>&nbsp;&nbsp;<small>'.$post_cont.'</small></h6>';
                          		$response_arr['messages'] .= '</div>';
                          		$response_arr['messages'] .= '<div class="get-more-comments text-left">';
                            
                              	if($this->northbridge_model->getNoOfCommentsInPost($post_id) !== false){
                                	if($this->northbridge_model->getNoOfCommentsInPost($post_id) > 5){
	                                	$response_arr['messages'] .= "<span class='more-comments-btn' onclick='return loadMoreComments(this,".$post_id.")'>view more comments(".$this->northbridge_model->getNoOfCommentsInPost($post_id).")</span>";
	                                 	$response_arr['messages'] .= '<img class="loader-img hide" src="'.base_url('assets/images/loading.gif').'" alt="">';
                                	}
                              	}
                            
                          		$response_arr['messages'] .= '</div>';
                          		$response_arr['messages'] .= '<div class="comment-section text-left">';
                              	$comments_on_post = $this->northbridge_model->getFirstFiveCommentsOnPost($post_id);
                              	if(is_array($comments_on_post)){
                                	$comments_on_post = array_reverse($comments_on_post); 
                                	foreach($comments_on_post as $row){
                                  		$comment_id = $row->id;
                                  		$comment_content = $row->content;
                                 
                                  		$likes = $row->likes;
                                  		$sender = $row->sender;
                                  		$sender_username = $this->northbridge_model->getUserNameById($sender);
                                  		$likes_num = 0;
		                                  if($likes !== ""){
		                                    $likes_arr = explode(",", $likes);
		                                    if(!empty($likes_arr)){
		                                      $likes_arr = array_unique($likes_arr);
		                                      $this->northbridge_model->updateCommentLikes($likes_arr,$comment_id);
		                                      $likes_num = count($likes_arr);
		                                    }
		                                  }
		                                  $new_comment_id = $comment_id . "-comment";
                            
                            			$response_arr['messages'] .= '<h6 id="'.$new_comment_id.'"><a href="'.site_url('northbridge/index/'.$sender_username).'" style="font-size: 14px; font-weight: 600;">'.$sender_username.'</a>&nbsp;&nbsp;<small>'.$comment_content.'</small></h6>';
                             		} 
                             	}	
                            
	                          	$response_arr['messages'] .= '</div>';
	                          	$response_arr['messages'] .= '<div class="add-comment-section">';
	                          	$response_arr['messages'] .= '<form>';
	                          	$response_arr['messages'] .= '<div class="form-group">';
	                         	$response_arr['messages'] .= '<textarea style="padding-bottom: 3px;" onkeypress="return commentInputKeypress (event,this,'.$post_id.');" autocomplete="off" name="message"  placeholder="Add A Comment..." class="form-control comment-input col-sm-10">';
	                          	$response_arr['messages'] .= '</textarea>';
	                          	$response_arr['messages'] .= '<div class="text-right col-sm-1">';
	                          	$response_arr['messages'] .= '<img class="loader-img hide" src="'.base_url('assets/images/loading.gif').'" alt="">';
	                          	$response_arr['messages'] .= '</div>';
	                          	$response_arr['messages'] .= '</div>';
	                          	$response_arr['messages'] .= '</form>';
	                          	$response_arr['messages'] .= '</div>';
	                          	$response_arr['messages'] .= '<div class="text-left">';
                                $response_arr['messages'] .= '<span class="post-time-display"'. $this->northbridge_model->getSocialMediaTime($date,$time) . '</span>';
                                $response_arr['messages'] .= '</div>';
	                          	$response_arr['messages'] .= '</div>';
	                      	  	$response_arr['messages'] .= '</div>';
	                    	  	$response_arr['messages'] .= '</div> ';
                            }
                        }
						}
					}
					echo json_encode($response_arr);
				}
			}

			elseif($addition == "load_more_posts_front" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
					$response_arr = array('success' => false,'messages' => '','last_batch' => false);			
					if($this->input->post('offset') && $this->input->post('last_id')){
						$offset = $this->input->post('offset');
						$last_id = $this->input->post('last_id');
						$is_admin = false;
						if($this->northbridge_model->checkIfPostIdIsValid($last_id)){
							
							$posts_by_user = $this->northbridge_model->getSubsequentPostsByUserFront($user_id,$offset,$last_id);
                           	if(is_array($posts_by_user)){
                            	// $posts_by_user = array_reverse($posts_by_user); 
                            	$response_arr['success'] = true;
                              foreach($posts_by_user as $row){
                              	$date = $row->date;
                    			$time = $row->time;
                                $post_id = $row->id;
                                $post_content = $row->content;
                                $images = $row->images;
                                $image_arr = explode(",", $images);
                                $likes = $row->likes;
                                $slug = $row->slug;
                                $sender = $row->sender;
                                $sender_username = $this->northbridge_model->getUserNameById($sender);
                                $likes_num = 0;
                                if($likes !== ""){
                                  $likes_arr = explode(",", $likes);
                                  if(!empty($likes_arr)){
                                    $likes_arr = array_unique($likes_arr);
                                    $this->northbridge_model->updatePostLikes($likes_arr,$post_id);
                                    $likes_num = count($likes_arr);
                                  }
                                }
                               	
                               	
                               	if($sender == $user_id){
                               		$is_admin = true;
                               	}
                               	$new_post_id = $post_id . "-post";

                               	$response_arr['messages'] .= '<div class="row justify-content-center">';
                      
                      			$response_arr['messages'] .= '<div class="card post-card col-sm-7" id="'.$new_post_id.'">';
                        		$response_arr['messages'] .= '<div class="card-header text-left">';
                          		$response_arr['messages'] .= '<div class="text-left" style="display: inline-block;">';
                            	$response_arr['messages'] .= '<h4 class="card-title text-left"><img src="'.$this->northbridge_model->getUserLogoById($sender).'" alt="">';
                            	$response_arr['messages'] .= '<span>'.$sender_username.'</span></h4>';
                          		$response_arr['messages'] .= '</div>';
                          		// if($is_admin){ 
	                              	$response_arr['messages'] .=  "<div class='text-right float-right' onclick='moreButton(this,".$post_id.", \"" . str_replace('"', '\"', $slug) . "\")' style='cursor: pointer; display: inline-block;'>";
	                                $response_arr['messages'] .= '<i class="fas fa-ellipsis-h"></i>';
	                            	$response_arr['messages'] .= '</div>';
                                // }
                        		$response_arr['messages'] .= '</div>';
                        		$response_arr['messages'] .= '<div class="card-body" >';
                          		if(!empty($image_arr) && $images !== ""){ 
                          			$response_arr['messages'] .= '<div id="" class="owl-carousel owl-theme owl-demo">';
                            		for($i = 0; $i < count($image_arr); $i++){ 
                              			$current_image = $image_arr[$i];
                           
                            			$response_arr['messages'] .= '<div class="item"><img class="col-sm-7" src="'.base_url('assets/images/'.$current_image).'" alt="'.$post_content.'"></div>';
                            
                             		} 
                           
                          			$response_arr['messages'] .= '</div>';
                          		}

                          		if($this->northbridge_model->checkIfUserHasAlreadyLikedPost($user_id,$post_id)){
                          			$like_str = 'likePost(this,'.$post_id.')'; 
                          		}else{ 
                          			$like_str = 'unlikePost(this,'.$post_id.')';
                          		}

                          		$liked_str = "";
                          		if(!$this->northbridge_model->checkIfUserHasAlreadyLikedPost($user_id,$post_id)){
                          			$liked_str = 'liked';
                          		}

                          		if($likes_num == 0){
                          			$likes_num_str = "No Likes"; 
                          		}
                          		else{ 
                          			if($likes_num == 1){
                          				$likes_num_str = $likes_num . ' like'; 
                          			}
                          			else{
                          				$likes_num_str = $likes_num . ' likes'; 
                          			}
                          		}  

                          		if(strlen($post_content) >= 60){ 

                          			$post_cont = '<span class="small-content">'.$this->northbridge_model->custom_echo($post_content,60).'</span><span class="hide big-content">'.$post_content.'</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="content-more-btn" onclick="getMorePostContent(this)">more</span>';
                          		}else{  
                          			$post_cont = '<span>'.$post_content.'</span>';
                          		}


                          		$response_arr['messages'] .= '<div class="action-buttons-panel text-left" style="">';
                            	$response_arr['messages'] .= '<div class="row">';
                              	$response_arr['messages'] .= '<div class="col-2 col-xs-2 like-btn" onclick="'.$like_str.'">';
                                $response_arr['messages'] .= '<i class="far fa-heart '.$liked_str.'"></i>';
                              	$response_arr['messages'] .= '</div>';
                              	$response_arr['messages'] .= '<div class="col-2 col-xs-2 comment-btn" onclick="comment(this)">';
                                $response_arr['messages'] .= '<i class="far fa-comment"></i>';
                              	$response_arr['messages'] .= '</div>';
                              	if($user_name !== $sender_username){
                              		$response_arr['messages'] .= '<div class="col-2 col-xs-2 share-btn" style="" onclick="sharePost(this,'.$post_id.')">';
                                    $response_arr['messages'] .= '<i class="far fa-share-square"></i>';
                              		$response_arr['messages'] .= '</div>';
                          		}
                            	$response_arr['messages'] .= '</div>';
                            	$response_arr['messages'] .= '<p class="likes-num text-left" onclick="showPostLikes(this,'.$post_id.')">'.$likes_num_str.'</p>';
                            	$response_arr['messages'] .= '<span class="post-likes-temp hide">'.$likes_num.'</span>';
                          		$response_arr['messages'] .= '</div>';
                          		$response_arr['messages'] .= '<div class="post-content text-left">';
                            	$response_arr['messages'] .= '<h6><a style="text-transform: lowercase;" href="'.site_url('northbridge/index/'.$sender_username).'" style="font-size: 14px; font-weight: 600;">'.$sender_username.'</a>&nbsp;&nbsp;<small>'.$post_cont.'</small></h6>';
                          		$response_arr['messages'] .= '</div>';
                          		$response_arr['messages'] .= '<div class="get-more-comments text-left">';
                            
                              	if($this->northbridge_model->getNoOfCommentsInPost($post_id) !== false){
                                	if($this->northbridge_model->getNoOfCommentsInPost($post_id) > 5){
	                                	$response_arr['messages'] .= "<span class='more-comments-btn' onclick='return loadMoreComments(this,".$post_id.")'>view more comments(".$this->northbridge_model->getNoOfCommentsInPost($post_id).")</span>";
	                                 	$response_arr['messages'] .= '<img class="loader-img hide" src="'.base_url('assets/images/loading.gif').'" alt="">';
                                	}
                              	}
                            
                          		$response_arr['messages'] .= '</div>';
                          		$response_arr['messages'] .= '<div class="comment-section text-left">';
                              	$comments_on_post = $this->northbridge_model->getFirstFiveCommentsOnPost($post_id);
                              	if(is_array($comments_on_post)){
                                	$comments_on_post = array_reverse($comments_on_post); 
                                	foreach($comments_on_post as $row){
                                  		$comment_id = $row->id;
                                  		$comment_content = $row->content;
                                 
                                  		$likes = $row->likes;
                                  		$sender = $row->sender;
                                  		$sender_username = $this->northbridge_model->getUserNameById($sender);
                                  		$likes_num = 0;
		                                  if($likes !== ""){
		                                    $likes_arr = explode(",", $likes);
		                                    if(!empty($likes_arr)){
		                                      $likes_arr = array_unique($likes_arr);
		                                      $this->northbridge_model->updateCommentLikes($likes_arr,$comment_id);
		                                      $likes_num = count($likes_arr);
		                                    }
		                                  }
		                                  $new_comment_id = $comment_id . "-comment";
                            
                            			$response_arr['messages'] .= '<h6 id="'.$new_comment_id.'"><a href="'.site_url('northbridge/index/'.$sender_username).'" style="font-size: 14px; font-weight: 600;">'.$sender_username.'</a>&nbsp;&nbsp;<small>'.$comment_content.'</small></h6>';
                             		} 
                             	}	
                            
	                          	$response_arr['messages'] .= '</div>';
	                          	$response_arr['messages'] .= '<div class="add-comment-section">';
	                          	$response_arr['messages'] .= '<form>';
	                          	$response_arr['messages'] .= '<div class="form-group">';
	                         	$response_arr['messages'] .= '<textarea style="padding-bottom: 3px;" onkeypress="return commentInputKeypress (event,this,'.$post_id.');" autocomplete="off" name="message"  placeholder="Add A Comment..." class="form-control comment-input col-sm-10">';
	                          	$response_arr['messages'] .= '</textarea>';
	                          	$response_arr['messages'] .= '<div class="text-right col-sm-1">';
	                          	$response_arr['messages'] .= '<img class="loader-img hide" src="'.base_url('assets/images/loading.gif').'" alt="">';
	                          	$response_arr['messages'] .= '</div>';
	                          	$response_arr['messages'] .= '</div>';
	                          	$response_arr['messages'] .= '</form>';
	                          	$response_arr['messages'] .= '</div>';
	                          	$response_arr['messages'] .= '<div class="text-left">';
                                $response_arr['messages'] .= '<span class="post-time-display"'. $this->northbridge_model->getSocialMediaTime($date,$time) . '</span>';
                                $response_arr['messages'] .= '</div>';
	                          	$response_arr['messages'] .= '</div>';
	                      	  	$response_arr['messages'] .= '</div>';
	                    	  	$response_arr['messages'] .= '</div> ';
                            }	
                            } 
                        
						}
					}
					echo json_encode($response_arr);
				}
			}


			elseif($addition == "load_more_posts_front_health" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
					$response_arr = array('success' => false,'messages' => '','last_batch' => false);			
					if($this->input->post('offset') && $this->input->post('last_id')){
						$offset = $this->input->post('offset');
						$last_id = $this->input->post('last_id');
						$is_admin = false;
						if($this->northbridge_model->checkIfPostIdIsValidHealth($last_id)){
							
							$posts_by_user = $this->northbridge_model->getSubsequentPostsByUserFrontHealth($user_id,$offset,$last_id);
                           	if(is_array($posts_by_user)){
                            	// $posts_by_user = array_reverse($posts_by_user); 
                            	$response_arr['success'] = true;
                              foreach($posts_by_user as $row){
                              	$date = $row->date;
                    			$time = $row->time;
                                $post_id = $row->id;
                                $post_content = $row->content;
                                $images = $row->images;
                                $image_arr = explode(",", $images);
                                $likes = $row->likes;
                                $slug = $row->slug;
                                $sender = $row->sender;
                                $sender_username = $this->northbridge_model->getUserNameById($sender);
                                $likes_num = 0;
                                if($likes !== ""){
                                  $likes_arr = explode(",", $likes);
                                  if(!empty($likes_arr)){
                                    $likes_arr = array_unique($likes_arr);
                                    $this->northbridge_model->updatePostLikesHealth($likes_arr,$post_id);
                                    $likes_num = count($likes_arr);
                                  }
                                }
                               	
                               	
                               	if($sender == $user_id){
                               		$is_admin = true;
                               	}
                               	$new_post_id = $post_id . "-post";

                               	$response_arr['messages'] .= '<div class="row justify-content-center">';
                      
                      			$response_arr['messages'] .= '<div class="card post-card col-sm-7" id="'.$new_post_id.'">';
                        		$response_arr['messages'] .= '<div class="card-header text-left">';
                          		$response_arr['messages'] .= '<div class="text-left" style="display: inline-block;">';
                            	$response_arr['messages'] .= '<h4 class="card-title text-left"><img src="'.$this->northbridge_model->getUserLogoById($sender).'" alt="">';
                            	$response_arr['messages'] .= '<span>'.$sender_username.'</span></h4>';
                          		$response_arr['messages'] .= '</div>';
                          		// if($is_admin){ 
	                              	$response_arr['messages'] .=  "<div class='text-right float-right' onclick='moreButton(this,".$post_id.", \"" . str_replace('"', '\"', $slug) . "\")' style='cursor: pointer; display: inline-block;'>";
	                                $response_arr['messages'] .= '<i class="fas fa-ellipsis-h"></i>';
	                            	$response_arr['messages'] .= '</div>';
                                // }
                        		$response_arr['messages'] .= '</div>';
                        		$response_arr['messages'] .= '<div class="card-body" >';
                          		if(!empty($image_arr) && $images !== ""){ 
                          			$response_arr['messages'] .= '<div id="" class="owl-carousel owl-theme owl-demo">';
                            		for($i = 0; $i < count($image_arr); $i++){ 
                              			$current_image = $image_arr[$i];
                           
                            			$response_arr['messages'] .= '<div class="item"><img class="" src="'.base_url('assets/images/'.$current_image).'" alt="'.$post_content.'"></div>';
                            
                             		} 
                           
                          			$response_arr['messages'] .= '</div>';
                          		}

                          		if($this->northbridge_model->checkIfUserHasAlreadyLikedPostHealth($user_id,$post_id)){
                          			$like_str = 'likePost(this,'.$post_id.')'; 
                          		}else{ 
                          			$like_str = 'unlikePost(this,'.$post_id.')';
                          		}

                          		$liked_str = "";
                          		if(!$this->northbridge_model->checkIfUserHasAlreadyLikedPostHealth($user_id,$post_id)){
                          			$liked_str = 'liked';
                          		}

                          		if($likes_num == 0){
                          			$likes_num_str = "No Likes"; 
                          		}
                          		else{ 
                          			if($likes_num == 1){
                          				$likes_num_str = $likes_num . ' like'; 
                          			}
                          			else{
                          				$likes_num_str = $likes_num . ' likes'; 
                          			}
                          		}  

                          		if(strlen($post_content) >= 60){ 

                          			$post_cont = '<span class="small-content">'.$this->northbridge_model->custom_echo($post_content,60).'</span><span class="hide big-content">'.$post_content.'</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="content-more-btn" onclick="getMorePostContent(this)">more</span>';
                          		}else{  
                          			$post_cont = '<span>'.$post_content.'</span>';
                          		}


                          		$response_arr['messages'] .= '<div class="action-buttons-panel text-left" style="">';
                            	$response_arr['messages'] .= '<div class="row">';
                              	$response_arr['messages'] .= '<div class="col-2 col-xs-2 like-btn" onclick="'.$like_str.'">';
                                $response_arr['messages'] .= '<i class="far fa-heart '.$liked_str.'"></i>';
                              	$response_arr['messages'] .= '</div>';
                              	$response_arr['messages'] .= '<div class="col-2 col-xs-2 comment-btn" onclick="comment(this)">';
                                $response_arr['messages'] .= '<i class="far fa-comment"></i>';
                              	$response_arr['messages'] .= '</div>';
                              	if($user_name !== $sender_username){
                              		
                          		}
                            	$response_arr['messages'] .= '</div>';
                            	$response_arr['messages'] .= '<p class="likes-num text-left" onclick="showPostLikes(this,'.$post_id.')">'.$likes_num_str.'</p>';
                            	$response_arr['messages'] .= '<span class="post-likes-temp hide">'.$likes_num.'</span>';
                          		$response_arr['messages'] .= '</div>';
                          		$response_arr['messages'] .= '<div class="post-content text-left">';
                            	$response_arr['messages'] .= '<h6><a style="text-transform: lowercase;" href="'.site_url('northbridge/index/'.$sender_username).'" style="font-size: 14px; font-weight: 600;">'.$sender_username.'</a>&nbsp;&nbsp;<small>'.$post_cont.'</small></h6>';
                          		$response_arr['messages'] .= '</div>';
                          		$response_arr['messages'] .= '<div class="get-more-comments text-left">';
                            
                              	if($this->northbridge_model->getNoOfCommentsInPostHealth($post_id) !== false){
                                	if($this->northbridge_model->getNoOfCommentsInPostHealth($post_id) > 5){
	                                	$response_arr['messages'] .= "<span class='more-comments-btn' onclick='return loadMoreComments(this,".$post_id.")'>view more comments(".$this->northbridge_model->getNoOfCommentsInPostHealth($post_id).")</span>";
	                                 	$response_arr['messages'] .= '<img class="loader-img hide" src="'.base_url('assets/images/loading.gif').'" alt="">';
                                	}
                              	}
                            
                          		$response_arr['messages'] .= '</div>';
                          		$response_arr['messages'] .= '<div class="comment-section text-left">';
                              	$comments_on_post = $this->northbridge_model->getFirstFiveCommentsOnPostHealth($post_id);
                              	if(is_array($comments_on_post)){
                                	$comments_on_post = array_reverse($comments_on_post); 
                                	foreach($comments_on_post as $row){
                                  		$comment_id = $row->id;
                                  		$comment_content = $row->content;
                                 
                                  		$likes = $row->likes;
                                  		$sender = $row->sender;
                                  		$sender_username = $this->northbridge_model->getUserNameById($sender);
                                  		$likes_num = 0;
		                                  if($likes !== ""){
		                                    $likes_arr = explode(",", $likes);
		                                    if(!empty($likes_arr)){
		                                      $likes_arr = array_unique($likes_arr);
		                                      $this->northbridge_model->updateCommentLikesHealth($likes_arr,$comment_id);
		                                      $likes_num = count($likes_arr);
		                                    }
		                                  }
		                                  $new_comment_id = $comment_id . "-comment";
                            
                            			$response_arr['messages'] .= '<h6 id="'.$new_comment_id.'"><a href="'.site_url('northbridge/index/'.$sender_username).'" style="font-size: 14px; font-weight: 600;">'.$sender_username.'</a>&nbsp;&nbsp;<small>'.$comment_content.'</small></h6>';
                             		} 
                             	}	
                            
	                          	$response_arr['messages'] .= '</div>';
	                          	$response_arr['messages'] .= '<div class="add-comment-section">';
	                          	$response_arr['messages'] .= '<form>';
	                          	$response_arr['messages'] .= '<div class="form-group">';
	                         	$response_arr['messages'] .= '<textarea style="padding-bottom: 3px;" onkeypress="return commentInputKeypress (event,this,'.$post_id.');" autocomplete="off" name="message"  placeholder="Add A Comment..." class="form-control comment-input col-sm-10">';
	                          	$response_arr['messages'] .= '</textarea>';
	                          	$response_arr['messages'] .= '<div class="text-right col-sm-1">';
	                          	$response_arr['messages'] .= '<img class="loader-img hide" src="'.base_url('assets/images/loading.gif').'" alt="">';
	                          	$response_arr['messages'] .= '</div>';
	                          	$response_arr['messages'] .= '</div>';
	                          	$response_arr['messages'] .= '</form>';
	                          	$response_arr['messages'] .= '</div>';
	                          	$response_arr['messages'] .= '<div class="text-left">';
                                $response_arr['messages'] .= '<span class="post-time-display"'. $this->northbridge_model->getSocialMediaTime($date,$time) . '</span>';
                                $response_arr['messages'] .= '</div>';
	                          	$response_arr['messages'] .= '</div>';
	                      	  	$response_arr['messages'] .= '</div>';
	                    	  	$response_arr['messages'] .= '</div> ';
                            }	
                            } 
                        
						}
					}
					echo json_encode($response_arr);
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "package_payment" && is_null($third_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$full_name = $user->full_name;
					}

					if($second_addition == "new_nigeria" || $second_addition == "great_nigeria"){
						$reference_code = bin2hex($this->encryption->create_key(16));

						if($second_addition == "new_nigeria"){
							$total_amount = 2498 * 100;
							$type = "new_nigeria";
						}elseif($second_addition == "great_nigeria"){
							$total_amount = 5300 * 100;
							$type = "great_nigeria";
						}
						$redirect_url = site_url('northbridge/index/process-payment/'.$type);
						$patient_email = $email;
						$name = $full_name;

	            		$auth_url = $this->paystack->init($reference_code, $total_amount,$patient_email,[
				            'name' => $name
				        ],$redirect_url);
				        if (filter_var($auth_url, FILTER_VALIDATE_URL)){
					        redirect($auth_url);
					    }else{				    	
						    $this->session->set_userdata('error','wrong');
		            		redirect('northbridge/start-earning');
		            		
					    }		            		
	            	}else{
	            		redirect("northbridge/start-earning");
	            	}	        
				}
			}

			elseif($addition == "check_if_user_is_buoyant" && is_null($third_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if($second_addition == "new_nigeria" || $second_addition == "great_nigeria"){
					if(is_array($user_info)){
						foreach($user_info as $user){
							$user_name = $user->user_name;
							$email = $user->email;
							$phone = $user->phone;
							$country_id = $user->country_id;
							$state_id = $user->state_id;
							$address = $user->address;
							$user_slug = $user->slug;
							$date = $user->date;
							$time = $user->time;
							$logo = $user->logo;
							$cover_photo = $user->cover_photo;
							$bio = $user->bio;
						}
						$data = array('success' => false,'bouyant' => false);								
						
						if($this->input->post('check_if_user_is_buoyant')){
							$data['success'] = true;
							if($this->northbridge_model->checkIfserIsBouyant($second_addition,$user_id)){
								
								$data['bouyant'] = true;
							}
						}
						
						
					}
				}
				echo json_encode($data);
			}

			elseif($addition == "remove_sponsor_id" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
					$data = array('success' => false);								
					
					if($this->input->post('remove_sponsor_id')){
						$data['success'] = true;
						set_cookie("reference","none",86400);
					}
					
					echo json_encode($data);
				}
			}

			elseif($addition == "submit_sponsor_id" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
					$data = array('success' => false,'messages' => '','user_name' => '','full_name' => '');			
					$this->form_validation->set_rules('sponsor-num','Sponsor Phone Number','trim|required|numeric|max_length[15]|min_length[9]');
					$this->form_validation->set_rules('sponsor-num_phoneCode','Phone Code','trim|required|numeric|max_length[3]');
					$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
					if($this->form_validation->run() == FALSE){
						// redirect('northbridge/account_created');
						foreach($_POST as $key => $value){
							$data['messages'][$key] = form_error($key);
						}
					}else{
						$phone_number = $this->input->post('sponsor-num');
						$phone_code = $this->input->post('sponsor-num_phoneCode');
						$phone_number = substr($phone_number, 1);
						
						if($this->northbridge_model->checkIfPhoneExists($phone_number,$phone_code,$user_id)){
							$data['success'] = true;
							$user_name = $this->northbridge_model->getUserNameByPhone1($phone_number);
							$user_id = $this->northbridge_model->getUserIdByName($user_name);
							set_cookie("reference",$user_id,86400);
						}
					}
					echo json_encode($data);
				}
			}

			elseif($addition == "get_sponsor_name" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
					$data = array('success' => false,'messages' => '','user_name' => '','full_name' => '');			
					$this->form_validation->set_rules('sponsor-num','Sponsor Phone Number','trim|required|numeric|max_length[15]|min_length[9]');
					$this->form_validation->set_rules('sponsor-num_phoneCode','Phone Code','trim|required|numeric|max_length[3]');
					$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
					if($this->form_validation->run() == FALSE){
						// redirect('northbridge/account_created');
						foreach($_POST as $key => $value){
							$data['messages'][$key] = form_error($key);
						}
					}else{
						$phone_number = $this->input->post('sponsor-num');
						$phone_code = $this->input->post('sponsor-num_phoneCode');
						$phone_number = substr($phone_number, 1);
						
						if($this->northbridge_model->checkIfPhoneExists($phone_number,$phone_code,$user_id)){
							$data['success'] = true;
							$user_name = $this->northbridge_model->getUserNameByPhone($phone_number,$user_id);
							$full_name = $this->northbridge_model->getFullNameByPhone($phone_number,$user_id);
							$data['user_name'] = $user_name;
							$data['full_name'] = $full_name;
						}
					}
					echo json_encode($data);
				}
			}


			elseif($addition == "load_more_comments" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
					$response_arr = array('success' => false,'messages' => '','last_batch' => false);			
					if($this->input->post('offset')){
						$offset = $this->input->post('offset');
						if($this->northbridge_model->checkIfCommentIdIsValid($offset)){
							$post_id = $this->northbridge_model->getPostIdByCommentId($offset);
							$messages = $this->northbridge_model->getSubsequentCommentsOnPost($post_id,$offset);
							if(is_array($messages)){
								$messages = array_reverse($messages); 
								$response_arr['success'] = true;
								foreach($messages as $row){
									$comment_id = $row->id;
                                  $comment_content = $row->content;
                                 
                                  $likes = $row->likes;
                                  $sender = $row->sender;
                                  $sender_username = $this->northbridge_model->getUserNameById($sender);
                                  $likes_num = 0;
                                  if($likes !== ""){
                                    $likes_arr = explode(",", $likes);
                                    if(!empty($likes_arr)){
                                      $likes_arr = array_unique($likes_arr);
                                      $this->northbridge_model->updateCommentLikes($likes_arr,$comment_id);
                                      $likes_num = count($likes_arr);
                                    }
                                  }
                                  if($this->northbridge_model->checkIfCommentsBatchIsLast($post_id,$comment_id)){
                                  	$response_arr['last_batch'] = true;
                                  }else{
                                  	$response_arr['last_batch'] = false;
                                  }
                                 
                                $response_arr['messages'] .= '<h6 id="'.$comment_id.'-comment"><a href="'.site_url('northbridge/index/'.$sender_username).'" style="font-size: 14px; font-weight: 600;">'.$sender_username.'</a>&nbsp;&nbsp;<small>'.$comment_content.'</small></h6>';
	                                  
								}
							}
						}
					}
					echo json_encode($response_arr);
				}
			}

			elseif($addition == "load_more_comments_health" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
					$response_arr = array('success' => false,'messages' => '','last_batch' => false);			
					if($this->input->post('offset')){
						$offset = $this->input->post('offset');
						if($this->northbridge_model->checkIfCommentIdIsValidHealth($offset)){
							$post_id = $this->northbridge_model->getPostIdByCommentIdHealth($offset);
							$messages = $this->northbridge_model->getSubsequentCommentsOnPostHealth($post_id,$offset);
							if(is_array($messages)){
								$messages = array_reverse($messages); 
								$response_arr['success'] = true;
								foreach($messages as $row){
									$comment_id = $row->id;
                                  $comment_content = $row->content;
                                 
                                  $likes = $row->likes;
                                  $sender = $row->sender;
                                  $sender_username = $this->northbridge_model->getUserNameById($sender);
                                  $likes_num = 0;
                                  if($likes !== ""){
                                    $likes_arr = explode(",", $likes);
                                    if(!empty($likes_arr)){
                                      $likes_arr = array_unique($likes_arr);
                                      $this->northbridge_model->updateCommentLikesHealth($likes_arr,$comment_id);
                                      $likes_num = count($likes_arr);
                                    }
                                  }
                                  if($this->northbridge_model->checkIfCommentsBatchIsLastHealth($post_id,$comment_id)){
                                  	$response_arr['last_batch'] = true;
                                  }else{
                                  	$response_arr['last_batch'] = false;
                                  }
                                 
                                $response_arr['messages'] .= '<h6 id="'.$comment_id.'-comment"><a href="'.site_url('northbridge/index/'.$sender_username).'" style="font-size: 14px; font-weight: 600;">'.$sender_username.'</a>&nbsp;&nbsp;<small>'.$comment_content.'</small></h6>';
	                                  
								}
							}
						}
					}
					echo json_encode($response_arr);
				}
			}

			elseif($addition == "get_users_post_likes" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
					
					$response_arr = array();			
					if($this->input->post('post_id')){
						$post_id = $this->input->post('post_id');
						if($this->northbridge_model->getIfPostIdIsValid($post_id)){
							$post_likes = $this->northbridge_model->getFirstPostLikes($post_id);
							if(is_array($post_likes)){
								for($i = 0; $i < count($post_likes); $i++){
									$post_like = $post_likes[$i];
									$user_info = array(
										'id' => $post_like,
										'user_name' => $this->northbridge_model->getUserNameById($post_like),
										'logo' => $this->northbridge_model->getUserLogoById($post_like),
										'is_following' => $this->northbridge_model->checkIfUserIsFollowingUser($user_id,$post_like)
									);

									if($post_like == $user_id){
										$user_info['user_name'] = "you";
									}

									if($user_info['is_following']){
										$user_info['is_following'] = false;
									}else{
										$user_info['is_following'] = true;
									}
									// var_dump($user_info);
									$response_arr[] = $user_info;
								}
							}
						}
					}
					echo json_encode($response_arr);
				}
			}		
			
			elseif($addition == "get_users_who_liked_post" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
					
					$response_arr = array('success' => false,'messages' => array());			
					if($this->input->post('post_id')){
						$post_id = $this->input->post('post_id');
						if($this->northbridge_model->getIfPostIdIsValid($post_id)){
							$post_likes = $this->northbridge_model->getFirstPostLikes($post_id);
							if(is_array($post_likes)){
								$response_arr['success'] = true;
								for($i = 0; $i < count($post_likes); $i++){
									if($user_id !== $post_likes[$i]){
										if($this->northbridge_model->getUserNameById($post_likes[$i]) !== false){
											$user_name = $this->northbridge_model->getUserNameById($post_likes[$i]);
										}
									}else{
										$user_name = "you";
									}

									if(!$this->northbridge_model->checkIfUserIsFollowingUser($user_id,$post_likes[$i])){
										$following = true;
									}else{
										$following = false;
									}

									if($user_id == $post_likes[$i]){
										$you = true;
									}else{
										$you = false;
									}

									$profile_url = site_url('northbridge/'.$user_name);

									$ret_arr = array(
										'user_name' => $user_name,
										'user_id' => $post_likes[$i],
										'you' => $you,
										'following' => $following,
										'profile_url' => $profile_url
									);

									if($you){
										$following = false;
										$ret_arr['following'] = $following;
									}

									$response_arr['messages'][] = $ret_arr;
									
								}
							}
						}
					}
					echo json_encode($response_arr);
				}
			}

			elseif($addition == "get_users_who_liked_post_health" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
					
					$response_arr = array('success' => false,'messages' => array());			
					if($this->input->post('post_id')){
						$post_id = $this->input->post('post_id');
						if($this->northbridge_model->getIfPostIdIsValidHealth($post_id)){
							$post_likes = $this->northbridge_model->getFirstPostLikesHealth($post_id);
							if(is_array($post_likes)){
								$response_arr['success'] = true;
								for($i = 0; $i < count($post_likes); $i++){
									if($user_id !== $post_likes[$i]){
										if($this->northbridge_model->getUserNameById($post_likes[$i]) !== false){
											$user_name = $this->northbridge_model->getUserNameById($post_likes[$i]);
										}
									}else{
										$user_name = "you";
									}

									if(!$this->northbridge_model->checkIfUserIsFollowingUser($user_id,$post_likes[$i])){
										$following = true;
									}else{
										$following = false;
									}

									if($user_id == $post_likes[$i]){
										$you = true;
									}else{
										$you = false;
									}

									$profile_url = site_url('northbridge/'.$user_name);

									$ret_arr = array(
										'user_name' => $user_name,
										'user_id' => $post_likes[$i],
										'you' => $you,
										'following' => $following,
										'profile_url' => $profile_url
									);

									if($you){
										$following = false;
										$ret_arr['following'] = $following;
									}

									$response_arr['messages'][] = $ret_arr;
									
								}
							}
						}
					}
					echo json_encode($response_arr);
				}
			}			

			elseif($addition == "get_post" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
					$response_arr = array('success' => false,'messages' => '','noval' => false);			
					if($this->input->post('post_id')){
						$post_id = $this->input->post('post_id');
						if($this->northbridge_model->getIfPostIdIsValid($post_id)){
							$posts_by_user = $this->northbridge_model->getMainUserPostById($post_id);
							$posts_by_user = $this->northbridge_model->getFirstTenPostsByUser($user_id);
                            if(is_array($posts_by_user)){
                            	$posts_by_user = array_reverse($posts_by_user); 
                            	$this->session->set_userdata('post_made',true);
                            	$response_arr['success'] = true;
                              foreach($posts_by_user as $row){
                              	$date = $row->date;
                    			$time = $row->time;
                                $post_id = $row->id;
                                $post_content = $row->content;
                                $images = $row->images;
                                $image_arr = explode(",", $images);
                                $likes = $row->likes;
                                $sender = $row->sender;
                                $slug = $row->slug;
                                $sender_username = $this->northbridge_model->getUserNameById($sender);
                                $likes_num = 0;
                                if($likes !== ""){
                                  $likes_arr = explode(",", $likes);
                                  if(!empty($likes_arr)){
                                    $likes_arr = array_unique($likes_arr);
                                    $this->northbridge_model->updatePostLikes($likes_arr,$post_id);
                                    $likes_num = count($likes_arr);
                                  }
                                }
                               
                               
                            
                            $response_arr['messages'] .= '<div class="row justify-content-center">';
                              
                            $response_arr['messages'] .=  '<div class="card-header text-left">';
                            $response_arr['messages'] .=  '<div class="text-left" style="display: inline-block;">';
                            $response_arr['messages'] .=  '<h4 class="card-title text-left"><img src="'.$this->northbridge_model->getUserLogoById($sender).'" alt="">';
                            $response_arr['messages'] .=  '<span>'.$user_name.'</span></h4>';
                            $response_arr['messages'] .=  '</div>';
                            $response_arr['messages'] .=  "<div class='text-right float-right' onclick='moreButton(this,".$post_id.", \"" . str_replace('"', '\"', $slug) . "\")' style='cursor: pointer; display: inline-block;'>";
                            $response_arr['messages'] .= '<i class="fas fa-ellipsis-h"></i>';
                        	$response_arr['messages'] .= '</div>';
                            $response_arr['messages'] .=  '</div>';
                            $response_arr['messages'] .= '<div class="card-body" >';
                                if(!empty($image_arr) && $images !== ""){ 
                                  $response_arr['messages'] .= '<div id="" class="owl-carousel owl-theme owl-demo">';
                                    for($i = 0; $i < count($image_arr); $i++){ 
                                      $current_image = $image_arr[$i];
                                   
                                 		$response_arr['messages'] .= '<div class="item"><img src="'.base_url('assets/images/'.$current_image) .'" alt="'.$post_content .'"></div>';
                                    } 
                                   
                                	$response_arr['messages'] .= '</div>';
                                } 

                                $response_arr['messages'] .= '<div class="action-buttons-panel text-left" style="">';
                                $response_arr['messages'] .= '<div class="row">';
                                $response_arr['messages'] .= '<div class="col-2 col-xs-2 like-btn" onclick="likePost(this,'.$post_id.')">';
                                $response_arr['messages'] .= '<i class="far fa-heart"></i>';
                                $response_arr['messages'] .= '</div>';
                                $response_arr['messages'] .= '<div class="col-2 col-xs-2 comment-btn" onclick="comment(this)">';
                                $response_arr['messages'] .= '<i class="far fa-comment"></i>';
                                $response_arr['messages'] .= '</div>';
                                if($user_name !== $sender_username){
                              		$response_arr['messages'] .= '<div class="col-2 col-xs-2 share-btn" style="" onclick="sharePost(this,'.$post_id.')">';
                                    $response_arr['messages'] .= '<i class="far fa-share-square"></i>';
                              		$response_arr['messages'] .= '</div>';
                          		}
                                $response_arr['messages'] .= '</div>';
                                $response_arr['messages'] .= '<p class="likes-num text-left" onclick="showPostLikes(this,'.$post_id.')">No Likes</p>';
                                $response_arr['messages'] .= '<span class="post-likes-temp hide">0</span>';
                                $response_arr['messages'] .= '</div>';
                                $response_arr['messages'] .= '<div class="post-content text-left">';
                                $response_arr['messages'] .= '<h6><a style="text-transform: lowercase;" href="'.site_url('northbridge/index/'.$sender_username).'" style="font-size: 14px; font-weight: 600;">'.$sender_username.'</a>&nbsp;&nbsp;<small>'.$post_content.'</small></h6>';
                                $response_arr['messages'] .= '</div>';
                                $response_arr['messages'] .= '<div class="get-more-comments text-left">';
                              if($this->northbridge_model->getNoOfCommentsInPost($post_id) !== false){
                                if($this->northbridge_model->getNoOfCommentsInPost($post_id) > 5){
                                  $response_arr['messages'] .= "<span class='more-comments-btn' onclick='return loadMoreComments(this,".$post_id.")'>view more comments(".$this->northbridge_model->getNoOfCommentsInPost($post_id).")</span>";
                                  $response_arr['messages'] .= '<img class="loader-img hide" src="'.base_url('assets/images/loading.gif').'" alt="">';
                                }
                              }
                                    
                               $response_arr['messages'] .= '</div>';
                                $response_arr['messages'] .= '<div class="comment-section text-left">';
                                
                                    
                                      $comments_on_post = $this->northbridge_model->getFirstFiveCommentsOnPost($post_id);
                                      if(is_array($comments_on_post)){
                                      	$comments_on_post = array_reverse($comments_on_post);
                                        foreach($comments_on_post as $row){
                                          $comment_id = $row->id;
                                          $comment_content = $row->content;
                                         
                                          $likes = $row->likes;
                                          $sender = $row->sender;
                                          $sender_username = $this->northbridge_model->getUserNameById($sender);
                                          $likes_num = 0;
                                          if($likes !== ""){
                                            $likes_arr = explode(",", $likes);
                                            if(!empty($likes_arr)){
                                              $likes_arr = array_unique($likes_arr);
                                              $this->northbridge_model->updateCommentLikes($likes_arr,$comment_id);
                                              $likes_num = count($likes_arr);
                                            }
                                          }
                                 
                                $response_arr['messages'] .= '<h6 id="'.$comment_id.'-comment"><a href="'.site_url('northbridge/index/'.$sender_username).'" style="font-size: 14px; font-weight: 600;">'.$sender_username.'</a>&nbsp;&nbsp;<small>'.$comment_content.'</small></h6>';
	                                    } 
	                                } 
                                    
                                $response_arr['messages'] .= '</div>';
                                $response_arr['messages'] .= '<div class="add-comment-section">';
                                $response_arr['messages'] .= '<form>';
                                $response_arr['messages'] .= '<div class="form-group">';
                                $response_arr['messages'] .= '<textarea style="padding-bottom: 3px;" onkeypress="return commentInputKeypress (event,this,'.$post_id.');" autocomplete="off" name="message"  placeholder="Add A Comment..." class="form-control comment-input col-sm-10">';
                                $response_arr['messages'] .= '</textarea>';
                                $response_arr['messages'] .= '<div class="text-right col-sm-1">';
                                $response_arr['messages'] .= '<img class="loader-img hide" src="'.base_url('assets/images/loading.gif').'" alt="">';
                                $response_arr['messages'] .= '</div>';
                                $response_arr['messages'] .= '</div>';
                                $response_arr['messages'] .= '</form>';
                                $response_arr['messages'] .= '</div>';
                                $response_arr['messages'] .= '<div class="text-left">';
                                $response_arr['messages'] .= '<span class="post-time-display"'. $this->northbridge_model->getSocialMediaTime($date,$time) . '</span>';
                                $response_arr['messages'] .= '</div>';
                                $response_arr['messages'] .= '</div>';
                              	$response_arr['messages'] .= '</div>';
                             
                            	$response_arr['messages'] .= '</div>';
                           } } 
						}
					}else{
						$response_arr['noval'] = true;
						$response_arr['messages'] = "";
					}
					echo json_encode($response_arr);
				}		
			}

			elseif($addition == "get_post_health" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
					$response_arr = array('success' => false,'messages' => '','noval' => false);			
					if($this->input->post('post_id')){
						$post_id = $this->input->post('post_id');
						if($this->northbridge_model->getIfPostIdIsValidHealth($post_id)){
							$posts_by_user = $this->northbridge_model->getMainUserPostByIdHealth($post_id);
							$posts_by_user = $this->northbridge_model->getFirstTenPostsByUserHealth($user_id);
                            if(is_array($posts_by_user)){
                            	$posts_by_user = array_reverse($posts_by_user); 
                            	$this->session->set_userdata('post_made',true);
                            	$response_arr['success'] = true;
                              foreach($posts_by_user as $row){
                              	$date = $row->date;
                    			$time = $row->time;
                                $post_id = $row->id;
                                $post_content = $row->content;
                                $images = $row->images;
                                $image_arr = explode(",", $images);
                                $likes = $row->likes;
                                $sender = $row->sender;
                                $slug = $row->slug;
                                $sender_username = $this->northbridge_model->getUserNameById($sender);
                                $likes_num = 0;
                                if($likes !== ""){
                                  $likes_arr = explode(",", $likes);
                                  if(!empty($likes_arr)){
                                    $likes_arr = array_unique($likes_arr);
                                    $this->northbridge_model->updatePostLikesHealth($likes_arr,$post_id);
                                    $likes_num = count($likes_arr);
                                  }
                                }
                               
                               
                            
                            $response_arr['messages'] .= '<div class="row justify-content-center">';
                              
                            
                            	$response_arr['messages'] .= '</div>';
                           } } 
						}
					}else{
						$response_arr['noval'] = true;
						$response_arr['messages'] = "";
					}
					echo json_encode($response_arr);
				}		
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "update_post_content" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
					$response_arr = array('success' => false);
					
					if($this->input->post('post_id') && $this->input->post('content')){
						$post_id = $this->input->post('post_id');
						$content = $this->input->post('content');
						if($this->northbridge_model->getIfPostIdIsValid($post_id)){
							if($this->northbridge_model->getIfUserOwnsThisPost($post_id,$user_id)){

								if($content !== ""){
									if($this->northbridge_model->updatePostContent($post_id,$content)){
										$response_arr['success'] = true;
									}
								}
							}
						}
					}
					
					echo json_encode($response_arr);
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "update_post_content_health" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
					$response_arr = array('success' => false);
					
					if($this->input->post('post_id') && $this->input->post('content')){
						$post_id = $this->input->post('post_id');
						$content = $this->input->post('content');
						if($this->northbridge_model->getIfPostIdIsValidHealth($post_id)){
							if($this->northbridge_model->getIfUserOwnsThisPostHealth($post_id,$user_id)){

								if($content !== ""){
									if($this->northbridge_model->updatePostContentHealth($post_id,$content)){
										$response_arr['success'] = true;
									}
								}
							}
						}
					}
					
					echo json_encode($response_arr);
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "get_all_post_images" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
					$response_arr = array('success' => false,'messages' => '');
					
					if($this->input->post('post_id')){
						$post_id = $this->input->post('post_id');
						if($this->northbridge_model->getIfPostIdIsValid($post_id) && $this->northbridge_model->getIfUserOwnsThisPost($post_id,$user_id)){
							
							
								$post = $this->northbridge_model->getPostById($post_id);
								if(is_array($post)){
									foreach($post as $row){
										$post_id = $row->id;
										$content = $row->content;
										$sender = $row->sender;
										$images = $row->images;
									}
									
										$response_arr['success'] = true;
										
										if($images !== ""){
											$image_arr = explode(",", $images);
											// echo count($image_arr);
											for($i = 0;$i < count($image_arr); $i++){
												$image_name = $image_arr[$i];
												
												 $response_arr['messages'] .= '<div class="col-sm-6 mato-30">';
						                         $response_arr['messages'] .= '<div class="contain">';
						                         $response_arr['messages'] .= '<img src="'.base_url('assets/images/'.$image_name).'" class="adjust-img image">';
						                         $response_arr['messages'] .= '<div class="overlay">';
						                         $response_arr['messages'] .= "<a href='#' class='icon3 text-danger' title='Delete Image' onclick='deletePostImage(this,event,".$post_id.",\"" . str_replace('"', '\"', $image_name) . "\")'>";
						                         $response_arr['messages'] .= '<i class="fas fa-trash-alt"></i>';
						                         $response_arr['messages'] .= '</a>';
						                              
						                         $response_arr['messages'] .= '</div>';
						                         $response_arr['messages'] .= '</div>';
						                         $response_arr['messages'] .= '</div>';
											}
										}
									// }
								}else{

								}
								$response_arr['messages'] .= '<div class="col-sm-6" style="line-height: 400px; cursor:pointer;" onclick="addNewImage('.$post_id.')">';
								$response_arr['messages'] .= '<i class="fas fa-plus-circle" style="font-size:176px; vertical-align: middle;"></i>';
								$response_arr['messages'] .= '</div>';
								
						}
					}
					
					echo json_encode($response_arr);
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "delete_post_image" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
					$response_arr = array('success' => false,'messages' => '');
					
					if($this->input->post('post_id') && $this->input->post('image_name')){
						$post_id = $this->input->post('post_id');
						$image_name = $this->input->post('image_name');
						if($this->northbridge_model->getIfPostIdIsValid($post_id) && $this->northbridge_model->getIfUserOwnsThisPost($post_id,$user_id)){
							if($this->northbridge_model->checkIfImageIsPartOfPost($post_id,$image_name)){
								if($this->northbridge_model->deletePostImage($post_id,$image_name)){
									$post = $this->northbridge_model->getPostById($post_id);
									if(is_array($post)){
										foreach($post as $row){
											$post_id = $row->id;
											$content = $row->content;
											$sender = $row->sender;
											$images = $row->images;
										}
										
											$response_arr['success'] = true;
											
											if($images !== ""){
												$image_arr = explode(",", $images);
												// echo count($image_arr);
												for($i = 0;$i < count($image_arr); $i++){
													$image_name = $image_arr[$i];
													
													 $response_arr['messages'] .= '<div class="col-sm-6 mato-30">';
							                         $response_arr['messages'] .= '<div class="contain">';
							                         $response_arr['messages'] .= '<img src="'.base_url('assets/images/'.$image_name).'" class="adjust-img image">';
							                         $response_arr['messages'] .= '<div class="overlay">';
							                         $response_arr['messages'] .= "<a href='#' class='icon3 text-danger' title='Delete Image' onclick='deletePostImage(this,event,".$post_id.",\"" . str_replace('"', '\"', $image_name) . "\")'>";
							                         $response_arr['messages'] .= '<i class="fas fa-trash-alt"></i>';
							                         $response_arr['messages'] .= '</a>';
							                              
							                         $response_arr['messages'] .= '</div>';
							                         $response_arr['messages'] .= '</div>';
							                         $response_arr['messages'] .= '</div>';
												}
											}
										// }
									}else{

									}
									$response_arr['messages'] .= '<div class="col-sm-6" style="line-height: 400px; cursor:pointer;" onclick="addNewImage('.$post_id.')">';
									$response_arr['messages'] .= '<i class="fas fa-plus-circle" style="font-size:176px; vertical-align: middle;"></i>';
									$response_arr['messages'] .= '</div>';
								}
							}	
						}
					}
					
					echo json_encode($response_arr);
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "delete_post_image_health" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
					$response_arr = array('success' => false,'messages' => '');
					
					if($this->input->post('post_id') && $this->input->post('image_name')){
						$post_id = $this->input->post('post_id');
						$image_name = $this->input->post('image_name');
						if($this->northbridge_model->getIfPostIdIsValidHealth($post_id) && $this->northbridge_model->getIfUserOwnsThisPostHealth($post_id,$user_id)){
							if($this->northbridge_model->checkIfImageIsPartOfPostHealth($post_id,$image_name)){
								if($this->northbridge_model->deletePostImageHealth($post_id,$image_name)){
									$post = $this->northbridge_model->getPostByIdHealth($post_id);
									if(is_array($post)){
										foreach($post as $row){
											$post_id = $row->id;
											$content = $row->content;
											$sender = $row->sender;
											$images = $row->images;
										}	
										
											$response_arr['success'] = true;
											
											if($images !== ""){
												$image_arr = explode(",", $images);
												// echo count($image_arr);
												for($i = 0;$i < count($image_arr); $i++){
													$image_name = $image_arr[$i];
													
													 $response_arr['messages'] .= '<div class="col-sm-6 mato-30">';
							                         $response_arr['messages'] .= '<div class="contain">';
							                         $response_arr['messages'] .= '<img src="'.base_url('assets/images/'.$image_name).'" class="adjust-img image">';
							                         $response_arr['messages'] .= '<div class="overlay">';
							                         $response_arr['messages'] .= "<a href='#' class='icon3 text-danger' title='Delete Image' onclick='deletePostImage(this,event,".$post_id.",\"" . str_replace('"', '\"', $image_name) . "\")'>";
							                         $response_arr['messages'] .= '<i class="fas fa-trash-alt"></i>';
							                         $response_arr['messages'] .= '</a>';
							                              
							                         $response_arr['messages'] .= '</div>';
							                         $response_arr['messages'] .= '</div>';
							                         $response_arr['messages'] .= '</div>';
												}
											}
										// }
									}else{

									}
									$response_arr['messages'] .= '<div class="col-sm-6" style="line-height: 400px; cursor:pointer;" onclick="addNewImage('.$post_id.')">';
									$response_arr['messages'] .= '<i class="fas fa-plus-circle" style="font-size:176px; vertical-align: middle;"></i>';
									$response_arr['messages'] .= '</div>';
								}
							}	
						}
					}
					
					echo json_encode($response_arr);
				}
			}

			elseif($addition == "delete_post"  && $this->northbridge_model->confirmLoggedIn() == TRUE  && is_null($second_addition)){

				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
					}
					
					
		            $response_arr = array('success' => false);
		            if($this->input->post('post_id') ){
		            	$post_id = $this->input->post('post_id');
		            	if($this->northbridge_model->checkIfPostIdIsValid($post_id) && $this->northbridge_model->getIfUserOwnsThisPost($post_id,$user_id)){
		            		if($this->northbridge_model->deletePost($post_id)){
		            			if($this->northbridge_model->deleteCommentsUnderPost($post_id)){
		            				$response_arr['success'] = true;
		            			}
		            		}
		            	}
					}
					echo json_encode($response_arr);			        
					
				}
			}

			elseif($addition == "delete_post_health"  && $this->northbridge_model->confirmLoggedIn() == TRUE  && is_null($second_addition)){

				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
					}
					
					
		            $response_arr = array('success' => false);
		            if($this->input->post('post_id') ){
		            	$post_id = $this->input->post('post_id');
		            	if($this->northbridge_model->checkIfPostIdIsValidHealth($post_id) && $this->northbridge_model->getIfUserOwnsThisPostHealth($post_id,$user_id)){
		            		if($this->northbridge_model->deletePostHealth($post_id)){
		            			if($this->northbridge_model->deleteCommentsUnderPostHealth($post_id)){
		            				$response_arr['success'] = true;
		            			}
		            		}
		            	}
					}
					echo json_encode($response_arr);			        
					
				}
			}

			elseif($addition == "add-new-post-image"  && $this->northbridge_model->confirmLoggedIn() == TRUE  && is_null($second_addition)){

				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
					}
					
					
		            $response_arr = array('success' => false,'errors' => '','max' => true);
		            if(get_cookie('post_id')){
		            	$post_id = get_cookie('post_id');
			            if($this->northbridge_model->getIfThereIsStillSpaceForPostUpload($post_id)){
				           	if(!empty($_FILES['image']['name'])){
				           		$response_arr['empty'] = false;
								$files_count = count($_FILES['image']['name']);
								
								if($files_count == 1){
									for($i = 0; $i < $files_count; $i++){
										$pos = $i + 1;
										$_FILES['file']['name']     = $_FILES['image']['name'][$i];
						                $_FILES['file']['type']     = $_FILES['image']['type'][$i];
						                $_FILES['file']['tmp_name'] = $_FILES['image']['tmp_name'][$i];
						                $_FILES['file']['error']     = $_FILES['image']['error'][$i];
						                $_FILES['file']['size']     = $_FILES['image']['size'][$i];

						                $config['encrypt_name'] = true;
						                $config['upload_path']  = './assets/images';
										$config['allowed_types'] = 'gif|jpg|png|jpeg';
										
										$config['max_width'] = '1400';
										$config['max_height'] = '1400';
										$config['min_width'] = '100';
										$config['min_height'] = '100';
										$this->upload->initialize($config);
										if($this->upload->do_upload('image')){
											$file_name = $this->upload->data('file_name');
						                	$this->load->library('image_lib');
											
											
											$config['image_library'] = 'gd2';
										    $config['source_image'] = realpath('./assets/images/'.$file_name);
										    $config['create_thumb'] = TRUE;
										    // $config['maintain_ratio'] = TRUE;
										    $config['quality'] = '100%';
										    $config['width']     = 500;
										    $config['height']   = 500;

										    $this->image_lib->clear();
										    $this->image_lib->initialize($config);
										    if($this->image_lib->resize()){

												$this->load->library('image_lib', $config);
												if($this->image_lib->resize()){
								                	
								                	$post_id = get_cookie('post_id',true);
								                	
								                	$file_name = $this->upload->data('raw_name') .'_thumb' . $this->upload->data('file_ext');

								                	if($this->northbridge_model->updatePostImages($file_name,$post_id,$user_id)){
									                	$response_arr['success'] = true;
									                }
									            }
									        }
										}else{
											$response_arr['errors'] .= "Image unable to upload because: <span style='font-style:italic;' class='text-danger' >". $this->upload->display_errors() . "</span><br>";
										}
									}
								}else{
									$response_arr['errors'] .= "Sorry You Must Select One Image";
								}
							}
						}
					}
					echo json_encode($response_arr);			        
					
				}
			}

			elseif($addition == "add-new-post-image-health"  && $this->northbridge_model->confirmLoggedIn() == TRUE  && is_null($second_addition)){

				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
					}
					
					
		            $response_arr = array('success' => false,'errors' => '','max' => false);
		            if($this->input->post('post_id')){
		            	$post_id = $this->input->post('post_id');
		            	// echo $post_id;
			            if($this->northbridge_model->getIfThereIsStillSpaceForPostUploadHealth($post_id)){
				           	if(!empty($_FILES['image']['name'])){
				           		$response_arr['empty'] = false;
								$files_count = count($_FILES['image']['name']);
								
								if($files_count == 1){
									for($i = 0; $i < $files_count; $i++){
										$pos = $i + 1;
										$_FILES['file']['name']     = $_FILES['image']['name'][$i];
						                $_FILES['file']['type']     = $_FILES['image']['type'][$i];
						                $_FILES['file']['tmp_name'] = $_FILES['image']['tmp_name'][$i];
						                $_FILES['file']['error']     = $_FILES['image']['error'][$i];
						                $_FILES['file']['size']     = $_FILES['image']['size'][$i];

						                $config['encrypt_name'] = true;
						                $config['upload_path']  = './assets/images';
										$config['allowed_types'] = 'gif|jpg|png|jpeg';
										
										$config['max_width'] = '1400';
										$config['max_height'] = '1400';
										$config['min_width'] = '100';
										$config['min_height'] = '100';
										$this->upload->initialize($config);
										if($this->upload->do_upload('image')){
											$file_name = $this->upload->data('file_name');
						                	$this->load->library('image_lib');
											
											
											$config['image_library'] = 'gd2';
										    $config['source_image'] = realpath('./assets/images/'.$file_name);
										    $config['create_thumb'] = TRUE;
										    // $config['maintain_ratio'] = TRUE;
										    $config['quality'] = '100%';
										    $config['width']     = 500;
										    $config['height']   = 500;

										    $this->image_lib->clear();
										    $this->image_lib->initialize($config);
										    if($this->image_lib->resize()){

												$this->load->library('image_lib', $config);
												if($this->image_lib->resize()){
								                	
								                	$post_id = get_cookie('post_id',true);
								                	
								                	$file_name = $this->upload->data('raw_name') .'_thumb' . $this->upload->data('file_ext');

								                	if($this->northbridge_model->updatePostImagesHealth($file_name,$post_id,$user_id)){
									                	$response_arr['success'] = true;
									                }
									            }
									        }
										}else{
											$response_arr['errors'] .= "Image unable to upload because: <span style='font-style:italic;' class='text-danger' >". $this->upload->display_errors() . "</span><br>";
										}
									}
								}else{
									$response_arr['errors'] .= "Sorry You Must Select One Image";
								}
							}
						}else{
							$response_arr['max'] = true;
						}
					}
					echo json_encode($response_arr);			        
					
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "get_post_for_edit" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
					$response_arr = array('success' => false,'messages' => '','post_content' => '');
					if($this->input->post('post_id')){
						$post_id = $this->input->post('post_id');
						if($this->northbridge_model->getIfPostIdIsValid($post_id)){
							$post = $this->northbridge_model->getPostById($post_id);
							if(is_array($post)){
								foreach($post as $row){
									$post_id = $row->id;
									$content = $row->content;
									$sender = $row->sender;
									$images = $row->images;
								}
								if($sender == $user_id){
									$response_arr['success'] = true;
									$response_arr['post_content'] = $content;
									if($images !== ""){
										$image_arr = explode(",", $images);
										// echo count($image_arr);
										for($i = 0;$i < count($image_arr); $i++){
											$image_name = $image_arr[$i];
											
											 $response_arr['messages'] .= '<div class="col-sm-6 mato-30">';
					                         $response_arr['messages'] .= '<div class="contain">';
					                         $response_arr['messages'] .= '<img src="'.base_url('assets/images/'.$image_name).'" class="adjust-img image">';
					                         $response_arr['messages'] .= '<div class="overlay">';
					                         $response_arr['messages'] .= "<a href='#' class='icon3 text-danger' title='Delete Image' onclick='deletePostImage(this,event,".$post_id.",\"" . str_replace('"', '\"', $image_name) . "\")'>";
					                         $response_arr['messages'] .= '<i class="fas fa-trash-alt"></i>';
					                         $response_arr['messages'] .= '</a>';
					                              
					                         $response_arr['messages'] .= '</div>';
					                         $response_arr['messages'] .= '</div>';
					                         $response_arr['messages'] .= '</div>';
										}
									}
								}
							}
							$response_arr['messages'] .= '<div class="col-sm-6" style="line-height: 400px; cursor:pointer;" onclick="addNewImage('.$post_id.')">';
							$response_arr['messages'] .= '<i class="fas fa-plus-circle" style="font-size:176px; vertical-align: middle;"></i>';
							$response_arr['messages'] .= '</div>';
						}
					}
					echo json_encode($response_arr);
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "get_post_for_edit_health" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
					$response_arr = array('success' => false,'messages' => '','post_content' => '');
					if($this->input->post('post_id')){
						$post_id = $this->input->post('post_id');
						if($this->northbridge_model->getIfPostIdIsValidHealth($post_id)){
							$post = $this->northbridge_model->getPostByIdHealth($post_id);
							if(is_array($post)){
								foreach($post as $row){
									$post_id = $row->id;
									$content = $row->content;
									$sender = $row->sender;
									$images = $row->images;
								}
								if($sender == $user_id){
									$response_arr['success'] = true;
									$response_arr['post_content'] = $content;
									if($images !== ""){
										$image_arr = explode(",", $images);
										// echo count($image_arr);
										for($i = 0;$i < count($image_arr); $i++){
											$image_name = $image_arr[$i];
											
											 $response_arr['messages'] .= '<div class="col-sm-6 mato-30">';
					                         $response_arr['messages'] .= '<div class="contain">';
					                         $response_arr['messages'] .= '<img src="'.base_url('assets/images/'.$image_name).'" class="adjust-img image">';
					                         $response_arr['messages'] .= '<div class="overlay">';
					                         $response_arr['messages'] .= "<a href='#' class='icon3 text-danger' title='Delete Image' onclick='deletePostImage(this,event,".$post_id.",\"" . str_replace('"', '\"', $image_name) . "\")'>";
					                         $response_arr['messages'] .= '<i class="fas fa-trash-alt"></i>';
					                         $response_arr['messages'] .= '</a>';
					                              
					                         $response_arr['messages'] .= '</div>';
					                         $response_arr['messages'] .= '</div>';
					                         $response_arr['messages'] .= '</div>';
										}
									}
								}
							}
							$response_arr['messages'] .= '<div class="col-sm-6" style="line-height: 400px; cursor:pointer;" onclick="addNewImage('.$post_id.')">';
							$response_arr['messages'] .= '<i class="fas fa-plus-circle" style="font-size:176px; vertical-align: middle;"></i>';
							$response_arr['messages'] .= '</div>';
						}
					}
					echo json_encode($response_arr);
				}
			}		

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "follow" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}

					if($this->input->post('user_id')){
						$response_arr = array('success' => false);
						$partner_id = $this->input->post('user_id');
						
						if($this->northbridge_model->getIfUserIdIsValid($partner_id) && $partner_id !== $user_id){
							$user_info = $this->northbridge_model->getUserInfoByUserId($partner_id);
							if(is_array($user_info)){
								foreach($user_info as $user){
									$partner_user_name = $user->user_name;
									$partner_email = $user->email;
									$partner_phone = $user->phone;
									$partner_country_id = $user->country_id;
									$partner_state_id = $user->state_id;
									$partner_address = $user->address;
									$partner_user_slug = $user->slug;
									$partner_date = $user->date;
									$partner_time = $user->time;
									$partner_logo = $user->logo;
									$partner_cover_photo = $user->cover_photo;
									$partner_bio = $user->bio;
								}
								if($this->northbridge_model->checkIfUserIsFollowingUser($user_id,$partner_id)){
									// echo "string";
									if($this->northbridge_model->followUser($user_id,$partner_id) == TRUE){
										$response_arr['success'] = true;
									}
								}
							}					
						}
						echo json_encode($response_arr);
					}
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "like_post" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}

					if($this->input->post('post_id')){
						$response_arr = array('success' => false);
						$post_id = $this->input->post('post_id');
						
						if($this->northbridge_model->getIfPostIdIsValid($post_id)){
							
							if($this->northbridge_model->checkIfUserHasAlreadyLikedPost($user_id,$post_id)){
								if($this->northbridge_model->likePost($user_id,$post_id) == TRUE){
									$response_arr['success'] = true;
								}
							}
												
						}
						echo json_encode($response_arr);
					}
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "like_post_health" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}

					if($this->input->post('post_id')){
						$response_arr = array('success' => false);
						$post_id = $this->input->post('post_id');
						
						if($this->northbridge_model->getIfPostIdIsValidHealth($post_id)){
							
							if($this->northbridge_model->checkIfUserHasAlreadyLikedPostHealth($user_id,$post_id)){
								if($this->northbridge_model->likePostHealth($user_id,$post_id) == TRUE){
									$response_arr['success'] = true;
								}
							}
												
						}
						echo json_encode($response_arr);
					}
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "comment" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}

					if($this->input->post('post_id') && $this->input->post('content')){
						$response_arr = array('success' => false);
						$post_id = $this->input->post('post_id');
						$content = $this->input->post('content');
						if($this->northbridge_model->getIfPostIdIsValid($post_id)){
							$date = date("j M Y");
							$time = date("h:i:sa");							
							if($this->northbridge_model->commentOnPost($user_id,$post_id,$content,$date,$time) == TRUE){
								$response_arr['success'] = true;
							}											
						}
						echo json_encode($response_arr);
					}
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "comment_health" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}

					if($this->input->post('post_id') && $this->input->post('content')){
						$response_arr = array('success' => false);
						$post_id = $this->input->post('post_id');
						$content = $this->input->post('content');
						if($this->northbridge_model->getIfPostIdIsValidHealth($post_id)){
							$date = date("j M Y");
							$time = date("h:i:sa");							
							if($this->northbridge_model->commentOnPostHealth($user_id,$post_id,$content,$date,$time) == TRUE){
								$response_arr['success'] = true;
							}											
						}
						echo json_encode($response_arr);
					}
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "unlike_post" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}

					if($this->input->post('post_id')){
						$response_arr = array('success' => false);
						$post_id = $this->input->post('post_id');
						
						if($this->northbridge_model->getIfPostIdIsValid($post_id)){
							
							if(!$this->northbridge_model->checkIfUserHasAlreadyLikedPost($user_id,$post_id)){
								if($this->northbridge_model->unlikePost($user_id,$post_id) == TRUE){
									$response_arr['success'] = true;
								}
							}
												
						}
						echo json_encode($response_arr);
					}
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "unlike_post_health" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}

					if($this->input->post('post_id')){
						$response_arr = array('success' => false);
						$post_id = $this->input->post('post_id');
						
						if($this->northbridge_model->getIfPostIdIsValidHealth($post_id)){
							
							if(!$this->northbridge_model->checkIfUserHasAlreadyLikedPostHealth($user_id,$post_id)){
								if($this->northbridge_model->unlikePostHealth($user_id,$post_id) == TRUE){
									$response_arr['success'] = true;
								}
							}
												
						}
						echo json_encode($response_arr);
					}
				}
			}


			//Share Post
			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "share_post" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}

					if($this->input->post('post_id')){
						$response_arr = array('success' => false);
						$post_id = $this->input->post('post_id');
						
						if($this->northbridge_model->getIfPostIdIsValid($post_id)){
							$images = $this->northbridge_model->getImagesInPost($post_id);
							if($images !== ""){
								
								$new_images_arr = array();
								$images_arr = explode(",", $images);
								$images_num = count($images_arr);
								for($i = 0; $i < $images_num; $i++){
									$image = $images_arr[$i];									
									$ext = pathinfo($image, PATHINFO_EXTENSION);
									$new_images_arr[] .= bin2hex($this->encryption->create_key(16)).".".$ext;	
									$new_image = $new_images_arr[$i];
									if(copy("./assets/images/".$image,"./assets/images/".$new_image)){

									}
								}

								
								$new_images = implode(",", $new_images_arr);
								$post = $this->northbridge_model->getPostContentById($post_id);
								$date = date("j M Y");
								$slug = url_title(substr($post, 0,50));
								$time = date("h:i:sa");
								$form_array = array(
									'images' => $new_images,
									'content' => $post,
									'slug' => $slug,
									'sender' => $user_id,
									'date' => $date,
									'time' => $time
								);
								if($post !== ""){
									if($this->northbridge_model->makePost($form_array)){										
										$response_arr['success'] = true;
									}
								}
								

								// print_r($new_images_arr);
							}else{
								$post = $this->northbridge_model->getPostContentById($post_id);
								$slug = strtolower(url_title(substr($post, 0,50)));
								$date = date("j M Y");
								$time = date("h:i:sa");
								$form_array = array(
									'content' => $post,
									'slug' => $slug,
									'sender' => $user_id,
									'date' => $date,
									'time' => $time
								);
								if($post !== ""){
									if($this->northbridge_model->makePost($form_array)){										
										$response_arr['success'] = true;
									}
								}
							}
						}
						echo json_encode($response_arr);
					}
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "unfollow" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}

					if($this->input->post('user_id')){
						$response_arr = array('success' => false);
						$partner_id = $this->input->post('user_id');
						// echo $user_id;
						if($this->northbridge_model->getIfUserIdIsValid($partner_id) && $partner_id !== $user_id){
							// echo "string";
							$user_info = $this->northbridge_model->getUserInfoByUserId($partner_id);
							if(is_array($user_info)){
								foreach($user_info as $user){
									$partner_user_name = $user->user_name;
									$partner_email = $user->email;
									$partner_phone = $user->phone;
									$partner_country_id = $user->country_id;
									$partner_state_id = $user->state_id;
									$partner_address = $user->address;
									$partner_user_slug = $user->slug;
									$partner_date = $user->date;
									$partner_time = $user->time;
									$partner_logo = $user->logo;
									$partner_cover_photo = $user->cover_photo;
									$partner_bio = $user->bio;
								}
								if(!$this->northbridge_model->checkIfUserIsFollowingUser($user_id,$partner_id)){
									// echo "string";
									if($this->northbridge_model->unfollowUser($user_id,$partner_id) == TRUE){
										$response_arr['success'] = true;
									}
								}
							}					
						}
						echo json_encode($response_arr);
					}
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "send_message" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}

					if($this->input->post('user_id') && $this->input->post('message')){
						$response_arr = array('success' => false,'new_id' => '');
						$partner_id = $this->input->post('user_id');
						$message = $this->input->post('message');
						if($this->northbridge_model->getIfUserIdIsValid($partner_id) && $partner_id !== $user_id){
							$user_info = $this->northbridge_model->getUserInfoByUserId($partner_id);
							if(is_array($user_info)){
								foreach($user_info as $user){
									$partner_user_name = $user->user_name;
									$partner_email = $user->email;
									$partner_phone = $user->phone;
									$partner_country_id = $user->country_id;
									$partner_state_id = $user->state_id;
									$partner_address = $user->address;
									$partner_user_slug = $user->slug;
									$partner_date = $user->date;
									$partner_time = $user->time;
									$partner_logo = $user->logo;
									$partner_cover_photo = $user->cover_photo;
									$partner_bio = $user->bio;
								}
								$date = date("j M Y");
								$time = date("h:i:sa");
								$form_array = array(
									'sender' => $user_id,
									'receiver' => $partner_id,
									'date' => $date,
									'time' => $time,
									'message' => $message,
									'received' => 0
								);
								
								$response_arr['new_id'] = $this->northbridge_model->sendChatMessage($form_array,$partner_id);
								$response_arr['success'] = true;
							
							}					
						}
						echo json_encode($response_arr);
					}
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "get_messages" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}

					if($this->input->post('user_id')){
						$response_arr = array('success' => false,'messages' => '','offset' => '','online_status' => false);
						$partner_id = $this->input->post('user_id');
						if($this->northbridge_model->getIfUserIdIsValid($partner_id) && $partner_id !== $user_id){
							$user_info = $this->northbridge_model->getUserInfoByUserId($partner_id);
							if(is_array($user_info)){
								foreach($user_info as $user){
									$partner_user_name = $user->user_name;
									$partner_email = $user->email;
									$partner_phone = $user->phone;
									$partner_country_id = $user->country_id;
									$partner_state_id = $user->state_id;
									$partner_address = $user->address;
									$partner_user_slug = $user->slug;
									$partner_date = $user->date;
									$partner_time = $user->time;
									$partner_logo = $user->logo;
									$partner_cover_photo = $user->cover_photo;
									$partner_bio = $user->bio;
								}
								$response_arr['success'] = true;
								$messages = $this->northbridge_model->getFirstChatMessages($user_id,$partner_id);
									if(is_array($messages)){
										$messages = array_reverse($messages);								
										
										$id_arr = array();
										foreach($messages as $row){
											$id = $row->id;
											$id_arr[] .= $id;
											$you = false;
											$sender = $row->sender;
											$receiver = $row->receiver;
											$message = $row->message;
											
											$curr_year = date("Y");
											$time = $row->time;
											$chat_date = $row->date;
											// echo $chat_date;
											$curr_date = date("j M Y");
											$curr_time = date("h:i:sa");
											if($sender == $user_id){											
												$you = true;
											}
											$year = substr($chat_date, -4);
											$mon_day = substr($chat_date,0, -4);

											//if its not the same year
											if($curr_year > $year){
												$t_stamp = $chat_date . ' ' . $time;
											}else{ //same day
												if($curr_date == $chat_date){
													$t_stamp = $time;
												}else{
													$t_stamp = $mon_day . ' ' .$time;
												}
												
											}
											// echo $partner_id;
											if(is_null($logo)){
												$logo_url = base_url('assets/images/avatar.jpg');
											}else{
												$logo_url = base_url('assets/images/'.$logo);
											}

											if(is_null($partner_logo)){
												$partner_logo_url = base_url('assets/images/avatar.jpg');
											}else{
												$partner_logo_url = base_url('assets/images/'.$partner_logo);
											}

											if($you){
												$who = 'self';
												$display_name = 'you';
												$mark = "<i class='fas fa-check message-mark'></i>";
											}else{
												$who = 'other';
												$display_name = $partner_user_name;
												$mark = "";
											}
											
											$response_arr['messages'] .= "<li class='".$who."'><div class='messages' id='".$id."'><p>".$message."</p><time datetime=".$chat_date. "".$time.">".$display_name." • ".$t_stamp."</time>".$mark."</div></li>";
											
										}
										
										$response_arr['offset'] = max($id_arr);
										
										$this->northbridge_model->updateMessageAsRead($id);
									}else{
										$response_arr['offset'] = "";
									}
								}
							$response_arr['online_status'] = $this->northbridge_model->getUserOnlineStatus($partner_id);
						}
						echo json_encode($response_arr);
					}
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "userlogin" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
					$response_arr = array('success' => false,'online_users_html' => '','total_online_users' => 0);
					if($this->input->post('login')){
						if($this->northbridge_model->updateUserLastActivity($user_id)){							
							
							$online_users = $this->northbridge_model->getUserTotalOnlineFollowing($user_id);
							if(is_array($online_users) && !empty($online_users)){
								$response_arr['total_online_users'] = $this->northbridge_model->getUserTotalFollowingOnlineNum($user_id);
								$response_arr['online_users_html'] .= '<ul class="nav">';

								for($i = 0; $i < count($online_users); $i++){
									$partner_id = $online_users[$i];
									$partner_user_name = $this->northbridge_model->getUserNameById($partner_id);
									$partner_initials = strtoupper(substr($partner_user_name,0, 1));
									$partner_full_name = $this->northbridge_model->getUserFullNameById($partner_id);
									$partner_full_name = $this->northbridge_model->custom_echo($partner_full_name,40);
									$get_messages = site_url('northbridge/get_messages');
									$get_status = site_url('northbridge/get_status');
									$sound_url = base_url('assets/audio/notif-sound.mp3');
									$send_message = site_url('northbridge/index/send_message');
									$get_last_chats = site_url('northbridge/index/get_last_chats');
									$messaging = site_url('northbridge/index/'.$user_id.'/messaging');
									$small_loader = base_url('assets/images/small-loader.gif');
									$partner_profile = site_url('northbridge/'.$partner_user_name);


					                $response_arr['online_users_html'] .= '<li class="nav-item ">';
					                $response_arr['online_users_html'] .= '<a class="nav-link" href="'.$partner_profile.'">';
					                $response_arr['online_users_html'] .= '<span class="sidebar-mini">'.$partner_initials.'</span>';
					                $response_arr['online_users_html'] .= '<span class="sidebar-normal">'.$partner_full_name.'<span class="dot text-right online-status" style="background-color: #33FF00; float:right; margin-top:6px;"></span>'.'</span>';
					                // $response_arr['online_users_html'] .= ;
					                $response_arr['online_users_html'] .= '</a>';

					                $response_arr['online_users_html'] .= '</li>';
					            }
				                $response_arr['online_users_html'] .= '</ul>';
				            }else{
				            	$response_arr['online_users_html'] .= '<span style="font-style: italic;" class="text-danger">No Followers Online</span>';
				            }   
				              
							$response_arr['success'] = true;
						}
					}
					echo json_encode($response_arr);
				}
			}	


			//Get Last Chats
			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "get_last_chats" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
					// echo $this->input->post('offset');
					if($this->input->post('user_id') && $this->input->post('get_last_chats')){

						$response_arr = array('success' => false,'messages' => '');
						$partner_id = $this->input->post('user_id');
						$offset = $this->input->post('offset');
						if($this->northbridge_model->getIfUserIdIsValid($partner_id) && $partner_id !== $user_id){
							$user_info = $this->northbridge_model->getUserInfoByUserId($partner_id);
							if(is_array($user_info)){

								foreach($user_info as $user){
									$partner_user_name = $user->user_name;
									$partner_email = $user->email;
									$partner_phone = $user->phone;
									$partner_country_id = $user->country_id;
									$partner_state_id = $user->state_id;
									$partner_address = $user->address;
									$partner_user_slug = $user->slug;
									$partner_date = $user->date;
									$partner_time = $user->time;
									$partner_logo = $user->logo;
									$partner_cover_photo = $user->cover_photo;
									$partner_bio = $user->bio;
								}
								
								$messages = $this->northbridge_model->getSubsequentChatOlderMessages($user_id,$partner_id,$offset);
									if(is_array($messages)){
										$messages = array_reverse($messages);								
										$response_arr['success'] = true;
										$id_arr = array();
										foreach($messages as $row){
											$id = $row->id;
											$id_arr[] .= $id;
											$you = false;
											$sender = $row->sender;
											$receiver = $row->receiver;
											$message = $row->message;
											
											$curr_year = date("Y");
											$time = $row->time;
											$chat_date = $row->date;
											// echo $chat_date;
											$curr_date = date("j M Y");
											$curr_time = date("h:i:sa");
											if($sender == $user_id){											
												$you = true;
											}
											$year = substr($chat_date, -4);
											$mon_day = substr($chat_date,0, -4);

											//if its not the same year
											if($curr_year > $year){
												$t_stamp = $chat_date . ' ' . $time;
											}else{ //same day
												if($curr_date == $chat_date){
													$t_stamp = $time;
												}else{
													$t_stamp = $mon_day . ' ' .$time;
												}
												
											}
											// echo $partner_id;
											if(is_null($logo)){
												$logo_url = base_url('assets/images/avatar.jpg');
											}else{
												$logo_url = base_url('assets/images/'.$logo);
											}

											if(is_null($partner_logo)){
												$partner_logo_url = base_url('assets/images/avatar.jpg');
											}else{
												$partner_logo_url = base_url('assets/images/'.$partner_logo);
											}

											if($you){
												$who = 'self';
												$display_name = 'you';
												$mark = "<i class='fas fa-check message-mark'></i>";
											}else{
												$who = 'other';
												$display_name = $partner_user_name;
												$mark = "";
											}
											
											$response_arr['messages'] .= "<li class='".$who."'><div class='messages' id='".$id."'><p>".$message."</p><time datetime=".$chat_date. "".$time.">".$display_name." • ".$t_stamp."</time>".$mark."</div></li>";
											
										}
										
										// $response_arr['offset'] = max($id_arr);
										
										$this->northbridge_model->updateMessageAsRead($id);
									}
								}
							
						}
						echo json_encode($response_arr);
					}
				}
			}

			//All Earning Page
			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "earnings" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['sponsor_income'] = $user->sponsor_income;
						
						$data['withdrawn'] = $user->withdrawn;
						$data['total_income'] = $user->total_income;
						$data['user_bank_name'] = $user->bank_name;
						$data['account_number'] = $user->account_number;
					}
					
					$this->load->view('includes/admin_header',$data);
		            $this->load->view('pages/earnings',$data);
		            $this->load->view('includes/admin_footer',$data);	

				}
			}

			elseif($addition == "submit_user_name"  && $this->northbridge_model->confirmLoggedIn() == TRUE){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
					}
					if($this->input->post('user_name')){
					  $search_val = $this->input->post('user_name');	                   	
                      $first_users = $this->northbridge_model->getFirstUsers($search_val);
	                    if(is_array($first_users)){
	                      $i = 0;
                              
                      ?>
                      <h4 class="text-center">Search Results For <span class="text-primary" style="font-style: italic;"><?php echo $search_val; ?></span></h4>
                      <div class="table-responsive">
	                      <table class="table table-test table-striped table-bordered nowrap hover display" id="full-user-results-table" cellspacing="0" width="100%" style="width:100%">
	                        <thead>
	                          <tr>
	                            <th>#</th>
	                            <th>Profile Picture</th>
	                            <th>Name</th>  
	                            <th>Full Name</th>                       
	                          </tr>
	                        </thead>
	                        <tbody>
	                          <?php
	                            foreach($first_users as $user){
	                              $i++;
	                              	$id = $user->id;
	                                $user_name = $user->user_name;
	                                $full_name = $user->full_name;
	                                $email = $user->email;
	                                $phone = $user->phone;
	                               	$hospital_country = $this->northbridge_model->getCountryById($user->country_id);
	                                $hospital_state = $this->northbridge_model->getStateById($user->state_id);
	                                $address = $user->address;
	                                $user_slug = $user->slug;
	                                $date = $user->date;
	                                $time = $user->time;
	                                $logo = $user->logo;
	                                
	                                $is_admin = $user->is_admin;
	                                
	                                if(is_null($logo)){
	                                  $logo = "avatar.jpg";
	                                }
	                          ?>
	                            <tr style="cursor: pointer;" onclick="selectUser(this,<?php echo $id; ?>)" data-user-name="<?php echo $user_name; ?>" data-full-name="<?php echo $full_name; ?>">
	                              <td><?php echo $i; ?>.</td>
	                              <td><img src="<?php echo base_url('assets/images/'.$logo); ?>" alt="" height="30" width="30" class='img-round'></td>
	                              <td><a href="<?php echo site_url('northbridge/'.$user_name); ?>"><?php echo $this->northbridge_model->custom_echo($user_name,35); ?></a></td>
	                              <td><?php echo $this->northbridge_model->custom_echo($full_name,35); ?></td>
	                            </tr>                         
	                          <?php    
	                            
	                          }
	                         ?>
	                        </tbody>
	                       
	                      </table>
	                  </div>
                      <?php
                       } 
					}
				}
			}


			//Fund Users Page
			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $this->northbridge_model->checkIfUserIsAdmin() && $addition == "fund_users" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['sponsor_income'] = $user->sponsor_income;
						
						$data['withdrawn'] = $user->withdrawn;
						$data['total_income'] = $user->total_income;
						$data['user_bank_name'] = $user->bank_name;
						$data['account_number'] = $user->account_number;
					}
					
					$this->load->view('includes/admin_header',$data);
		            $this->load->view('pages/fund_users',$data);
		            $this->load->view('includes/admin_footer',$data);	

				}
			}


			//View Members History Page
			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $this->northbridge_model->checkIfUserIsAdmin() && $addition == "view_members_history" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['sponsor_income'] = $user->sponsor_income;
						
						$data['withdrawn'] = $user->withdrawn;
						$data['total_income'] = $user->total_income;
						$data['user_bank_name'] = $user->bank_name;
						$data['account_number'] = $user->account_number;
					}
					
					$this->load->view('includes/admin_header',$data);
		            $this->load->view('pages/view_members_history',$data);
		            $this->load->view('includes/admin_footer',$data);	

				}
			}


			//View Account Credit History Page
			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $this->northbridge_model->checkIfUserIsAdmin() && $addition == "account_credit_history" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['sponsor_income'] = $user->sponsor_income;
						
						$data['withdrawn'] = $user->withdrawn;
						$data['total_income'] = $user->total_income;
						$data['user_bank_name'] = $user->bank_name;
						$data['account_number'] = $user->account_number;
					}
					
					$this->load->view('includes/admin_header',$data);
		            $this->load->view('pages/account_credit_history',$data);
		            $this->load->view('includes/admin_footer',$data);	

				}
			}

			elseif($addition == "load_account_credit_history_for_all_users_by_date"  && $this->northbridge_model->confirmLoggedIn() == TRUE && $this->northbridge_model->checkIfUserIsAdmin()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
					}
					if($this->input->post('show_records') && $this->input->post('date')){
						$date = $this->input->post('date');
						
						if($this->northbridge_model->getIfUserIdIsValid($user_id)){
							$response_arr = array('success' => true,'messages' => '','title' => '');

							
							
							
							$records = $this->northbridge_model->getAccountCreditHistoryForAllUsers($date);
							

							if(is_array($records)){
								$j = 0;
								$response_arr['messages'] .= '<div class="table-responsive">';
		                      	$response_arr['messages'] .= '<table class="table table-test table-striped table-bordered nowrap hover display" id="account-credit-history-table" cellspacing="0" width="100%" style="width:100%">';
		                        $response_arr['messages'] .= '<thead>';
		                        $response_arr['messages'] .= '<tr>';
		                        $response_arr['messages'] .= '<th>#</th>';
		                        $response_arr['messages'] .= '<th>Full Name</th>';
		                        $response_arr['messages'] .= '<th>Time</th>';
		                        $response_arr['messages'] .= '<th>Amount</th>';
		                        $response_arr['messages'] .= '<th>Reference Code</th>';
		                        
		                        $response_arr['messages'] .= '</tr>';
		                        $response_arr['messages'] .= '</thead>';
		                        $response_arr['messages'] .= '<tbody>';
								foreach($records as $row){
									$j++;

									$reference = $row->reference;
									$user_id = $row->user_id;
									$time = $row->time;
									$amount = $row->amount;

									$full_name = $this->northbridge_model->getUserFullNameByUserId($user_id);
									$slug = $this->northbridge_model->getUserParamById("slug",$user_id);

									$response_arr['messages'] .= '<tr style="cursor:unset;">';
									
									$response_arr['messages'] .= '<td>'.$j.'</td>';
									$response_arr['messages'] .= '<td><a target="_blank" href="'.site_url('northbridge/'.$slug).'">'.$full_name.'</a></td>';
									$response_arr['messages'] .= '<td>'.$time.'</td>';
									$response_arr['messages'] .= '<td>'.number_format($amount,2).'</td>';
									$response_arr['messages'] .= '<td><em>'.$reference.'</em></td>';
									
									$response_arr['messages'] .= '</tr>';
								}
								$response_arr['messages'] .= '</tbody>';
								$response_arr['messages'] .= '</table>';
								$response_arr['messages'] .= '</div>';
							}else{
								$response_arr['messages'] .= '<h4 class="text-warning">No Records To Display</h4>';
							}
						

	                       	echo json_encode($response_arr);
                       }
					}
				}
			}



			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $this->northbridge_model->checkIfUserIsAdmin() && $addition == "get_current_users_account_balance" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['sponsor_income'] = $user->sponsor_income;
						
						$data['withdrawn'] = $user->withdrawn;
						$data['total_income'] = $user->total_income;
						$data['user_bank_name'] = $user->bank_name;
						$data['account_number'] = $user->account_number;
					}
					
					$response_arr = array('success' => false,'account_balance' => false);

					if($this->input->post('user_id')){
						$user_id = $this->input->post('user_id');

						$response_arr['success'] = true;

						$total_income = $this->northbridge_model->getUserParamById("total_income",$user_id);
						$withdrawn = $this->northbridge_model->getUserParamById("withdrawn",$user_id);

						$account_balance = $total_income - $withdrawn;
						$response_arr['account_balance'] = $account_balance;
					}

					echo json_encode($response_arr);

				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $this->northbridge_model->checkIfUserIsAdmin() && $addition == "debit_member" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['sponsor_income'] = $user->sponsor_income;
						
						$data['withdrawn'] = $user->withdrawn;
						$data['total_income'] = $user->total_income;
						$data['user_bank_name'] = $user->bank_name;
						$data['account_number'] = $user->account_number;
					}
					
					$response_arr = array('success' => false,'exceeds_max' => true,'account_balance' => false);

					if($this->input->post('user_id') && $this->input->post('amount')){
						$user_id = $this->input->post('user_id');
						$amount = $this->input->post('amount');
						$total_income = $this->northbridge_model->getUserParamById("total_income",$user_id);
						$withdrawn = $this->northbridge_model->getUserParamById("withdrawn",$user_id);

						$account_balance = $total_income - $withdrawn;
						
						if($amount <= $account_balance){
							$response_arr['exceeds_max'] = false;
							if($this->northbridge_model->debitUser($user_id,$amount)){
								$response_arr['success'] = true;
							}
						}else{
							$response_arr['account_balance'] = $account_balance;
						}

					}

					echo json_encode($response_arr);

				}
			}


			//Edit Email Settings Page
			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $this->northbridge_model->checkIfUserIsAdmin() && $addition == "email_settings" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['sponsor_income'] = $user->sponsor_income;
						
						$data['withdrawn'] = $user->withdrawn;
						$data['total_income'] = $user->total_income;
						$data['user_bank_name'] = $user->bank_name;
						$data['account_number'] = $user->account_number;
					}
					
					$this->load->view('includes/admin_header',$data);
		            $this->load->view('pages/email_settings',$data);
		            $this->load->view('includes/admin_footer',$data);	

				}
			}


			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $this->northbridge_model->checkIfUserIsAdmin() && $addition == "edit_default_email_address_and_password" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['sponsor_income'] = $user->sponsor_income;
						
						$data['withdrawn'] = $user->withdrawn;
						$data['total_income'] = $user->total_income;
						$data['user_bank_name'] = $user->bank_name;
						$data['account_number'] = $user->account_number;
					}
					
					$response_arr = array('success' => false,'error' => '');

					if($this->input->post('email_address') && $this->input->post('password')){
						$email_address = $this->input->post('email_address');
						$password = $this->input->post('password');

						$response = $this->northbridge_model->testSendEmail($email_address,$password);
						
						if($response !== true){
							
							$response_arr['error'] = $response;
						}else{
							
							if($this->northbridge_model->updateDefaultEmailAddress($email_address,$password)){
								$response_arr['success'] = true;
							}
						}
					}

					echo json_encode($response_arr);
				}
			}

			//Resubscriptions Page
			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && !$this->northbridge_model->checkIfUserIsAdmin() && $addition == "re-subscriptions" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['sponsor_income'] = $user->sponsor_income;
						$data['new_nigeria_income'] = $user->new_nigeria_income;
						$data['great_nigeria_income'] = $user->great_nigeria_income;
						$data['withdrawn'] = $user->withdrawn;
						$data['total_income'] = $user->total_income;
						$data['user_bank_name'] = $user->bank_name;
						$data['account_number'] = $user->account_number;
					}
					
					$this->load->view('includes/admin_header',$data);
		            $this->load->view('pages/re-subscriptions',$data);
		            $this->load->view('includes/admin_footer',$data);	

				}
			}

			//Start Earning Page
			elseif($this->northbridge_model->confirmLoggedIn() == TRUE  && !$this->northbridge_model->checkIfUserIsAdmin()  && $addition == "start-earning" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					
					$this->load->view('includes/admin_header',$data);
		            $this->load->view('pages/start_earning',$data);
		            $this->load->view('includes/admin_footer',$data);	

				}
			}

			//Check If Mobile Number Exists Page
			elseif($addition == "check_if_phone_exists" && is_null($second_addition)){
				
				$response_arr = array('success' => false,'empty' => true,'no_post' => true,'mobile' => '','full_name' => '','user_id' => '','user_name' => '');
				if($this->input->post('phone')){
					$phone = $this->input->post('phone');
					// echo $phone;
					$response_arr['no_post'] = false;
					if($phone !== ""){
						$response_arr['empty'] = false;
						if($this->northbridge_model->userExistsPhone($phone)){
							$response_arr['success'] = true;
							$user_name = $this->northbridge_model->getUserNameByFullPhone($phone);
							$user_id = $this->northbridge_model->getUserIdByName($user_name);
							$response_arr['mobile'] = $phone;
							$response_arr['full_name'] = $this->northbridge_model->getUserFullNameById($user_id);
							$response_arr['user_id'] = $user_id;
							$response_arr['user_name'] = $user_name;
						}
					}
				}
				$response_arr = json_encode($response_arr);
				echo $response_arr;
				
			}	


			//Check If UserName Exists Page
			elseif($addition == "check_if_user_name_exists" && is_null($second_addition)){
				
				$response_arr = array('success' => false,'empty' => true,'no_post' => true,'mobile' => '','full_name' => '','user_id' => '','email' => '');
				if($this->input->post('user_name')){
					$user_name = $this->input->post('user_name');
					$response_arr['no_post'] = false;
					if($user_name !== ""){
						$response_arr['empty'] = false;
						if($this->northbridge_model->userExists($user_name)){
							$response_arr['success'] = true;
							$user_id = $this->northbridge_model->getUserIdByName($user_name);
							$response_arr['mobile'] = $this->northbridge_model->getFullMobileNoByUserName($user_name);
							$response_arr['full_name'] = $this->northbridge_model->getUserFullNameById($user_id);
							$email = $this->northbridge_model->getUserParamById("email",$user_id);
							$response_arr['email'] = $email;
							$response_arr['user_id'] = $user_id;
							$response_arr['phone'] = $this->northbridge_model->getUserPhoneNumberByUserId($user_id);
							$response_arr['phone_code'] = $this->northbridge_model->getUserPhoneCodeByUserId($user_id);
							$response_arr['url'] = site_url('northbridge/send_forgot_password_otp');

						}
					}
				}
				$response_arr = json_encode($response_arr);
				echo $response_arr;
				
			}	

			//Send OTP For Forgot Password
			elseif($addition == "send_forgot_password_otp" && is_null($second_addition)){
				
				$response_arr = array('success' => false,'empty' => true,'no_post' => true,'mobile' => '','full_name' => '','user_id' => '','email' => '');
				if($this->input->post('user_name')){
					$user_name = $this->input->post('user_name');
					$response_arr['no_post'] = false;
					if($user_name !== ""){
						$response_arr['empty'] = false;
						if($this->northbridge_model->userExists($user_name)){
							
							$user_id = $this->northbridge_model->getUserIdByName($user_name);
							$response_arr['mobile'] = $this->northbridge_model->getFullMobileNoByUserName($user_name);
							$response_arr['full_name'] = $this->northbridge_model->getUserFullNameById($user_id);
							$email = $this->northbridge_model->getUserParamById("email",$user_id);
							$response_arr['email'] = $email;
							$response_arr['user_id'] = $user_id;
							$response_arr['phone'] = $this->northbridge_model->getUserPhoneNumberByUserId($user_id);
							$response_arr['phone_code'] = $this->northbridge_model->getUserPhoneCodeByUserId($user_id);
							$response_arr['url'] = site_url('northbridge/send_forgot_password_otp');

							$otp = rand ( 10000 , 99999 );
							$email_arr = array($email);
							if($this->northbridge_model->sendOtpEmail($email_arr,$otp)){
								$this->session->set_userdata('otp',$otp);
								$this->session->set_userdata('forgot_pass_first_step',$user_name);
								//Change This Once In Development
								$response_arr['success'] = true;
								if($_SERVER['SERVER_NAME'] == "localhost"){
									$response_arr['otp'] = $otp;
								}
							}	

						}
					}
				}
				$response_arr = json_encode($response_arr);
				echo $response_arr;
				
			}	

			// elseif($addition == "change_password_reset" && is_null($second_addition)){
			// 	$response_arr = array('success' => false,'expired' => false);
			// 	if(isset($_SESSION['next_stage']) && isset($_SESSION['user_name'])){
			// 		if($this->input->post('new-password')){
			// 			$new_password = $this->input->post('new-password');
			// 			$user_name = $_SESSION['user_name'];
			// 			$token = bin2hex($this->encryption->create_key(16));
								
			// 			$user_id = $this->northbridge_model->getUserIdByName($user_name);
			// 			if($this->northbridge_model->onRegister($user_id,$token)){
			// 				if($this->northbridge_model->changeUserPassword($user_id,$token,$new_password)){
			// 					$this->session->set_flashdata('password_changed',true);
			// 					session_unset();
			// 					$response_arr['success'] = true;
			// 				} 
			// 			}
			// 		}
			// 	}else{
			// 		$response_arr['expired'] = true;
			// 	}
				
			// 	echo json_encode($response_arr);
			// }	

			elseif($addition == "process_reset_pass_otp_form" && is_null($second_addition)){
				$response_arr = array('success' => false,'expired' => false,'invalid' => false,'id' => '');
				$otp_entered = $this->input->post('otp');
				$otp = $this->session->password_otp;
				// echo $otp;
				if(!is_null($this->session->password_otp)){
					if($otp_entered == $otp){
						$user_name = $this->session->password_otp_user_name;
						$this->session->set_userdata('password_otp_user_name',$user_name);
						$this->session->set_userdata('next_stage',true);
						$response_arr['success'] = true;
					}else{
						$response_arr['invalid'] = true;
					}
				}else{
					$response_arr['expired'] = true;
				}
				echo json_encode($response_arr);
			}	

			//Send Otp
			elseif($addition == "send_otp" && is_null($second_addition)){
				
				$response_arr = array('success' => false,'otp' => '','yours' => false,'mobile_no' => '');
				if($this->input->post('send_otp') && $this->input->post('mobile') && $this->input->post('user_id')){
					$mobile_no = $this->input->post('mobile');
					$response_arr['mobile_no'] = $mobile_no;
					$user_id = $this->input->post('user_id');
					if($this->northbridge_model->checkIfMobileNoIsForUser($user_id,$mobile_no)){
						$response_arr['yours'] = true;
						$otp = substr(bin2hex($this->encryption->create_key(16)),0,6);
						$user_name = "Meet%20Global%20Resources";
						$password = "44precious44";
						$message = "Your%20Otp%20Is:%20".$otp.".%20Thanks%20For%20Using%20";
						$response = $this->northbridge_model->curl("http://goldsms247.com/components/com_spc/smsapi.php?username=". $user_name ."&password=". $password ."&sender=Meet&recipient=". $mobile_no ."&message=".$message,FALSE);
						// echo $response;
						if($response !== "" && $response !== "2904" && $response !== "2905" && $response !== "2906"&& $response !== "2907" && $response !== "2908" && $response !== "2909"){

							$user_name = $this->northbridge_model->getUserNameById($user_id);
							$response_arr['success'] = true;
							// $response_arr['otp'] = $otp;
							$this->session->set_userdata('password_otp_user_name',$user_name);
							$this->session->set_userdata('password_otp',$otp);
						}
					}	
				}
				$response_arr = json_encode($response_arr);
				echo $response_arr;
				
			}		

			//About Us Page
			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "about_us" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					
					$this->load->view('includes/admin_header',$data);
		            $this->load->view('pages/about_us',$data);
		            $this->load->view('includes/admin_footer',$data);	

				}
			}

			//Main Chat Page
			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "main_chat_page" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					
					$this->load->view('includes/admin_header',$data);
		            $this->load->view('pages/main_chat_page',$data);
		            $this->load->view('includes/admin_footer',$data);	

				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "admin_page" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}


					
					$this->load->view('includes/admin_header',$data);
		            $this->load->view('pages/admin_page',$data);
		            $this->load->view('includes/admin_footer',$data);	

				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "recharge_vtu" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				// echo $user_id;
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					
					$this->load->view('includes/admin_header',$data);
		            $this->load->view('pages/recharge_vtu',$data);
		            $this->load->view('includes/admin_footer',$data);	

				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "add_mini_importation_product_to_cart" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					
					if($this->input->post('id')){
						$response_arr = array('success' => false,'invalid_product_id' => false,'out_of_stock' => false,'expired' => false,'already_there' => false,'exceeded_slots' => false);
						$date = date("j M Y");
						$time = date("h:i:sa");
						$product_id = $this->input->post('id');
						if($this->northbridge_model->checkIfMiniImportationProductIdIsValid($product_id)){
							if($this->northbridge_model->checkIfMiniImportationProductIdIsInStock($product_id)){
								if($this->northbridge_model->checkIfMiniImportationProductIdHasExpired($product_id)){
									
									if($this->northbridge_model->checkIfThisProductIsInCartAlreadyMiniImportation($product_id)){
										$response_arr['already_there'] = true;
										$quantity_requested = $this->northbridge_model->getQuantityOfProductRequestedInCartMiniImportation($product_id);
										$cart_id = $this->northbridge_model->getCartIdOfProductRequestedInCartMiniImportation($product_id);
										$new_quantity = $quantity_requested + 1;

										if($this->northbridge_model->checkIfSlotsForProductIsStillRemainingForYou($new_quantity,$product_id,$user_id)){

											$form_array = array(
												'user_id' => $user_id,
												'product_id' => $product_id,
												'quantity' => $new_quantity,
												'date' => $date,
												'time' => $time
											);

											if($this->northbridge_model->updateMiniImportationCart($form_array,$cart_id,$user_id)){
												$response_arr['success'] = true;
											}
										}else{
											$response_arr['exceeded_slots'] = true;
										}
									}else{
										$form_array = array(
											'user_id' => $user_id,
											'product_id' => $product_id,
											'quantity' => 1,
											'date' => $date,
											'time' => $time
										);

										if($this->northbridge_model->insertMiniImportationCart($form_array)){
											$response_arr['success'] = true;
										}	
									}
								
								}else{	
									$response_arr['expired'] = true;
								}
							}else{
								$response_arr['out_of_stock'] = true;
							}
						}else{
							$response_arr['invalid_product_id'] = true;
						}
						echo json_encode($response_arr);
					}

				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "remove_product_mini_importation_info" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					
					if($this->input->post('cart_id')){
						$response_arr = array('success' => false);
						$cart_id = $this->input->post('cart_id');
						if($this->northbridge_model->removeItemFromCart($cart_id,$user_id)){
							$response_arr['success'] = true;
						}
						echo json_encode($response_arr);
					}
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "get_local_govts_for_state_select" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					
					if($this->input->post('state_id')){
						$response_arr = array('success' => false,'messages' => '','center_leader_html' => '');
						$state_id = $this->input->post('state_id');
						$first_locals = $this->northbridge_model->getLocalGovernmentsByStateId($state_id);
                  
		                if(is_array($first_locals)){ 
		                	$response_arr['success'] = true;
		                	$response_arr['messages'] .= '<div class="form-group col-sm-6">';
              				$response_arr['messages'] .= '<label for="local_government" style="font-weight: bold;">Local Government: </label>';
		                	$response_arr['messages'] .= '<select name="local_government" id="local_government" class="form-control my-select" onchange="localGovernmentChanged(this,event)" data-style="btn btn-primary btn-round"  data-size="7">';
		                    foreach($first_locals as $row){
			                    $id = $row->id;
			                    $state_id = $row->state_id;
			                    $name = $row->name;

		                      $response_arr['messages'] .= '<option style="text-transform: capitalize;" value="'.$id.'">'.$name.'</option>';
		                    }  
		                    $response_arr['messages'] .= '</select>';
		                    $response_arr['messages'] .= '</div>';

		                    $local_government_id = $this->northbridge_model->getFirstLocalGovtIdOfState($state_id);
		                    $response_arr['local_government_id'] = $local_government_id;

		                    $center_leaders = $this->northbridge_model->getCenterLeadersInLocalGovt($local_government_id);
							if(is_array($center_leaders)){
								$response_arr['center_leader_html'] .= '<div class="text-center">';
                				$response_arr['center_leader_html'] .= '<span class="text-center heading-text">'.count($center_leaders).' CENTER LEADER(S) FOUND</span>';
                				$response_arr['center_leader_html'] .= '<span class="text-secondary" style="font-weight: bold;">Please Select Center Leader To Proceed</span>';
              					$response_arr['center_leader_html'] .= '</div>';

              					$response_arr['center_leader_html'] .= '<div class="center-leaders" style="border: 0;">';
								foreach($center_leaders as $row){
									$center_leader_user_id = $row->id;
									$center_leader_logo = $row->logo;
									$center_leader_full_name = $row->full_name;
									$center_leader_user_name = $row->user_name;
									$center_leader_town = $row->city;
									$center_leader_address = $row->address;
									$center_leader_phone_code = $row->phone_code;
									$center_leader_phone_number = $row->phone;

									$center_leader_slug = url_title($center_leader_user_name);

									if(is_null($center_leader_logo)){
										$center_leader_logo = 'avatar.jpg';
									}

									

									$response_arr['center_leader_html'] .= '<div class="card" style="padding-top: 10px; padding-bottom: 10px; ">';
                      				$response_arr['center_leader_html'] .= '<div class="card-body">';

                        			$response_arr['center_leader_html'] .= '<div class="row" style="width: 100%;">';
                          			$response_arr['center_leader_html'] .= '<div class="col-3">';
                            		$response_arr['center_leader_html'] .= '<img style="width: 100px;" src="'.base_url('assets/images/'.$center_leader_logo).'" class="col-12 img-round" alt="">';
                          			$response_arr['center_leader_html'] .= '</div>';

                          			$response_arr['center_leader_html'] .= '<div class="col-9">';
                            		$response_arr['center_leader_html'] .= '<span class="name"><a href="'.site_url('northbridge/'.$center_leader_slug).'" target="_blank">'.$center_leader_full_name.'</a></span>';
                            		$response_arr['center_leader_html'] .= '<div class="">';
                              		$response_arr['center_leader_html'] .= '<span class="town-label" style="font-weight: bold;">Town: </span>';
                              		$response_arr['center_leader_html'] .= '<span class="town-val" >'.$center_leader_town.'</span>';
                            		$response_arr['center_leader_html'] .= '</div>';
                            		$response_arr['center_leader_html'] .= '<div class="">';
                              		$response_arr['center_leader_html'] .= '<span class="address-label" style="font-weight: bold;">Address: </span>';
                              		$response_arr['center_leader_html'] .= '<span class="address-val">'.$center_leader_address.'</span>';
                            		$response_arr['center_leader_html'] .= '</div>';
                            		$response_arr['center_leader_html'] .= '<div class="">';
                              		$response_arr['center_leader_html'] .= '<span class="phone-label" style="font-weight: bold;">Phone: </span>';
                              		$response_arr['center_leader_html'] .= '<span class="phone-val">+'.$center_leader_phone_code. '' .$center_leader_phone_number.'</span>';
                            		$response_arr['center_leader_html'] .= '</div>';
                            		$response_arr['center_leader_html'] .= '<button onclick="proceedToPayment(this,event,'.$center_leader_user_id.')" class="btn btn-success btn-round">';
                              		$response_arr['center_leader_html'] .= '<i class="fas fa-hand-pointer" style="color: #fff;"></i> Select';
                            		$response_arr['center_leader_html'] .= '</button>';
                          			$response_arr['center_leader_html'] .= '</div>';
                        			$response_arr['center_leader_html'] .= '</div>';

                      				$response_arr['center_leader_html'] .= '</div>';
                    				$response_arr['center_leader_html'] .= '</div>';
								}
								$response_arr['center_leader_html'] .= '</div>';
							}else{
								$response_arr['center_leader_html'] .= '<h4 class="text-warning">No Center Leaders In This Location.</h4>';
							}

		                }      
						echo json_encode($response_arr);
					}
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "transfer_to_main_acct" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['full_name'] = $user->full_name;
					}
					
					if($this->input->post('amount')){
						$response_arr = array('success' => true,'not_enough_money' => true,'amount' => 0);

						$amount = $this->input->post('amount');

						if($amount > 0){
							$amount_withdrawable = $this->northbridge_model->getTotalWithdrawableMlmIncome($user_id);

							if($amount <= $amount_withdrawable){
								$response_arr['not_enough_money'] = true;

								if($this->northbridge_model->transferMoneyFromMlmAccountToMainAccount($user_id,$amount)){
									$response_arr['success'] = true;
									$response_arr['amount'] = $amount;
								}
							}
						}
						echo json_encode($response_arr);
					}
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "transfer_to_main_acct_admin" && is_null($second_addition) && $this->northbridge_model->checkIfUserIsAdmin()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['full_name'] = $user->full_name;
					}
					
					if($this->input->post('amount')){
						$response_arr = array('success' => true,'not_enough_money' => true,'amount' => 0);

						$amount = $this->input->post('amount');

						$admin_basic_sponsor_bonus = $this->northbridge_model->getAdminBasicSponsorBonus();
	                    $admin_business_sponsor_bonus = $this->northbridge_model->getAdminPlacementSponsorBonus();
	                    $admin_center_leader_selection_income = $this->northbridge_model->getUserParamById("admin_center_leader_selection_income",$this->northbridge_model->getAdminId());
	                    $total_vat_accrued = $this->northbridge_model->getUserParamById("admin_vat_total",$this->northbridge_model->getAdminId());

	                    $total_earnings = $admin_basic_sponsor_bonus + $admin_business_sponsor_bonus + $admin_center_leader_selection_income + $total_vat_accrued;

	                    $total_mlm_withdrawn = $this->northbridge_model->getUserParamById("admin_mlm_withdrawn",$this->northbridge_model->getAdminId());
	                    $grand_total_balance = $total_earnings - $total_mlm_withdrawn;


						if($amount > 0){
							$amount_withdrawable = $grand_total_balance;

							if($amount <= $amount_withdrawable){
								$response_arr['not_enough_money'] = true;

								if($this->northbridge_model->transferMoneyFromMlmAccountToMainAccountAdmin($user_id,$amount)){
									$response_arr['success'] = true;
									$response_arr['amount'] = $amount;
								}
							}
						}
						echo json_encode($response_arr);
					}
				}
			}			

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "view_your_mlm_earnings" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['full_name'] = $user->full_name;
					}
					
					if($this->input->post('show_records')){
						$response_arr = array('success' => true,'messages' => '');

						
							
							
	            		$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="">';
	            		$response_arr['messages'] .= '<table class="table table-striped table-bordered nowrap hover display" id="all-earnings-table" cellspacing="0" width="100%" style="width:100%">';
	            		$response_arr['messages'] .= '<thead>';
	            		$response_arr['messages'] .= '<tr>';
	            		$response_arr['messages'] .= '<th>#</th>';
	            		$response_arr['messages'] .= '<th></th>';
	            		$response_arr['messages'] .= '<th>Basic Earnings</th>';
	            		$response_arr['messages'] .= '<th>Business Earnings</th>';
	            		
	            		$response_arr['messages'] .= '</tr>';
	            		$response_arr['messages'] .= '<tbody>';

	            		$response_arr['messages'] .= '<tr>';

	            		$basic_sponsor_earnings = $this->northbridge_model->getUsersMlmBasicSponsorEarnings($user_id);
	            		$business_sponsor_earnings = $this->northbridge_model->getUsersMlmBusinessSponsorEarnings($user_id);

	            		$response_arr['messages'] .= '<td>1</td>';
	            		$response_arr['messages'] .= '<td>Sponsor Earnings</td>';
	            		$response_arr['messages'] .= '<td>₦'.number_format($basic_sponsor_earnings,2).'</td>';
	            		$response_arr['messages'] .= '<td>₦'.number_format($business_sponsor_earnings,2).'</td>';
	            		$response_arr['messages'] .= '</tr>';

	            		$response_arr['messages'] .= '<tr>';

	            		$basic_placement_earnings = $this->northbridge_model->getUsersMlmBasicPlacementEarnings($user_id);
	            		$business_placement_earnings = $this->northbridge_model->getUsersMlmBusinessPlacementEarnings($user_id);

	            		$response_arr['messages'] .= '<td>2</td>';
	            		$response_arr['messages'] .= '<td>Placement Earnings</td>';
	            		$response_arr['messages'] .= '<td>₦'.number_format($basic_placement_earnings,2).'</td>';
	            		$response_arr['messages'] .= '<td>₦'.number_format($business_placement_earnings,2).'</td>';
	            		$response_arr['messages'] .= '</tr>';

	            		$response_arr['messages'] .= '<tr>';

	            		$center_leader_sponsor_bonus = $this->northbridge_model->getUsersCenterLeaderSponsorBonus($user_id);
	            		
	            		$response_arr['messages'] .= '<td>3</td>';
	            		$response_arr['messages'] .= '<td>Center Leader Sponsor Bonus</td>';
	            		$response_arr['messages'] .= '<td></td>';
	            		$response_arr['messages'] .= '<td>₦'.number_format($center_leader_sponsor_bonus,2).'</td>';
	            		$response_arr['messages'] .= '</tr>';


	            		$response_arr['messages'] .= '<tr>';

	            		$center_leader_placement_bonus = $this->northbridge_model->getUsersCenterLeaderPlacementBonus($user_id);
	            		

	            		$response_arr['messages'] .= '<td>4</td>';
	            		$response_arr['messages'] .= '<td>Center Leader Placement Bonus</td>';
	            		$response_arr['messages'] .= '<td></td>';
	            		$response_arr['messages'] .= '<td>₦'.number_format($center_leader_placement_bonus,2).'</td>';
	            		$response_arr['messages'] .= '</tr>';


	            		$response_arr['messages'] .= '<tr>';

	            		$center_leader_selection_income = $this->northbridge_model->getUserParamById("center_leader_selection_income",$user_id);
	            		

	            		$response_arr['messages'] .= '<td>5</td>';
	            		$response_arr['messages'] .= '<td>Center Leader Selection Income</td>';
	            		$response_arr['messages'] .= '<td></td>';
	            		$response_arr['messages'] .= '<td>₦'.number_format($center_leader_selection_income,2).'</td>';
	            		$response_arr['messages'] .= '</tr>';

	            		$response_arr['messages'] .= '<tr>';

	            		$trade_delivery_income = $this->northbridge_model->getUsersTradeDeliveryIncome($user_id);
	            		

	            		$response_arr['messages'] .= '<td>6</td>';
	            		$response_arr['messages'] .= '<td>Trade / Delivery Income</td>';
	            		$response_arr['messages'] .= '<td></td>';
	            		$response_arr['messages'] .= '<td>₦'.number_format($trade_delivery_income,2).'</td>';
	            		$response_arr['messages'] .= '</tr>';


	            		$response_arr['messages'] .= '<tr>';

	            		

	            		$vtu_trade_income = $this->northbridge_model->getUsersVtuTradeIncome($user_id);
	            		

	            		$response_arr['messages'] .= '<td>7</td>';
	            		$response_arr['messages'] .= '<td>VTU Trade Income</td>';
	            		$response_arr['messages'] .= '<td></td>';
	            		$response_arr['messages'] .= '<td>₦'.number_format($vtu_trade_income,2).'</td>';
	            		$response_arr['messages'] .= '</tr>';


	            		$response_arr['messages'] .= '<tr>';

	            		$sgps_income = $this->northbridge_model->getUsersSGPSIncome($user_id);
	            		

	            		$response_arr['messages'] .= '<td>8</td>';
	            		$response_arr['messages'] .= '<td>SGPS Income</td>';
	            		$response_arr['messages'] .= '<td></td>';
	            		$response_arr['messages'] .= '<td>₦'.number_format($sgps_income,2).'</td>';
	            		$response_arr['messages'] .= '</tr>';


	            		$response_arr['messages'] .= '<tr>';


	            		$car_award_earnings = $this->northbridge_model->getUsersCarAwardEarnings($user_id);
	            		

	            		$response_arr['messages'] .= '<td>9</td>';
	            		$response_arr['messages'] .= '<td>Car Award Earnings</td>';
	            		$response_arr['messages'] .= '<td></td>';
	            		$response_arr['messages'] .= '<td>₦'.number_format($car_award_earnings,2).'</td>';
	            		$response_arr['messages'] .= '</tr>';

	            		
	            		$response_arr['messages'] .= '<tr>';

	            		$response_arr['messages'] .= '<td><p style="visibility: hidden;">10</p></td>';
	            		$response_arr['messages'] .= '<td></td>';
	            		$response_arr['messages'] .= '<td></td>';
	            		$response_arr['messages'] .= '<td></td>';
	            		$response_arr['messages'] .= '</tr>';


	            		$response_arr['messages'] .= '<tr>';

	            		$total_basic_earnings = $basic_sponsor_earnings + $basic_placement_earnings;
	            		$total_business_earnings = $business_sponsor_earnings + $business_placement_earnings + $center_leader_sponsor_bonus + $center_leader_placement_bonus + $center_leader_selection_income + $trade_delivery_income + $car_award_earnings + $vtu_trade_income + $sgps_income;
	            		

	            		$response_arr['messages'] .= '<td><p style="visibility: hidden;">11</p></td>';
	            		$response_arr['messages'] .= '<td style="font-weight: 900;">Total Earnings</td>';
	            		$response_arr['messages'] .= '<td style="font-weight: 900;">₦'.number_format($total_basic_earnings,2).'</td>';
	            		$response_arr['messages'] .= '<td style="font-weight: 900;">₦'.number_format($total_business_earnings,2).'</td>';
	            		$response_arr['messages'] .= '</tr>';


	            		$response_arr['messages'] .= '<tr>';

	            		$total_withdrawable_basic_earnings = $total_basic_earnings;
	            		
	            		$total_withdrawable_business_earnings = $this->northbridge_model->getTotalBusinessWithdrawableEarnings($user_id);
	            		

	            		$response_arr['messages'] .= '<td><p style="visibility: hidden;">12</p></td>';
	            		$response_arr['messages'] .= '<td style="font-weight: 900;">Total Withdrawable Earnings</td>';
	            		$response_arr['messages'] .= '<td style="font-weight: 900;">₦'.number_format(0,2).'</td>';
	            		$response_arr['messages'] .= '<td style="font-weight: 900;">₦'.number_format($total_withdrawable_business_earnings,2).'</td>';
	            		$response_arr['messages'] .= '</tr>';

	            		
	            		$response_arr['messages'] .= '</tbody>';
	            		$response_arr['messages'] .= '</table>';
	            		$response_arr['messages'] .= '</div>';

	            		$grand_total_withdrawable_earnings = $total_withdrawable_business_earnings;
	            		$total_mlm_withdrawn = $this->northbridge_model->getUserParamById("mlm_withdrawn",$user_id);
	            		$grand_total_balance = $grand_total_withdrawable_earnings - $total_mlm_withdrawn;
	            		$response_arr['messages'] .= '<div class="container">';
	            		$response_arr['messages'] .= '<h4>Grand Total Withdrawable Earnings: <em class="text-primary">₦'.number_format($grand_total_withdrawable_earnings,2).'</em></h4>';

	            		$response_arr['messages'] .= '<h4>Total Withdrawn: <em class="text-primary">₦'.number_format($total_mlm_withdrawn,2).'</em></h4>';

	            		$response_arr['messages'] .= '<h4>Grand Total Balance: <em class="text-primary">₦'.number_format($grand_total_balance,2).'</em></h4>';

						
						$response_arr['messages'] .= '<div>';
						$response_arr['messages'] .= '<button class="btn btn-primary" onclick="transferToMainAcct(this,event)">Transfer To Your Main Account</button>';
						$response_arr['messages'] .= '<div>';

	            		$response_arr['messages'] .= '</div>';

	            		echo json_encode($response_arr);
		            	
		            }
		        }   		
		    }    

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "get_your_orders_mini_importation" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['full_name'] = $user->full_name;
					}
					
					if($this->input->post('show_records')){
						$response_arr = array('success' => true,'messages' => '');

						$order_codes = $this->northbridge_model->getMiniImportationOrderCodes();
						if(is_array($order_codes) && count($order_codes) > 0){
							$j = 0;
							$response_arr['messages'] .= '<p>Click On Order To Find Out More Information</p>';
		            		$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="">';
		            		$response_arr['messages'] .= '<table class="table table-striped table-bordered nowrap hover display" id="your-orders-table" cellspacing="0" width="100%" style="width:100%">';
		            		$response_arr['messages'] .= '<thead>';
		            		$response_arr['messages'] .= '<tr>';
		            		$response_arr['messages'] .= '<th>#</th>';
		            		$response_arr['messages'] .= '<th>Order Code</th>';
		            		$response_arr['messages'] .= '<th>Date Of Order</th>';
		            		$response_arr['messages'] .= '<th>Number Of Products</th>';
		            		$response_arr['messages'] .= '<th>Center Leader Name</th>';
		            		$response_arr['messages'] .= '<th>Center Leader Phone Number</th>';
		            		
		            		$response_arr['messages'] .= '</tr>';
		            		$response_arr['messages'] .= '<tbody>';
							for($i = 0; $i < count($order_codes); $i++){
								$order_code = $order_codes[$i];

								$j++;
								$date_of_order = $this->northbridge_model->getMiniImportationOrderParamByOrderCode("check_out_date",$order_code);
								$time_of_order = $this->northbridge_model->getMiniImportationOrderParamByOrderCode("check_out_time",$order_code);
								$date = $date_of_order . " " . $time_of_order;
								$number_of_products = $this->northbridge_model->getMiniImportationOrderNumberOfProducts($order_code);
								$center_leader_user_id = $this->northbridge_model->getMiniImportationOrderParamByOrderCode("center_leader",$order_code);
								$center_leader_full_name = $this->northbridge_model->getUserFullNameById($center_leader_user_id);
								$center_leader_user_name = $this->northbridge_model->getUserNameById($center_leader_user_id);
								$center_leader_phone_number = $this->northbridge_model->getUserPhoneNumberByUserId($center_leader_user_id);
								$center_leader_phone_code = $this->northbridge_model->getUserPhoneCodeByUserId($center_leader_user_id);
								$center_leader_slug = $this->northbridge_model->getUserParamById("slug",$center_leader_user_id);


								$response_arr['messages'] .= "<tr onclick='loadOrderInfo(this,event,\"" . str_replace('"', '\"', $order_code) . "\")'>";

	            				$response_arr['messages'] .= '<td>'.$j.'</td>';
	            				$response_arr['messages'] .= '<td>'.$order_code.'</td>';
	            				$response_arr['messages'] .= '<td>'.$date.'</td>';
	            				$response_arr['messages'] .= '<td style="text-transform : capitalize;">'.$number_of_products.'</td>';
	            				$response_arr['messages'] .= '<td><a target="_blank" href="'.site_url('northbridge/'.$center_leader_slug).'">'.$center_leader_full_name.'</a></td>';
	            				$response_arr['messages'] .= '<td>+'.$center_leader_phone_code. '' .$center_leader_phone_number.'</td>';
	            				$response_arr['messages'] .= "</tr>";

							}
							$response_arr['messages'] .= "</tbody>";
							$response_arr['messages'] .= "</table>";
						}else{
							$response_arr['messages'] .= "<h4 class='text-warning'>No Orders Yet. When You Make An Other It Appears Here.</h4>";
						}

						echo json_encode($response_arr);
					}
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "order_info_mini_importation" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['full_name'] = $user->full_name;
					}
					
					if($this->input->post('show_records') && $this->input->post('order_code')){
						$response_arr = array('success' => true,'messages' => '');
						$order_code = $this->input->post('order_code');
						$order_code_info = $this->northbridge_model->getMiniImportationOrderCodeInfo($order_code);
						if(is_array($order_code_info)){
							$j = 0;
							$response_arr['order_code'] = $order_code;
							$response_arr['messages'] .= '<h4>Products In This Order</h4>';
		            		$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="">';
		            		$response_arr['messages'] .= '<table class="table table-striped table-bordered wrap hover display" id="orders-info-table" cellspacing="0" width="100%" style="width:100%">';
		            		$response_arr['messages'] .= '<thead>';
		            		$response_arr['messages'] .= '<tr>';
		            		$response_arr['messages'] .= '<th>#</th>';
		            		$response_arr['messages'] .= '<th>Product Image</th>';
		            		$response_arr['messages'] .= '<th>Product Name</th>';
		            		$response_arr['messages'] .= '<th>Product Quantity Bought</th>';
		            		$response_arr['messages'] .= '<th>Product Quantity Remaining</th>';
		            		$response_arr['messages'] .= '<th>Product Quantity Requested</th>';
		            		$response_arr['messages'] .= '<th>Days Remaining</th>';
		            		$response_arr['messages'] .= '<th>Order Status</th>';
		            		$response_arr['messages'] .= '</tr>';
		            		$response_arr['messages'] .= '<tbody>';
							foreach($order_code_info as $row){
								$j++;
								$id = $row->id;
								$product_id = $row->product_id;
								$refunded = $this->northbridge_model->getProductParamByIdMiniImportation("refunded",$product_id);
								if($refunded == 0){
									$product_name = $this->northbridge_model->getProductParamByIdMiniImportation("name",$product_id);
									
									$date_of_order = $this->northbridge_model->getMiniImportationOrderParamByOrderCode("check_out_date",$order_code);
									$product_image = $this->northbridge_model->getProductParamByIdMiniImportation("image",$product_id);
									$quantity_purchased = $this->northbridge_model->getProductParamByIdMiniImportation("quantity_purchased",$product_id);
									$original_quantity = $this->northbridge_model->getProductParamByIdMiniImportation("quantity",$product_id);

									$quantity_remaininig = $original_quantity - $quantity_purchased;
									$quantity_requested = $row->quantity;
									
									$order_status = $this->northbridge_model->getProductParamByIdMiniImportation("order_status",$product_id);

									$expiry_date = $this->northbridge_model->getProductParamByIdMiniImportation("expiry_date",$product_id);


									$now = time(); // or your date as well
						            $your_date = strtotime($expiry_date);
						            $datediff = $your_date - $now;

						            $datediff = ceil($datediff / (60 * 60 * 24));
									
						            
									if($this->northbridge_model->checkIfAllMiniImportationSlotsHaveBeenTaken($product_id)){

										$response_arr['messages'] .= "<tr onclick='loadMoreInfoOnProductInOrder(this,event,".$id.")'>";


			            				$response_arr['messages'] .= '<td>'.$j.'</td>';
			            				$response_arr['messages'] .= '<td><img style="width: 50px; height: 50px; border-radius:50%;" src="'.base_url('assets/images/'.$product_image).'"></td>';
			            				$response_arr['messages'] .= '<td style="text-transform : capitalize;">'.$product_name.'</td>';
			            				$response_arr['messages'] .= '<td style="text-transform : capitalize;">'.number_format($quantity_purchased).'</td>';
			            				$response_arr['messages'] .= '<td style="text-transform : capitalize;">'.number_format($quantity_remaininig).'</td>';
			            				$response_arr['messages'] .= '<td style="text-transform : capitalize;">'.number_format($quantity_requested).'</td>';
			            				$response_arr['messages'] .= '<td style="text-transform : capitalize;">'.$datediff.' days</td>';
			            				$response_arr['messages'] .= '<td style="text-transform : capitalize;">'.$order_status.'</td>';
			            				$response_arr['messages'] .= "</tr>";
			            			}else if($this->northbridge_model->checkIfMiniImportationProductIdHasExpired($product_id)){
			            				$response_arr['messages'] .= "<tr onclick='loadNotExpiredError(this,event)' data-expiry-days='".$datediff."'>";
			            					
				            				$response_arr['messages'] .= '<td>'.$j.'</td>';
				            				$response_arr['messages'] .= '<td><img style="width: 50px; height: 50px; border-radius:50%;" src="'.base_url('assets/images/'.$product_image).'"></td>';
				            				$response_arr['messages'] .= '<td style="text-transform : capitalize;">'.$product_name.'</td>';
				            				$response_arr['messages'] .= '<td style="text-transform : capitalize;">'.number_format($quantity_purchased).'</td>';
				            				$response_arr['messages'] .= '<td style="text-transform : capitalize;">'.number_format($quantity_remaininig).'</td>';
				            				$response_arr['messages'] .= '<td style="text-transform : capitalize;">'.number_format($quantity_requested).'</td>';
				            				$response_arr['messages'] .= '<td style="text-transform : capitalize;"></td>';
				            				$response_arr['messages'] .= '<td style="text-transform : capitalize;">'.$order_status.'</td>';
				            				$response_arr['messages'] .= "</tr>";
			            			}else{
			            				$progress_percent = ($quantity_purchased / $original_quantity) * 100;
			            				if($progress_percent >= 50){
			            					$response_arr['messages'] .= "<tr onclick='loadMoreInfoOnProductInOrder(this,event,".$id.")'>";

				            				$response_arr['messages'] .= '<td>'.$j.'</td>';
				            				$response_arr['messages'] .= '<td><img style="width: 50px; height: 50px; border-radius:50%;" src="'.base_url('assets/images/'.$product_image).'"></td>';
				            				$response_arr['messages'] .= '<td style="text-transform : capitalize;">'.$product_name.'</td>';
				            				$response_arr['messages'] .= '<td style="text-transform : capitalize;">'.number_format($quantity_purchased).'</td>';
				            				$response_arr['messages'] .= '<td style="text-transform : capitalize;">'.number_format($quantity_remaininig).'</td>';
				            				$response_arr['messages'] .= '<td style="text-transform : capitalize;">'.number_format($quantity_requested).'</td>';
				            				$response_arr['messages'] .= '<td style="text-transform : capitalize;"></td>';
				            				$response_arr['messages'] .= '<td style="text-transform : capitalize;">'.$order_status.'</td>';
				            				$response_arr['messages'] .= "</tr>";
			            				}else{
			            					if($this->northbridge_model->refundMoneyPaidForProductMiniImportationToAllUsers($product_id)){
			            						$response_arr['messages'] .= "<tr onclick='getRefundInfo(this,event)' data-order-code='".$order_code."'>";
					            				$response_arr['messages'] .= '<td>'.$j.'</td>';
												$response_arr['messages'] .= '<td style="text-transform : capitalize;">This Product Did Not Attain At Least 50 %. Your Money Has Been Refunded. Click To View Refund History.</td>';
												$response_arr['messages'] .= '<td></td>';
												$response_arr['messages'] .= '<td></td>';
												$response_arr['messages'] .= '<td></td>';
												$response_arr['messages'] .= '<td></td>';
												$response_arr['messages'] .= '<td></td>';
												$response_arr['messages'] .= '<td></td>';
					            				$response_arr['messages'] .= "</tr>";	
			            					}
			            				}

			            			}
		            			}else{


		            				$response_arr['messages'] .= "<tr onclick='getRefundInfo(this,event)' data-order-code='".$order_code."'>";
		            				$response_arr['messages'] .= '<td>'.$j.'</td>';
									$response_arr['messages'] .= '<td style="text-transform : capitalize;">This Product Did Not Attain At Least 50 %. Your Money Has Been Refunded. Click To View Refund History.</td>';
									$response_arr['messages'] .= '<td></td>';
									$response_arr['messages'] .= '<td></td>';
									$response_arr['messages'] .= '<td></td>';
									$response_arr['messages'] .= '<td></td>';
									$response_arr['messages'] .= '<td></td>';
									$response_arr['messages'] .= '<td></td>';
		            				$response_arr['messages'] .= "</tr>";
		            			}	

							}
							$response_arr['messages'] .= "</tbody>";
							$response_arr['messages'] .= "</table>";
						}else{
							$response_arr['messages'] .= "<h4 class='text-warning'>No Order With This Code.</h4>";
						}

						echo json_encode($response_arr);
					}
				}
			}	

			//Read Notif Page
			elseif($addition == "mini_importation_refunds" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn() == TRUE){
				if($this->northbridge_model->getUserIdWhenLoggedIn() !== FALSE){
					$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
					$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
					$data['main_user_id'] = $user_id;
					$data['addition'] = $addition;
					$data['second_addition'] = $second_addition;
					if(is_array($user_info)){
						foreach($user_info as $user){
							$data['user_name'] = $user->user_name;
							$data['email'] = $user->email;
							$data['phone'] = $user->phone;
							$data['country_id'] = $user->country_id;
							$data['state_id'] = $user->state_id;
							$data['address'] = $user->address;
							$data['user_slug'] = $user->slug;
							$data['date'] = $user->date;
							$data['time'] = $user->time;
							$data['logo'] = $user->logo;
							$data['cover_photo'] = $user->cover_photo;
							$data['bio'] = $user->bio;
							$data['full_name'] = $user->full_name;
						}
						$data['notif_array'] = $this->northbridge_model->getNotifById($second_addition);
						$this->load->view('includes/admin_header',$data);
						$this->load->view('pages/mini_importation_refunds',$data);
						$this->load->view('includes/admin_footer',$data);
					}
				}
			}		


			elseif($addition == "notification" && $this->northbridge_model->checkIfNotifExistsById($second_addition) && is_null($third_addition) && is_null($fourth_addition) && is_null($fivth_addition) && $this->northbridge_model->confirmLoggedIn() == TRUE){
				if($this->northbridge_model->getUserIdWhenLoggedIn() !== FALSE){
					$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
					$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
					if(is_array($user_info)){
						foreach($user_info as $user){
							$data['user_name'] = $user->user_name;
							$data['email'] = $user->email;
							$data['phone'] = $user->phone;
							$data['country_id'] = $user->country_id;
							$data['state_id'] = $user->state_id;
							$data['address'] = $user->address;
							$data['user_slug'] = $user->slug;
							$data['date'] = $user->date;
							$data['time'] = $user->time;
							$data['logo'] = $user->logo;
						}
						$data['second_addition'] = $second_addition;
						
						$data['title'] = "Admin Page";
						$date = date("j M Y");
						$time = date("h:i:sa");
						$form_array = array(
							'date_received' => $date,
							'time_received' => $time,
							'received' => 1
						);
						if($this->northbridge_model->updateNotif($form_array,$second_addition)){
							$data['notif_array'] = $this->northbridge_model->getNotifById($second_addition);
							$this->load->view('includes/admin_header',$data);
							$this->load->view('pages/view_notif_page',$data);
							$this->load->view('includes/admin_footer',$data);
						}
							
						
						
					}
				}
			}		

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "checkout_cart_mini_importation" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['full_name'] = $user->full_name;
					}
					
					if($this->input->post('center_leader_user_id')){
						$response_arr = array('success' => false,'messages' => '','not_center_leader' => false,'not_enough_money' => false);
						$center_leader_user_id = $this->input->post('center_leader_user_id');
						$code_date = date("j");
						$code_time = date("h");
						$order_code = substr(bin2hex($this->encryption->create_key(8)),4). '-' . $code_date .'-' . $code_time;

						if($this->northbridge_model->checkIfUserIsAValidCenterLeader($center_leader_user_id)){
							$total_amount_plus_shipping = $this->northbridge_model->getTotalSumOfProductsSelectedPlusShippingMiniImportation();
							$user_total_amount = $this->northbridge_model->getUserTotalAmountByUse($user_id);

							if($user_total_amount >= $total_amount_plus_shipping){
								$products_selected_arr = $this->northbridge_model->getMiniImportationProductsSelecetedByUserInArrForm();
								if(count($products_selected_arr > 0)){
									if($this->northbridge_model->debitUser($user_id,$total_amount_plus_shipping)){
										$date =	date("j M Y");
										$time = date("H:i:s");
										for($i = 0; $i < count($products_selected_arr); $i++){
											$product_id = $products_selected_arr[$i]['product_id'];
											$quantity = $products_selected_arr[$i]['quantity'];
											$shipping_fee = $products_selected_arr[$i]['shipping_fee'];
											$cart_id = $products_selected_arr[$i]['cart_id'];
											$product_cost = $this->northbridge_model->getProductParamByIdMiniImportation("new_price",$product_id);
											$product_cost = $product_cost * $quantity;
											$shipping_fee = $shipping_fee * $quantity;
											$total_sum = $product_cost + $shipping_fee;
											$cart_date = $this->northbridge_model->getCartParamByIdMiniImportation("date",$cart_id);
											$cart_time = $this->northbridge_model->getCartParamByIdMiniImportation("time",$cart_id);

											$form_array = array(
												'user_id' => $user_id,
												'product_id' => $product_id,
												'quantity' => $quantity,
												'cart_date' => $cart_date,
												'cart_time' => $cart_time,
												'checked_out' => 1,
												'center_leader' => $center_leader_user_id,
												'check_out_date' => $date,
												'check_out_time' => $time,
												'order_code' => $order_code,
												'product_amount_paid' => $product_cost,
												'shipping_fee' => $shipping_fee
											);

											if($this->northbridge_model->moveMiniImportationCartRowToOrdersTable($form_array,$cart_id,$user_id)){
												$quantity_purchased = $this->northbridge_model->getProductParamByIdMiniImportation('quantity_purchased',$product_id);
												$new_quantity_purchased = $quantity_purchased + $quantity;

												$form_array = array(
													'quantity_purchased' => $new_quantity_purchased
												);

												$this->northbridge_model->updateProduct($form_array,$product_id);
											}
										}	

										
						        		$title = "Notice Of Request As Center Leader";
						        		$message = "This Is To Inform You That <em><a class='text-primary' href='".site_url('northbridge/'.$data['user_slug'])."'>".$data['full_name']."/a> Has Selected You As Center Leader In Mini Importation. Go To Your Center Leader Panel In Mini Importation To Find Out More.</em>";
						        		$date =	date("j M Y");
										$time = date("H:i:s");

										$form_array = array(
											'sender' => $user_id,
											'receiver' => $center_leader_user_id,
											'title' => $title,
											'message' => $message,
											'date_sent' => $date,
											'time_sent' => $time,
											'type' => 'mini_importation'
										);

										$this->northbridge_model->sendMessage($form_array);
										$response_arr['success'] = true;
									}	
								}
							}else{
								$response_arr['not_enough_money'] = true;
							}
						}else{
							$response_arr['not_center_leader'] = true;
						}

						echo json_encode($response_arr);
					}
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "get_live_products_mini_importation" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['full_name'] = $user->full_name;
					}
					
					if($this->input->post('show_records')){
						$response_arr = array('success' => true,'messages' => '');

          				$products = $this->northbridge_model->getLiveMiniImportationProducts();
				        if(is_array($products)){
				        	$products = array_values(array_reverse($products));
				          
				          	$response_arr['messages'] .= '<section id="shop">';
				            $response_arr['messages'] .= '<div class="container">';
				            $response_arr['messages'] .= '<div class="row">';
				           
				            foreach($products as $row){
				            	$date = date("j M Y");
				            	$time = date("h:i:sa");
				            	$curr_date = $date . " " . $time;
				            	$id = $row->id;
				            	$name = $row->name;
				            	$image = $row->image;
				            	$quantity = $row->quantity;
				            	$old_price = $row->old_price;
				            	$new_price = $row->new_price;
				            	$quantity_purchased = $row->quantity_purchased;
				            	$expiry_date = $row->expiry_date;
				            	$expiry_time = $row->expiry_time;
				            	$upload_date = $row->upload_date;
				            	$upload_time = $row->upload_time;
				            	$progress_percent = ($quantity_purchased / $quantity) * 100;
				            
				               	$response_arr['messages'] .= '<div class="card product-card col-sm-3" onclick="loadProductInfo(this,event)" data-id="'.$id.'">';
				                $response_arr['messages'] .= '<div class="card-body">';
				                $response_arr['messages'] .= '<div class="text-center">';

                      			$response_arr['messages'] .= '<img class="mx-auto product-img" src="'.base_url('assets/images/'.$image).'" alt="'.$name.'">';
                    			$response_arr['messages'] .= '</div>';

                    			$response_arr['messages'] .= '<div class="product-info">';
                      			$response_arr['messages'] .= '<h3 class="text-center">'.$name.'</h3>';
                      			$response_arr['messages'] .= '<div class="progress" style="margin: 3px;">';
                        		$response_arr['messages'] .= '<div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="'.$progress_percent.'" aria-valuemin="0" aria-valuemax="100" style="width:'.$progress_percent.'%">';
                          		$response_arr['messages'] .= '<span class="sr-only">'.$progress_percent.'% Complete</span>';
                        		$response_arr['messages'] .= '</div>';
                      			$response_arr['messages'] .= '</div>';
                      			$response_arr['messages'] .= '<span>'.$quantity_purchased.'</span>';
                      			$response_arr['messages'] .= '<span style="float: right;" class="text-right">'.$quantity.'</span>';
                      			$response_arr['messages'] .= '<div class="product-price-div">';
                        		$response_arr['messages'] .= '<span class="product-real-price">₦'.number_format($new_price,2).'</span>';
                        		$response_arr['messages'] .= '<span class="product-fake-price text-right">₦'. number_format($old_price,2).'</span>';
                      			$response_arr['messages'] .= '</div>';
                    			$response_arr['messages'] .= '</div>';

                  				$response_arr['messages'] .= '</div>';
                				$response_arr['messages'] .= '</div>';
             
            				}  
            
              				$response_arr['messages'] .= '</div>';
            				$response_arr['messages'] .= '</div>';

          					$response_arr['messages'] .= '</section>';
           				}else{ 
          					$response_arr['messages'] .= '<h4 class="text-warning">No Products Here. Please Click The Button To Add New Products.</h4>';
           				} 
						echo json_encode($response_arr);
					}
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "get_expired_products_mini_importation" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
						$data['full_name'] = $user->full_name;
					}
					
					if($this->input->post('show_records')){
						$response_arr = array('success' => true,'messages' => '');

          				$products = $this->northbridge_model->getExpiredMiniImportationProducts();
				        if(is_array($products) && count($products) > 0){
				          
				          	$response_arr['messages'] .= '<section id="shop">';
				            $response_arr['messages'] .= '<div class="container">';
				            $response_arr['messages'] .= '<div class="row">';
				           
				            foreach($products as $row){
				            	$date = date("j M Y");
				            	$time = date("h:i:sa");
				            	$curr_date = $date . " " . $time;
				            	$id = $row->id;
				            	$name = $row->name;
				            	$image = $row->image;
				            	$quantity = $row->quantity;
				            	$old_price = $row->old_price;
				            	$new_price = $row->new_price;
				            	$quantity_purchased = $row->quantity_purchased;
				            	$expiry_date = $row->expiry_date;
				            	$expiry_time = $row->expiry_time;
				            	$upload_date = $row->upload_date;
				            	$upload_time = $row->upload_time;
				            	$progress_percent = ($quantity_purchased / $quantity) * 100;
				            
				               	$response_arr['messages'] .= '<div class="card product-card col-sm-3" onclick="loadProductInfoExpired(this,event)" data-id="'.$id.'">';
				                $response_arr['messages'] .= '<div class="card-body">';
				                $response_arr['messages'] .= '<div class="text-center">';

                      			$response_arr['messages'] .= '<img class="mx-auto product-img" src="'.base_url('assets/images/'.$image).'" alt="'.$name.'">';
                    			$response_arr['messages'] .= '</div>';

                    			$response_arr['messages'] .= '<div class="product-info">';
                      			$response_arr['messages'] .= '<h3 class="text-center">'.$name.'</h3>';
                      			$response_arr['messages'] .= '<div class="progress" style="margin: 3px;">';
                        		$response_arr['messages'] .= '<div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="'.$progress_percent.'" aria-valuemin="0" aria-valuemax="100" style="width:'.$progress_percent.'%">';
                          		$response_arr['messages'] .= '<span class="sr-only">'.$progress_percent.'% Complete</span>';
                        		$response_arr['messages'] .= '</div>';
                      			$response_arr['messages'] .= '</div>';
                      			$response_arr['messages'] .= '<span>'.$quantity_purchased.'</span>';
                      			$response_arr['messages'] .= '<span style="float: right;" class="text-right">'.$quantity.'</span>';
                      			$response_arr['messages'] .= '<div class="product-price-div">';
                        		$response_arr['messages'] .= '<span class="product-real-price">₦'.number_format($new_price,2).'</span>';
                        		$response_arr['messages'] .= '<span class="product-fake-price text-right">₦'. number_format($old_price,2).'</span>';
                      			$response_arr['messages'] .= '</div>';

                      			$response_arr['messages'] .= '<div>';
                      			$response_arr['messages'] .= '<span >Expired On '.$expiry_date.'</span>';
                      			$response_arr['messages'] .= '</div>';
                    			$response_arr['messages'] .= '</div>';

                  				$response_arr['messages'] .= '</div>';
                				$response_arr['messages'] .= '</div>';
             
            				}  
            
              				$response_arr['messages'] .= '</div>';
            				$response_arr['messages'] .= '</div>';

          					$response_arr['messages'] .= '</section>';
           				}else{ 
          					$response_arr['messages'] .= '<h4 class="text-warning">No Expired Products .Products Will Display Here When They Expire.</h4>';
           				} 
						echo json_encode($response_arr);
					}
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "get_final_sum_mini_importation" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					
					if($this->input->post('show_records')){
						$response_arr = array('success' => false,'amount' => 0);
						$total_sum = $this->northbridge_model->getTotalSumOfProductsSelectedPlusShippingMiniImportation();

						if($total_sum > 0){
							$response_arr['success'] = true;
							$response_arr['amount'] = $total_sum;
						}

						echo json_encode($response_arr);
					}
				}
			}



			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "get_cart_info_mini_importation" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['local_government'] = $user->local_government;
						$data['city'] = $user->city;
						$data['address'] = $user->address;
						$data['place_of_use'] = $user->place_of_use;
						$data['whatsapp_user'] = $user->whatsapp_user;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					
					$response_arr = array('success' => true,'messages' => '','cart_num' => 0);
					if($this->input->post('show_records')){
						$cart_info = $this->northbridge_model->getMiniImportationCartInfo();
						if(is_array($cart_info)){
							$grand_total = 0;
							$response_arr['cart_num'] = $this->northbridge_model->getNumberOfProductsInCart();
							$response_arr['messages'] .= '<div class="container">';
							$response_arr['messages'] .= '<div class="row" id="label-row" style="margin-top: 10px;">';
	            			$response_arr['messages'] .= '<div class="col-6">';
	              			$response_arr['messages'] .= '<h4 style="color: #8e8e93; font-weight: 600; font-size: 16px; line-height: 1.14; text-transform: uppercase;">Item</h4>';
	            			$response_arr['messages'] .= '</div>';
	            			$response_arr['messages'] .= '<div class="col-2">';
			              	$response_arr['messages'] .= '<h4 style="color: #8e8e93; font-weight: 600; font-size: 16px; line-height: 1.14; text-transform: uppercase;">Quantity</h4>';
			            	$response_arr['messages'] .= '</div>';
			            	$response_arr['messages'] .= '<div class="col-2">';
			              	$response_arr['messages'] .= '<h4 style="color: #8e8e93; font-weight: 600; font-size: 16px; line-height: 1.14; text-transform: uppercase;">UNIT PRICE</h4>';
			            	$response_arr['messages'] .= '</div>';
			            	$response_arr['messages'] .= '<div class="col-2">';
			              	$response_arr['messages'] .= '<h4 style="color: #8e8e93; font-weight: 600; font-size: 16px; line-height: 1.14; text-transform: uppercase;">subtotal</h4>';
			            	$response_arr['messages'] .= '</div>';
			         		$response_arr['messages'] .= '</div>';
			          		$response_arr['messages'] .= '<div class="row">';

			          		foreach($cart_info as $row){
			          			$id = $row->id;
			          			$product_id = $row->product_id;
			          			$quantity = $row->quantity;
			          			$date = $row->date;
			          			$time = $row->time;



			          			
			          			if(!$this->northbridge_model->checkIfMiniImportationProductIdHasExpired($product_id)){
			          				$response_arr['messages'] .= '<div class="card col-12" style="min-height: 150px;">';
			          				$response_arr['messages'] .= '<h4 class="text-danger">This Product Is Expired</h4>';
			          				$response_arr['messages'] .= '</div>';
			          			}else if(!$this->northbridge_model->checkIfMiniImportationProductIdIsInStock($product_id)){
			          				$response_arr['messages'] .= '<div class="card col-12" style="min-height: 150px;">';
			          				$response_arr['messages'] .= '<h4 class="text-danger">This Product Is Out Of Stock</h4>';
			          				$response_arr['messages'] .= '</div>';
			          			}else if(!$this->northbridge_model->checkIfMiniImportationProductIdIsValid($product_id)){
			          				$response_arr['messages'] .= '<div class="card col-12" style="min-height: 150px;">';
			          				$response_arr['messages'] .= '<h4 class="text-danger">This Product Has Been Deleted By Admin.</h4>';
			          				$response_arr['messages'] .= '</div>';
			          			}else{

			          				$product_quantity = $this->northbridge_model->getProductParamByIdMiniImportation("quantity",$product_id);
									$product_quantity_purchased = $this->northbridge_model->getProductParamByIdMiniImportation("quantity_purchased",$product_id);
									$remaining_product_quantity = $product_quantity - $product_quantity_purchased;

									if($remaining_product_quantity >= $quantity){
										
									}else{

										if($quantity > $remaining_product_quantity){
											if($this->northbridge_model->readjustMiniImpotationCartForUserIfItExceedsRemainingQuantity($product_id,$user_id)){
												$quantity = $this->northbridge_model->getCartParamByIdMiniImportation("quantity",$id);
											}
										}
										
									}

			          				$product_image = $this->northbridge_model->getProductParamByIdMiniImportation('image',$product_id);

				          			$product_name = $this->northbridge_model->getProductParamByIdMiniImportation('name',$product_id);
				          			$product_price = $this->northbridge_model->getProductParamByIdMiniImportation('new_price',$product_id);
				          			$product_old_price = $this->northbridge_model->getProductParamByIdMiniImportation('old_price',$product_id);

				          			$product_total_price = $product_price * $quantity;
				          			$grand_total += $product_total_price;




				            		$response_arr['messages'] .= '<div class="card col-12 main-row" data-cart-id="'.$id.'" style="min-height: 150px;">';
				              		$response_arr['messages'] .= '<div class="card-body">';
				                	$response_arr['messages'] .= '<div class="row" style="margin-top: 10px;">';
				                 	$response_arr['messages'] .= '<div class="col-2">';
				                    $response_arr['messages'] .= '<img src="'.base_url('assets/images/'.$product_image).'" alt="'.$product_name.'" style="width: 60px; height: 60px;">';
				                  	$response_arr['messages'] .= '</div>';

				                  	$response_arr['messages'] .= '<div class="col-4" style="padding-bottom: 32px; padding-right: 10px; ">';
				                    $response_arr['messages'] .= '<h4 style="font-size: 14px; font-weight: bold">'.$this->northbridge_model->custom_echo($product_name,67).'</h4>';
				                    $response_arr['messages'] .= '<div class="" onclick="removeProductFromCart(this,event)" data-id="'.$id.'" style="cursor: pointer;">';
				                    $response_arr['messages'] .= '<i class="fas fa-trash" style="color: #FF9900;"></i>';
				                    $response_arr['messages'] .= '<span style="font-weight: bold; color: #FF9900;">REMOVE</span>';
				                    $response_arr['messages'] .= '</div>';
				                  	$response_arr['messages'] .= '</div>';

				                  	$response_arr['messages'] .= '<div class="col-2" style="padding: 23px 20px 50px 20px; border-left: 1px solid #eee; border-right: 1px solid #eee;">';
				                    $response_arr['messages'] .= '<div class="form-group">';
				                    $response_arr['messages'] .= '<input type="number" class="form-control quantity_requested" value="'.$quantity.'" min="1" max="'.$remaining_product_quantity.'" onkeyup="cartQuantityChange(this,event)" data-price="'.$product_price.'" data-previous-quantity="'.$quantity.'">';
				                    $response_arr['messages'] .= '</div>';
				                  	$response_arr['messages'] .= '</div>';

				                  	$response_arr['messages'] .= '<div class="col-2" style="border-right: 1px solid #eee; padding: 23px 20px 50px 20px;">';
				                    $response_arr['messages'] .= '<h4 style="font-size: 15px;" class="text-center">₦ '.number_format($product_price,2).'</h4>';
				                    $response_arr['messages'] .= '<span style="font-size: 13px; display: block; text-decoration: line-through; color: #ababab;" class="text-center">₦ '.number_format($product_old_price,2).'</span>';
				                  	$response_arr['messages'] .= '</div>';

				                  	$response_arr['messages'] .= '<div class="col-2" style="padding: 23px 20px 50px 20px;">';
				                    $response_arr['messages'] .= '<h4 class="text-center" id="total-price" style="font-size: 16px; font-weight: bold; color: #FF9900;">₦ '.number_format($product_total_price,2).'</h4>';
				                  	$response_arr['messages'] .= '</div>';
				                	$response_arr['messages'] .= '</div>';
				              		$response_arr['messages'] .= '</div>';
				            		$response_arr['messages'] .= '</div>';

				            	}	

					        }
					        $response_arr['messages'] .= '</div>';
					        $response_arr['messages'] .= '</div>';

					        $response_arr['messages'] .= '<h5 id="grand-total-cont-h5">Total:  <h3 class="text-warning" id="grand-total-price" data-price="'.$grand_total.'">₦ '.number_format($grand_total,2).'</h3></h5>';
			      		}else{
			      			$response_arr['messages'] .= "<h4 class='text-warning'>No Products In Cart</h4>";
			      		}	
					}
					echo json_encode($response_arr);

				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "submit_cart_final_mini_importation" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['local_government'] = $user->local_government;
						$data['city'] = $user->city;
						$data['address'] = $user->address;
						$data['place_of_use'] = $user->place_of_use;
						$data['whatsapp_user'] = $user->whatsapp_user;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					
					$response_arr = array('success' => false,'messages' => '','products' => array(),'total_price' => 0,'total_shipping' => 0,'full_name' => '','user_name' => '','address' => '','phone_number' => '');

					if($this->input->post('data')){
						$data = $this->input->post('data');
						if(is_array($data)){
							// var_dump($data);
							for($i = 0; $i  < count($data); $i++){
								$cart_id = $data[$i]['cart_id'];
								$quantity = $data[$i]['quantity'];

								$form_array = array(
									'quantity' => $quantity
								);
								$this->northbridge_model->updateMiniImportationCart($form_array,$cart_id,$user_id);
							}
						}
						$cart_info = $this->northbridge_model->getMiniImportationCartInfo();
						if(is_array($cart_info)){
							
							$i = -1;
							$total_price = 0;
							$total_shipping = 0;
							foreach($cart_info as $row){
								$i++;
								$cart_id = $row->id;
								$product_id = $row->product_id;
								$quantity_requested = $row->quantity;

								if(!$this->northbridge_model->checkIfMiniImportationProductIdHasExpired($product_id)){
			          				
			          			}else if(!$this->northbridge_model->checkIfMiniImportationProductIdIsInStock($product_id)){
			          				
			          			}else if(!$this->northbridge_model->checkIfMiniImportationProductIdIsValid($product_id)){
			          				
			          			}else{

			          				$product_quantity = $this->northbridge_model->getProductParamByIdMiniImportation("quantity",$product_id);
									$product_quantity_purchased = $this->northbridge_model->getProductParamByIdMiniImportation("quantity_purchased",$product_id);
									$remaining_product_quantity = $product_quantity - $product_quantity_purchased;

									if($remaining_product_quantity >= $quantity_requested){
										
									}else{

										if($quantity_requested > $remaining_product_quantity){
											if($this->northbridge_model->readjustMiniImpotationCartForUserIfItExceedsRemainingQuantity($product_id,$user_id)){
												$quantity_requested = $this->northbridge_model->getCartParamByIdMiniImportation("quantity",$id);
											}
										}
										
									}

			          				$product_info = $this->northbridge_model->getMiniImportationProductInfoById($product_id);
			          				if(is_array($product_info)){
			          					$response_arr['success'] = true;

			          					$price = $product_info[0]->new_price * $quantity_requested;
			          					$total_price += $price;
			          					$shipping_fee = $product_info[0]->shipping_fee * $quantity_requested;
			          					$total_shipping += $shipping_fee;
		          						$response_arr['products'][$i] = $product_info[0];
		          						$response_arr['products'][$i]->quantity_requested = $quantity_requested;
			          					
			          				}
			          			}
							}

							$response_arr['total_price'] = $total_price;
							$service_charge = $total_price + $total_shipping;
							$response_arr['service_charge'] = $service_charge * 0.05;
							$response_arr['total_shipping'] = $total_shipping;
							$response_arr['full_name'] = $this->northbridge_model->getUserFullNameByUserId($user_id);
							$response_arr['user_name'] = $this->northbridge_model->getUserNameById($user_id);
							$response_arr['address'] = $this->northbridge_model->getUserAddressById($user_id);
							$response_arr['phone_number'] =  "+" . $this->northbridge_model->getUserPhoneCodeByUserId($user_id) . "" .$this->northbridge_model->getUserPhoneNumberByUserId($user_id);

						}
					}
					echo json_encode($response_arr);
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "change_user_address" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['local_government'] = $user->local_government;
						$data['city'] = $user->city;
						$data['address'] = $user->address;
						$data['place_of_use'] = $user->place_of_use;
						$data['whatsapp_user'] = $user->whatsapp_user;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					
					$response_arr = array('success' => false,'messages' => '');

					$this->form_validation->set_rules('address','Your Address','trim|required');
						$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
					if($this->form_validation->run() == TRUE){
						$address = $this->input->post('address');

						$form_array = array(
							'address' => $address
						);

						if($this->northbridge_model->updateUserTable($form_array,$user_id)){
							$response_arr['success'] = true;
						}
					}else{
						foreach($_POST as $key => $value){
							$response_arr['messages'][$key] = form_error($key);
						}
					}

					echo json_encode($response_arr);
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "get_data_bundles_for_operator_vtu" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['local_government'] = $user->local_government;
						$data['city'] = $user->city;
						$data['address'] = $user->address;
						$data['place_of_use'] = $user->place_of_use;
						$data['whatsapp_user'] = $user->whatsapp_user;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					$date = date("j M Y");
					$time = date("h:i:sa");
					
					if($this->input->post('type')){
						$type = $this->input->post('type');
						if($type == "mtn-data" || $type == "glo-data" || $type == "airtel-data" || $type == "9mobile-data"){
							$response_arr = array('success' => false,'messages' => '','network' => '');

							$url = "https://www.payscribe.ng/api/lookup/data";
							$use_post = true;

							if($type == "mtn-data"){
								$network = "Mtn";
								$network_num = 01;
							}elseif($type == "glo-data"){
								$network = "Glo";
								$network_num = 02;
							}else if($type == "9mobile-data"){
								$network = "9mobile";
								$network_num = 03;
							}else if($type == "airtel-data"){
								$network = "Airtel";
								$network_num = 04;
							}

							$post_data = array(
								'network' => $network
							);


							$response = $this->northbridge_model->payscribeVtuCurl($url,$use_post,$post_data);


							if($this->northbridge_model->isJson($response)){
								$response = json_decode($response);
								if(is_object($response)){
									if($response->status && $response->status_code == 200){
									
										$response_arr['network'] = $network;
										// var_dump($response->message->details[]);
										
										$plans = $response->message->details[0]->plans;
										

										if(is_array($plans)){
											$response_arr['success'] = true;
											$j = 0;
											$response_arr['messages'] .= '<p class="text-secondary">Select Bundle To Proceed</p>';
											$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive">';

							        		$response_arr['messages'] .= '<table class="table table-striped table-bordered wrap hover display" id="data-bundles-table" cellspacing="0" width="100%" style="width:100%">';
							        		$response_arr['messages'] .= '<thead>';
							        		$response_arr['messages'] .= '<tr>';
							        		$response_arr['messages'] .= '<th>#</th>';
							        		$response_arr['messages'] .= '<th>Data Amount</th>';
							        		$response_arr['messages'] .= '<th>(₦) Cost</th>';
							        		
							        		$response_arr['messages'] .= '</tr>';
							        		$response_arr['messages'] .= '<tbody>';

							        		for($i = 0; $i < count($plans); $i++){
							        			$j++;
							        			$product_id = $plans[$i]->plan_code;
							        			// $product_id = $plans[$i]->PRODUCT_ID;
							        			$product_name = $plans[$i]->name;
							        			$product_amount = $plans[$i]->amount;
							        			// $product_amount = $product_amount + 20;
							        			if($type == "mtn-data"){
								        			$product_amount = round((0.04 * $product_amount) + $product_amount,2);
								        		}else{
								        			$product_amount = round((0.05 * $product_amount) + $product_amount,2);
								        		}

							        			$response_arr['messages'] .= '<tr data-product-id="'.$product_id.'" onclick="selectDataBundle(this,event)" data-type="'.$type.'" data-product-name="'.$product_name.'" data-amount="'.$product_amount.'">';
							        			$response_arr['messages'] .= '<td>'.$j.'</td>';
							        			$response_arr['messages'] .= '<td>'.$product_name.'</td>';
							        			$response_arr['messages'] .= '<td>'.number_format($product_amount,2).'</td>';
							        			$response_arr['messages'] .= '</tr>';
							        		}

							        		$response_arr['messages'] .= '</tbody>';
							        		$response_arr['messages'] .= '</table>';
							        		$response_arr['messages'] .= '</div>';
							        	}
							        }
								        

								}
							}

							echo json_encode($response_arr);
						}else if($type == "mtn-data"){
							$response_arr = array('success' => false,'messages' => '','network' => '');

							$url = "https://www.nellobytesystems.com/APIDatabundlePlansV1.asp";
							$use_post = true;

							$response = $this->northbridge_model->vtu_curl($url,$use_post,$post_data=[]);


							if($this->northbridge_model->isJson($response)){
								$response = json_decode($response);
								if(is_object($response)){
									
									if($type == "mtn-data"){
										$network = "MTN";
										$network_num = 01;
									}elseif($type == "glo-data"){
										$network = "Glo";
										$network_num = 02;
									}else if($type == "9mobile-data"){
										$network = "9mobile";
										$network_num = 03;
									}else if($type == "airtel-data"){
										$network = "Airtel";
										$network_num = 04;
									}

									$response_arr['network'] = $network;
									
									$plans = $response->MOBILE_NETWORK->$network[0]->PRODUCT;
									

									if(is_array($plans)){
										$response_arr['success'] = true;
										$j = 0;
										$response_arr['messages'] .= '<p class="text-secondary">Select Bundle To Proceed</p>';
										$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive">';

						        		$response_arr['messages'] .= '<table class="table table-striped table-bordered wrap hover display" id="data-bundles-table" cellspacing="0" width="100%" style="width:100%">';
						        		$response_arr['messages'] .= '<thead>';
						        		$response_arr['messages'] .= '<tr>';
						        		$response_arr['messages'] .= '<th>#</th>';
						        		$response_arr['messages'] .= '<th>Data Amount</th>';
						        		$response_arr['messages'] .= '<th>(₦) Cost</th>';
						        		
						        		$response_arr['messages'] .= '</tr>';
						        		$response_arr['messages'] .= '<tbody>';

						        		for($i = 0; $i < count($plans); $i++){
						        			$j++;
						        			$product_code = $plans[$i]->PRODUCT_CODE;
						        			$product_id = $plans[$i]->PRODUCT_ID;
						        			$product_name = $plans[$i]->PRODUCT_NAME;
						        			$product_amount = $plans[$i]->PRODUCT_AMOUNT;
						        			// $product_amount = $product_amount + 20;

						        			$product_amount = round((0.04 * $product_amount) + $product_amount,2);

						        			$response_arr['messages'] .= '<tr data-product-id="'.$product_id.'" onclick="selectDataBundle(this,event)" data-type="'.$type.'" data-product-name="'.$product_name.'" data-amount="'.$product_amount.'">';
						        			$response_arr['messages'] .= '<td>'.$j.'</td>';
						        			$response_arr['messages'] .= '<td>'.$product_name.'</td>';
						        			$response_arr['messages'] .= '<td>'.number_format($product_amount,2).'</td>';
						        			$response_arr['messages'] .= '</tr>';
						        		}

						        		$response_arr['messages'] .= '</tbody>';
						        		$response_arr['messages'] .= '</table>';
						        		$response_arr['messages'] .= '</div>';
						        	}
							        

								}
							}

							echo json_encode($response_arr);
						}
					}
				}
			}	

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "get_data_bundles_for_9mobile_combo" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['local_government'] = $user->local_government;
						$data['city'] = $user->city;
						$data['address'] = $user->address;
						$data['place_of_use'] = $user->place_of_use;
						$data['whatsapp_user'] = $user->whatsapp_user;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					$date = date("j M Y");
					$time = date("h:i:sa");
					
					if($this->input->post('type')){
						$type = $this->input->post('type');
						if($type == "9mobile-data"){
							$response_arr = array('success' => false,'messages' => '','network' => '');
	
							$response_arr['network'] = "9mobile";
							$bundles = $this->northbridge_model->get9mobileComboDataBundles();
									

							if(is_array($bundles)){
								$response_arr['success'] = true;
								$j = 0;
								$response_arr['messages'] .= '<p class="text-secondary">Select Bundle To Proceed</p>';
								$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive">';

				        		$response_arr['messages'] .= '<table class="table table-striped table-bordered wrap hover display" id="data-bundles-table" cellspacing="0" width="100%" style="width:100%">';
				        		$response_arr['messages'] .= '<thead>';
				        		$response_arr['messages'] .= '<tr>';
				        		$response_arr['messages'] .= '<th>#</th>';
				        		$response_arr['messages'] .= '<th>Data Amount</th>';
				        		$response_arr['messages'] .= '<th>(₦) Cost</th>';
				        		
				        		$response_arr['messages'] .= '</tr>';
				        		$response_arr['messages'] .= '<tbody>';

				        		foreach($bundles as $row){
				        			$j++;
				        			$product_id = $row->id;
				        			$product_name = $row->data_amount;
				        			$product_amount = $row->amount;
				        			

				        			$response_arr['messages'] .= '<tr data-product-id="'.$product_id.'" onclick="selectDataBundle(this,event,true)" data-type="'.$type.'" data-product-name="'.$product_name.'" data-amount="'.$product_amount.'">';
				        			$response_arr['messages'] .= '<td>'.$j.'</td>';
				        			$response_arr['messages'] .= '<td>'.$product_name.'</td>';
				        			$response_arr['messages'] .= '<td>'.number_format($product_amount,2).'</td>';
				        			$response_arr['messages'] .= '</tr>';
				        		}

				        		$response_arr['messages'] .= '</tbody>';
				        		$response_arr['messages'] .= '</table>';
				        		$response_arr['messages'] .= '</div>';
				        	}

							echo json_encode($response_arr);
						}
					}
				}
			}			

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "get_package_for_operator_vtu" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['local_government'] = $user->local_government;
						$data['city'] = $user->city;
						$data['address'] = $user->address;
						$data['place_of_use'] = $user->place_of_use;
						$data['whatsapp_user'] = $user->whatsapp_user;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					$date = date("j M Y");
					$time = date("h:i:sa");
					
					if($this->input->post('type')){
						$type = $this->input->post('type');
						if($type == "dstv" || $type == "gotv" || $type == "startimes"){
							$response_arr = array('success' => false,'messages' => '','network' => '');

							$url = "https://www.nellobytesystems.com/APICableTVPackagesV1.asp";
							$use_post = true;

							$response = $this->northbridge_model->vtu_curl($url,$use_post,$post_data=[]);

							if($this->northbridge_model->isJson($response)){
								$response = json_decode($response);
								if(is_object($response)){
									if($type == "dstv"){
										$response_arr['network'] = "DStv";
										$packages = $response->TV_ID->DStv[0]->PRODUCT;
									}else if($type == "gotv"){
										$response_arr['network'] = "GOtv";
										$packages = $response->TV_ID->GOtv[0]->PRODUCT;
									}else if($type == "startimes"){
										$response_arr['network'] = "Startimes";
										$packages = $response->TV_ID->Startimes[0]->PRODUCT;
									}

									if(is_array($packages)){
										$response_arr['success'] = true;
										$j = 0;
										$response_arr['messages'] .= '<p class="text-secondary">Select Package To Proceed</p>';
										$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive">';

						        		$response_arr['messages'] .= '<table class="table table-striped table-bordered wrap hover display" id="packages-table" cellspacing="0" width="100%" style="width:100%">';
						        		$response_arr['messages'] .= '<thead>';
						        		$response_arr['messages'] .= '<tr>';
						        		$response_arr['messages'] .= '<th>#</th>';
						        		$response_arr['messages'] .= '<th>Package Name</th>';
						        		$response_arr['messages'] .= '<th>(₦) Cost</th>';
						        		
						        		$response_arr['messages'] .= '</tr>';
						        		$response_arr['messages'] .= '<tbody>';

						        		for($i = 0; $i < count($packages); $i++){
						        			$j++;
						        			$package_id = $packages[$i]->PACKAGE_ID;
						        			$package_name = $packages[$i]->PACKAGE_NAME;
						        			$package_amount = $packages[$i]->PACKAGE_AMOUNT;
						        			$package_amount += 20;
						        			$package_discount = $packages[$i]->PRODUCT_DISCOUNT_AMOUNT;
						        			$package_discount += 10;
						        			

						        			$response_arr['messages'] .= '<tr data-package-id="'.$package_id.'" onclick="selectTVPackage(this,event)" data-type="'.$type.'" data-package-name="'.$package_name.'" data-discount-amount="'.$package_discount.'" data-amount="'.$package_amount.'">';
						        			$response_arr['messages'] .= '<td>'.$j.'</td>';
						        			$response_arr['messages'] .= '<td>'.$package_name.'</td>';
						        			$response_arr['messages'] .= '<td>'.number_format($package_amount).'</td>';
						        			$response_arr['messages'] .= '</tr>';
						        		}

						        		$response_arr['messages'] .= '</tbody>';
						        		$response_arr['messages'] .= '</table>';
						        		$response_arr['messages'] .= '</div>';
						        	}

								}
							}

							echo json_encode($response_arr);
						}
					}
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "buy_airtime_vtu" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['local_government'] = $user->local_government;
						$data['city'] = $user->city;
						$data['address'] = $user->address;
						$data['place_of_use'] = $user->place_of_use;
						$data['whatsapp_user'] = $user->whatsapp_user;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					$date = date("j M Y");
					$time = date("h:i:sa");
					
					if($this->input->post('type')){
						$type = $this->input->post('type');
						// echo $this->input->post('amount') . "<br>";
						if($type == "mtn-airtime" || $type == "glo-airtime" || $type == "airtel-airtime" || $type == "9mobile-airtime"){
							$response_arr = array('success' => false,'messages' => '','insuffecient_funds' => false,'order_id' => '','invalid_amount' => false,'invalid_recipient' => false);

							$this->form_validation->set_rules('amount','Amount','trim|required|numeric|greater_than_equal_to[100]|less_than_equal_to[20000]');
							$this->form_validation->set_rules('mobile_no','Mobile No','trim|required|numeric|min_length[6]|max_length[15]');
							$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
							if($this->form_validation->run() == TRUE){
								$amount = $this->input->post('amount');
								$mobile_no = $this->input->post('mobile_no');
								if($type == "mtn-airtime"){
									$amount_to_debit_user = $amount;
								}else if($type == "glo-airtime"){
									$amount_to_debit_user = $amount;
								}else if($type == "9mobile-airtime"){
									$amount_to_debit_user = $amount;
								}else if($type == "airtel-airtime"){
									$amount_to_debit_user = $amount;
								}
								
								$user_total_amount = $this->northbridge_model->getUserTotalAmountByUse($user_id);
								// echo $user_total_amount;
								// echo $amount;

								if($amount_to_debit_user <= $user_total_amount){
									// var_dump($_POST);
									
									if(!isset($_POST['combo'])){
										if($type == "mtn-airtime"){
											$mobilenetwork_code = "01";
										}else if($type == "glo-airtime"){
											$mobilenetwork_code = "02";
										}else if($type == "9mobile-airtime"){
											$mobilenetwork_code = "03";
										}else if($type == "airtel-airtime"){
											$mobilenetwork_code = "04";
										}

										$url = "https://www.nellobytesystems.com/APIAirtimeV1.asp?UserID=CK10153218&APIKey=UYV68HTPI15IFS0T8C94HC55PP7UCK44E11O033OAAEW7604BM3S7N50EE483649&MobileNetwork=". $mobilenetwork_code ."&Amount=" . $amount . "&MobileNumber=" . $mobile_no;
										$use_post = true;

										$response = $this->northbridge_model->vtu_curl($url,$use_post,$post_data=[]);

										if($this->northbridge_model->isJson($response)){
											$response = json_decode($response);
											if(is_object($response)){
												$status = $response->status;

												if($status == "ORDER_RECEIVED"){
													if($this->northbridge_model->debitUser($user_id,$amount_to_debit_user)){
														$order_id = $response->orderid;
														$form_array = array(
															'user_id' => $user_id,
															'type' => 'airtime',
															'sub_type' => $type,
															'number' => $mobile_no,
															'date' => $date,
															'time' => $time,
															'amount' => $amount,
															'order_id' => $order_id
														);
														if($this->northbridge_model->addTransactionStatus($form_array)){
															$response_arr['success'] = true;
															$response_arr['order_id'] = $order_id;
														}
													}
												}else if($status == "INVALID_AMOUNT"){
													$response_arr['invalid_amount'] = true;
													
												}else if($status == "INVALID_RECIPIENT"){
													$response_arr['invalid_recipient'] = true;
													
												}else if($status == "INSUFFICIENT_BALANCE"){
													// $response_arr['invalid_recipient'] = true;
													// echo "string";
													
												}else if($status == "INVALID_CREDENTIALS"){
													// $response_arr['invalid_recipient'] = true;
													// echo "string";
													
												}
											}
										}
									}else{
										if($type == "9mobile-airtime"){
											$form_array = array(
												'user_id' => $user_id,
												'type' => 'airtime',
												'sub_type' => $type,
												'number' => $mobile_no,
												'date' => $date,
												'time' => $time,
												'amount' => $amount,
												'order_id' => ""
											);
											if($this->northbridge_model->addTransactionStatus($form_array)){
												$form_array = array(
													'user_id' => $user_id,
													'number' => $mobile_no,
													'amount' => $amount,
													'date' => $date,
													'time' => $time
												);
												if($this->northbridge_model->addComboRequest($form_array)){
													if($this->northbridge_model->debitUser($user_id,$amount_to_debit_user)){
														$response_arr['success'] = true;
													}
												}
												
											}
										}
										
									}
									
								}else{
									$response_arr['insuffecient_funds'] = true;
								}
							}else{
								foreach($_POST as $key => $value){
									$response_arr['messages'][$key] = form_error($key);
								}
							}
						}

						echo json_encode($response_arr);
					}
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "buy_data_vtu" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['local_government'] = $user->local_government;
						$data['city'] = $user->city;
						$data['address'] = $user->address;
						$data['place_of_use'] = $user->place_of_use;
						$data['whatsapp_user'] = $user->whatsapp_user;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					$date = date("j M Y");
					$time = date("h:i:sa");
					
					if($this->input->post('type') && $this->input->post('product_id')){
						$product_id = $this->input->post('product_id');
						$type = $this->input->post('type');
						// echo $this->input->post('amount') . "<br>";
						if($type == "mtn-data" || $type == "glo-data" || $type == "airtel-data" || $type == "9mobile-data"){
							$response_arr = array('success' => false,'messages' => '','insuffecient_funds' => false,'order_id' => '');

							
							$this->form_validation->set_rules('mobile_no','Mobile No','trim|required|numeric|min_length[6]|max_length[15]');
							$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
							if($this->form_validation->run() == TRUE){
								if($type == "mtn-data"){
									$network = "Mtn";
									$mobilenetwork_code = "01";
								}elseif($type == "glo-data"){
									$network = "Glo";
									$mobilenetwork_code = "02";
								}else if($type == "9mobile-data"){
									$network = "9mobile";
									$mobilenetwork_code = "03";
								}else if($type == "airtel-data"){
									$network = "Airtel";
									$mobilenetwork_code = "04";
								}


								if(!isset($_POST['combo'])){
									$amount = $this->northbridge_model->getPayscribeVtuDataBundleCostByProductId($type,$product_id);
								}else{
									$amount = $this->northbridge_model->get9mobileComboCostByProductId($product_id);
								}
								if($amount != 0){
									$mobile_no = $this->input->post('mobile_no');
									if(!isset($_POST['combo'])){
										
										if($type == "mtn-data"){
						        			$amount_to_debit_user = round((0.04 * $amount) + $amount,2);
						        		}else{
						        			$amount_to_debit_user = round((0.05 * $amount) + $amount,2);
						        		}
									}else{
										$amount_to_debit_user = $amount;
									}
									$user_total_amount = $this->northbridge_model->getUserTotalAmountByUse($user_id);
									
									if($amount_to_debit_user <= $user_total_amount){
										if(!isset($_POST['combo'])){
											$url = "https://www.payscribe.ng/api/vend/data/";
											$use_post = true;
											$post_data = array(
												'network' => $network,
												'plan' => $product_id,
												'recipent' => $mobile_no
											);
											
											$response = $this->northbridge_model->payscribeVtuCurl($url,$use_post,$post_data);
											

											if($this->northbridge_model->isJson($response)){
												$response = json_decode($response);
												// var_dump($response);
												if($response->status && $response->status_code == 200){
													if($this->northbridge_model->debitUser($user_id,$amount_to_debit_user)){
														$order_id = $response->message->details->transaction_id;
														$form_array = array(
															'user_id' => $user_id,
															'type' => 'data',
															'sub_type' => $type,
															'number' => $mobile_no,
															'date' => $date,
															'time' => $time,
															'amount' => $amount_to_debit_user,
															'order_id' => $order_id
														);
														if($this->northbridge_model->addTransactionStatus($form_array)){
															$response_arr['success'] = true;
															$response_arr['order_id'] = $order_id;
														}
													}
												}
											}	

										}else{
											
											if($type == "9mobile-data"){
												$data_amount = $this->northbridge_model->get9mobileComboDataAmountByProductId($product_id);
												if($data_amount != ""){
													$form_array = array(
														'user_id' => $user_id,
														'type' => 'data',
														'sub_type' => $type,
														'number' => $mobile_no,
														'date' => $date,
														'time' => $time,
														'amount' => $amount_to_debit_user,
														'order_id' => ""
													);
													if($this->northbridge_model->addTransactionStatus($form_array)){
														$form_array = array(
															'user_id' => $user_id,
															'number' => $mobile_no,
															'amount' => $data_amount,
															'date' => $date,
															'time' => $time
														);
														if($this->northbridge_model->addComboRequest($form_array)){
															if($this->northbridge_model->debitUser($user_id,$amount_to_debit_user)){
																$response_arr['success'] = true;
															}
														}
														
													}
												}
											}
											
										}
									}else{
										$response_arr['insuffecient_funds'] = true;
									}
								}	
							}else{
								foreach($_POST as $key => $value){
									$response_arr['messages'][$key] = form_error($key);
								}
							}
						}
						else if($type == "mtn-data"){
							$response_arr = array('success' => false,'messages' => '','insuffecient_funds' => false,'order_id' => '');

							
							$this->form_validation->set_rules('mobile_no','Mobile No','trim|required|numeric|min_length[6]|max_length[15]');
							$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
							if($this->form_validation->run() == TRUE){
								if($type == "mtn-data"){
									$network = "Mtn";
									$mobilenetwork_code = "01";
								}elseif($type == "glo-data"){
									$network = "Glo";
									$mobilenetwork_code = "02";
								}else if($type == "9mobile-data"){
									$network = "9mobile";
									$mobilenetwork_code = "03";
								}else if($type == "airtel-data"){
									$network = "Airtel";
									$mobilenetwork_code = "04";
								}


								if(!isset($_POST['combo'])){
									$amount = $this->northbridge_model->getVtuDataBundleCostByProductId($type,$product_id);
								}else{
									$amount = $this->northbridge_model->get9mobileComboCostByProductId($product_id);
								}
								if($amount != 0){
									$mobile_no = $this->input->post('mobile_no');
									if(!isset($_POST['combo'])){
										$amount_to_debit_user = round((0.04 * $amount) + $amount,2);
									}else{
										$amount_to_debit_user = $amount;
									}

									// echo $amount_to_debit_user;
									$user_total_amount = $this->northbridge_model->getUserTotalAmountByUse($user_id);
									
									if($amount_to_debit_user <= $user_total_amount){
										if(!isset($_POST['combo'])){
											// $url = "https://www.nellobytesystems.com/APIVerifyElectricityV1.asp?UserID=CK10153218&APIKey=UYV68HTPI15IFS0T8C94HC55PP7UCK44E11O033OAAEW7604BM3S7N50EE483649&ElectricCompany=".$disco_code."&meterno=".$meter_no;

											$url = "https://www.nellobytesystems.com/APIDatabundleV1.asp?UserID=CK10153218&APIKey=UYV68HTPI15IFS0T8C94HC55PP7UCK44E11O033OAAEW7604BM3S7N50EE483649&MobileNetwork=".$mobilenetwork_code."&DataPlan=".$product_id."&MobileNumber=".$mobile_no;
											$use_post = true;
											// $post_data = array(
											// 	'network' => $network,
											// 	'plan' => $product_id,
											// 	'recipent' => $mobile_no
											// );
											
											$response = $this->northbridge_model->vtu_curl($url,$use_post,$post_data = []);
											

											if($this->northbridge_model->isJson($response)){
												$response = json_decode($response);
												// var_dump($response);
												if($response->status == "ORDER_RECEIVED"){
													if($this->northbridge_model->debitUser($user_id,$amount_to_debit_user)){
														$order_id = $response->orderid;
														$form_array = array(
															'user_id' => $user_id,
															'type' => 'data',
															'sub_type' => $type,
															'number' => $mobile_no,
															'date' => $date,
															'time' => $time,
															'amount' => $amount_to_debit_user,
															'order_id' => $order_id
														);
														if($this->northbridge_model->addTransactionStatus($form_array)){
															$response_arr['success'] = true;
															$response_arr['order_id'] = $order_id;
														}
													}
												}
											}	

										}else{
											
											if($type == "9mobile-data"){
												$data_amount = $this->northbridge_model->get9mobileComboDataAmountByProductId($product_id);
												if($data_amount != ""){
													$form_array = array(
														'user_id' => $user_id,
														'type' => 'data',
														'sub_type' => $type,
														'number' => $mobile_no,
														'date' => $date,
														'time' => $time,
														'amount' => $amount_to_debit_user,
														'order_id' => ""
													);
													if($this->northbridge_model->addTransactionStatus($form_array)){
														$form_array = array(
															'user_id' => $user_id,
															'number' => $mobile_no,
															'amount' => $data_amount,
															'date' => $date,
															'time' => $time
														);
														if($this->northbridge_model->addComboRequest($form_array)){
															if($this->northbridge_model->debitUser($user_id,$amount_to_debit_user)){
																$response_arr['success'] = true;
															}
														}
														
													}
												}
											}
											
										}
									}else{
										$response_arr['insuffecient_funds'] = true;
									}
								}	
							}else{
								foreach($_POST as $key => $value){
									$response_arr['messages'][$key] = form_error($key);
								}
							}
						}

						echo json_encode($response_arr);
					}
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "track_payscribe_vtu_order" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['local_government'] = $user->local_government;
						$data['city'] = $user->city;
						$data['address'] = $user->address;
						$data['place_of_use'] = $user->place_of_use;
						$data['whatsapp_user'] = $user->whatsapp_user;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					$date = date("j M Y");
					$time = date("h:i:sa");
					
					if($this->input->post('show_records') && $this->input->post('order_id')){
						$order_id = $this->input->post('order_id');
						
						$response_arr = array('success' => false,'messages' => '');
	
						$url = "https://www.payscribe.ng/api/get_report/?trans_id=".$order_id;
						$use_post = true;
						
						
						$response = $this->northbridge_model->payscribeVtuCurl($url,$use_post,$post_data = []);
						
						if($this->northbridge_model->isJson($response)){
							$response = json_decode($response);
							// var_dump($response->message->details);
							if($response->status && $response->status_code == 200){
								$response_arr['success'] = true;

								$description = $response->message->details->description;
								$amount = $response->message->details->amount;
								$date_initiated = $response->message->details->date_initiated;
								$status = $response->message->details->transaction_status;

								// echo $this->northbridge_model->getVtuTransactionParamByOrderId("refunded",$order_id);

								if(($status == "fail" || $status == "refunded") && $this->northbridge_model->getVtuTransactionParamByOrderId("refunded",$order_id) == 0){
									$this->northbridge_model->refundFundsAndMarkAsRefunded($order_id);
								}

								$type = $this->northbridge_model->getVtuTransactionParamByOrderId("type",$order_id);
								if($type == "data"){
									$amount = round((0.04 * $amount) + $amount,2);
								}

								$response_arr['messages'] .= 'Transaction Status: <em class="text-primary">' . $status . '</em><br>';
								$response_arr['messages'] .= 'Amount: <em class="text-primary">' . number_format($amount,2) . '</em><br>';
								$response_arr['messages'] .= 'Date Initiated: <em class="text-primary">' .$date_initiated . '</em>';
								// $response_arr['messages'] .= 'Description: <em class="text-primary">' . $description . '</em>';
								
							}
						}	

						
						echo json_encode($response_arr);
					}
				}
			}


			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "verify_decoder_number" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['local_government'] = $user->local_government;
						$data['city'] = $user->city;
						$data['address'] = $user->address;
						$data['place_of_use'] = $user->place_of_use;
						$data['whatsapp_user'] = $user->whatsapp_user;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					$date = date("j M Y");
					$time = date("h:i:sa");
					
					if($this->input->post('type') && $this->input->post('iuc_no')){
						
						$type = $this->input->post('type');
						$iuc_no = $this->input->post('iuc_no');
						// echo $this->input->post('amount') . "<br>";
						if($type == "dstv" || $type == "gotv"){
							$response_arr = array('success' => false,'messages' => '','customer_name' => '','invalid_user' => false);
							
							
							if($type == "dstv"){
								$type = "DSTV";
							}else if($type == "gotv"){
								$type = "GOTV";
							}

							

							$url = "https://www.payscribe.ng/api/validate/multichoice/";
							$use_post = true;
							$post_data = array(
								'multichoice_type' => $type,
								'smart_card_no' => $iuc_no
							);
							$response = $this->northbridge_model->payscribeVtuCurl($url,$use_post,$post_data);

							if($this->northbridge_model->isJson($response)){
								$response = json_decode($response);
								if($response->status == true && $response->status_code == 200){
									$customer_name = $response->message->details->customer_smart_card_name;
									$bouquets = $response->message->details->bouquets;
									$productCode = $response->message->details->productCode;
									if(is_array($bouquets)){
										$response_arr['success'] = true;
										$response_arr['customer_name'] = $customer_name;
										$response_arr['productCode'] = $productCode;

										$j = 0;
										$response_arr['messages'] .= '<p class="text-secondary">Select Package To Proceed</p>';
										$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive">';

						        		$response_arr['messages'] .= '<table class="table table-striped table-bordered wrap hover display" id="packages-table" cellspacing="0" width="100%" style="width:100%">';
						        		$response_arr['messages'] .= '<thead>';
						        		$response_arr['messages'] .= '<tr>';
						        		$response_arr['messages'] .= '<th>#</th>';
						        		$response_arr['messages'] .= '<th>Package Name</th>';
						        		$response_arr['messages'] .= '<th>(₦) Cost</th>';
						        		
						        		$response_arr['messages'] .= '</tr>';
						        		$response_arr['messages'] .= '<tbody>';

						        		
										for($i = 0; $i < count($bouquets); $i++){
											$j++;

											$package_id = $bouquets[$i]->product_code;
											$package_name = $bouquets[$i]->name;
											$package_amount = $bouquets[$i]->amount;

											$response_arr['messages'] .= '<tr data-package-id="'.$package_id.'" onclick="selectTVPackage(this,event)" data-type="'.$type.'" data-package-name="'.$package_name.'" data-amount="'.$package_amount.'" data-iuc-no="'.$iuc_no.'">';
						        			$response_arr['messages'] .= '<td>'.$j.'</td>';
						        			$response_arr['messages'] .= '<td>'.$package_name.'</td>';
						        			$response_arr['messages'] .= '<td>'.number_format($package_amount).'</td>';
						        			$response_arr['messages'] .= '</tr>';
										}

										$response_arr['messages'] .= '</tbody>';
										$response_arr['messages'] .= '</table>';
										$response_arr['messages'] .= '</div>';
									}
								}else{
									$response_arr['invalid_user'] = true;
								}
							}	

							
							
						}else if($type == "startimes"){
							$response_arr = array('success' => false,'messages' => '','customer_name' => '','invalid_user' => false);
							$type = "STARTIMES";
							
							$url = "https://www.payscribe.ng/api/validate/startimes/";
							$use_post = true;
							$post_data = array(
								'smart_card_no' => $iuc_no
							);
							$response = $this->northbridge_model->payscribeVtuCurl($url,$use_post,$post_data);

							if($this->northbridge_model->isJson($response)){
								$response = json_decode($response);
								if($response->status == true && $response->status_code == 200){
									$customer_name = $response->message->details->customer_smart_card_name;
									$bouquets = $response->message->details->bouquets;
									$productCode = $response->message->details->productCode;
									if(is_array($bouquets)){
										$response_arr['success'] = true;
										$response_arr['customer_name'] = $customer_name;
										$response_arr['productCode'] = $productCode;

										$j = 0;
										$response_arr['messages'] .= '<p class="text-secondary">Select Package To Proceed</p>';
										$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive">';

						        		$response_arr['messages'] .= '<table class="table table-striped table-bordered wrap hover display" id="packages-table" cellspacing="0" width="100%" style="width:100%">';
						        		$response_arr['messages'] .= '<thead>';
						        		$response_arr['messages'] .= '<tr>';
						        		$response_arr['messages'] .= '<th>#</th>';
						        		$response_arr['messages'] .= '<th>Package Name</th>';
						        		$response_arr['messages'] .= '<th>(₦) Cost</th>';
						        		
						        		$response_arr['messages'] .= '</tr>';
						        		$response_arr['messages'] .= '<tbody>';

						        		
										for($i = 0; $i < count($bouquets); $i++){
											$j++;

											
											$package_name = $bouquets[$i]->name;
											$cycles = $bouquets[$i]->cycles;

											$response_arr['messages'] .= '<tr>';
						        			$response_arr['messages'] .= '<td style="font-weight: bold;">'.$j.'. </td>';
						        			$response_arr['messages'] .= '<td style="font-weight: bold;">'.$package_name.'</td>';
						        			$response_arr['messages'] .= '<td></td>';
						        			
						        			$response_arr['messages'] .= '</tr>';

						        			
											
											
											$package_amount = $cycles->daily;

											$response_arr['messages'] .= '<tr onclick="selectTVPackage(this,event)" data-type="'.$type.'" data-package-id="'.$package_name.'" data-package-name="'.$package_name.'" data-amount="'.$package_amount.'" data-iuc-no="'.$iuc_no.'">';
						        			$response_arr['messages'] .= '<td>i.</td>';
						        			$response_arr['messages'] .= '<td>Daily</td>';
						        			$response_arr['messages'] .= '<td>'.$package_amount.'</td>';
						        			
						        			$response_arr['messages'] .= '</tr>';


						        			
											$package_amount = $cycles->weekly;

											$response_arr['messages'] .= '<tr onclick="selectTVPackage(this,event)" data-type="'.$type.'" data-package-id="'.$package_name.'" data-package-name="'.$package_name.'" data-amount="'.$package_amount.'" data-iuc-no="'.$iuc_no.'">';
						        			$response_arr['messages'] .= '<td>ii.</td>';
						        			$response_arr['messages'] .= '<td>Weekly</td>';
						        			$response_arr['messages'] .= '<td>'.$package_amount.'</td>';
						        			
						        			$response_arr['messages'] .= '</tr>';


						        			
											$package_amount = $cycles->monthly;

											$response_arr['messages'] .= '<tr onclick="selectTVPackage(this,event)" data-type="'.$type.'" data-package-id="'.$package_name.'" data-package-name="'.$package_name.'" data-amount="'.$package_amount.'" data-iuc-no="'.$iuc_no.'">';
						        			$response_arr['messages'] .= '<td>iii.</td>';
						        			$response_arr['messages'] .= '<td>Monthly</td>';
						        			$response_arr['messages'] .= '<td>'.$package_amount.'</td>';
						        			
						        			$response_arr['messages'] .= '</tr>';

						        			
										}

										$response_arr['messages'] .= '</tbody>';
										$response_arr['messages'] .= '</table>';
										$response_arr['messages'] .= '</div>';
									}
								}else{
									$response_arr['invalid_user'] = true;
								}
							}	
						}

						echo json_encode($response_arr);
					}
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "verify_electricity_details" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['local_government'] = $user->local_government;
						$data['city'] = $user->city;
						$data['address'] = $user->address;
						$data['place_of_use'] = $user->place_of_use;
						$data['whatsapp_user'] = $user->whatsapp_user;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					$date = date("j M Y");
					$time = date("h:i:sa");
					
					if($this->input->post('disco') && $this->input->post('meter_type')){
						$disco = $this->input->post('disco');
						$meter_type = $this->input->post('meter_type');
						// echo $this->input->post('amount') . "<br>";
						if($disco == "EKO_ELECTRIC" || $disco == "IKEJA_ELECTRIC" || $disco == "ABUJA_ELECTRIC" || $disco == "KANO_ELECTRIC" || $disco == "JOS_ELECTRIC" || $disco == "IBADAN_ELECTRIC" || $disco == "ENUGU_ELECTRIC" || $disco == "PHC_ELECTRIC"){
							$response_arr = array('success' => false,'customer_name' => '','invalid_user' => false);

							
							$meter_no = $this->input->post('meter_no');
								
							if($disco == "EKO_ELECTRIC"){
								$disco_code = "01";
							}else if($disco == "IKEJA_ELECTRIC"){
								$disco_code = "02";
							}else if($disco == "ABUJA_ELECTRIC"){
								$disco_code = "03";
							}else if($disco == "KANO_ELECTRIC"){
								$disco_code = "04";
							}else if($disco == "JOS_ELECTRIC"){
								$disco_code = "06";
							}else if($disco == "IBADAN_ELECTRIC"){
								$disco_code = "07";
							}else if($disco == "ENUGU_ELECTRIC"){
								$disco_code = "09";
							}else if($disco == "PHC_ELECTRIC"){
								$disco_code = "05";
							}

							if($meter_type == "prepaid"){
								$meter_type = "01";
							}else if($meter_type == "postpaid"){
								$meter_type = "02";
							}

							

							$url = "https://www.nellobytesystems.com/APIVerifyElectricityV1.asp?UserID=CK10153218&APIKey=UYV68HTPI15IFS0T8C94HC55PP7UCK44E11O033OAAEW7604BM3S7N50EE483649&ElectricCompany=".$disco_code."&meterno=".$meter_no;
							// echo $url;
							$use_post = true;

							$response = $this->northbridge_model->vtu_curl($url,$use_post,$post_data=[]);

							if($this->northbridge_model->isJson($response)){
								$response = json_decode($response);
								// var_dump($response);
								if(is_object($response)){
									$customer_name = $response->customer_name;
									
									if($customer_name != ""){
										$response_arr['success'] = true;
										$response_arr['customer_name'] = $customer_name;	
									}else{
										$response_arr['invalid_user'] = true;
									}
								}else{

								}
							}
						}

						echo json_encode($response_arr);
					}
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "buy_electricity_vtu" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['local_government'] = $user->local_government;
						$data['city'] = $user->city;
						$data['address'] = $user->address;
						$data['place_of_use'] = $user->place_of_use;
						$data['whatsapp_user'] = $user->whatsapp_user;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					$date = date("j M Y");
					$time = date("h:i:sa");
					
					if($this->input->post('disco') && $this->input->post('meter_type')){
						$disco = $this->input->post('disco');
						$meter_type = $this->input->post('meter_type');
						// echo $this->input->post('amount') . "<br>";
						if($disco == "EKO_ELECTRIC" || $disco == "IKEJA_ELECTRIC" || $disco == "IBADAN_ELECTRIC" || $disco == "ENUGU_ELECTRIC" || $disco == "JOS_ELECTRIC" || $disco == "ABUJA_ELECTRIC" || $disco == "PHC_ELECTRIC" || $disco == "KADUNA_ELECTRIC" || $disco == "KANO_ELECTRIC"){
							$response_arr = array('success' => false,'messages' => '','insuffecient_funds' => false,'order_id' => '','invalid_meterno' => false,'meter_type_not_available' => false,'metertoken' => '');

							$this->form_validation->set_rules('amount','Amount','trim|required|numeric|greater_than_equal_to[300]|less_than_equal_to[20000]');
							$this->form_validation->set_rules('meter_no','Meter No.','trim|required|numeric');
							$this->form_validation->set_rules('phone_number','Mobile Number','trim|required|numeric|exact_length[11]');
							$this->form_validation->set_rules('email','Email','trim|required|valid_email');
							$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
							if($this->form_validation->run() == TRUE){
								$amount = $this->input->post('amount');
								$meter_no = $this->input->post('meter_no');
								$phone_number = $this->input->post('phone_number');
								$email = $this->input->post('email');

								$amount_to_debit_user = $amount;
								$user_total_amount = $this->northbridge_model->getUserTotalAmountByUse($user_id);
								// echo $user_total_amount;
								// echo $amount;

								$meter_type = strtolower($meter_type);

								if($amount_to_debit_user <= $user_total_amount){
									
									if($disco == "EKO_ELECTRIC"){
										$disco_code = "EKO";
									}else if($disco == "IKEJA_ELECTRIC"){
										$disco_code = "IKEJA";
									}else if($disco == "ABUJA_ELECTRIC"){
										$disco_code = "ABUJA";
									}else if($disco == "IBADAN_ELECTRIC"){
										$disco_code = "IBADAN";
									}else if($disco == "ENUGU_ELECTRIC"){
										$disco_code = "ENUGU";
									}else if($disco == "PHC_ELECTRIC"){
										$disco_code = "PH";
									}else if($disco == "KANO_ELECTRIC"){
										$disco_code = "KANO";
									}else if($disco == "KADUNA_ELECTRIC"){
										$disco_code = "KADUNA";
									}else if($disco == "JOS_ELECTRIC"){
										$disco_code = "JOS";
									}


									$url = "https://api.buypower.ng/v2/vend";
									$use_post = true;

									$order_id = "BP" . mt_rand(10000000, 99999999);

									$post_data = array(
										'meter' => $meter_no,
										'disco' => $disco_code,
										'vendType' => $meter_type,
										'orderId' => $order_id,
										'phone' => $phone_number,
										'paymentType' => 'ONLINE',
										'amount' => $amount,
										'email' => $email
									);

									if($this->northbridge_model->debitUser($user_id,$amount_to_debit_user)){

										$response = $this->northbridge_model->buyPowerVtuCurl($url,$use_post,$post_data);

										if($this->northbridge_model->isJson($response)){
											$response = json_decode($response);
											if(is_object($response)){
												if(isset($response->status)){
													$status = $response->status;
												
													$metertoken = "";
													if($status == true){
														
														// if(isset($response->message->details->reference_number)){
														// 	$order_id = $response->message->details->reference_number;
														// }else{
														// 	$order_id = "";
														// }

														if(isset($response->data->token)){
															$metertoken = $response->data->token;
															$this->northbridge_model->sendMeterTokenForPrepaidToUserByNotif($user_id,$email,$date,$time,$order_id,$disco,$meter_no,$amount,$metertoken);
														}

														$form_array = array(
															'user_id' => $user_id,
															'type' => 'electricity',
															'sub_type' => $disco,
															'date' => $date,
															'time' => $time,
															'amount' => $amount,
															'number' => $meter_no,
															'order_id' => $order_id
														);
														if($this->northbridge_model->addTransactionStatus($form_array)){
															$response_arr['success'] = true;
															$response_arr['order_id'] = $order_id;
															$response_arr['metertoken'] = $metertoken;
														}
														
													}else{
														$this->northbridge_model->creditUser($user_id,$amount_to_debit_user);
													}
												}else{
													$this->northbridge_model->creditUser($user_id,$amount_to_debit_user);
												}
											}else{
												$this->northbridge_model->creditUser($user_id,$amount_to_debit_user);
											}
										}else{
											$this->northbridge_model->creditUser($user_id,$amount_to_debit_user);
										}

									}
									
								}else{
									$response_arr['insuffecient_funds'] = true;
								}
							}else{
								foreach($_POST as $key => $value){
									$response_arr['messages'][$key] = form_error($key);
								}
							}
						}

						// else if(){
						// 	$response_arr = array('success' => false,'messages' => '','insuffecient_funds' => false,'order_id' => '','invalid_meterno' => false,'meter_type_not_available' => false,'metertoken' => '');

						// 	$this->form_validation->set_rules('amount','Amount','trim|required|numeric|greater_than_equal_to[100]|less_than_equal_to[20000]');
						// 	$this->form_validation->set_rules('meter_no','Meter No.','trim|required|numeric');
						// 	$this->form_validation->set_rules('phone_number','Mobile Number','trim|required|numeric|exact_length[11]');
						// 	$this->form_validation->set_rules('email','Email','trim|required|valid_email');
						// 	$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
						// 	if($this->form_validation->run() == TRUE){
						// 		$amount = $this->input->post('amount');
						// 		$meter_no = $this->input->post('meter_no');
						// 		$phone_number = $this->input->post('phone_number');
						// 		$email = $this->input->post('email');

						// 		$amount_to_debit_user = $amount;
						// 		$user_total_amount = $this->northbridge_model->getUserTotalAmountByUse($user_id);
						// 		// echo $user_total_amount;
						// 		// echo $amount;

						// 		if($amount_to_debit_user <= $user_total_amount){
									
						// 			if($disco == "JOS_ELECTRIC"){
						// 				$disco_code = "06";
						// 			}elseif($disco == "ABUJA_ELECTRIC"){
						// 				$disco_code = "03";
						// 			}elseif($disco == "PHC_ELECTRIC"){
						// 				$disco_code = "05";
						// 			}
									

						// 			if($meter_type == "prepaid"){
						// 				$meter_type = "01";
						// 			}else if($meter_type == "postpaid"){
						// 				$meter_type = "02";
						// 			}


						// 			$url = "https://www.nellobytesystems.com/APIElectricityV1.asp?UserID=CK10153218&APIKey=UYV68HTPI15IFS0T8C94HC55PP7UCK44E11O033OAAEW7604BM3S7N50EE483649&ElectricCompany=" . $disco_code . "&MeterType=" . $meter_type . "&MeterNo=" . $meter_no . "&Amount=" . $amount;
						// 			$use_post = true;

						// 			$response = $this->northbridge_model->vtu_curl($url,$use_post,$post_data=[]);

						// 			if($this->northbridge_model->isJson($response)){
						// 				$response = json_decode($response);
						// 				if(is_object($response)){
						// 					$status = $response->status;
						// 					$metertoken = "";
						// 					if($status == "ORDER_RECEIVED"){
						// 						if($this->northbridge_model->debitUser($user_id,$amount_to_debit_user)){
						// 							if(isset($response->transactionid)){
						// 								$order_id = $response->transactionid;
						// 							}else{
						// 								$order_id = "";
						// 							}

						// 							if(isset($response->metertoken)){
						// 								$metertoken = $response->metertoken;
						// 							}

						// 							$form_array = array(
						// 								'user_id' => $user_id,
						// 								'type' => 'electricity',
						// 								'sub_type' => $disco,
						// 								'date' => $date,
						// 								'time' => $time,
						// 								'amount' => $amount,
						// 								'number' => $meter_no,
						// 								'order_id' => $order_id
						// 							);
						// 							if($this->northbridge_model->addTransactionStatus($form_array)){
						// 								$response_arr['success'] = true;
						// 								$response_arr['order_id'] = $order_id;
						// 								// $response_arr['metertoken'] = $metertoken;
						// 								$vtu_id = $this->northbridge_model->getVtuIdByOrderId($order_id);
						// 								if($vtu_id != "" && $meter_type == "01"){
						// 									$this->northbridge_model->sendMeterTokenForPrepaidToUserByNotif($user_id,$date,$time,$order_id,$disco,$meter_no,$amount);

						// 									$this->northbridge_model->sendAdminEmailToNotifyAboutNewPrepaidElectricity($vtu_id,$user_id,$date,$time,$order_id,$disco,$meter_no,$amount,$phone_number,$email);
						// 								}
						// 							}
						// 						}
						// 					}else if($status == "INVALID_MeterNo"){
						// 						$response_arr['invalid_meterno'] = true;
												
						// 					}else if($status == "MeterType_NOT_AVAILABLE"){
						// 						$response_arr['meter_type_not_available'] = true;
												
						// 					}else if($status == "INSUFFICIENT_BALANCE"){
						// 						// $response_arr['invalid_recipient'] = true;
												
						// 					}else if($status == "INVALID_CREDENTIALS"){
						// 						// $response_arr['invalid_recipient'] = true;
						// 						// echo "string";
												
						// 					}
						// 				}
						// 			}
									
						// 		}else{
						// 			$response_arr['insuffecient_funds'] = true;
						// 		}
						// 	}else{
						// 		foreach($_POST as $key => $value){
						// 			$response_arr['messages'][$key] = form_error($key);
						// 		}
						// 	}
						// }
						echo json_encode($response_arr);
					}
				}
			}


			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "check_if_disco_is_available" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['local_government'] = $user->local_government;
						$data['city'] = $user->city;
						$data['address'] = $user->address;
						$data['place_of_use'] = $user->place_of_use;
						$data['whatsapp_user'] = $user->whatsapp_user;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					$date = date("j M Y");
					$time = date("h:i:sa");
					
					if($this->input->post('disco')){
						$disco = $this->input->post('disco');
						$response_arr = array('success' => false);
						// echo $this->input->post('amount') . "<br>";
						if($disco == "EKO_ELECTRIC" || $disco == "IKEJA_ELECTRIC" || $disco == "IBADAN_ELECTRIC" || $disco == "ENUGU_ELECTRIC" || $disco == "JOS_ELECTRIC" || $disco == "ABUJA_ELECTRIC" || $disco == "PHC_ELECTRIC" || $disco == "KADUNA_ELECTRIC" || $disco == "KANO_ELECTRIC"){
							

								
							if($disco == "EKO_ELECTRIC"){
								$disco_code = "EKO";
							}else if($disco == "IKEJA_ELECTRIC"){
								$disco_code = "IKEJA";
							}else if($disco == "ABUJA_ELECTRIC"){
								$disco_code = "ABUJA";
							}else if($disco == "IBADAN_ELECTRIC"){
								$disco_code = "IBADAN";
							}else if($disco == "ENUGU_ELECTRIC"){
								$disco_code = "ENUGU";
							}else if($disco == "PHC_ELECTRIC"){
								$disco_code = "PH";
							}else if($disco == "KANO_ELECTRIC"){
								$disco_code = "KANO";
							}else if($disco == "KADUNA_ELECTRIC"){
								$disco_code = "KADUNA";
							}else if($disco == "JOS_ELECTRIC"){
								$disco_code = "JOS";
							}


							$url = "https://api.buypower.ng/v2/discos/status";
							$use_post = false;


							$response = $this->northbridge_model->buyPowerVtuCurl($url,$use_post);

							if($this->northbridge_model->isJson($response)){
								$response = json_decode($response);
								if(is_object($response)){

									if(isset($response->$disco_code)){
										$status = $response->$disco_code;
										if($status){
											$response_arr['success'] = true;
										}
										
									}
											
								}
							}
						}
						echo json_encode($response_arr);
					}
				}
			}

			
			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "recharge_decoder" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['local_government'] = $user->local_government;
						$data['city'] = $user->city;
						$data['address'] = $user->address;
						$data['place_of_use'] = $user->place_of_use;
						$data['whatsapp_user'] = $user->whatsapp_user;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					$date = date("j M Y");
					$time = date("h:i:sa");
					
					if($this->input->post('multichoice_type') && $this->input->post('smart_card_no') && $this->input->post('amount') && $this->input->post('product_code')){
						
						$multichoice_type = $this->input->post('multichoice_type');
						$smart_card_no = $this->input->post('smart_card_no');
						$amount = $this->input->post('amount');
						$product_code = $this->input->post('product_code');
						$package_name = $this->input->post('package_name');

						
						// echo $this->input->post('amount') . "<br>";
						if($multichoice_type == "DSTV" || $multichoice_type == "GOTV"){
							$response_arr = array('success' => false,'insuffecient_funds' => false,'order_id' => '','invalid_no' => false);
								
								
							
							$url = "https://www.payscribe.ng/api/validate/multichoice/";
							$use_post = true;
							$post_data = array(
								'multichoice_type' => $multichoice_type,
								'smart_card_no' => $smart_card_no
							);
							$response = $this->northbridge_model->payscribeVtuCurl($url,$use_post,$post_data);

							if($this->northbridge_model->isJson($response)){
								$response = json_decode($response);

								if($response->status == true && $response->status_code == 200){
									$customer_name = $response->message->details->customer_smart_card_name;
									$bouquets = $response->message->details->bouquets;
									$productCode = $response->message->details->productCode;
									if(is_array($bouquets)){

										
										for($i = 0; $i < count($bouquets); $i++){
											$package_id = $bouquets[$i]->product_code;
											$package_name = $bouquets[$i]->name;
											$package_amount = $bouquets[$i]->amount;

											if($package_id == $product_code){
												$amount = $package_amount;

												$amount_to_debit_user = $amount;
												$user_total_amount = $this->northbridge_model->getUserTotalAmountByUse($user_id);
												// echo $user_total_amount;
												// echo $amount;

												if($amount_to_debit_user <= $user_total_amount){
													
													$url = "https://www.payscribe.ng/api/multichoice/payment/";
													$use_post = true;
													
													$transaction_id = "PS" . mt_rand(10000000, 99999999);

													$post_data = array(
														'multichoice_type' => $multichoice_type,
														'smart_card_no' => $smart_card_no,
														'amount' => $amount,
														'product_code' => $package_id,
														'productCode' => $productCode,
														'transaction_id' => $transaction_id
													);
													if($this->northbridge_model->debitUser($user_id,$amount_to_debit_user)){

														$response = $this->northbridge_model->payscribeVtuCurl($url,$use_post,$post_data);

														if($this->northbridge_model->isJson($response)){
															$response = json_decode($response);
															if(is_object($response)){
																$status = $response->status;
																$status_code = $response->status_code;

																if($status == true && $status_code == 200){
																	
																	$order_id = $response->message->details->transaction_id;
																	$form_array = array(
																		'user_id' => $user_id,
																		'type' => 'cable tv',
																		'sub_type' => $multichoice_type,
																		'number' => $smart_card_no,
																		'date' => $date,
																		'time' => $time,
																		'amount' => $amount_to_debit_user,
																		'order_id' => $order_id
																	);
																
																	if($this->northbridge_model->addTransactionStatus($form_array)){
																		$response_arr['success'] = true;
																		$response_arr['order_id'] = $order_id;
																	}
																	
																}else{
																	$this->northbridge_model->creditUser($user_id,$amount_to_debit_user);
																}
															}else{
																$this->northbridge_model->creditUser($user_id,$amount_to_debit_user);
															}
														}else{
															$this->northbridge_model->creditUser($user_id,$amount_to_debit_user);
														}
													}
												}else{
													$response_arr['insuffecient_funds'] = true;
												}
											}
										}
									}
								}else{
									$response_arr['invalid_no'] = true;
								}
							}		
						}elseif($multichoice_type == "STARTIMES"){
							$response_arr = array('success' => false,'insuffecient_funds' => false,'order_id' => '','invalid_no' => false);
								
							$url = "https://www.payscribe.ng/api/validate/startimes/";
							$use_post = true;
							$post_data = array(
								'smart_card_no' => $smart_card_no
							);
							$response = $this->northbridge_model->payscribeVtuCurl($url,$use_post,$post_data);

							if($this->northbridge_model->isJson($response)){
								$response = json_decode($response);

								if($response->status == true && $response->status_code == 200){
									$customer_name = $response->message->details->customer_smart_card_name;
									$bouquets = $response->message->details->bouquets;
									$productCode = $response->message->details->productCode;

									$amount_to_debit_user = $amount;
									$user_total_amount = $this->northbridge_model->getUserTotalAmountByUse($user_id);
									// echo $user_total_amount;
									// echo $amount;

									if($amount_to_debit_user <= $user_total_amount){
										
										$url = "https://www.payscribe.ng/api/startimes/payment/";
										$use_post = true;
										
										$transaction_id = "PS" . mt_rand(10000000, 99999999);

										$post_data = array(
											'multichoice_type' => "STARTIMES",
											'smart_card_no' => $smart_card_no,
											'amount' => $amount,
											'product_code' => $package_name,
											'productCode' => $productCode,
											'transaction_id' => $transaction_id
										);
										if($this->northbridge_model->debitUser($user_id,$amount_to_debit_user)){

											$response = $this->northbridge_model->payscribeVtuCurl($url,$use_post,$post_data);

											if($this->northbridge_model->isJson($response)){
												$response = json_decode($response);
												if(is_object($response)){
													$status = $response->status;
													$status_code = $response->status_code;

													if($status == true && $status_code == 200){
														
														$order_id = $response->message->details->transaction_id;
														$form_array = array(
															'user_id' => $user_id,
															'type' => 'cable tv',
															'sub_type' => $multichoice_type,
															'number' => $smart_card_no,
															'date' => $date,
															'time' => $time,
															'amount' => $amount_to_debit_user,
															'order_id' => $order_id
														);
													
														if($this->northbridge_model->addTransactionStatus($form_array)){
															$response_arr['success'] = true;
															$response_arr['order_id'] = $order_id;
														}
														
													}else{
														$this->northbridge_model->creditUser($user_id,$amount_to_debit_user);
													}
												}else{
													$this->northbridge_model->creditUser($user_id,$amount_to_debit_user);
												}
											}else{
												$this->northbridge_model->creditUser($user_id,$amount_to_debit_user);
											}
										}
									}else{
										$response_arr['insuffecient_funds'] = true;
									}
								}
							}
							
									
						}

						echo json_encode($response_arr);
					}
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "get_center_leaders_in_local_govt" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['local_government'] = $user->local_government;
						$data['city'] = $user->city;
						$data['address'] = $user->address;
						$data['place_of_use'] = $user->place_of_use;
						$data['whatsapp_user'] = $user->whatsapp_user;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					
					$response_arr = array('success' => false,'messages' => '');

					if($this->input->post('local_government_id')){
						$local_government_id = $this->input->post('local_government_id');

						if($this->northbridge_model->checkIfLocalGovtIdIsValid($local_government_id)){
							$response_arr['success'] = true;

							$center_leaders = $this->northbridge_model->getCenterLeadersInLocalGovt($local_government_id);
							if(is_array($center_leaders)){
								$response_arr['messages'] .= '<div class="text-center">';
                				$response_arr['messages'] .= '<span class="text-center heading-text">'.count($center_leaders).' CENTER LEADER(S) FOUND</span>';
                				$response_arr['messages'] .= '<span class="text-secondary" style="font-weight: bold;">Please Select Center Leader To Proceed</span>';
              					$response_arr['messages'] .= '</div>';

              					$response_arr['messages'] .= '<div class="center-leaders" style="border: 0;">';
								foreach($center_leaders as $row){
									$center_leader_user_id = $row->id;
									$center_leader_logo = $row->logo;
									$center_leader_full_name = $row->full_name;
									$center_leader_user_name = $row->user_name;
									$center_leader_town = $row->city;
									$center_leader_address = $row->address;
									$center_leader_phone_code = $row->phone_code;
									$center_leader_phone_number = $row->phone;

									$center_leader_slug = url_title($center_leader_user_name);

									if(is_null($center_leader_logo)){
										$center_leader_logo = 'avatar.jpg';
									}

									

									$response_arr['messages'] .= '<div class="card" style="padding-top: 10px; padding-bottom: 10px; ">';
                      				$response_arr['messages'] .= '<div class="card-body">';

                        			$response_arr['messages'] .= '<div class="row" style="width: 100%;">';
                          			$response_arr['messages'] .= '<div class="col-3">';
                            		$response_arr['messages'] .= '<img style="width: 100px;" src="'.base_url('assets/images/'.$center_leader_logo).'" class="col-12 img-round" alt="">';
                          			$response_arr['messages'] .= '</div>';

                          			$response_arr['messages'] .= '<div class="col-9">';
                            		$response_arr['messages'] .= '<span class="name"><a href="'.site_url('northbridge/'.$center_leader_slug).'" target="_blank">'.$center_leader_full_name.'</a></span>';
                            		$response_arr['messages'] .= '<div class="">';
                              		$response_arr['messages'] .= '<span class="town-label" style="font-weight: bold;">Town: </span>';
                              		$response_arr['messages'] .= '<span class="town-val" >'.$center_leader_town.'</span>';
                            		$response_arr['messages'] .= '</div>';
                            		$response_arr['messages'] .= '<div class="">';
                              		$response_arr['messages'] .= '<span class="address-label" style="font-weight: bold;">Address: </span>';
                              		$response_arr['messages'] .= '<span class="address-val">'.$center_leader_address.'</span>';
                            		$response_arr['messages'] .= '</div>';
                            		$response_arr['messages'] .= '<div class="">';
                              		$response_arr['messages'] .= '<span class="phone-label" style="font-weight: bold;">Phone: </span>';
                              		$response_arr['messages'] .= '<span class="phone-val">+'.$center_leader_phone_code. '' .$center_leader_phone_number.'</span>';
                            		$response_arr['messages'] .= '</div>';
                            		$response_arr['messages'] .= '<button onclick="proceedToPayment(this,event,'.$center_leader_user_id.')" class="btn btn-success btn-round">';
                              		$response_arr['messages'] .= '<i class="fas fa-hand-pointer" style="color: #fff;"></i> Select';
                            		$response_arr['messages'] .= '</button>';
                          			$response_arr['messages'] .= '</div>';
                        			$response_arr['messages'] .= '</div>';

                      				$response_arr['messages'] .= '</div>';
                    				$response_arr['messages'] .= '</div>';
								}
								$response_arr['messages'] .= '</div>';
							}else{
								$response_arr['messages'] .= '<h4 class="text-warning">No Center Leaders In This Location.</h4>';
							}
						}
					}

					echo json_encode($response_arr);
				}
			}


			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "mini_importation" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['local_government'] = $user->local_government;
						$data['city'] = $user->city;
						$data['address'] = $user->address;
						$data['place_of_use'] = $user->place_of_use;
						$data['whatsapp_user'] = $user->whatsapp_user;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					
					$this->load->view('includes/admin_header',$data);
		            $this->load->view('pages/mini_importation',$data);
		            $this->load->view('includes/admin_footer',$data);	

				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $this->northbridge_model->checkIfUserIsAdmin() && $addition == "admin_mini_importation" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['local_government'] = $user->local_government;
						$data['city'] = $user->city;
						$data['address'] = $user->address;
						$data['place_of_use'] = $user->place_of_use;
						$data['whatsapp_user'] = $user->whatsapp_user;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}

					$response_arr = array('success' => false,'messages' => '','full_name' => '','invalid_user' => false,'already_assigned' => false);

					if(isset($_GET['open_products_on_way_to_center_leader_info']) && isset($_GET['center_leader_id']) && isset($_GET['product_id'])){

						$product_id = $_GET['product_id'];
						$center_leader_id = $_GET['center_leader_id'];

						$center_leader_ids = $this->northbridge_model->getMiniImportationCenterLeaderUserIds1($product_id,$center_leader_id);

	        			if(is_array($center_leader_ids) && count($center_leader_ids) == 1){
	        				for($i = 0; $i < count($center_leader_ids); $i++){
	        					
	        					$center_leader_id = $center_leader_ids[$i];
	        					$product_name = $this->northbridge_model->getProductParamByIdMiniImportation("name",$product_id);
	        					$center_leader_user_name = $this->northbridge_model->getUserNameById($center_leader_id);

	        					$quantity = $this->northbridge_model->getMiniImportationProductQuantityComingToCenterLeader($product_id,$center_leader_id);
	        					$center_leader_state = $this->northbridge_model->getUserParamById("state_id",$center_leader_id);
	        					$center_leader_local_govt = $this->northbridge_model->getUserParamById("local_government",$center_leader_id);
	        					$center_leader_slug = $this->northbridge_model->getUserParamById("slug",$center_leader_id);
	        					$center_leader_full_name = $this->northbridge_model->getUserParamById("full_name",$center_leader_id);
	        					$center_leader_city = $this->northbridge_model->getUserParamById("city",$center_leader_id);
	        					$center_leader_address = $this->northbridge_model->getUserParamById("address",$center_leader_id);
	        					$center_leader_country = $this->northbridge_model->getUserParamById("country_id",$center_leader_id);

	        					$center_leader_country = $this->northbridge_model->getCountryById($center_leader_country);

	        					$center_leader_local_govt = $this->northbridge_model->getLocalGovernmentByStateIdAndId($center_leader_state,$center_leader_local_govt);
	        					$center_leader_state = $this->northbridge_model->getStateById($center_leader_state);

	        					$current_status = $this->northbridge_model->getMiniImportationOrderCurrentStatus($center_leader_id,$product_id);

	        					if($current_status == ""){
	        						$current_status = "No Status Entered Here";
	        					}

	        					$response_arr['messages'] .= '<div class="container">';

	        					$response_arr['messages'] .= '<div id="center-leader-info-div">';

								$response_arr['messages'] .= '<h3>Product Name: </h3>';	        					
								$response_arr['messages'] .= '<p >'.$product_name.'</p>';	 

								$response_arr['messages'] .= '<h3>Product Quantity: </h3>';	        					
								$response_arr['messages'] .= '<p >'.$quantity.'</p>';	 

								$response_arr['messages'] .= '<h3>Center Leader Name: </h3>';
								$response_arr['messages'] .= '<p >'.$center_leader_full_name.'</p>';
								$response_arr['messages'] .= '<h3>Center Leader Username: </h3>';
								$response_arr['messages'] .= '<p ><a target="_blank" href="'.site_url("northbridge/".$center_leader_slug).'">'.$center_leader_user_name.'</a></p>';

								$response_arr['messages'] .= '<h3>Center Leader Country: </h3>';
								$response_arr['messages'] .= '<p >'.$center_leader_country.'</p>';

								$response_arr['messages'] .= '<h3>Center Leader State: </h3>';
								$response_arr['messages'] .= '<p >'.$center_leader_state.'</p>';

								$response_arr['messages'] .= '<h3>Center Leader Local Government: </h3>';
								$response_arr['messages'] .= '<p >'.$center_leader_local_govt.'</p>';

								$response_arr['messages'] .= '<h3>Center Leader City: </h3>';
								$response_arr['messages'] .= '<p >'.$center_leader_city.'</p>';

								$response_arr['messages'] .= '<h3>Center Leader Address: </h3>';
								$response_arr['messages'] .= '<p >'.$center_leader_address.'</p>';

								$response_arr['messages'] .= '</div>';


								$response_arr['messages'] .= '<div id="order-status-div">';
								$response_arr['messages'] .= '<h3 class="text-center" style="font-weight: bold;">Order Status</h3>';

								$order_statuses = $this->northbridge_model->getMiniImportationOrderStatusesByProductIdAndCenterLeaderId($product_id,$center_leader_id);
								if(is_array($order_statuses)){
									

									$i = 0;

									$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="margin-top: 40px;">';
					        		$response_arr['messages'] .= '<table class="table table-striped table-bordered wrap hover display" id="statuses-table" cellspacing="0" width="100%" style="width:100%">';
					        		$response_arr['messages'] .= '<thead>';
					        		$response_arr['messages'] .= '<tr>';
					        		$response_arr['messages'] .= '<th>#</th>';
					        		$response_arr['messages'] .= '<th>Status</th>';
					        		$response_arr['messages'] .= '<th>Date / Time</th>';
					        		$response_arr['messages'] .= '<th>Actions</th>';
					        		$response_arr['messages'] .= '</tr>';
					        		$response_arr['messages'] .= '<tbody>';

					        		foreach($order_statuses as $row){
					        			$i++;
					        			$id = $row->id;
					        			$status = $row->status;
					        			$date = $row->date;
					        			$time = $row->time;

					        			$response_arr['messages'] .= '<tr>';

					        			$response_arr['messages'] .= '<td>'.$i.'</td>';
					        			$response_arr['messages'] .= '<td>'.$status.'</td>';	
					        			$response_arr['messages'] .= '<td>'.$date. ' ' . $time .'</td>';
					        			$response_arr['messages'] .= '<td class="td-actions text-center">';
					                   	$response_arr['messages'] .= '<button type="button" rel="tooltip" title="Delete Status" class="btn btn-danger btn-link btn-lg" onclick="deleteStatus(this,event,'.$id.')">';
					                   	$response_arr['messages'] .= '<i class="fas fa-trash"></i>';
					                    $response_arr['messages'] .= '<div class="ripple-container"></div>';
					                    $response_arr['messages'] .= '</button>';
					                    $response_arr['messages'] .= '</td>';


					        			$response_arr['messages'] .= '</tr>';
					        		}

					        		$response_arr['messages'] .= '</tbody>';
					        		$response_arr['messages'] .= '</table>';
					        		$response_arr['messages'] .= '</div>';
								}else{
									$response_arr['messages'] .= '<h4 class="text-warning">No Status To Display Here. Click On The Floating Add Button To Add.</h4>';
								}
								$response_arr['messages'] .= '</div>';



								$response_arr['messages'] .= '<div id="select-dispatcher-div">';
								$response_arr['messages'] .= '<h3 class="text-center">Dispatcher Details</h3>';

								if($this->northbridge_model->checkIfProductForCenterLeaderHasBeenGivenADispatcher($product_id,$center_leader_id)){
									$response_arr['no_status'] = true;
									$dispatcher_id = $this->northbridge_model->getDispatcherIdForProductForCenterLeader($product_id,$center_leader_id);
									$dispatcher_full_name = $this->northbridge_model->getUserParamById("full_name",$dispatcher_id);

									$dispatcher_slug = $this->northbridge_model->getUserParamById("slug",$dispatcher_id);
									if($this->northbridge_model->checkIfDispatcherForProductForCenterLeaderHasApprovedReceiptOfProduct($product_id,$center_leader_id)){
										$response_arr['messages'] .= '<h4><a target="_blank" href="'.site_url('northbridge/'.$dispatcher_slug).'">'.$dispatcher_full_name.'</a> Has Accepted The Dispatch Responsibility</h4>';
									}else{
										$response_arr['messages'] .= '<h4><a target="_blank" href="'.site_url('northbridge/'.$dispatcher_slug).'">'.$dispatcher_full_name.'</a> Has Not Accepted The Dispatch Responsibility</h4>';
									}
								}else{
									$response_arr['messages'] .= '<h3 class="text-center">All Available Dispatchers</h3>';
									$response_arr['messages'] .= '<p>Click To Select Dispatcher</p>';
									$dispatchers = $this->northbridge_model->listAllDispatchers();
									if(is_array($dispatchers)){

										$j = 0;

										$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="margin-top: 40px;">';
						        		$response_arr['messages'] .= '<table class="table table-striped table-bordered wrap hover display" id="dispatchers-table" cellspacing="0" width="100%" style="width:100%">';
						        		$response_arr['messages'] .= '<thead>';
						        		$response_arr['messages'] .= '<tr>';
						        		$response_arr['messages'] .= '<th>#</th>';
						        		$response_arr['messages'] .= '<th>UserName</th>';
						        		$response_arr['messages'] .= '<th>Full Name</th>';
						        		
						        		$response_arr['messages'] .= '</tr>';
						        		$response_arr['messages'] .= '<tbody>';

						        		foreach($dispatchers as $row){
						        			$id = $row->id;
						        			$user_name = $row->user_name;
						        			$full_name = $row->full_name;
						        			$slug = $row->slug;

						        			if(!$this->northbridge_model->checkIfUserIsAdmin1($id)){
						        				$j++;
							        			$response_arr['messages'] .= '<tr data-full-name="'.$full_name.'" onclick="selectThisDispatcher(this,event,'.$id.')">';

							        			$response_arr['messages'] .= '<td>'.$j.'</td>';
							        			$response_arr['messages'] .= '<td><a href='.site_url('northbridge/'.$slug).' target="_blank">'.$user_name.'</a></td>';	
							        			$response_arr['messages'] .= '<td>'.$full_name.'</td>';
							        			


							        			$response_arr['messages'] .= '</tr>';
							        		}
						        		}	

						        		$response_arr['messages'] .= '</tbody>';
						        		$response_arr['messages'] .= '</table>';
						        		$response_arr['messages'] .= '</div>';

										$response_arr['messages'] .= '</div>';
									}else{
										$response_arr['messages'] .= '<h4 class="text-warning">No Dispatcher To Display</h4>';
									}
								}

	        					$response_arr['messages'] .= '</div>';
	        				}	
	        			}
        			}	

        			$data['response_arr'] = $response_arr;
					
					$this->load->view('includes/admin_header',$data);
		            $this->load->view('pages/admin_mini_importation',$data);
		            $this->load->view('includes/admin_footer',$data);	

				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $this->northbridge_model->checkIfUserIsAdmin() && $addition == "submit_add_new_product_form" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['local_government'] = $user->local_government;
						$data['city'] = $user->city;
						$data['address'] = $user->address;
						$data['place_of_use'] = $user->place_of_use;
						$data['whatsapp_user'] = $user->whatsapp_user;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					
					if(isset($_POST['name'])){
						$response_arr = array('success' => false,'wrong_extension' => false,'too_large' => false,'not_really_json' => false,"image_name" => '');
						
						$this->form_validation->set_rules('name','Product Name','trim|required');
						$this->form_validation->set_rules('quantity','Product Quantity','trim|numeric|required');
						$this->form_validation->set_rules('old_price','Product Old Price','trim|required|numeric');
						$this->form_validation->set_rules('new_price','Product New Price','trim|required|numeric');
						$this->form_validation->set_rules('expiry_date','Product Expiry Date','trim|required');
						$this->form_validation->set_rules('weight','Product Weight','trim|required|numeric');
						$this->form_validation->set_rules('length','Product Length','trim|required|numeric');
						$this->form_validation->set_rules('width','Product Width','trim|required|numeric');
						$this->form_validation->set_rules('height','Product Height','trim|required|numeric');
						$this->form_validation->set_rules('description','Product Description','trim|required');
						$this->form_validation->set_rules('shipping_fee','Product Shipping Fee','trim|required');
						$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
						if($this->form_validation->run() == TRUE){
						
							if(isset($_FILES['image'])){

								$real_file_name = basename($_FILES['image']['name']);
								$image_extension = strtolower(pathinfo($real_file_name,PATHINFO_EXTENSION));
								$file_size = $_FILES['image']['size'];
								// echo $file_size;
								if($image_extension == "png" || $image_extension == "jpg" || $image_extension == "jpeg" ){	
									$target_dir = "assets/images/";
									$target_file_name = bin2hex($this->encryption->create_key(16)) . ".".$image_extension;
									$target_file = $target_dir .$target_file_name;
					                
				                	if(move_uploaded_file($_FILES["image"]["tmp_name"], $target_file)){
				                		$target_file1 = base_url($target_file);
				                		if(exif_imagetype($target_file)){
				                			$date = date("j M Y");
											$time = date("h:i:sa");
											$name = $this->input->post('name');
											$quantity = $this->input->post('quantity');
											$old_price = $this->input->post('old_price');
											$new_price = $this->input->post('new_price');
											$expiry_date = $this->input->post('expiry_date');
											$weight = $this->input->post('weight');
											$height = $this->input->post('height');
											$length = $this->input->post('length');
											$width = $this->input->post('width');
											$description = $this->input->post('description');
											$shipping_fee = $this->input->post('shipping_fee');
				                			$form_array = array(
				                				'name' => $name,
				                				'quantity' => $quantity,
				                				'old_price' => $old_price,
				                				'new_price' => $new_price,
				                				'expiry_date' => $expiry_date,
				                				'weight' => $weight,
				                				'height' => $height,
				                				'length' => $length,
				                				'width' => $width,
				                				'description' => $description,
				                				'upload_date' => $date,
				                				'upload_time' => $time,
				                				'shipping_fee' => $shipping_fee,
				                				'image' => $target_file_name
				                			);

				                			if($this->northbridge_model->uploadProduct($form_array)){
					                			$response_arr['success'] = true;
					                			$response_arr['image_name'] = $target_file1;
				                			}
					                		
				                		}else{
				                			unlink($target_file);
				                			$response_arr['not_really_json'] = true;
				                		}
				                		
				                	}
					                
								}else{
									$response_arr['wrong_extension'] = true;
								}
							}else{
								$response_arr['messages']['image'] = '<p class="form-error">An Image Must Be Selected</p>';
							}
						}else{
							foreach($_POST as $key => $value){
								$response_arr['messages'][$key] = form_error($key);
							}
						}
						
						echo json_encode($response_arr);
					}

				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $this->northbridge_model->checkIfUserIsAdmin() && $addition == "submit_approve_merchant_product_form" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['local_government'] = $user->local_government;
						$data['city'] = $user->city;
						$data['address'] = $user->address;
						$data['place_of_use'] = $user->place_of_use;
						$data['whatsapp_user'] = $user->whatsapp_user;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					
					if(isset($_POST['id'])){
						$id = $_POST['id'];
						if($this->northbridge_model->checkIfMerchantRequestIdIsValid($id)){
							$response_arr = array('success' => false,'messages' => '');
							
							$this->form_validation->set_rules('name','Product Name','trim|required');
							$this->form_validation->set_rules('quantity','Product Quantity','trim|numeric|required');
							$this->form_validation->set_rules('old_price','Product Old Price','trim|required|numeric');
							$this->form_validation->set_rules('new_price','Product New Price','trim|required|numeric');
							$this->form_validation->set_rules('expiry_date','Product Expiry Date','trim|required');
							$this->form_validation->set_rules('weight','Product Weight','trim|required|numeric');
							$this->form_validation->set_rules('length','Product Length','trim|required|numeric');
							$this->form_validation->set_rules('width','Product Width','trim|required|numeric');
							$this->form_validation->set_rules('height','Product Height','trim|required|numeric');
							$this->form_validation->set_rules('description','Product Description','trim|required');
							$this->form_validation->set_rules('shipping_fee','Product Shipping Fee','trim|required');
							$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
							if($this->form_validation->run() == TRUE){
							
	                			$date = date("j M Y");
								$time = date("h:i:sa");
								$name = $this->input->post('name');
								$quantity = $this->input->post('quantity');
								$old_price = $this->input->post('old_price');
								$new_price = $this->input->post('new_price');
								$expiry_date = $this->input->post('expiry_date');
								$weight = $this->input->post('weight');
								$height = $this->input->post('height');
								$length = $this->input->post('length');
								$width = $this->input->post('width');
								$description = $this->input->post('description');
								$shipping_fee = $this->input->post('shipping_fee');
								$target_file_name = $this->northbridge_model->getMerchantRequestParamById("image",$id);
								$merchant_id = $this->northbridge_model->getMerchantRequestParamById("user_id",$id);
	                			$form_array = array(
	                				'name' => $name,
	                				'quantity' => $quantity,
	                				'old_price' => $old_price,
	                				'new_price' => $new_price,
	                				'expiry_date' => $expiry_date,
	                				'weight' => $weight,
	                				'height' => $height,
	                				'length' => $length,
	                				'width' => $width,
	                				'description' => $description,
	                				'upload_date' => $date,
	                				'upload_time' => $time,
	                				'shipping_fee' => $shipping_fee,
	                				'image' => $target_file_name,
	                				'merchant' => $merchant_id
	                			);

	                			if($this->northbridge_model->uploadProduct($form_array)){
	                				$sent_date = $this->northbridge_model->getMerchantRequestParamById("upload_date",$id) . " " . $this->northbridge_model->getMerchantRequestParamById("upload_time",$id);
									$product_name = $this->northbridge_model->getMerchantRequestParamById("name",$id);
									$image = $this->northbridge_model->getMerchantRequestParamById("image",$id);
									$user_id = $this->northbridge_model->getMerchantRequestParamById("user_id",$id);

									$title = "Notice Of Merchant Request Approval";
					        		$message = "This Is To Alert You That You Your Merchant Request You Made On " . $sent_date . " Has Been Approved. Its Now Live. You Can View Details Below. View More Details On The Merchant Request Tab In <a href='".site_url('northbridge/mini_importation')."'>Mini Importation</a>";
					        		$message .= "<div class='container' style='margin-top: 30px;'>";
					        		$message .= "<p>Product Name: <em class='text-primary'>".$product_name."</em><p>";
					        		$message .= "<p>Product Image: <p>";
					        		$message .= "<img class='col-sm-6' src='".base_url('assets/images/'.$image)."'/>";
					        		
					        		$message .= "</div>";
					        		

									$form_array = array(
										'sender' => "System",
										'receiver' => $user_id,
										'title' => $title,
										'message' => $message,
										'date_sent' => $date,
										'time_sent' => $time,
										'type' => 'misc'
									);

									if($this->northbridge_model->sendMessage($form_array)){
										if($this->northbridge_model->deleteMerchantRequest($id)){
											$response_arr['success'] = true;
										}
									}
	                			}
							}else{
								foreach($_POST as $key => $value){
									$response_arr['messages'][$key] = form_error($key);
								}
							}
							echo json_encode($response_arr);
						}
					}

				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $this->northbridge_model->checkIfUserIsAdmin() && $addition == "submit_edit_product_form" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['local_government'] = $user->local_government;
						$data['city'] = $user->city;
						$data['address'] = $user->address;
						$data['place_of_use'] = $user->place_of_use;
						$data['whatsapp_user'] = $user->whatsapp_user;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					
					if(isset($_POST['product_id'])){
						$product_id =  $this->input->post('product_id');
						$response_arr = array('success' => false,'wrong_extension' => false,'too_large' => false,'not_really_json' => false,"image_name" => '');
						
						$this->form_validation->set_rules('name','Product Name','trim|required');
						$this->form_validation->set_rules('quantity','Product Quantity','trim|numeric|required');
						$this->form_validation->set_rules('old_price','Product Old Price','trim|required|numeric');
						$this->form_validation->set_rules('new_price','Product New Price','trim|required|numeric');
						$this->form_validation->set_rules('expiry_date','Product Expiry Date','trim|required');
						$this->form_validation->set_rules('weight','Product Weight','trim|required|numeric');
						$this->form_validation->set_rules('length','Product Length','trim|required|numeric');
						$this->form_validation->set_rules('width','Product Width','trim|required|numeric');
						$this->form_validation->set_rules('height','Product Height','trim|required|numeric');
						$this->form_validation->set_rules('description','Product Description','trim|required');
						$this->form_validation->set_rules('shipping_fee','Product Shipping Fee','trim|required|numeric');
						$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
						if($this->form_validation->run() == TRUE){

							$date = date("j M Y");
							$time = date("h:i:sa");
							$name = $this->input->post('name');
							$quantity = $this->input->post('quantity');
							$old_price = $this->input->post('old_price');
							$new_price = $this->input->post('new_price');
							$expiry_date = $this->input->post('expiry_date');
							$weight = $this->input->post('weight');
							$height = $this->input->post('height');
							$length = $this->input->post('length');
							$width = $this->input->post('width');
							$shipping_fee = $this->input->post('shipping_fee');
							$description = $this->input->post('description');

							$product_quantity = $this->northbridge_model->getProductParamByIdMiniImportation("quantity",$product_id);
							$product_quantity_purchased = $this->northbridge_model->getProductParamByIdMiniImportation("quantity_purchased",$product_id);
							$quantity = $quantity + $product_quantity_purchased;


                			$form_array = array(
                				'name' => $name,
                				'quantity' => $quantity,
                				'old_price' => $old_price,
                				'new_price' => $new_price,
                				'expiry_date' => $expiry_date,
                				'weight' => $weight,
                				'height' => $height,
                				'length' => $length,
                				'width' => $width,
                				'description' => $description,
                				'upload_date' => $date,
                				'upload_time' => $time,
                				'shipping_fee' => $shipping_fee
                			);

                			if($this->northbridge_model->updateProduct($form_array,$product_id)){
	                			$response_arr['success'] = true;
                			}
						
							if(isset($_FILES['image'])){

								$real_file_name = basename($_FILES['image']['name']);
								$image_extension = strtolower(pathinfo($real_file_name,PATHINFO_EXTENSION));
								$file_size = $_FILES['image']['size'];
								// echo $file_size;
								if($image_extension == "png" || $image_extension == "jpg" || $image_extension == "jpeg" ){	
									$target_dir = "assets/images/";
									$target_file_name = bin2hex($this->encryption->create_key(16)) . ".".$image_extension;
									$target_file = $target_dir .$target_file_name;
					                
				                	if(move_uploaded_file($_FILES["image"]["tmp_name"], $target_file)){
				                		$target_file1 = base_url($target_file);
				                		if(exif_imagetype($target_file)){
				                			$form_array = array(
				                				'image' => $target_file_name
				                			);
				                			if($this->northbridge_model->updateProduct($form_array,$product_id)){
					                			$response_arr['image_name'] = $target_file1;
				                			}
				                			
				                		}else{
				                			unlink($target_file);
				                			$response_arr['not_really_json'] = true;
				                		}
				                		
				                	}
					                
								}else{
									$response_arr['wrong_extension'] = true;
								}
							}else{
								$response_arr['messages']['image'] = '<p class="form-error">An Image Must Be Selected</p>';
							}
						}else{
							foreach($_POST as $key => $value){
								$response_arr['messages'][$key] = form_error($key);
							}
						}
						
						echo json_encode($response_arr);
					}

				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "get_mini_importation_info" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['local_government'] = $user->local_government;
						$data['city'] = $user->city;
						$data['address'] = $user->address;
						$data['place_of_use'] = $user->place_of_use;
						$data['whatsapp_user'] = $user->whatsapp_user;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					
					if(isset($_POST['product_id'])){
						$response_arr = array('success' => false,'messages' => '','html' => '');
						$product_id = $_POST['product_id'];

						$product_info = $this->northbridge_model->getMiniImportationProductInfoById($product_id);
						if(is_array($product_info) && count($product_info) == 1){
							$response_arr['success'] = true;
							$response_arr['name_concat'] = $this->northbridge_model->custom_echo($product_info[0]->name,50);
            				foreach ($product_info[0] as $key=>$value) {
            					$product_quantity = $this->northbridge_model->getProductParamByIdMiniImportation("quantity",$product_id);
								$product_quantity_purchased = $this->northbridge_model->getProductParamByIdMiniImportation("quantity_purchased",$product_id);
								$remaining_product_quantity = $product_quantity - $product_quantity_purchased;
								if($key == "quantity"){
									$value = $remaining_product_quantity;
								}
							  	$response_arr['messages'][$key] = $value;
							}

							$users_with_slots = $this->northbridge_model->getUsersWithSlotsOnProductMiniImportation($product_id);

							if(is_array($users_with_slots)){

								$response_arr['html'] .= '<h3 class="text-center">Users With Slots</h3>';
								foreach($users_with_slots as $row){
									$id = $row->id;
									$user_id = $row->user_id;
									$product_id = $row->product_id;
									$quantity = $row->quantity;
									$cart_date = $row->cart_date;
									$cart_time = $row->cart_time;
									$checked_out = $row->checked_out;
									$check_out_date = $row->check_out_date;
									$check_out_time = $row->check_out_time;
									$center_leader = $row->center_leader;
									$dispatched = $row->dispatched;
									$status = $row->status;
									$order_code = $row->order_code;
									$product_amount_paid = $row->product_amount_paid;
									$shipping_fee = $row->shipping_fee;

									$user_logo = $this->northbridge_model->getUserParamById("logo",$user_id);
									$user_name = $this->northbridge_model->getUserParamById("user_name",$user_id);
									$full_name = $this->northbridge_model->getUserParamById("full_name",$user_id);
									$slug = $this->northbridge_model->getUserParamById("slug",$user_id);

									$center_leader_full_name = $this->northbridge_model->getUserParamById("full_name",$user_id);
									$center_leader_slug = $this->northbridge_model->getUserParamById("slug",$user_id);


									if(is_null($user_logo)){
										$user_logo = "avatar.jpg";
									}

									$response_arr['html'] .= '<div class="card" style="">';
              						$response_arr['html'] .= '<div class="card-body">';
                					$response_arr['html'] .= '<div class="container">';
                  					$response_arr['html'] .= '<div class="row">';

                    				$response_arr['html'] .= '<div class="col-3">';	
                    				$response_arr['html'] .= '<img style="width: 100px;" src="'.base_url('assets/images/'.$user_logo).'" class="img-round">';
                    				$response_arr['html'] .= '</div>';

									$response_arr['html'] .= '<div class="col-7">';	
                    				$response_arr['html'] .= '<h5><a target="_blank" href="'.site_url('northbridge/'.$slug).'">'.$full_name.'</a></h5>';


                    				$response_arr['html'] .= '<p style="margin: 0;">Order Code: <span><em class="text-primary">'.$order_code.'</em></span></p>';	
                    				

                    				$response_arr['html'] .= '<p style="margin: 0;">No Of Slots: <span><em class="text-primary">'.$quantity.'</em></span></p>';	

                    				$response_arr['html'] .= '<p style="margin: 0;">Time Of Order: <span><em class="text-primary">'.$check_out_date. " " . $check_out_time . '</em></span></p>';	

                    				$response_arr['html'] .= '<p style="margin: 0;">Center Leader: <a target="_blank" href="'.site_url('northbridge/'.$center_leader_slug).'">'.$center_leader_full_name.'</a></p>';	
                    				
                    				$response_arr['html'] .= '</div>';                    				

                  					$response_arr['html'] .= '</div>';
                					$response_arr['html'] .= '</div>';
              						$response_arr['html'] .= '</div>';
            						$response_arr['html'] .= '</div>';
								}

							}else{
								$response_arr['html'] .= '<h4 class="text-warning">No User With Slots On This Product.</h4>';
							}
            			}
						echo json_encode($response_arr);
					}

				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "get_product_mini_importation_info" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['local_government'] = $user->local_government;
						$data['city'] = $user->city;
						$data['address'] = $user->address;
						$data['place_of_use'] = $user->place_of_use;
						$data['whatsapp_user'] = $user->whatsapp_user;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					
					if(isset($_POST['product_id'])){
						$response_arr = array('success' => false,'messages' => '');
						$product_id = $_POST['product_id'];

						$product_info = $this->northbridge_model->getMiniImportationProductInfoById($product_id);
						if(is_array($product_info)){
							$response_arr['success'] = true;
							foreach($product_info as $row){
								$id = $row->id;
								$name = $row->name;
								$image = $row->image;
								$quantity = $row->quantity;
								$old_price = $row->old_price;
								$new_price = $row->new_price;
								$quantity_purchased = $row->quantity_purchased;
								$expiry_date = $row->expiry_date;
								$expiry_time = $row->expiry_time;
								$upload_date = $row->upload_date;
								$upload_time = $row->upload_time;
								$weight = $row->weight;
								$length = $row->length;
								$width = $row->width;
								$height = $row->height;
								$description = $row->description;

								$progress_percent = ($quantity_purchased / $quantity) * 100;

								$savings = $old_price - $new_price;

								$now = time(); // or your date as well
					            $your_date = strtotime($expiry_date);
					            $datediff = $your_date - $now;

					            $datediff = ceil($datediff / (60 * 60 * 24));

								$response_arr['messages'] .= '<div class="container">';
					          	$response_arr['messages'] .= '<div class="row">';
					            $response_arr['messages'] .= '<div class="col-sm-6">';
					            $response_arr['messages'] .= '<img class="col-12" src="'.base_url('assets/images/'.$image).'" alt="'.$name.' image">';
					            $response_arr['messages'] .= '</div>';

					            $response_arr['messages'] .= '<div class="col-sm-6">';
					            $response_arr['messages'] .= '<h3 style="font-size: 29px; font-weight: bold;">'.$name.'</h3>';

					            $response_arr['messages'] .= '<div class="price-div" style="padding-top: 15px; padding-bottom: 15px; border-top: 1px solid rgb(242, 242, 242); border-bottom: 1px solid rgb(242, 242, 242);">';
					            $response_arr['messages'] .= '<span style="font-size: 25px; font-weight: bolder;">₦'.number_format($new_price,2).'</span>';
					            $response_arr['messages'] .= '<span style="text-decoration: line-through; margin-left: 15px; font-size: 14px; color: #b9b9b9; text-decoration-color: #b9b9b9;">₦'.number_format($old_price,2).'</span>';
					            $response_arr['messages'] .= '<span style="font-size: 14px; color: #FF9900; margin-left: 15px; font-weight: 700;">You save ₦'.number_format($savings,2).'</span>';
					            $response_arr['messages'] .= '</div>';

					            $response_arr['messages'] .= '<div class="progress-bar-div" style="padding-top: 18px; padding-bottom: 18px; border-bottom: 1px solid rgb(242, 242, 242);">';
					            $response_arr['messages'] .= '<div class="progress" style="margin: 0;">';
					            $response_arr['messages'] .= '<div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="'.$progress_percent.'"
					                  aria-valuemin="0" aria-valuemax="100" style="width:'.$progress_percent.'%;">';
					            $response_arr['messages'] .= '<span class="sr-only">'.$progress_percent.'% Complete</span>';
					            $response_arr['messages'] .= '</div>';
					            $response_arr['messages'] .= '</div>';

					            $response_arr['messages'] .= '<span>'.$quantity_purchased.'</span>';
					            $response_arr['messages'] .= '<span style="float: right;" class="text-right">'.$quantity.'</span>';
					                
					            $response_arr['messages'] .= '</div>';

					            $response_arr['messages'] .= '<div class="" style="padding-top: 18px; padding-bottom: 18px; border-bottom: 1px solid rgb(242, 242, 242);">';
					            $response_arr['messages'] .= '<h5 style="font-weight: bold; font-size: 12px; margin: 0;" class="text-warning">This Product Will Expire In '.$datediff.' days</h5>';
					            $response_arr['messages'] .= '</div>';

					            $response_arr['messages'] .= '<div class="add-to-cart-div" style="padding-top: 18px; padding-bottom: 18px; border-bottom: 1px solid rgb(242, 242, 242);">';
					            $response_arr['messages'] .= '<button class="btn-orange add-to-cart-btn" onclick="addToCart(this,event)" data-id="'.$id.'">Add To Cart</button>';
					            $response_arr['messages'] .= '</div>';

					            $response_arr['messages'] .= '<div class="" style="padding-top: 18px; padding-bottom: 18px; height: 150px; overflow-y: scroll; border-bottom: 1px solid rgb(242, 242, 242);">';
					            $response_arr['messages'] .= '<h5 style="font-weight: bold; font-size: 21px; margin: 0;">Description</h5> ';
					            $response_arr['messages'] .= '<h5 style="font-weight: bold; font-size: 14px; margin: 0; margin-top: 19px;">Weight (kg) : <span style="font-style: italic; font-weight: bold; font-style: 12px;" class="text-warning">'.$weight.'</span></h5>'; 
					            $response_arr['messages'] .= '<h5 style="font-weight: bold; font-size: 14px; margin: 0; margin-top: 19px;">Length (cm) : <span style="font-style: italic; font-weight: bold; font-style: 12px;" class="text-warning">'.$length.'</span></h5>';
					            $response_arr['messages'] .= '<h5 style="font-weight: bold; font-size: 14px; margin: 0; margin-top: 19px;">Width (cm) : <span style="font-style: italic; font-weight: bold; font-style: 12px;" class="text-warning">'.$width.'</span></h5> ';
					            $response_arr['messages'] .= '<h5 style="font-weight: bold; font-size: 14px; margin: 0; margin-top: 19px;">Height (cm) : <span style="font-style: italic; font-weight: bold; font-style: 12px;" class="text-warning">'.$height.'</span></h5>';

					            $response_arr['messages'] .= '<p style="margin-top: 15px; line-height: 1.5; font-size: 12px;">'.$description.'</p>';
					            $response_arr['messages'] .= '</div>';
					            $response_arr['messages'] .= '</div>';
					          	$response_arr['messages'] .= '</div>';
					        	$response_arr['messages'] .= '</div>';
							}
            			}
						echo json_encode($response_arr);
					}

				}
			}


			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $this->northbridge_model->checkIfUserIsAdmin() && $addition == "submit_add_new_banner_form" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['local_government'] = $user->local_government;
						$data['city'] = $user->city;
						$data['address'] = $user->address;
						$data['place_of_use'] = $user->place_of_use;
						$data['whatsapp_user'] = $user->whatsapp_user;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					
					if(isset($_GET['product_id'])){
						$response_arr = array('success' => false,'invalid_product_id' => false,'wrong_extension' => false,'too_large' => false,'not_really_json' => false,"image_name" => '');
						$product_id = $_GET['product_id'];
						if($this->northbridge_model->checkIfMiniImportationProductIdIsValid($product_id)){
							if(isset($_FILES['banner_img'])){

								$real_file_name = basename($_FILES['banner_img']['name']);
								$image_extension = strtolower(pathinfo($real_file_name,PATHINFO_EXTENSION));
								$file_size = $_FILES['banner_img']['size'];
								// echo $file_size;
								if($image_extension == "png" || $image_extension == "jpg" || $image_extension == "jpeg" ){	
									$target_dir = "assets/images";
									$target_file_name = bin2hex($this->encryption->create_key(16)) . ".".$image_extension;
									$target_file = $target_dir .$target_file_name;
					                
				                	if(move_uploaded_file($_FILES["banner_img"]["tmp_name"], $target_file)){
				                		$target_file1 = base_url($target_file);
				                		if(exif_imagetype($target_file)){
				                			$date = date("j M Y");
											$time = date("h:i:sa");
				                			$form_array = array(
				                				'product_id' => $product_id,
				                				'image' => $target_file_name,
				                				'date' => $date,
				                				'time' => $time
				                			);

				                			if($this->northbridge_model->uploadBannerImage($form_array)){
					                			$response_arr['success'] = true;
					                			$response_arr['image_name'] = $target_file1;
				                			}
					                		
				                		}else{
				                			unlink($target_file);
				                			$response_arr['not_really_json'] = true;
				                		}
				                		
				                	}
					                
								}else{
									$response_arr['wrong_extension'] = true;
								}
							}
						}else{
							$response_arr['invalid_product_id'] = true;
						}
						echo json_encode($response_arr);
					}

				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "health" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					
					$this->load->view('includes/admin_header',$data);
		            $this->load->view('pages/health',$data);
		            $this->load->view('includes/admin_footer',$data);	

				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "e-commerce" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['local_government'] = $user->local_government;
						$data['city'] = $user->city;
						$data['address'] = $user->address;
						$data['place_of_use'] = $user->place_of_use;
						$data['whatsapp_user'] = $user->whatsapp_user;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					
					$this->load->view('includes/admin_header',$data);
		            $this->load->view('pages/e-commerce',$data);
		            $this->load->view('includes/admin_footer',$data);	

				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "combo_recharge_history"){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}

					$config['base_url'] = site_url('northbridge/index/combo_recharge_history');
					$config['total_rows'] = $this->northbridge_model->getTotalNoOfComboRechargeHistory();
					$config['per_page'] = 10;

					$config['per_page'] = 10;
					$config['use_page_numbers'] = TRUE;
					$config['next_link'] = 'Next';
					$config['first_link'] = FALSE;
					$config['last_link'] = FALSE;
					$config['full_tag_open'] = "<ul class='pagination'>";
					$config['full_tag_close'] ="</ul>";
					$config['num_tag_open'] = '<li>';
					$config['num_tag_close'] = '</li>';
					$config['cur_tag_open'] = "<li class='disabled'><li class='active'><a href='#'>";
					$config['cur_tag_close'] = "<span class='sr-only'></span></a></li>";
					$config['next_tag_open'] = "<li>";
					$config['next_tagl_close'] = "</li>";
					$config['prev_tag_open'] = "<li>";
					$config['prev_tagl_close'] = "</li>";
					$config['first_tag_open'] = "<li>";
					$config['first_tagl_close'] = "</li>";
					$config['last_tag_open'] = "<li>";
					$config['last_tagl_close'] = "</li>";

					// By clicking on performing PREVIOUS pagination.
					$config['prev_link'] = 'Previous';



					if(!is_null($second_addition)){
						$page = $second_addition;
					}else{
						$page = 1;
					}
					
					$page = $page - 1;


					$data['rows'] = $this->northbridge_model->getComboRechargeHistoryForUser($page);
					$this->pagination->initialize($config);

					$data['str_links'] = $this->pagination->create_links();
					
					$this->load->view('includes/admin_header',$data);
		            $this->load->view('pages/combo_recharge_history',$data);
		            $this->load->view('includes/admin_footer',$data);	

				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "prepaid_electricity_history"){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}

					$config['base_url'] = site_url('northbridge/index/prepaid_electricity_history');
					$config['total_rows'] = $this->northbridge_model->getTotalNoOfPrepaidElectricityHistory();
					$config['per_page'] = 10;

					$config['per_page'] = 10;
					$config['use_page_numbers'] = TRUE;
					$config['next_link'] = 'Next';
					$config['first_link'] = FALSE;
					$config['last_link'] = FALSE;
					$config['full_tag_open'] = "<ul class='pagination'>";
					$config['full_tag_close'] ="</ul>";
					$config['num_tag_open'] = '<li>';
					$config['num_tag_close'] = '</li>';
					$config['cur_tag_open'] = "<li class='disabled'><li class='active'><a href='#'>";
					$config['cur_tag_close'] = "<span class='sr-only'></span></a></li>";
					$config['next_tag_open'] = "<li>";
					$config['next_tagl_close'] = "</li>";
					$config['prev_tag_open'] = "<li>";
					$config['prev_tagl_close'] = "</li>";
					$config['first_tag_open'] = "<li>";
					$config['first_tagl_close'] = "</li>";
					$config['last_tag_open'] = "<li>";
					$config['last_tagl_close'] = "</li>";

					// By clicking on performing PREVIOUS pagination.
					$config['prev_link'] = 'Previous';



					if(!is_null($second_addition)){
						$page = $second_addition;
					}else{
						$page = 1;
					}
					
					$page = $page - 1;


					$data['rows'] = $this->northbridge_model->getPrepaidElectricityHistoryForUser($page);
					$this->pagination->initialize($config);

					$data['str_links'] = $this->pagination->create_links();
					
					$this->load->view('includes/admin_header',$data);
		            $this->load->view('pages/prepaid_electricity_history',$data);
		            $this->load->view('includes/admin_footer',$data);	

				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "mlm_income_history"){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}

					$config['base_url'] = site_url('northbridge/index/mlm_income_history');
					$config['total_rows'] = $this->northbridge_model->getTotalNoOfMlmIncomeHistoryForUser($user_id);
					$config['per_page'] = 10;

					$config['per_page'] = 10;
					$config['use_page_numbers'] = TRUE;
					$config['next_link'] = 'Next';
					$config['first_link'] = FALSE;
					$config['last_link'] = FALSE;
					$config['full_tag_open'] = "<ul class='pagination'>";
					$config['full_tag_close'] ="</ul>";
					$config['num_tag_open'] = '<li>';
					$config['num_tag_close'] = '</li>';
					$config['cur_tag_open'] = "<li class='disabled'><li class='active'><a href='#'>";
					$config['cur_tag_close'] = "<span class='sr-only'></span></a></li>";
					$config['next_tag_open'] = "<li>";
					$config['next_tagl_close'] = "</li>";
					$config['prev_tag_open'] = "<li>";
					$config['prev_tagl_close'] = "</li>";
					$config['first_tag_open'] = "<li>";
					$config['first_tagl_close'] = "</li>";
					$config['last_tag_open'] = "<li>";
					$config['last_tagl_close'] = "</li>";

					// By clicking on performing PREVIOUS pagination.
					$config['prev_link'] = 'Previous';



					if(!is_null($second_addition)){
						$page = $second_addition;
					}else{
						$page = 1;
					}
					
					$page = $page - 1;


					$data['rows'] = $this->northbridge_model->getMlmIncomeHistoryForUser($user_id,$page);
					$this->pagination->initialize($config);

					$data['str_links'] = $this->pagination->create_links();
					
					$this->load->view('includes/admin_header',$data);
		            $this->load->view('pages/mlm_income_history',$data);
		            $this->load->view('includes/admin_footer',$data);	

				}
			}


			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "affiliate-plans-benefits" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					
					$this->load->view('includes/admin_header',$data);
		            $this->load->view('pages/affiliate-plans-benefits',$data);
		            $this->load->view('includes/admin_footer',$data);	

				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "love-sex-relationship" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					
					$this->load->view('includes/admin_header',$data);
		            $this->load->view('pages/love-sex-relationship',$data);
		            $this->load->view('includes/admin_footer',$data);	

				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "get_user_center_leader_info" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					$response_arr = array('success' => false,'type' => '','messages' => '');
					// if($this->northbridge_model->checkIfUserHasReferredAtLeast15People()){
						if($this->northbridge_model->checkIfUserIsACenterLeader()){
							$response_arr['success'] = true;
							$response_arr['type'] = "already";
						}else{
							$response_arr['success'] = true;
							$response_arr['type'] = "not_yet";
						}
					// }else{
					// 	$response_arr['messages'] = "You Must Have At Least Referred 15 Users To Qualify To Become A Center Leader";
					// }
					echo json_encode($response_arr);
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "submit_become_center_leader_form" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					$response_arr = array('success' => false,'url' => '','messages' => '','terms_selected' => false,'not_enough_sponsors' => true,'has_business_account' => false);
					if($this->input->post('terms_checkbox') && $this->input->post('terms_checkbox') == true){
						$response_arr['terms_selected'] = true;
						if($this->northbridge_model->checkIfUserHasAtLeastOneBusinessAccount($user_id)){
							$response_arr['has_business_account'] = true;
							if($this->northbridge_model->makeSureUserHasReferredAtLeastTenPersonsInMlm($user_id)){
								$response_arr['not_enough_sponsors'] = false;
								
								$list_of_states_in_country = $this->northbridge_model->getListOfStatesInCountryCommaSeeperated($data['country_id']);
								$list_of_locals_in_state = $this->northbridge_model->getListOfLocalsInStateCommaSeeperated($this->input->post('state'));
								$this->form_validation->set_rules('state','State','trim|required|max_length[250]|in_list['.$list_of_states_in_country.']',array('in_list' => 'Invalid State Entered'));
								$this->form_validation->set_rules('local_government','Local Government','trim|required|max_length[250]|in_list['.$list_of_locals_in_state.']',array('in_list' => 'Invalid Local Govt. Entered'));
								$this->form_validation->set_rules('city','Town','trim|required|max_length[250]');
								$this->form_validation->set_rules('address','Address','trim|required|max_length[500]');
								$this->form_validation->set_rules('place_of_use','Place Of Use','trim|required|max_length[250]|in_list[home,shop,office]');
								$this->form_validation->set_rules('whatsapp_user','Whatsapp User?','trim|required|max_length[250]|in_list[1,0]',array('in_list' => 'Invalid Input Entered'));

								$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
								if($this->form_validation->run() == TRUE){
									$state = $this->input->post('state');
									$local_government = $this->input->post('local_government');
									$city = $this->input->post('city');
									$address = $this->input->post('address');
									$place_of_use = $this->input->post('place_of_use');
									$whatsapp_user = $this->input->post('whatsapp_user');

									$form_array = array(
										'state_id' => $state,
										'local_government' => $local_government,
										'city' => $city,
										'address' => $address,
										'place_of_use' => $place_of_use,
										'whatsapp_user' => $whatsapp_user
									);

									if($this->northbridge_model->updateUserTable($form_array,$user_id)){
										
										$reference_code = substr(bin2hex($this->encryption->create_key(8)),4);
										$total_amount = 2500;
										$total_amount = $total_amount * 100;
										$email = $this->northbridge_model->getUserEmailByUserId($user_id);
										$token = $this->northbridge_model->getUserTokenByUserId($user_id);
										
										$name = $this->northbridge_model->getUserFullNameByUserId($user_id);
										
										$redirect_url = site_url('northbridge/process_content_leader_payment/');
										
										
					            		$auth_url = $this->paystack->init($reference_code, $total_amount,$email,[
								            'name' => $name
								        ],$redirect_url);
								        if (filter_var($auth_url, FILTER_VALIDATE_URL)){
								        	$response_arr['success'] = true;
								        	$response_arr['url'] = $auth_url;
									    }
									}
								}else{
									foreach($_POST as $key => $value){
										$response_arr['messages'][$key] = form_error($key);
									}
								}
							}
						}	
					}
					echo json_encode($response_arr);
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "submit_edit_center_leader_info_form" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					$response_arr = array('success' => false,'url' => '','messages' => '');
					
						
					$list_of_states_in_country = $this->northbridge_model->getListOfStatesInCountryCommaSeeperated($data['country_id']);
					$list_of_locals_in_state = $this->northbridge_model->getListOfLocalsInStateCommaSeeperated($this->input->post('state'));
					$this->form_validation->set_rules('state','State','trim|required|max_length[250]|in_list['.$list_of_states_in_country.']',array('in_list' => 'Invalid State Entered'));
					$this->form_validation->set_rules('local_government','Local Government','trim|required|max_length[250]|in_list['.$list_of_locals_in_state.']',array('in_list' => 'Invalid Local Govt. Entered'));
					$this->form_validation->set_rules('city','Town','trim|required|max_length[250]');
					$this->form_validation->set_rules('address','Address','trim|required|max_length[500]');
					$this->form_validation->set_rules('place_of_use','Place Of Use','trim|required|max_length[250]|in_list[home,shop,office]');
					$this->form_validation->set_rules('whatsapp_user','Whatsapp User?','trim|required|max_length[250]|in_list[1,0]',array('in_list' => 'Invalid Input Entered'));

					$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
					if($this->form_validation->run() == TRUE){
						$state = $this->input->post('state');
						$local_government = $this->input->post('local_government');
						$city = $this->input->post('city');
						$address = $this->input->post('address');
						$place_of_use = $this->input->post('place_of_use');
						$whatsapp_user = $this->input->post('whatsapp_user');

						$form_array = array(
							'state_id' => $state,
							'local_government' => $local_government,
							'city' => $city,
							'address' => $address,
							'place_of_use' => $place_of_use,
							'whatsapp_user' => $whatsapp_user
						);

						if($this->northbridge_model->updateUserTable($form_array,$user_id)){
					        $response_arr['success'] = true;
						}
					}else{
						foreach($_POST as $key => $value){
							$response_arr['messages'][$key] = form_error($key);
						}
					}
					
					echo json_encode($response_arr);
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "get_products_on_way_to_center_leader_info" && is_null($second_addition) && $this->northbridge_model->checkIfUserIsAdmin()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					$response_arr = array('success' => true,'messages' => '','no_status' => false);
					if($this->input->post('show_records') && $this->input->post('product_id') && $this->input->post('center_leader_id')){
						$product_id = $this->input->post('product_id');
						$center_leader_id = $this->input->post('center_leader_id');

						$center_leader_ids = $this->northbridge_model->getMiniImportationCenterLeaderUserIds1($product_id,$center_leader_id);

	        			if(is_array($center_leader_ids) && count($center_leader_ids) == 1){
	        				for($i = 0; $i < count($center_leader_ids); $i++){
	        					
	        					$center_leader_id = $center_leader_ids[$i];
	        					$product_name = $this->northbridge_model->getProductParamByIdMiniImportation("name",$product_id);
	        					$center_leader_user_name = $this->northbridge_model->getUserNameById($center_leader_id);

	        					$quantity = $this->northbridge_model->getMiniImportationProductQuantityComingToCenterLeader($product_id,$center_leader_id);
	        					$center_leader_state = $this->northbridge_model->getUserParamById("state_id",$center_leader_id);
	        					$center_leader_local_govt = $this->northbridge_model->getUserParamById("local_government",$center_leader_id);
	        					$center_leader_slug = $this->northbridge_model->getUserParamById("slug",$center_leader_id);
	        					$center_leader_full_name = $this->northbridge_model->getUserParamById("full_name",$center_leader_id);
	        					$center_leader_city = $this->northbridge_model->getUserParamById("city",$center_leader_id);
	        					$center_leader_address = $this->northbridge_model->getUserParamById("address",$center_leader_id);
	        					$center_leader_country = $this->northbridge_model->getUserParamById("country_id",$center_leader_id);

	        					$center_leader_country = $this->northbridge_model->getCountryById($center_leader_country);

	        					$center_leader_local_govt = $this->northbridge_model->getLocalGovernmentByStateIdAndId($center_leader_state,$center_leader_local_govt);
	        					$center_leader_state = $this->northbridge_model->getStateById($center_leader_state);

	        					$current_status = $this->northbridge_model->getMiniImportationOrderCurrentStatus($center_leader_id,$product_id);

	        					if($current_status == ""){
	        						$current_status = "No Status Entered Here";
	        					}

	        					$response_arr['messages'] .= '<div class="container">';

	        					$response_arr['messages'] .= '<div id="center-leader-info-div">';

								$response_arr['messages'] .= '<h3>Product Name: </h3>';	        					
								$response_arr['messages'] .= '<p >'.$product_name.'</p>';	 

								$response_arr['messages'] .= '<h3>Product Quantity: </h3>';	        					
								$response_arr['messages'] .= '<p >'.$quantity.'</p>';	 

								$response_arr['messages'] .= '<h3>Center Leader Name: </h3>';
								$response_arr['messages'] .= '<p >'.$center_leader_full_name.'</p>';
								$response_arr['messages'] .= '<h3>Center Leader Username: </h3>';
								$response_arr['messages'] .= '<p ><a target="_blank" href="'.site_url("northbridge/".$center_leader_slug).'">'.$center_leader_user_name.'</a></p>';

								$response_arr['messages'] .= '<h3>Center Leader Country: </h3>';
								$response_arr['messages'] .= '<p >'.$center_leader_country.'</p>';

								$response_arr['messages'] .= '<h3>Center Leader State: </h3>';
								$response_arr['messages'] .= '<p >'.$center_leader_state.'</p>';

								$response_arr['messages'] .= '<h3>Center Leader Local Government: </h3>';
								$response_arr['messages'] .= '<p >'.$center_leader_local_govt.'</p>';

								$response_arr['messages'] .= '<h3>Center Leader City: </h3>';
								$response_arr['messages'] .= '<p >'.$center_leader_city.'</p>';

								$response_arr['messages'] .= '<h3>Center Leader Address: </h3>';
								$response_arr['messages'] .= '<p >'.$center_leader_address.'</p>';

								$response_arr['messages'] .= '</div>';


								$response_arr['messages'] .= '<div id="order-status-div">';
								$response_arr['messages'] .= '<h3 class="text-center" style="font-weight: bold;">Order Status</h3>';

								$order_statuses = $this->northbridge_model->getMiniImportationOrderStatusesByProductIdAndCenterLeaderId($product_id,$center_leader_id);
								if(is_array($order_statuses)){
									

									$i = 0;

									$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="margin-top: 40px;">';
					        		$response_arr['messages'] .= '<table class="table table-striped table-bordered wrap hover display" id="statuses-table" cellspacing="0" width="100%" style="width:100%">';
					        		$response_arr['messages'] .= '<thead>';
					        		$response_arr['messages'] .= '<tr>';
					        		$response_arr['messages'] .= '<th>#</th>';
					        		$response_arr['messages'] .= '<th>Status</th>';
					        		$response_arr['messages'] .= '<th>Date / Time</th>';
					        		$response_arr['messages'] .= '<th>Actions</th>';
					        		$response_arr['messages'] .= '</tr>';
					        		$response_arr['messages'] .= '<tbody>';

					        		foreach($order_statuses as $row){
					        			$i++;
					        			$id = $row->id;
					        			$status = $row->status;
					        			$date = $row->date;
					        			$time = $row->time;

					        			$response_arr['messages'] .= '<tr>';

					        			$response_arr['messages'] .= '<td>'.$i.'</td>';
					        			$response_arr['messages'] .= '<td>'.$status.'</td>';	
					        			$response_arr['messages'] .= '<td>'.$date. ' ' . $time .'</td>';
					        			$response_arr['messages'] .= '<td class="td-actions text-center">';
					                   	$response_arr['messages'] .= '<button type="button" rel="tooltip" title="Delete Status" class="btn btn-danger btn-link btn-lg" onclick="deleteStatus(this,event,'.$id.')">';
					                   	$response_arr['messages'] .= '<i class="fas fa-trash"></i>';
					                    $response_arr['messages'] .= '<div class="ripple-container"></div>';
					                    $response_arr['messages'] .= '</button>';
					                    $response_arr['messages'] .= '</td>';


					        			$response_arr['messages'] .= '</tr>';
					        		}

					        		$response_arr['messages'] .= '</tbody>';
					        		$response_arr['messages'] .= '</table>';
					        		$response_arr['messages'] .= '</div>';
								}else{
									$response_arr['messages'] .= '<h4 class="text-warning">No Status To Display Here. Click On The Floating Add Button To Add.</h4>';
								}
								$response_arr['messages'] .= '</div>';



								$response_arr['messages'] .= '<div id="select-dispatcher-div">';
								$response_arr['messages'] .= '<h3 class="text-center">Dispatcher Details</h3>';

								if($this->northbridge_model->checkIfProductForCenterLeaderHasBeenGivenADispatcher($product_id,$center_leader_id)){
									$response_arr['no_status'] = true;
									$dispatcher_id = $this->northbridge_model->getDispatcherIdForProductForCenterLeader($product_id,$center_leader_id);
									$dispatcher_full_name = $this->northbridge_model->getUserParamById("full_name",$dispatcher_id);

									$dispatcher_slug = $this->northbridge_model->getUserParamById("slug",$dispatcher_id);
									if($this->northbridge_model->checkIfDispatcherForProductForCenterLeaderHasApprovedReceiptOfProduct($product_id,$center_leader_id)){
										$response_arr['messages'] .= '<h4><a target="_blank" href="'.site_url('northbridge/'.$dispatcher_slug).'">'.$dispatcher_full_name.'</a> Has Accepted The Dispatch Responsibility</h4>';
									}else{
										$response_arr['messages'] .= '<h4><a target="_blank" href="'.site_url('northbridge/'.$dispatcher_slug).'">'.$dispatcher_full_name.'</a> Has Not Accepted The Dispatch Responsibility</h4>';
									}
								}else{
									$response_arr['messages'] .= '<h3 class="text-center">All Available Dispatchers</h3>';
									$response_arr['messages'] .= '<p>Click To Select Dispatcher</p>';
									$dispatchers = $this->northbridge_model->listAllDispatchers();
									if(is_array($dispatchers)){

										$j = 0;

										$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="margin-top: 40px;">';
						        		$response_arr['messages'] .= '<table class="table table-striped table-bordered wrap hover display" id="dispatchers-table" cellspacing="0" width="100%" style="width:100%">';
						        		$response_arr['messages'] .= '<thead>';
						        		$response_arr['messages'] .= '<tr>';
						        		$response_arr['messages'] .= '<th>#</th>';
						        		$response_arr['messages'] .= '<th>UserName</th>';
						        		$response_arr['messages'] .= '<th>Full Name</th>';
						        		
						        		$response_arr['messages'] .= '</tr>';
						        		$response_arr['messages'] .= '<tbody>';

						        		foreach($dispatchers as $row){
						        			$id = $row->id;
						        			$user_name = $row->user_name;
						        			$full_name = $row->full_name;
						        			$slug = $row->slug;

						        			if(!$this->northbridge_model->checkIfUserIsAdmin1($id)){
						        				$j++;
							        			$response_arr['messages'] .= '<tr data-full-name="'.$full_name.'" onclick="selectThisDispatcher(this,event,'.$id.')">';

							        			$response_arr['messages'] .= '<td>'.$j.'</td>';
							        			$response_arr['messages'] .= '<td><a href='.site_url('northbridge/'.$slug).' target="_blank">'.$user_name.'</a></td>';	
							        			$response_arr['messages'] .= '<td>'.$full_name.'</td>';
							        			


							        			$response_arr['messages'] .= '</tr>';
							        		}
						        		}	

						        		$response_arr['messages'] .= '</tbody>';
						        		$response_arr['messages'] .= '</table>';
						        		$response_arr['messages'] .= '</div>';

										$response_arr['messages'] .= '</div>';
									}else{
										$response_arr['messages'] .= '<h4 class="text-warning">No Dispatcher To Display</h4>';
									}
								}

	        					$response_arr['messages'] .= '</div>';
	        				}	
	        			}	

					}
					echo json_encode($response_arr);
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "mark_order_as_picked_up_by_user" && is_null($second_addition) ){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					$response_arr = array('success' => false,'messages' => '','no_status' => false);
					if($this->input->post('order_id')){
						$date = date("j M Y");
						$time = date("h:i:sa");
						$order_id = $this->input->post('order_id');
						if($this->northbridge_model->getMiniImportationOrderParamById("user_id",$order_id) == $user_id){
							if($this->northbridge_model->markOrderAsPickedUpByUser($order_id,$date,$time,$user_id)){
								$response_arr['success'] = true;
							}
						}

					}
					echo json_encode($response_arr);
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "get_if_user_is_valid_to_be_merchant" && is_null($second_addition) ){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					$response_arr = array('success' => false,'has_business_account' => false);
					if($this->input->post('show_records')){
						$date = date("j M Y");
						$time = date("h:i:sa");
						
						if($this->northbridge_model->checkIfUserHasAtLeastOneBusinessAccount($user_id)){
							$response_arr['has_business_account'] = true;
							$response_arr['success'] = true;
						}
					}
					echo json_encode($response_arr);
				}
			}	

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "submit_add_new_product_for_merchant_form" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['local_government'] = $user->local_government;
						$data['city'] = $user->city;
						$data['address'] = $user->address;
						$data['place_of_use'] = $user->place_of_use;
						$data['whatsapp_user'] = $user->whatsapp_user;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					
					if(isset($_POST['name'])){
						if($this->northbridge_model->checkIfUserHasAtLeastOneBusinessAccount($user_id)){
							$response_arr = array('success' => false,'wrong_extension' => false,'too_large' => false,'not_really_json' => false,"image_name" => '');
							
							$this->form_validation->set_rules('name','Product Name','trim|required');
							$this->form_validation->set_rules('quantity','Product Quantity','trim|numeric|required');
							$this->form_validation->set_rules('old_price','Product Old Price','trim|required|numeric');
							$this->form_validation->set_rules('new_price','Product New Price','trim|required|numeric');
							$this->form_validation->set_rules('expiry_date','Product Expiry Date','trim|required');
							$this->form_validation->set_rules('weight','Product Weight','trim|required|numeric');
							$this->form_validation->set_rules('length','Product Length','trim|required|numeric');
							$this->form_validation->set_rules('width','Product Width','trim|required|numeric');
							$this->form_validation->set_rules('height','Product Height','trim|required|numeric');
							$this->form_validation->set_rules('description','Product Description','trim|required');
							$this->form_validation->set_rules('shipping_fee','Product Shipping Fee','trim|required');
							$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
							if($this->form_validation->run() == TRUE){
							
								if(isset($_FILES['image'])){

									$real_file_name = basename($_FILES['image']['name']);
									$image_extension = strtolower(pathinfo($real_file_name,PATHINFO_EXTENSION));
									$file_size = $_FILES['image']['size'];
									// echo $file_size;
									if($image_extension == "png" || $image_extension == "jpg" || $image_extension == "jpeg" ){	
										$target_dir = "assets/images/";
										$target_file_name = bin2hex($this->encryption->create_key(16)) . ".".$image_extension;
										$target_file = $target_dir .$target_file_name;
						                
					                	if(move_uploaded_file($_FILES["image"]["tmp_name"], $target_file)){
					                		$target_file1 = base_url($target_file);
					                		if(exif_imagetype($target_file)){
					                			$date = date("j M Y");
												$time = date("h:i:sa");
												$name = $this->input->post('name');
												$quantity = $this->input->post('quantity');
												$old_price = $this->input->post('old_price');
												$new_price = $this->input->post('new_price');
												$expiry_date = $this->input->post('expiry_date');
												$weight = $this->input->post('weight');
												$height = $this->input->post('height');
												$length = $this->input->post('length');
												$width = $this->input->post('width');
												$description = $this->input->post('description');
												$shipping_fee = $this->input->post('shipping_fee');
					                			$form_array = array(
					                				'name' => $name,
					                				'user_id' => $user_id,
					                				'quantity' => $quantity,
					                				'old_price' => $old_price,
					                				'new_price' => $new_price,
					                				'expiry_date' => $expiry_date,
					                				'weight' => $weight,
					                				'height' => $height,
					                				'length' => $length,
					                				'width' => $width,
					                				'description' => $description,
					                				'upload_date' => $date,
					                				'upload_time' => $time,
					                				'shipping_fee' => $shipping_fee,
					                				'image' => $target_file_name
					                			);

					                			if($this->northbridge_model->uploadMerchantProduct($form_array)){
						                			$response_arr['success'] = true;
						                			$response_arr['image_name'] = $target_file1;
					                			}
						                		
					                		}else{
					                			unlink($target_file);
					                			$response_arr['not_really_json'] = true;
					                		}
					                		
					                	}
						                
									}else{
										$response_arr['wrong_extension'] = true;
									}
								}else{
									$response_arr['messages']['image'] = '<p class="form-error">An Image Must Be Selected</p>';
								}
							}else{
								foreach($_POST as $key => $value){
									$response_arr['messages'][$key] = form_error($key);
								}
							}
						}
						
						echo json_encode($response_arr);
					}

				}
			}	

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "load_more_info_on_product_in_mini_importation_order" && is_null($second_addition) ){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					$response_arr = array('success' => true,'messages' => '','no_status' => false);
					if($this->input->post('show_records') && $this->input->post('order_id')){
						$order_id = $this->input->post('order_id');
						$product_id = $this->northbridge_model->getMiniImportationOrderParamById("product_id",$order_id);
						$center_leader_id = $this->northbridge_model->getMiniImportationOrderParamById("center_leader",$order_id);



						$center_leader_ids = $this->northbridge_model->getMiniImportationCenterLeaderUserIds2($product_id,$center_leader_id);
						// print_r($center_leader_ids);

	        			if(is_array($center_leader_ids) && count($center_leader_ids) == 1){

	        				for($i = 0; $i < count($center_leader_ids); $i++){
	        					
	        					$center_leader_id = $center_leader_ids[$i];
	        					$product_name = $this->northbridge_model->getProductParamByIdMiniImportation("name",$product_id);
	        					$center_leader_user_name = $this->northbridge_model->getUserNameById($center_leader_id);

	        					$quantity = $this->northbridge_model->getMiniImportationOrderParamById("quantity",$order_id);;
	        					$center_leader_state = $this->northbridge_model->getUserParamById("state_id",$center_leader_id);
	        					$center_leader_local_govt = $this->northbridge_model->getUserParamById("local_government",$center_leader_id);
	        					$center_leader_slug = $this->northbridge_model->getUserParamById("slug",$center_leader_id);
	        					$center_leader_full_name = $this->northbridge_model->getUserParamById("full_name",$center_leader_id);
	        					$center_leader_city = $this->northbridge_model->getUserParamById("city",$center_leader_id);
	        					$center_leader_address = $this->northbridge_model->getUserParamById("address",$center_leader_id);
	        					$center_leader_country = $this->northbridge_model->getUserParamById("country_id",$center_leader_id);

	        					$center_leader_country = $this->northbridge_model->getCountryById($center_leader_country);

	        					$center_leader_local_govt = $this->northbridge_model->getLocalGovernmentByStateIdAndId($center_leader_state,$center_leader_local_govt);
	        					$center_leader_state = $this->northbridge_model->getStateById($center_leader_state);

	        					$current_status = $this->northbridge_model->getMiniImportationOrderCurrentStatusByOrderId($order_id);

	        					

	        					$response_arr['messages'] .= '<div class="container">';

	        					$response_arr['messages'] .= '<div id="center-leader-info-div">';

								$response_arr['messages'] .= '<h3>Product Name: </h3>';	        					
								$response_arr['messages'] .= '<p >'.$product_name.'</p>';	 

								$response_arr['messages'] .= '<h3>Product Quantity: </h3>';	        					
								$response_arr['messages'] .= '<p >'.$quantity.'</p>';

								$response_arr['messages'] .= '<h3>Current Status: </h3>';	        					
								$response_arr['messages'] .= '<p >'.$current_status.'</p>';	

								$received_by_user = $this->northbridge_model->getMiniImportationOrderParamById("received_by_user",$order_id);
								$dispatched = $this->northbridge_model->getMiniImportationOrderParamById("dispatched",$order_id);
								if($dispatched == 1 && $received_by_user == 0){

						            $response_arr['messages'] .= '<button data-order-id="'.$order_id.'" class="btn btn-primary" onclick="verifyThatIHaveReceivedMyOrder(this,event)">I Have Received My Order</button>';
								}
								
	 

								$response_arr['messages'] .= '<h3>Center Leader Name: </h3>';
								$response_arr['messages'] .= '<p >'.$center_leader_full_name.'</p>';
								$response_arr['messages'] .= '<h3>Center Leader Username: </h3>';
								$response_arr['messages'] .= '<p ><a target="_blank" href="'.site_url("northbridge/".$center_leader_slug).'">'.$center_leader_user_name.'</a></p>';

								$response_arr['messages'] .= '<h3>Center Leader Country: </h3>';
								$response_arr['messages'] .= '<p >'.$center_leader_country.'</p>';

								$response_arr['messages'] .= '<h3>Center Leader State: </h3>';
								$response_arr['messages'] .= '<p >'.$center_leader_state.'</p>';

								$response_arr['messages'] .= '<h3>Center Leader Local Government: </h3>';
								$response_arr['messages'] .= '<p >'.$center_leader_local_govt.'</p>';

								$response_arr['messages'] .= '<h3>Center Leader City: </h3>';
								$response_arr['messages'] .= '<p >'.$center_leader_city.'</p>';

								$response_arr['messages'] .= '<h3>Center Leader Address: </h3>';
								$response_arr['messages'] .= '<p >'.$center_leader_address.'</p>';

								$response_arr['messages'] .= '</div>';


								$response_arr['messages'] .= '<div id="order-status-div">';
								$response_arr['messages'] .= '<h3 class="text-center" style="font-weight: bold;">Order Status</h3>';

								$order_statuses = $this->northbridge_model->getMiniImportationOrderStatusesByProductIdAndCenterLeaderId($product_id,$center_leader_id);
								if(is_array($order_statuses)){
									

									$i = 0;

									$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="margin-top: 40px;">';
					        		$response_arr['messages'] .= '<table class="table table-striped table-bordered wrap hover display" id="statuses-table" cellspacing="0" width="100%" style="width:100%">';
					        		$response_arr['messages'] .= '<thead>';
					        		$response_arr['messages'] .= '<tr>';
					        		$response_arr['messages'] .= '<th>#</th>';
					        		$response_arr['messages'] .= '<th>Status</th>';
					        		$response_arr['messages'] .= '<th>Date / Time</th>';
					        		
					        		$response_arr['messages'] .= '</tr>';
					        		$response_arr['messages'] .= '<tbody>';

					        		foreach($order_statuses as $row){
					        			$i++;
					        			$id = $row->id;
					        			$status = $row->status;
					        			$date = $row->date;
					        			$time = $row->time;

					        			$response_arr['messages'] .= '<tr>';

					        			$response_arr['messages'] .= '<td>'.$i.'</td>';
					        			$response_arr['messages'] .= '<td>'.$status.'</td>';	
					        			$response_arr['messages'] .= '<td>'.$date. ' ' . $time .'</td>';

					        			$response_arr['messages'] .= '</tr>';
					        		}

					        		$response_arr['messages'] .= '</tbody>';
					        		$response_arr['messages'] .= '</table>';
					        		$response_arr['messages'] .= '</div>';
								}else{
									$response_arr['messages'] .= '<h4 class="text-warning">No Status To Display Here. </h4>';
								}
								$response_arr['messages'] .= '</div>';

	        					$response_arr['messages'] .= '</div>';
	        				}	
	        			}	

					}
					echo json_encode($response_arr);
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "mark_mini_importation_product_of_center_leader_as_recieved_by_center_leader" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['full_name'] = $user->full_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					$date =	date("j M Y");
					$time = date("H:i:s");
					$response_arr = array('success' => false,'messages' => '');
					if($this->input->post('product_id') && $this->input->post('center_leader')){
						$product_id = $this->input->post('product_id');
						$center_leader_id = $this->input->post('center_leader');


						if($this->northbridge_model->makeSureUserIsTheRightDispatcherForMiniImportationOrder($product_id,$center_leader_id,$user_id)){
							if($this->northbridge_model->markCenterLeaderProductAsDeliveredToHim($center_leader_id,$product_id,$user_id,$date,$time)){



								$title = "Notice Of Goods Delivery";
				        		$message = "This Is To Inform You That Goods Booked Via Your Center Have Been Delivered At " . $date . " " . $time .  " By <a target='_blank' href='".site_url('northbridge/'.$data['user_slug'])."'>".$data['full_name']."</a>. View More Information Below.";


				        		$btn_1 = "<a class='btn btn-success' href='".site_url('northbridge/mini_importation/?open_products_arrived_at_to_center_leader_info=true&center_leader_id='.$center_leader_id.'&product_id='.$product_id)."'>Click Here</a>";
				        		

								$form_array = array(
									'sender' => "Admin",
									'receiver' => $center_leader_id,
									'title' => $title,
									'message' => $message,
									'date_sent' => $date,
									'time_sent' => $time,
									'type' => 'misc',
									'btn_1' => $btn_1
								);

								if($this->northbridge_model->sendMessage($form_array)){
									$response_arr['success'] = true;
								}

							}
						}

					}
					echo json_encode($response_arr);
				}
			}		

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "get_products_on_way_to_center_leader_info_previous_requests" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					$response_arr = array('success' => true,'messages' => '','no_status' => false);
					if($this->input->post('show_records') && $this->input->post('product_id') && $this->input->post('center_leader_id')){
						$product_id = $this->input->post('product_id');
						$center_leader_id = $this->input->post('center_leader_id');

						$center_leader_ids = $this->northbridge_model->getMiniImportationCenterLeaderUserIds1($product_id,$center_leader_id);

	        			if(is_array($center_leader_ids) && count($center_leader_ids) == 1){
	        				for($i = 0; $i < count($center_leader_ids); $i++){
	        					
	        					$center_leader_id = $center_leader_ids[$i];
	        					$product_name = $this->northbridge_model->getProductParamByIdMiniImportation("name",$product_id);
	        					$center_leader_user_name = $this->northbridge_model->getUserNameById($center_leader_id);

	        					$quantity = $this->northbridge_model->getMiniImportationProductQuantityComingToCenterLeader($product_id,$center_leader_id);
	        					$center_leader_state = $this->northbridge_model->getUserParamById("state_id",$center_leader_id);
	        					$center_leader_local_govt = $this->northbridge_model->getUserParamById("local_government",$center_leader_id);
	        					$center_leader_slug = $this->northbridge_model->getUserParamById("slug",$center_leader_id);
	        					$center_leader_full_name = $this->northbridge_model->getUserParamById("full_name",$center_leader_id);
	        					$center_leader_city = $this->northbridge_model->getUserParamById("city",$center_leader_id);
	        					$center_leader_address = $this->northbridge_model->getUserParamById("address",$center_leader_id);
	        					$center_leader_country = $this->northbridge_model->getUserParamById("country_id",$center_leader_id);

	        					$center_leader_country = $this->northbridge_model->getCountryById($center_leader_country);

	        					$center_leader_local_govt = $this->northbridge_model->getLocalGovernmentByStateIdAndId($center_leader_state,$center_leader_local_govt);
	        					$center_leader_state = $this->northbridge_model->getStateById($center_leader_state);

	        					$current_status = $this->northbridge_model->getMiniImportationOrderCurrentStatus($center_leader_id,$product_id);

	        					if($current_status == ""){
	        						$current_status = "No Status Entered Here";
	        					}

	        					$response_arr['messages'] .= '<div class="container">';

	        					$response_arr['messages'] .= '<div id="center-leader-info-div">';

								$response_arr['messages'] .= '<h3>Product Name: </h3>';	        					
								$response_arr['messages'] .= '<p >'.$product_name.'</p>';	 

								$response_arr['messages'] .= '<h3>Product Quantity: </h3>';	        					
								$response_arr['messages'] .= '<p >'.$quantity.'</p>';	 

								$response_arr['messages'] .= '<h3>Center Leader Name: </h3>';
								$response_arr['messages'] .= '<p >'.$center_leader_full_name.'</p>';
								$response_arr['messages'] .= '<h3>Center Leader Username: </h3>';
								$response_arr['messages'] .= '<p ><a target="_blank" href="'.site_url("northbridge/".$center_leader_slug).'">'.$center_leader_user_name.'</a></p>';

								$response_arr['messages'] .= '<h3>Center Leader Country: </h3>';
								$response_arr['messages'] .= '<p >'.$center_leader_country.'</p>';

								$response_arr['messages'] .= '<h3>Center Leader State: </h3>';
								$response_arr['messages'] .= '<p >'.$center_leader_state.'</p>';

								$response_arr['messages'] .= '<h3>Center Leader Local Government: </h3>';
								$response_arr['messages'] .= '<p >'.$center_leader_local_govt.'</p>';

								$response_arr['messages'] .= '<h3>Center Leader City: </h3>';
								$response_arr['messages'] .= '<p >'.$center_leader_city.'</p>';

								$response_arr['messages'] .= '<h3>Center Leader Address: </h3>';
								$response_arr['messages'] .= '<p >'.$center_leader_address.'</p>';

								$response_arr['messages'] .= '</div>';


								$response_arr['messages'] .= '<div id="order-status-div">';
								$response_arr['messages'] .= '<h3 class="text-center" style="font-weight: bold;">Order Status</h3>';

								$order_statuses = $this->northbridge_model->getMiniImportationOrderStatusesByProductIdAndCenterLeaderId($product_id,$center_leader_id);
								if(is_array($order_statuses)){
									

									$i = 0;

									$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="margin-top: 40px;">';
					        		$response_arr['messages'] .= '<table class="table table-striped table-bordered wrap hover display" id="statuses-table" cellspacing="0" width="100%" style="width:100%">';
					        		$response_arr['messages'] .= '<thead>';
					        		$response_arr['messages'] .= '<tr>';
					        		$response_arr['messages'] .= '<th>#</th>';
					        		$response_arr['messages'] .= '<th>Status</th>';
					        		$response_arr['messages'] .= '<th>Date / Time</th>';
					        		
					        		$response_arr['messages'] .= '</tr>';
					        		$response_arr['messages'] .= '<tbody>';

					        		foreach($order_statuses as $row){
					        			$i++;
					        			$id = $row->id;
					        			$status = $row->status;
					        			$date = $row->date;
					        			$time = $row->time;

					        			$response_arr['messages'] .= '<tr>';

					        			$response_arr['messages'] .= '<td>'.$i.'</td>';
					        			$response_arr['messages'] .= '<td>'.$status.'</td>';	
					        			$response_arr['messages'] .= '<td>'.$date. ' ' . $time .'</td>';

					        			$response_arr['messages'] .= '</tr>';
					        		}

					        		$response_arr['messages'] .= '</tbody>';
					        		$response_arr['messages'] .= '</table>';
					        		$response_arr['messages'] .= '</div>';
								}else{
									$response_arr['messages'] .= '<h4 class="text-warning">No Status To Display Here.</h4>';
								}
								$response_arr['messages'] .= '</div>';

	        				}	
	        			}	

					}
					echo json_encode($response_arr);
				}
			}



			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "add_order_status" && is_null($second_addition) && $this->northbridge_model->checkIfUserIsAdmin()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					$response_arr = array('success' => false,'messages' => '');
					if($this->input->post('product_id') && $this->input->post('center_leader_id')){
						$product_id = $this->input->post('product_id');
						$center_leader_id = $this->input->post('center_leader_id');

						$this->form_validation->set_rules('status','Status','trim|required');
							
						$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
						if($this->form_validation->run() == TRUE){
							$date = date("j M Y");
							$time = date("h:i:sa");

							$status = $this->input->post('status');

							$form_array = array(
								'status' => $status,
								'date' => $date,
								'time' => $time,
								'center_leader' => $center_leader_id,
								'product_id' => $product_id
							);

							if($this->northbridge_model->updateMiniImportationStatusTable($form_array)){
								$response_arr['success'] = true;

								$order_statuses = $this->northbridge_model->getMiniImportationOrderStatusesByProductIdAndCenterLeaderId($product_id,$center_leader_id);

								$response_arr['messages'] .= '<div id="order-status-div">';
								$response_arr['messages'] .= '<h3 class="text-center" style="font-weight: bold;">Order Status</h3>';
								if(is_array($order_statuses)){
									

									$i = 0;


									$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="margin-top: 40px;">';
					        		$response_arr['messages'] .= '<table class="table table-striped table-bordered wrap hover display" id="statuses-table" cellspacing="0" width="100%" style="width:100%">';
					        		$response_arr['messages'] .= '<thead>';
					        		$response_arr['messages'] .= '<tr>';
					        		$response_arr['messages'] .= '<th>#</th>';
					        		$response_arr['messages'] .= '<th>Status</th>';
					        		$response_arr['messages'] .= '<th>Date / Time</th>';
					        		$response_arr['messages'] .= '<th>Actions</th>';
					        		$response_arr['messages'] .= '</tr>';
					        		$response_arr['messages'] .= '<tbody>';

					        		foreach($order_statuses as $row){
					        			$i++;
					        			$id = $row->id;
					        			$status = $row->status;
					        			$date = $row->date;
					        			$time = $row->time;

					        			$response_arr['messages'] .= '<tr>';

					        			$response_arr['messages'] .= '<td>'.$i.'</td>';
					        			$response_arr['messages'] .= '<td>'.$status.'</td>';	
					        			$response_arr['messages'] .= '<td>'.$date. ' ' . $time .'</td>';
					        			$response_arr['messages'] .= '<td class="td-actions text-center">';
					                   	$response_arr['messages'] .= '<button type="button" rel="tooltip" title="Delete Status" class="btn btn-danger btn-link btn-lg" onclick="deleteStatus(this,event,'.$id.')">';
					                   	$response_arr['messages'] .= '<i class="fas fa-trash"></i>';
					                    $response_arr['messages'] .= '<div class="ripple-container"></div>';
					                    $response_arr['messages'] .= '</button>';
					                    $response_arr['messages'] .= '</td>';


					        			$response_arr['messages'] .= '</tr>';
					        		}

					        		$response_arr['messages'] .= '</tbody>';
					        		$response_arr['messages'] .= '</table>';
					        		$response_arr['messages'] .= '</div>';
								}else{
									$response_arr['messages'] .= '<h4 class="text-warning">No Status To Display Here. Click On The Floating Add Button To Add.</h4>';
								}
								$response_arr['messages'] .= '</div>';
							}
						}else{
							foreach($_POST as $key => $value){
								$response_arr['messages'][$key] = form_error($key);
							}
						}

					}
					echo json_encode($response_arr);
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "list_users_to_select_as_dispatcher" && is_null($second_addition) && $this->northbridge_model->checkIfUserIsAdmin()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}

					if($this->input->post('show_records')){
						$response_arr = array('success' => false,'messages' => '');
						
								
						$response_arr['success'] = true;

						$users = $this->northbridge_model->getUsersWhoAreNotDispatchers();

						if(is_array($users)){
							

							$i = 0;


							$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="margin-top: 40px;">';
			        		$response_arr['messages'] .= '<table class="table table-striped table-bordered wrap hover display" id="select-user-as-dispatcher-table" cellspacing="0" width="100%" style="width:100%">';
			        		$response_arr['messages'] .= '<thead>';
			        		$response_arr['messages'] .= '<tr>';
			        		$response_arr['messages'] .= '<th>#</th>';
			        		$response_arr['messages'] .= '<th>UserName</th>';
			        		$response_arr['messages'] .= '<th>Full Name</th>';
			        		$response_arr['messages'] .= '<th>Actions</th>';
			        		$response_arr['messages'] .= '</tr>';
			        		$response_arr['messages'] .= '<tbody>';

			        		foreach($users as $row){
			        			
			        			$id = $row->id;
			        			$user_name = $row->user_name;
			        			$full_name = $row->full_name;
			        			$slug = $row->slug;

			        			if(!$this->northbridge_model->checkIfUserIsAdmin1($id)){
			        				$i++;
				        			$response_arr['messages'] .= '<tr>';

				        			$response_arr['messages'] .= '<td>'.$i.'</td>';
				        			$response_arr['messages'] .= '<td><a href='.site_url('northbridge/'.$slug).' target="_blank">'.$user_name.'</a></td>';	
				        			$response_arr['messages'] .= '<td>'.$full_name.'</td>';
				        			$response_arr['messages'] .= '<td class="td-actions text-center">';
				                   	$response_arr['messages'] .= '<button type="button" rel="tooltip" data-full-name="'.$full_name.'" title="Add As Dispatcher" class="btn btn-primary btn-link btn-lg" onclick="addUserAsDispatcher(this,event,'.$id.')">';
				                   	$response_arr['messages'] .= '<i class="fas fa-plus"></i>';
				                    $response_arr['messages'] .= '<div class="ripple-container"></div>';
				                    $response_arr['messages'] .= '</button>';
				                    $response_arr['messages'] .= '</td>';


				        			$response_arr['messages'] .= '</tr>';
				        		}
			        		}

			        		$response_arr['messages'] .= '</tbody>';
			        		$response_arr['messages'] .= '</table>';
			        		$response_arr['messages'] .= '</div>';
						}else{
							$response_arr['messages'] .= '<h4 class="text-warning">No User Available.</h4>';
						}
						
							
						echo json_encode($response_arr);
					}
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "add_user_as_dispatcher" && is_null($second_addition) && $this->northbridge_model->checkIfUserIsAdmin()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}

					if($this->input->post('id')){
						$id = $this->input->post('id');
						$response_arr = array('success' => false,'messages' => '','invalid_user' => false,'full_name' => '');
						
						if($this->northbridge_model->getIfUserIdIsValid($id) && !$this->northbridge_model->checkIfUserIsAdmin1($id)){
							
							$form_array = array(
								'dispatcher' => 1
							);

							if($this->northbridge_model->updateUserTable($form_array,$id)){

								$response_arr['success'] = true;
								$response_arr['full_name'] = $this->northbridge_model->getUserParamById("full_name",$id);

								$users = $this->northbridge_model->getUsersWhoAreNotDispatchers();

								if(is_array($users)){
									

									$i = 0;


									$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="margin-top: 40px;">';
					        		$response_arr['messages'] .= '<table class="table table-striped table-bordered wrap hover display" id="select-user-as-dispatcher-table" cellspacing="0" width="100%" style="width:100%">';
					        		$response_arr['messages'] .= '<thead>';
					        		$response_arr['messages'] .= '<tr>';
					        		$response_arr['messages'] .= '<th>#</th>';
					        		$response_arr['messages'] .= '<th>UserName</th>';
					        		$response_arr['messages'] .= '<th>Full Name</th>';
					        		$response_arr['messages'] .= '<th>Actions</th>';
					        		$response_arr['messages'] .= '</tr>';
					        		$response_arr['messages'] .= '<tbody>';

					        		foreach($users as $row){
					        			
					        			$id = $row->id;
					        			$user_name = $row->user_name;
					        			$full_name = $row->full_name;
					        			$slug = $row->slug;

					        			if(!$this->northbridge_model->checkIfUserIsAdmin1($id)){
					        				$i++;
					        			
						        			$response_arr['messages'] .= '<tr>';

						        			$response_arr['messages'] .= '<td>'.$i.'</td>';
						        			$response_arr['messages'] .= '<td><a href='.site_url('northbridge/'.$slug).' target="_blank">'.$user_name.'</a></td>';	
						        			$response_arr['messages'] .= '<td>'.$full_name.'</td>';
						        			$response_arr['messages'] .= '<td class="td-actions text-center">';
						                   	$response_arr['messages'] .= '<button type="button" rel="tooltip" data-full-name="'.$full_name.'" title="Add As Dispatcher" class="btn btn-primary btn-link btn-lg" onclick="addUserAsDispatcher(this,event,'.$id.')">';
						                   	$response_arr['messages'] .= '<i class="fas fa-plus"></i>';
						                    $response_arr['messages'] .= '<div class="ripple-container"></div>';
						                    $response_arr['messages'] .= '</button>';
						                    $response_arr['messages'] .= '</td>';


						        			$response_arr['messages'] .= '</tr>';
						        		}
					        		}

					        		$response_arr['messages'] .= '</tbody>';
					        		$response_arr['messages'] .= '</table>';
					        		$response_arr['messages'] .= '</div>';
								}else{
									$response_arr['messages'] .= '<h4 class="text-warning">No User Available.</h4>';
								}
							}
						}else{
							$response_arr['invalid_user'] = true;
						}
						echo json_encode($response_arr);
					}
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "get_merchant_requests" && is_null($second_addition) && $this->northbridge_model->checkIfUserIsAdmin()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}

					if($this->input->post('show_records')){
						
						$response_arr = array('success' => true,'messages' => '');
						
						$merchant_requests = $this->northbridge_model->getAllMerchantRequests();

						if(is_array($merchant_requests)){
							$merchant_requests = array_values(array_reverse($merchant_requests));
							$response_arr['success'] = true;
							
							$i = 0;
							$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="margin-top: 40px;">';
			        		$response_arr['messages'] .= '<table class="table table-striped table-bordered no-wrap hover display" id="merchant-requests-table" cellspacing="0" width="100%" style="width:100%">';
			        		$response_arr['messages'] .= '<thead>';
			        		$response_arr['messages'] .= '<tr>';
			        		$response_arr['messages'] .= '<th>#</th>';
			        		$response_arr['messages'] .= '<th>UserName</th>';
			        		$response_arr['messages'] .= '<th>Full Name</th>';
			        		$response_arr['messages'] .= '<th>Phone Number</th>';
			        		$response_arr['messages'] .= '<th>Product Name</th>';
			        		$response_arr['messages'] .= '<th>Date Of Request</th>';
			        		
			        		$response_arr['messages'] .= '</tr>';
			        		$response_arr['messages'] .= '<tbody>';

			        		foreach($merchant_requests as $row){
			        			$i++;
			        			$id = $row->id;
			        			$user_id = $row->user_id;
			        			$user_name = $this->northbridge_model->getUserParamById("user_name",$user_id);
			        			$slug = $this->northbridge_model->getUserParamById("slug",$user_id);
			        			$full_name = $this->northbridge_model->getUserParamById("full_name",$user_id);
			        			$phone_code = $this->northbridge_model->getUserParamById("phone_code",$user_id);
			        			$phone_number = $this->northbridge_model->getUserParamById("phone",$user_id);
			        			$phone_number = "+" . $phone_code . "" . $phone_number;
			        			$product_name = $row->name;
			        			$date_of_request = $row->upload_date . " " . $row->upload_time;
			        			
		        			
			        			$response_arr['messages'] .= '<tr onclick="viewMerchantRequestInfo(this,event,'.$id.')">';

			        			$response_arr['messages'] .= '<td>'.$i.'</td>';
			        			$response_arr['messages'] .= '<td><a href='.site_url('northbridge/'.$slug).' target="_blank">'.$user_name.'</a></td>';	
			        			$response_arr['messages'] .= '<td>'.$full_name.'</td>';
			        			$response_arr['messages'] .= '<td>'.$phone_number.'</td>';
			        			$response_arr['messages'] .= '<td>'.$product_name.'</td>';
			        			$response_arr['messages'] .= '<td>'.$date_of_request.'</td>';

			        			$response_arr['messages'] .= '</tr>';
			        		}

			        		$response_arr['messages'] .= '</tbody>';
			        		$response_arr['messages'] .= '</table>';
			        		$response_arr['messages'] .= '</div>';
						}else{
							$response_arr['messages'] .= '<h4 class="text-warning">No New Merchant Request Made Yet.</h4>';
						}
							
						echo json_encode($response_arr);
					}
				}
			}	

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "view_dispaproved_merchant_requests" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}

					if($this->input->post('show_records')){
						$id = $this->input->post('id');
						$response_arr = array('success' => true,'messages' => '');
						$date = date("j M Y");
						$time = date("h:i:sa");

						$disapproved_requests = $this->northbridge_model->getDisapprovedRequests($user_id);
						if(is_array($disapproved_requests)){
							$disapproved_requests = array_values(array_reverse($disapproved_requests));
							$i = 0;

							$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="margin-top: 40px;">';
			        		$response_arr['messages'] .= '<table class="table table-striped table-bordered wrap hover display" id="disapproved-merchant-requests-table" cellspacing="0" width="100%" style="width:100%">';
			        		$response_arr['messages'] .= '<thead>';
			        		$response_arr['messages'] .= '<tr>';
			        		$response_arr['messages'] .= '<th>#</th>';
			        		$response_arr['messages'] .= '<th>Product Image</th>';
			        		$response_arr['messages'] .= '<th>Product Name</th>';
			        		$response_arr['messages'] .= '<th>Request Date / Time</th>';
			        		$response_arr['messages'] .= '</tr>';
			        		$response_arr['messages'] .= '<tbody>';

			        		foreach($disapproved_requests as $row){
			        			$i++;
			        			$id = $row->id;
								$user_id = $row->user_id;
								$name = $row->name;
								$image = $row->image;
								$quantity = $row->quantity;
								$old_price = $row->old_price;
								$new_price = $row->new_price;
								$quantity_purchased = $row->quantity_purchased;
								$expiry_date = $row->expiry_date;
								$expiry_time = $row->expiry_time;
								$upload_date = $row->upload_date;
								$upload_time = $row->upload_time;
								$weight = $row->weight;
								$length = $row->length;
								$width = $row->width;
								$height = $row->height;
								$description = $row->description;
								$shipping_fee = $row->shipping_fee;
								$order_status = $row->order_status;
								$refunded = $row->refunded;
								$disapproved = $row->disapproved;

			        			$response_arr['messages'] .= '<tr onclick="loadDisapprovedMerchantRequestInfo(this,event,'.$id.')">';

			        			$response_arr['messages'] .= '<td>'.$i.'</td>';
			        			$response_arr['messages'] .= '<td><img style="border-radius: 50%; width: 100px; height: 100px;" src="'.base_url('assets/images/'.$image).'"></td>';	
			        			$response_arr['messages'] .= '<td>'.$name .'</td>';
			        			$response_arr['messages'] .= '<td>'.$upload_date . ' ' . $upload_time .'</td>';
			        			
			        			$response_arr['messages'] .= '</tr>';
			        		}

						}else{
							$response_arr['messages'] .= '<h4 class="text-warning">No Disapproved Merchant Requests To Display Here.</h4>';
						}
						echo json_encode($response_arr);
					}
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "view_dispaproved_merchant_request_info" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}

					if($this->input->post('show_records') && $this->input->post('id')){
						$id = $this->input->post('id');
						$response_arr = array('success' => true,'messages' => '');
						$date = date("j M Y");
						$time = date("h:i:sa");

						$disapproved_request_info = $this->northbridge_model->getDisapprovedRequestInfo($user_id,$id);
						if(is_array($disapproved_request_info)){
							unset($disapproved_request_info[0]->id);
							unset($disapproved_request_info[0]->user_id);
							unset($disapproved_request_info[0]->quantity_purchased);
							unset($disapproved_request_info[0]->order_status);
							unset($disapproved_request_info[0]->refunded);
							unset($disapproved_request_info[0]->disapproved);
							foreach($disapproved_request_info[0] as $key => $value){
								if($key == "image"){
									$response_arr['messages'] .= '<h5>Product Image</h5>';
									$response_arr['messages'] .= '<img class="col-sm-6" src="'.base_url('assets/images/'.$value).'">';
								}else if($key == "quantity"){
									$response_arr['messages'] .= '<h5>Product Quantity</h5>';
									$response_arr['messages'] .= '<h6>' . number_format($value) . '</h6>';
								}else if($key == "old_price" || $key == "new_price" || $key == "shipping_fee" || $key == "weight" || $key == "length" || $key == "width" || $key == "height"){
									$response_arr['messages'] .= '<h5>'.$key.'</h5>';
									$response_arr['messages'] .= '<h6>' . number_format($value,2) . '</h6>';
								}else{
									$response_arr['messages'] .= '<h5>'.$key.'</h5>';
									$response_arr['messages'] .= '<h6>' . $value . '</h6>';
								}

							}
						}else{
							$response_arr['messages'] .= '<h4 class="text-warning">No Disapproved Merchant Requests To Display Here.</h4>';
						}
						echo json_encode($response_arr);
					}
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "disapprove_merchant_request" && is_null($second_addition) && $this->northbridge_model->checkIfUserIsAdmin()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}

					if($this->input->post('show_records') && $this->input->post('id')){
						$id = $this->input->post('id');
						$response_arr = array('success' => false);
						$date = date("j M Y");
						$time = date("h:i:sa");
						if($this->northbridge_model->disapproveMerchantRequest($id,$date,$time)){
							$response_arr['success'] = true;
						}
						echo json_encode($response_arr);
					}
				}
			}		
			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "view_merchant_request_info" && is_null($second_addition) && $this->northbridge_model->checkIfUserIsAdmin()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}

					if($this->input->post('show_records') && $this->input->post('id')){
						$id = $this->input->post('id');
						
						$response_arr = array('success' => false,'messages' => '');
						
						$merchant_request_info = $this->northbridge_model->getMerchantRequestInfo($id);

						if(is_array($merchant_request_info)){
							
							$response_arr['success'] = true;
							
							$i = 0;
							

			        		foreach($merchant_request_info as $row){
			        			$i++;
			        			$id = $row->id;
								$user_id = $row->user_id;
								$name = $row->name;
								$image = $row->image;
								$quantity = $row->quantity;
								$old_price = $row->old_price;
								$new_price = $row->new_price;
								$quantity_purchased = $row->quantity_purchased;
								$expiry_date = $row->expiry_date;
								$expiry_time = $row->expiry_time;
								$upload_date = $row->upload_date;
								$upload_time = $row->upload_time;
								$weight = $row->weight;
								$length = $row->length;
								$width = $row->width;
								$height = $row->height;
								$description = $row->description;
								$shipping_fee = $row->shipping_fee;
								$order_status = $row->order_status;
								$refunded = $row->refunded;
								$disapproved = $row->disapproved;
			        			$user_name = $this->northbridge_model->getUserParamById("user_name",$user_id);
			        			$slug = $this->northbridge_model->getUserParamById("slug",$user_id);
			        			$full_name = $this->northbridge_model->getUserParamById("full_name",$user_id);
			        			$phone_code = $this->northbridge_model->getUserParamById("phone_code",$user_id);
			        			$phone_number = $this->northbridge_model->getUserParamById("phone",$user_id);
			        			$phone_number = "+" . $phone_code . "" . $phone_number;
			        			$product_name = $row->name;
			        			$date_of_request = $row->upload_date . " " . $row->upload_time;

			        			$response_arr['messages'] .= '<h3 class="text-center">Merchant Info</h3>';
			        			$response_arr['messages'] .= '<h5>User Name: </h5>';
			        			$response_arr['messages'] .= '<h6><a target="_blank" href="'.site_url('northbridge/'.$slug).'">'.$user_name.'</a></h6>';

			        			$response_arr['messages'] .= '<h5>Full Name: </h5>';
			        			$response_arr['messages'] .= '<h6>'.$full_name.'</h6>';

			        			$response_arr['messages'] .= '<h5>Phone Number: </h5>';
			        			$response_arr['messages'] .= '<h6>'.$phone_number.'</h6>';

								$response_arr['messages'] .= '<h5>Date Of Request: </h5>';
			        			$response_arr['messages'] .= '<h6>'.$date_of_request.'</h6>';

			        			$response_arr['messages'] .= '<h3 class="text-center">Product Info</h3>';


					            $attr = array('id' => 'add-new-product-form','onsubmit' => 'approveMerchantProduct(this,event)','data-id' => $id);
					           	$response_arr['messages'] .= form_open_multipart('northbridge/submit_approve_merchant_product_form',$attr);
					          	$response_arr['messages'] .= '<input type="hidden" name="id" id="id" value="'.$id.'" class="form-control">';
					          
					            $response_arr['messages'] .= '<div class="form-group">';
					            $response_arr['messages'] .= '<label for="name">Product Name: </label>';
					            $response_arr['messages'] .= '<input type="text" name="name" id="name" value="'.$name.'" class="form-control">';
					            $response_arr['messages'] .= '<span class="form-error"></span>';
					            $response_arr['messages'] .= '</div>';

					            $response_arr['messages'] .= '<div class="form-group">';
					            $response_arr['messages'] .= '<label for="quantity">Product Quantity: </label>';
					            $response_arr['messages'] .= '<input type="number" name="quantity" id="quantity" value="'.$quantity.'" class="form-control">';
					            $response_arr['messages'] .= '<span class="form-error"></span>';
					            $response_arr['messages'] .= '</div>';

					            $response_arr['messages'] .= '<div class="form-group">';
					            $response_arr['messages'] .= '<label for="old_price">Product Old Price: </label>';
					            $response_arr['messages'] .= '<input type="number" step="any" name="old_price" id="old_price" class="form-control" value="'.$old_price.'">';
					            $response_arr['messages'] .= '<span class="form-error"></span>';
					            $response_arr['messages'] .= '</div>';

					            $response_arr['messages'] .= '<div class="form-group">';
					            $response_arr['messages'] .= '<label for="new_price">Product New Price: </label>';
					            $response_arr['messages'] .= '<input type="number" step="any" name="new_price" id="new_price" class="form-control" value="'.$new_price.'">';
					            $response_arr['messages'] .= '<span class="form-error"></span>';
					            $response_arr['messages'] .= '</div>';

					            $response_arr['messages'] .= '<div class="form-group">';
					            $response_arr['messages'] .= '<label for="expiry_date">Product Expiry Date: </label>';
					            $response_arr['messages'] .= '<input type="date" name="expiry_date" id="expiry_date" class="form-control" value="'.$expiry_date.'">';
					            $response_arr['messages'] .= '<span class="form-error"></span>';
					            $response_arr['messages'] .= '</div>';

					            $response_arr['messages'] .= '<div >';
					            $response_arr['messages'] .= '<img class="col-sm-6" src="'.base_url('assets/images/'.$image).'">';
					            $response_arr['messages'] .= '</div>';

					            $response_arr['messages'] .= '<div class="form-group">';
					            $response_arr['messages'] .= '<label for="weight">Product Weight(kg): </label>';
					            $response_arr['messages'] .= '<input type="number" step="any" name="weight" id="weight" class="form-control" value="'.$weight.'">';
					            $response_arr['messages'] .= '<span class="form-error"></span>';
					            $response_arr['messages'] .= '</div>';

					            $response_arr['messages'] .= '<div class="form-group">';
					            $response_arr['messages'] .= '<label for="length">Product Length(cm): </label>';
					            $response_arr['messages'] .= '<input type="number" step="any" name="length" id="length" class="form-control" value="'.$length.'">';
					            $response_arr['messages'] .= '<span class="form-error"></span>';
					            $response_arr['messages'] .= '</div>';

					            $response_arr['messages'] .= '<div class="form-group">';
					            $response_arr['messages'] .= '<label for="width">Product Width(cm): </label>';
					            $response_arr['messages'] .= '<input type="number" step="any" name="width" id="width" class="form-control" value="'.$width.'">';
					            $response_arr['messages'] .= '<span class="form-error"></span>';
					            $response_arr['messages'] .= '</div>';

					            $response_arr['messages'] .= '<div class="form-group">';
					            $response_arr['messages'] .= '<label for="height">Product Height(cm): </label>';
					            $response_arr['messages'] .= '<input type="number" step="any" name="height" id="height" class="form-control" value="'.$height.'">';
					            $response_arr['messages'] .= '<span class="form-error"></span>';
					            $response_arr['messages'] .= '</div>';

					            $response_arr['messages'] .= '<div class="form-group">';
					            $response_arr['messages'] .= '<label for="new_price">Product Shipping Fee: </label>';
					            $response_arr['messages'] .= '<input type="number" step="any" name="shipping_fee" id="shipping_fee" class="form-control" value="'.$shipping_fee.'">';
					            $response_arr['messages'] .= '<span class="form-error"></span>';
					            $response_arr['messages'] .= '</div>';

					            $response_arr['messages'] .= '<div class="form-group">';
					            $response_arr['messages'] .= '<label for="description">Product Description: </label>';
					            $response_arr['messages'] .= '<textarea name="description" id="description" cols="30" rows="10" class="form-control">'.$description.'</textarea>';
					            $response_arr['messages'] .= '<span class="form-error"></span>';
					            $response_arr['messages'] .= '</div>';

					            $response_arr['messages'] .= '<input type="submit" class="btn btn-primary" value="APPROVE">';

					          	$response_arr['messages'] .= '</form>';

			        			
			        		}

			        		
						}else{
							$response_arr['messages'] .= '<h4 class="text-warning">No New Merchant Request Made Yet.</h4>';
						}
							
						echo json_encode($response_arr);
					}
				}
			}					
				

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "delete_order_status_mini_importation_info" && is_null($second_addition) && $this->northbridge_model->checkIfUserIsAdmin()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					$response_arr = array('success' => false,'messages' => '');
					if($this->input->post('id') ){
						$id = $this->input->post('id');
						$product_id = $this->northbridge_model->getMiniImporataionOrderStatusParamById("product_id",$id);
						$center_leader_id = $this->northbridge_model->getMiniImporataionOrderStatusParamById("center_leader",$id);
						if($this->northbridge_model->deleteMiniImportationStatusTable($id)){
							$response_arr['success'] = true;

							$response_arr['messages'] .= '<div id="order-status-div">';
							$response_arr['messages'] .= '<h3 class="text-center" style="font-weight: bold;">Order Status</h3>';

							$order_statuses = $this->northbridge_model->getMiniImportationOrderStatusesByProductIdAndCenterLeaderId($product_id,$center_leader_id);
							if(is_array($order_statuses)){
								

								$i = 0;

								$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="margin-top: 40px;">';
				        		$response_arr['messages'] .= '<table class="table table-striped table-bordered wrap hover display" id="statuses-table" cellspacing="0" width="100%" style="width:100%">';
				        		$response_arr['messages'] .= '<thead>';
				        		$response_arr['messages'] .= '<tr>';
				        		$response_arr['messages'] .= '<th>#</th>';
				        		$response_arr['messages'] .= '<th>Status</th>';
				        		$response_arr['messages'] .= '<th>Date / Time</th>';
				        		$response_arr['messages'] .= '<th>Actions</th>';
				        		$response_arr['messages'] .= '</tr>';
				        		$response_arr['messages'] .= '<tbody>';

				        		foreach($order_statuses as $row){
				        			$i++;
				        			$id = $row->id;
				        			$status = $row->status;
				        			$date = $row->date;
				        			$time = $row->time;

				        			$response_arr['messages'] .= '<tr>';

				        			$response_arr['messages'] .= '<td>'.$i.'</td>';
				        			$response_arr['messages'] .= '<td>'.$status.'</td>';	
				        			$response_arr['messages'] .= '<td>'.$date. ' ' . $time .'</td>';
				        			$response_arr['messages'] .= '<td class="td-actions text-center">';
				                   	$response_arr['messages'] .= '<button type="button" rel="tooltip" title="Delete Status" class="btn btn-danger btn-link btn-lg" onclick="deleteStatus(this,event,'.$id.')">';
				                   	$response_arr['messages'] .= '<i class="fas fa-trash"></i>';
				                    $response_arr['messages'] .= '<div class="ripple-container"></div>';
				                    $response_arr['messages'] .= '</button>';
				                    $response_arr['messages'] .= '</td>';


				        			$response_arr['messages'] .= '</tr>';
				        		}

				        		$response_arr['messages'] .= '</tbody>';
				        		$response_arr['messages'] .= '</table>';
				        		$response_arr['messages'] .= '</div>';
							}else{
								$response_arr['messages'] .= '<h4 class="text-warning">No Status To Display Here. Click On The Floating Add Button To Add.</h4>';
							}
							$response_arr['messages'] .= '</div>';
						}
					}
					echo json_encode($response_arr);
				}
			}	

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "select_this_user_to_dispatch" && is_null($second_addition) && $this->northbridge_model->checkIfUserIsAdmin()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					$response_arr = array('success' => false,'messages' => '','full_name' => '','invalid_user' => false,'already_assigned' => false);
					if($this->input->post('dispatcher_id') && $this->input->post('center_leader_id') && $this->input->post('product_id')){

						$dispatcher_id = $this->input->post('dispatcher_id');
						$center_leader_id = $this->input->post('center_leader_id');
						$product_id = $this->input->post('product_id');

						if($this->northbridge_model->getIfUserIdIsValid($dispatcher_id) && !$this->northbridge_model->checkIfUserIsAdmin1($dispatcher_id) && ($this->northbridge_model->getUserParamById("dispatcher",$dispatcher_id)) == 1){
							if($this->northbridge_model->checkIfProductCenterLeaderHasADispatcherAlready($center_leader_id,$product_id)){
								$date =	date("j M Y");
								$time = date("H:i:s");
								$form_array = array(
									'sent_to_dispatcher' => 1,
									'dispatcher' => $dispatcher_id,
									'sent_to_dispatcher_date' => $date,
									'sent_to_dispatcher_time' => $time
								);

								if($this->northbridge_model->updateMiniImportationOrderDispatcher($form_array,$center_leader_id,$product_id)){
									$title = "Notice Of Request As Dispatcher";
					        		$message = "This Is To Inform You That You Have Been Selected As Dispatcher In Mini Importation. Go To Your Dispatcher Panel In Mini Importation To Find Out More.</em>";
					        		

									$form_array = array(
										'sender' => "Admin",
										'receiver' => $dispatcher_id,
										'title' => $title,
										'message' => $message,
										'date_sent' => $date,
										'time_sent' => $time,
										'type' => 'misc'
									);

									if($this->northbridge_model->sendMessage($form_array)){
										$response_arr['success'] = true;
									}
								}
							}else{
								$response_arr['already_assigned'] = true;
							}
						}else{
							$response_arr['invalid_user'] = true;
						}
						
			        }
			        echo json_encode($response_arr);
			    }
			}				

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "get_products_on_way_to_center_leader" && is_null($second_addition) && $this->northbridge_model->checkIfUserIsAdmin()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					$response_arr = array('success' => false,'messages' => '');
					if($this->input->post('show_records')){
						$response_arr['success'] = true;
						$product_ids = $this->northbridge_model->getCenterLeaderOnTheWayProducts();
						if(is_array($product_ids) && count($product_ids) > 0){
							$j = 0;

							$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="">';
			        		$response_arr['messages'] .= '<table class="table table-striped table-bordered wrap hover display" id="products-on-way-to-center-leader-table" cellspacing="0" width="100%" style="width:100%">';
			        		$response_arr['messages'] .= '<thead>';
			        		$response_arr['messages'] .= '<tr>';
			        		$response_arr['messages'] .= '<th>#</th>';
			        		$response_arr['messages'] .= '<th>Product Name</th>';
			        		$response_arr['messages'] .= '<th>Quantity</th>';
			        		$response_arr['messages'] .= '<th>Center Leader UserName</th>';
			        		$response_arr['messages'] .= '<th>State</th>';
			        		$response_arr['messages'] .= '<th>Local Government</th>';
			        		$response_arr['messages'] .= '<th>Current Status</th>';
			        		
			        		$response_arr['messages'] .= '</tr>';
			        		$response_arr['messages'] .= '<tbody>';


			        		for($k = 0; $k < count($product_ids); $k++){
			        			

			        			$product_id = $product_ids[$k];

			        			$product_name = $this->northbridge_model->getProductParamByIdMiniImportation("name",$product_id);
			        			$center_leader_ids = $this->northbridge_model->getMiniImportationCenterLeaderUserIds($product_id);

			        			if(is_array($center_leader_ids) && count($center_leader_ids) > 0){
			        				for($i = 0; $i < count($center_leader_ids); $i++){
			        					$j++;
			        					$center_leader_id = $center_leader_ids[$i];
			        					$center_leader_user_name = $this->northbridge_model->getUserNameById($center_leader_id);

			        					$quantity = $this->northbridge_model->getMiniImportationProductQuantityComingToCenterLeader($product_id,$center_leader_id);
			        					$center_leader_state = $this->northbridge_model->getUserParamById("state_id",$center_leader_id);
			        					$center_leader_local_govt = $this->northbridge_model->getUserParamById("local_government",$center_leader_id);
			        					$center_leader_slug = $this->northbridge_model->getUserParamById("slug",$center_leader_id);

			        					$center_leader_local_govt = $this->northbridge_model->getLocalGovernmentByStateIdAndId($center_leader_state,$center_leader_local_govt);
			        					$center_leader_state = $this->northbridge_model->getStateById($center_leader_state);

			        					$current_status = $this->northbridge_model->getMiniImportationOrderCurrentStatus($center_leader_id,$product_id);

			        					if($current_status == ""){
			        						$current_status = "No Status Entered Here";
			        					}

			        					$response_arr['messages'] .= '<tr onclick="loadCenterLeaderProductInfo(this,event)" data-product-id="'.$product_id.'" data-center-leader="'.$center_leader_id.'">';
			        					$response_arr['messages'] .= '<td>'.$j.'</td>';
			        					$response_arr['messages'] .= '<td>'.$product_name.'</td>';
			        					$response_arr['messages'] .= '<td>'.$quantity.'</td>';
			        					$response_arr['messages'] .= '<td><a target="_blank" href="'.site_url('northbridge/'.$center_leader_slug).'">'.$center_leader_user_name.'</a></td>';
			        					$response_arr['messages'] .= '<td>'.$center_leader_state.'</td>';
			        					$response_arr['messages'] .= '<td>'.$center_leader_local_govt.'</td>';
			        					$response_arr['messages'] .= '<td>'.$current_status.'</td>';

			        					$response_arr['messages'] .= '</tr>';

			        				}
			        			}

			        		}


			        		$response_arr['messages'] .= '</tbody>';
			        		$response_arr['messages'] .= '</table>';
			        		$response_arr['messages'] .= '</div>';
			        	}else{
			        		$response_arr['messages'] .= '<h4 class="text-warning">No Data To Display Here</h4>';
			        	}
			        }
			        echo json_encode($response_arr);
			    }
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "view_orders_awaiting_approval_on_center_leaders_page_mini_importation" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					$response_arr = array('success' => false,'messages' => '');
					if($this->input->post('show_records')){
						$response_arr['success'] = true;
						$product_ids = $this->northbridge_model->viewOrdersAwaitingCenterLeadersApproval();
						if(is_array($product_ids) && count($product_ids) > 0){
							$j = 0;

							$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="">';
			        		$response_arr['messages'] .= '<table class="table table-striped table-bordered wrap hover display" id="orders-awaiting-approval-table" cellspacing="0" width="100%" style="width:100%">';
			        		$response_arr['messages'] .= '<thead>';
			        		$response_arr['messages'] .= '<tr>';
			        		$response_arr['messages'] .= '<th>#</th>';
			        		$response_arr['messages'] .= '<th>Product Name</th>';
			        		$response_arr['messages'] .= '<th>Quantity</th>';
			        		$response_arr['messages'] .= '<th>Center Leader UserName</th>';
			        		$response_arr['messages'] .= '<th>State</th>';
			        		$response_arr['messages'] .= '<th>Local Government</th>';
			        		$response_arr['messages'] .= '<th>Current Status</th>';
			        		
			        		$response_arr['messages'] .= '</tr>';
			        		$response_arr['messages'] .= '<tbody>';


			        		for($k = 0; $k < count($product_ids); $k++){
			        			

			        			$product_id = $product_ids[$k];

			        			$product_name = $this->northbridge_model->getProductParamByIdMiniImportation("name",$product_id);
			        			$center_leader_ids = $this->northbridge_model->getMiniImportationCenterLeaderUserIdsAwaitingCenterLeaderApproval($product_id);

			        			if(is_array($center_leader_ids) && count($center_leader_ids) > 0){
			        				for($i = 0; $i < count($center_leader_ids); $i++){
			        					$j++;
			        					$center_leader_id = $center_leader_ids[$i];
			        					$center_leader_user_name = $this->northbridge_model->getUserNameById($center_leader_id);

			        					$quantity = $this->northbridge_model->getMiniImportationProductQuantityComingToCenterLeader($product_id,$center_leader_id);
			        					$center_leader_state = $this->northbridge_model->getUserParamById("state_id",$center_leader_id);
			        					$center_leader_local_govt = $this->northbridge_model->getUserParamById("local_government",$center_leader_id);
			        					$center_leader_slug = $this->northbridge_model->getUserParamById("slug",$center_leader_id);

			        					$center_leader_local_govt = $this->northbridge_model->getLocalGovernmentByStateIdAndId($center_leader_state,$center_leader_local_govt);
			        					$center_leader_state = $this->northbridge_model->getStateById($center_leader_state);

			        					$current_status = $this->northbridge_model->getMiniImportationOrderCurrentStatus($center_leader_id,$product_id);

			        					if($current_status == ""){
			        						$current_status = "No Status Entered Here";
			        					}

			        					$response_arr['messages'] .= '<tr onclick="acceptOrderAwaitingCenterLeaderApproval(this,event)" data-product-id="'.$product_id.'" data-center-leader="'.$center_leader_id.'">';
			        					$response_arr['messages'] .= '<td>'.$j.'</td>';
			        					$response_arr['messages'] .= '<td>'.$product_name.'</td>';
			        					$response_arr['messages'] .= '<td>'.$quantity.'</td>';
			        					$response_arr['messages'] .= '<td><a target="_blank" href="'.site_url('northbridge/'.$center_leader_slug).'">'.$center_leader_user_name.'</a></td>';
			        					$response_arr['messages'] .= '<td>'.$center_leader_state.'</td>';
			        					$response_arr['messages'] .= '<td>'.$center_leader_local_govt.'</td>';
			        					$response_arr['messages'] .= '<td>'.$current_status.'</td>';

			        					$response_arr['messages'] .= '</tr>';

			        				}
			        			}

			        		}


			        		$response_arr['messages'] .= '</tbody>';
			        		$response_arr['messages'] .= '</table>';
			        		$response_arr['messages'] .= '</div>';
			        	}else{
			        		$response_arr['messages'] .= '<h4 class="text-warning">No Data To Display Here</h4>';
			        	}
			        }
			        echo json_encode($response_arr);
			    }
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "mark_mini_importatio_order_as_delivered_to_final_user" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					$response_arr = array('success' => false,'messages' => '');
					if($this->input->post('order_id')){
						$date =	date("j M Y");
						$time = date("H:i:s");
						$order_id = $this->input->post('order_id');

						$order_code = $this->northbridge_model->getMiniImportationOrderParamById("order_code",$order_id);
						$product_id = $this->northbridge_model->getMiniImportationOrderParamById("product_id",$order_id);
						$sharer_quantity = $this->northbridge_model->getMiniImportationOrderParamById("quantity",$order_id);

						$center_leader_id = $this->northbridge_model->getMiniImportationOrderParamById("center_leader",$order_id);
						// echo $center_leader_id;
						$center_leader_user_name = $this->northbridge_model->getUserParamById("user_name",$center_leader_id);
						$center_leader_slug = $this->northbridge_model->getUserParamById("slug",$center_leader_id);
						$center_leader_full_name = $this->northbridge_model->getUserParamById("full_name",$center_leader_id);
						$center_leader_address = $this->northbridge_model->getUserParamById("address",$center_leader_id);
						$center_leader_phone_code = $this->northbridge_model->getUserParamById("phone_code",$center_leader_id);
						$center_leader_phone_number = $this->northbridge_model->getUserParamById("phone",$center_leader_id);

						$center_leader_city = $this->northbridge_model->getUserParamById("city",$center_leader_id);

						$center_leader_local_govt = $this->northbridge_model->getUserParamById("local_government",$center_leader_id);
						$center_leader_state = $this->northbridge_model->getUserParamById("state_id",$center_leader_id);

						$center_leader_local_govt = $this->northbridge_model->getLocalGovernmentByStateIdAndId($center_leader_state,$center_leader_local_govt);
		        		$center_leader_state = $this->northbridge_model->getStateById($center_leader_state);
		        		$center_leader_country = $this->northbridge_model->getUserParamById("country_id",$center_leader_id);

    					$center_leader_country = $this->northbridge_model->getCountryById($center_leader_country);

						$product_name = $this->northbridge_model->getProductParamByIdMiniImportation("name",$product_id);

						if($user_id == $center_leader_id){
							if($this->northbridge_model->markOrderAsDeliveredToFinalUserByCenterLeader($order_id,$user_id)){
								

								$sharer_id = $this->northbridge_model->getMiniImportationOrderParamById("user_id",$order_id);

			        			$sharer_username = $this->northbridge_model->getUserParamById("user_name",$sharer_id);
			        			$sharer_full_name = $this->northbridge_model->getUserParamById("full_name",$sharer_id);
			        			$sharer_slug = $this->northbridge_model->getUserParamById("slug",$sharer_id);
			        			

			        			$title = "Goods Delivered To You";
				        		$message = "This Is To Inform You That  Your Center Leader has Marked The Product With The Following Details As Delivered.<br> If You Picked Up This Order, Click The Button At The End Of This Message To Verify That You Did And Leave A Review.";

				        		$message .= "<p><b>Product Name: </b><em class='text-primary'>".$product_name."</em></p>";

				        		$message .= "<p><b>Product Quantity: </b><em class='text-primary'>".$sharer_quantity." Unit(s)</em></p>";

				        		$message .= "<p><b>Order Code: </b><em class='text-primary'>".$order_code."</em></p>";


				        		$message .= "<h4 class='text-center'>Center Leader Info</h4>";

				        		$message .= "<p><b>Center Leader Name: </b><a target='_blank' href='".site_url('northbridge/'.$center_leader_slug)."'>".$center_leader_full_name."</a></p>";

				        		$message .= "<p><b>Center Leader Phone Number: </b><em class='text-primary'>+".$center_leader_phone_code . '' . $center_leader_phone_number ."</em></p>";

				        		$message .= "<p><b>Center Leader Address: </b><em class='text-primary'>".$center_leader_address."</em></p>";

				        		$message .= "<p><b>Center Leader City: </b><em class='text-primary'>".$center_leader_city."</em></p>";

				        		$message .= "<p><b>Center Leader Local Government: </b><em class='text-primary'>".$center_leader_local_govt."</em></p>";

				        		$message .= "<p><b>Center Leader State: </b><em class='text-primary'>".$center_leader_state."</em></p>";

				        		$message .= "<p><b>Center Leader Country: </b><em class='text-primary'>".$center_leader_country."</em></p>";

				        		$btn_1 = "<a href='".site_url('northbridge/mini_importation?accept_product_delivered=true&order_id='.$order_id)."' class='btn btn-primary'>Click Here</a>";
				        		
				        		

								$form_array = array(
									'sender' => "Admin",
									'receiver' => $sharer_id,
									'title' => $title,
									'message' => $message,
									'date_sent' => $date,
									'time_sent' => $time,
									'type' => 'misc',
									'btn_1' => $btn_1
								);

								if($this->northbridge_model->sendMessage($form_array)){
									$response_arr['success'] = true;
								}
							}
						}

					}
					echo json_encode($response_arr);
				}
			}		

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "view_users_who_have_share_in_this_order_center_leader" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					$response_arr = array('success' => false,'messages' => '','product_name' => '');
					if($this->input->post('show_records') && $this->input->post('product_id') && $this->input->post('center_leader')){
						
						$product_id = $this->input->post('product_id');
						$center_leader_id = $this->input->post('center_leader');
						if($center_leader_id == $user_id){
							$users = $this->northbridge_model->getUsersWhoHaveShareInOrderByProductIdAndCenterLeaderId($product_id,$center_leader_id);

							if(is_array($users)){
								$product_name = $this->northbridge_model->getProductParamByIdMiniImportation("name",$product_id);
								$response_arr['product_name'] = $product_name;
								$response_arr['success'] = true;
								$i = 0;

								$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="">';
				        		$response_arr['messages'] .= '<table class="table table-striped table-bordered wrap hover display" id="users-who-have-share-in-this-order-table" cellspacing="0" width="100%" style="width:100%">';
				        		$response_arr['messages'] .= '<thead>';
				        		$response_arr['messages'] .= '<tr>';
				        		$response_arr['messages'] .= '<th>#</th>';
				        		$response_arr['messages'] .= '<th>Full Name</th>';
				        		$response_arr['messages'] .= '<th>Quantity Requested</th>';
				        		$response_arr['messages'] .= '<th>Date Of Order</th>';
				        		$response_arr['messages'] .= '<th>Actions</th>';
				        		$response_arr['messages'] .= '</tr>';
				        		$response_arr['messages'] .= '<tbody>';
				        		foreach($users as $row){
				        			$i++;
				        			$id = $row->id;
				        			$sharer_id = $row->user_id;
				        			$sharer_username = $this->northbridge_model->getUserParamById("user_name",$sharer_id);
				        			$sharer_full_name = $this->northbridge_model->getUserParamById("full_name",$sharer_id);
				        			$sharer_slug = $this->northbridge_model->getUserParamById("slug",$sharer_id);
				        			$quantity_requested = $row->quantity;
				        			$date_of_order = $row->check_out_date . " " .$row->check_out_time;


				        			$response_arr['messages'] .= '<tr>';
				        			$response_arr['messages'] .= '<td>'.$i.'</td>';
				        			$response_arr['messages'] .= '<td><a target="_blank" href="'.site_url('northbridge/'.$sharer_slug).'">'.$sharer_full_name.'</a></td>';
				        			$response_arr['messages'] .= '<td>'.number_format($quantity_requested).' Unit(s)</td>';
				        			$response_arr['messages'] .= '<td>'.$date_of_order.'</td>';

				        			$response_arr['messages'] .= '<td class="td-actions text-center">';
				                   	$response_arr['messages'] .= '<button type="button" rel="tooltip" title="Mark This Product As Delivered To '.$sharer_full_name. '" class="btn btn-primary btn-link btn-lg" onclick="markThisProductAsDelivered(this,event,'.$id.')">';
				                   	$response_arr['messages'] .= '<i style="font-size: 20px;" class="fas fa-check-square"></i>';
				                    $response_arr['messages'] .= '<div class="ripple-container"></div>';
				                    $response_arr['messages'] .= '</button>';
				                    $response_arr['messages'] .= '</td>';

				        			$response_arr['messages'] .= '</tr>';
				        		}
				        		$response_arr['messages'] .= '</tbody>';
				        	}
				        }
			        }
			        echo json_encode($response_arr);
			    }
			}        	

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "view_orders_with_your_approval_on_center_leaders_page_mini_importation" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					$response_arr = array('success' => false,'messages' => '');
					if($this->input->post('show_records')){
						$response_arr['success'] = true;
						$product_ids = $this->northbridge_model->viewOrdersWithCenterLeadersApproval();
						if(is_array($product_ids) && count($product_ids) > 0){
							$j = 0;

							$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="">';
			        		$response_arr['messages'] .= '<table class="table table-striped table-bordered wrap hover display" id="orders-with-your-approval-table" cellspacing="0" width="100%" style="width:100%">';
			        		$response_arr['messages'] .= '<thead>';
			        		$response_arr['messages'] .= '<tr>';
			        		$response_arr['messages'] .= '<th>#</th>';
			        		$response_arr['messages'] .= '<th>Product Name</th>';
			        		$response_arr['messages'] .= '<th>Quantity</th>';
			        		$response_arr['messages'] .= '<th>Center Leader UserName</th>';
			        		$response_arr['messages'] .= '<th>State</th>';
			        		$response_arr['messages'] .= '<th>Local Government</th>';
			        		$response_arr['messages'] .= '<th>Current Status</th>';
			        		
			        		$response_arr['messages'] .= '</tr>';
			        		$response_arr['messages'] .= '<tbody>';


			        		for($k = 0; $k < count($product_ids); $k++){
			        			

			        			$product_id = $product_ids[$k];

			        			$product_name = $this->northbridge_model->getProductParamByIdMiniImportation("name",$product_id);
			        			$center_leader_ids = $this->northbridge_model->getMiniImportationCenterLeaderUserIdsWithCenterLeaderApproval($product_id);

			        			if(is_array($center_leader_ids) && count($center_leader_ids) > 0){
			        				for($i = 0; $i < count($center_leader_ids); $i++){
			        					$j++;
			        					$center_leader_id = $center_leader_ids[$i];
			        					$center_leader_user_name = $this->northbridge_model->getUserNameById($center_leader_id);

			        					$quantity = $this->northbridge_model->getMiniImportationProductQuantityComingToCenterLeader($product_id,$center_leader_id);
			        					$center_leader_state = $this->northbridge_model->getUserParamById("state_id",$center_leader_id);
			        					$center_leader_local_govt = $this->northbridge_model->getUserParamById("local_government",$center_leader_id);
			        					$center_leader_slug = $this->northbridge_model->getUserParamById("slug",$center_leader_id);

			        					$center_leader_local_govt = $this->northbridge_model->getLocalGovernmentByStateIdAndId($center_leader_state,$center_leader_local_govt);
			        					$center_leader_state = $this->northbridge_model->getStateById($center_leader_state);

			        					$current_status = $this->northbridge_model->getMiniImportationOrderCurrentStatus($center_leader_id,$product_id);

			        					if($current_status == ""){
			        						$current_status = "No Status Entered Here";
			        					}

			        					$response_arr['messages'] .= '<tr onclick="viewUsersWhoHaveShareInThisOrder(this,event)" data-product-id="'.$product_id.'" data-center-leader="'.$center_leader_id.'">';
			        					$response_arr['messages'] .= '<td>'.$j.'</td>';
			        					$response_arr['messages'] .= '<td>'.$product_name.'</td>';
			        					$response_arr['messages'] .= '<td>'.$quantity.'</td>';
			        					$response_arr['messages'] .= '<td><a target="_blank" href="'.site_url('northbridge/'.$center_leader_slug).'">'.$center_leader_user_name.'</a></td>';
			        					$response_arr['messages'] .= '<td>'.$center_leader_state.'</td>';
			        					$response_arr['messages'] .= '<td>'.$center_leader_local_govt.'</td>';
			        					$response_arr['messages'] .= '<td>'.$current_status.'</td>';

			        					$response_arr['messages'] .= '</tr>';

			        				}
			        			}

			        		}


			        		$response_arr['messages'] .= '</tbody>';
			        		$response_arr['messages'] .= '</table>';
			        		$response_arr['messages'] .= '</div>';
			        	}else{
			        		$response_arr['messages'] .= '<h4 class="text-warning">No Data To Display Here</h4>';
			        	}
			        }
			        echo json_encode($response_arr);
			    }
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "accept_dispatcher_request" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					$response_arr = array('success' => false,'messages' => '');
					if($this->input->post('center_leader') && $this->input->post('product_id')){
						$product_id = $this->input->post('product_id');
						$center_leader_id = $this->input->post('center_leader');

						if($this->northbridge_model->confirmThisIsTheRealDispatchOfficer($user_id,$product_id,$center_leader_id)){
							$form_array = array(
								'with_dispatcher' => 1
							);

							if($this->northbridge_model->updateMiniImportationOrderDispatcherAsAccepted($product_id,$center_leader_id)){
								$response_arr['success'] = true;
							}
						}
					}
					echo json_encode($response_arr);
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "accept_that_center_leader_has_received_package" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					$date =	date("j M Y");
					$time = date("H:i:s");
					$response_arr = array('success' => false,'messages' => '');
					if($this->input->post('center_leader') && $this->input->post('product_id')){
						$product_id = $this->input->post('product_id');
						$center_leader_id = $this->input->post('center_leader');

						if($user_id == $center_leader_id){
							if($this->northbridge_model->updateMiniImportationOrderCenterLeaderrAsReceived($product_id,$center_leader_id)){
								$center_leader_user_name = $this->northbridge_model->getUserParamById("user_name",$center_leader_id);
								$center_leader_slug = $this->northbridge_model->getUserParamById("slug",$center_leader_id);
								$center_leader_full_name = $this->northbridge_model->getUserParamById("full_name",$center_leader_id);
								$center_leader_address = $this->northbridge_model->getUserParamById("address",$center_leader_id);
								$center_leader_phone_code = $this->northbridge_model->getUserParamById("phone_code",$center_leader_id);
								$center_leader_phone_number = $this->northbridge_model->getUserParamById("phone",$center_leader_id);

								$center_leader_city = $this->northbridge_model->getUserParamById("city",$center_leader_id);

								$center_leader_local_govt = $this->northbridge_model->getUserParamById("local_government",$center_leader_id);
								$center_leader_state = $this->northbridge_model->getUserParamById("state_id",$center_leader_id);

								$center_leader_local_govt = $this->northbridge_model->getLocalGovernmentByStateIdAndId($center_leader_state,$center_leader_local_govt);
				        		$center_leader_state = $this->northbridge_model->getStateById($center_leader_state);
				        		$center_leader_country = $this->northbridge_model->getUserParamById("country_id",$center_leader_id);

	        					$center_leader_country = $this->northbridge_model->getCountryById($center_leader_country);

								$product_name = $this->northbridge_model->getProductParamByIdMiniImportation("name",$product_id);

								$all_sharer_ids = $this->northbridge_model->getAllUsersWhoHaveShareInThisOrder($product_id,$center_leader_id);
								$response_arr['success'] = true;

								if(is_array($all_sharer_ids) && count($all_sharer_ids) > 0){
									for($i = 0; $i < count($all_sharer_ids); $i++){
										$sharer_id = $all_sharer_ids[$i];


										$sharer_quantity = $this->northbridge_model->getMiniImportationOrderParamByUserIdProductIdAndCenterLeaderId("quantity",$sharer_id,$product_id,$center_leader_id);

										$title = "Notice Of Goods Delivery";
						        		$message = "This Is To Inform You That The Product With The Following Details Have Been Received By Your Center Leader.<br> Please Check Your Orders Panel In Mini Importation Section For More Information And Pick Up Your Order At The Center Leader Address Below.";

						        		$message .= "<p><b>Product Name: </b><em class='text-primary'>".$product_name."</em></p>";

						        		$message .= "<p><b>Product Quantity: </b><em class='text-primary'>".$sharer_quantity." Unit(s)</em></p>";

						        		$message .= "<h4 class='text-center'>Center Leader Info</h4>";

						        		$message .= "<p><b>Center Leader Name: </b><a target='_blank' href='".site_url('northbridge/'.$center_leader_slug)."'>".$center_leader_full_name."</a></p>";

						        		$message .= "<p><b>Center Leader Phone Number: </b><em class='text-primary'>+".$center_leader_phone_code . '' . $center_leader_phone_number ."</em></p>";

						        		$message .= "<p><b>Center Leader Address: </b><em class='text-primary'>".$center_leader_address."</em></p>";

						        		$message .= "<p><b>Center Leader City: </b><em class='text-primary'>".$center_leader_city."</em></p>";

						        		$message .= "<p><b>Center Leader Local Government: </b><em class='text-primary'>".$center_leader_local_govt."</em></p>";

						        		$message .= "<p><b>Center Leader State: </b><em class='text-primary'>".$center_leader_state."</em></p>";

						        		$message .= "<p><b>Center Leader Country: </b><em class='text-primary'>".$center_leader_country."</em></p>";

						        		
						        		

										$form_array = array(
											'sender' => "Admin",
											'receiver' => $sharer_id,
											'title' => $title,
											'message' => $message,
											'date_sent' => $date,
											'time_sent' => $time,
											'type' => 'misc'
										);

										if($this->northbridge_model->sendMessage($form_array)){
											$response_arr['success'] = true;
										}
									}
								}
							}
						}
					}
					echo json_encode($response_arr);
				}
			}	

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "get_dispatcher_previous_requests" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					$response_arr = array('success' => false,'messages' => '');
					if($this->input->post('show_records')){
						$response_arr['success'] = true;
						$product_ids = $this->northbridge_model->getCenterLeaderOnTheWayProductsPreviousDispatcherRequests($user_id);
						if(is_array($product_ids) && count($product_ids) > 0){
							$j = 0;

							$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="">';
			        		$response_arr['messages'] .= '<table class="table table-striped table-bordered wrap hover display" id="previous-requests-dispatcher-table" cellspacing="0" width="100%" style="width:100%">';
			        		$response_arr['messages'] .= '<thead>';
			        		$response_arr['messages'] .= '<tr>';
			        		$response_arr['messages'] .= '<th>#</th>';
			        		$response_arr['messages'] .= '<th>Product Name</th>';
			        		$response_arr['messages'] .= '<th>Quantity</th>';
			        		$response_arr['messages'] .= '<th>Center Leader UserName</th>';
			        		$response_arr['messages'] .= '<th>State</th>';
			        		$response_arr['messages'] .= '<th>Local Government</th>';
			        		$response_arr['messages'] .= '<th>Current Status</th>';
			        		$response_arr['messages'] .= '<th>Request Date / Time</th>';
			        		
			        		$response_arr['messages'] .= '</tr>';
			        		$response_arr['messages'] .= '<tbody>';


			        		for($k = 0; $k < count($product_ids); $k++){
			        			

			        			$product_id = $product_ids[$k];

			        			$product_name = $this->northbridge_model->getProductParamByIdMiniImportation("name",$product_id);
			        			$center_leader_ids = $this->northbridge_model->getMiniImportationCenterLeaderUserIds($product_id);


			        			if(is_array($center_leader_ids) && count($center_leader_ids) > 0){
			        				for($i = 0; $i < count($center_leader_ids); $i++){
			        					$center_leader_id = $center_leader_ids[$i];
			        					if($this->northbridge_model->checkIfThisCenterLeaderAndProductIdIsForThisDispatcher1($user_id,$center_leader_id,$product_id)){
				        					$j++;
				        					
				        					$center_leader_user_name = $this->northbridge_model->getUserNameById($center_leader_id);

				        					$quantity = $this->northbridge_model->getMiniImportationProductQuantityComingToCenterLeader($product_id,$center_leader_id);
				        					$center_leader_state = $this->northbridge_model->getUserParamById("state_id",$center_leader_id);
				        					$center_leader_local_govt = $this->northbridge_model->getUserParamById("local_government",$center_leader_id);
				        					$center_leader_slug = $this->northbridge_model->getUserParamById("slug",$center_leader_id);

				        					$center_leader_local_govt = $this->northbridge_model->getLocalGovernmentByStateIdAndId($center_leader_state,$center_leader_local_govt);
				        					$center_leader_state = $this->northbridge_model->getStateById($center_leader_state);

				        					$current_status = $this->northbridge_model->getMiniImportationOrderCurrentStatus($center_leader_id,$product_id);

				        					$sent_to_dispatcher_date = $this->northbridge_model->getMiniImportationOrderParamByCenterLeaderIdAndProductId("sent_to_dispatcher_date",$center_leader_id,$product_id);

				        					$sent_to_dispatcher_time = $this->northbridge_model->getMiniImportationOrderParamByCenterLeaderIdAndProductId("sent_to_dispatcher_time",$center_leader_id,$product_id);

				        					if($current_status == ""){
				        						$current_status = "No Status Entered Here";
				        					}

				        					$response_arr['messages'] .= '<tr onclick="loadCenterLeaderProductInfoPrevious(this,event)" data-product-id="'.$product_id.'" data-center-leader="'.$center_leader_id.'">';
				        					$response_arr['messages'] .= '<td>'.$j.'</td>';
				        					$response_arr['messages'] .= '<td>'.$product_name.'</td>';
				        					$response_arr['messages'] .= '<td>'.$quantity.'</td>';
				        					$response_arr['messages'] .= '<td><a target="_blank" href="'.site_url('northbridge/'.$center_leader_slug).'">'.$center_leader_user_name.'</a></td>';
				        					$response_arr['messages'] .= '<td>'.$center_leader_state.'</td>';
				        					$response_arr['messages'] .= '<td>'.$center_leader_local_govt.'</td>';
				        					$response_arr['messages'] .= '<td>'.$current_status.'</td>';
				        					$response_arr['messages'] .= '<td>'.$sent_to_dispatcher_date. ' ' . $sent_to_dispatcher_time .'</td>';

				        					$response_arr['messages'] .= '</tr>';
				        				}	

			        				}
			        			}

			        		}


			        		$response_arr['messages'] .= '</tbody>';
			        		$response_arr['messages'] .= '</table>';
			        		$response_arr['messages'] .= '</div>';
			        	}else{
			        		$response_arr['messages'] .= '<h4 class="text-warning">No Data To Display Here</h4>';
			        	}
			        }
			        echo json_encode($response_arr);
			    }
			}		

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "get_dispatcher_new_requests" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					$response_arr = array('success' => false,'messages' => '');
					if($this->input->post('show_records')){
						$response_arr['success'] = true;
						$product_ids = $this->northbridge_model->getCenterLeaderOnTheWayProductsNewDispatcherRequests($user_id);
						if(is_array($product_ids) && count($product_ids) > 0){
							$j = 0;

							$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="">';
			        		$response_arr['messages'] .= '<table class="table table-striped table-bordered wrap hover display" id="new-requests-dispatcher-table" cellspacing="0" width="100%" style="width:100%">';
			        		$response_arr['messages'] .= '<thead>';
			        		$response_arr['messages'] .= '<tr>';
			        		$response_arr['messages'] .= '<th>#</th>';
			        		$response_arr['messages'] .= '<th>Product Name</th>';
			        		$response_arr['messages'] .= '<th>Quantity</th>';
			        		$response_arr['messages'] .= '<th>Center Leader UserName</th>';
			        		$response_arr['messages'] .= '<th>State</th>';
			        		$response_arr['messages'] .= '<th>Local Government</th>';
			        		$response_arr['messages'] .= '<th>Current Status</th>';
			        		$response_arr['messages'] .= '<th>Request Date / Time</th>';
			        		
			        		$response_arr['messages'] .= '</tr>';
			        		$response_arr['messages'] .= '<tbody>';


			        		for($k = 0; $k < count($product_ids); $k++){
			        			

			        			$product_id = $product_ids[$k];

			        			$product_name = $this->northbridge_model->getProductParamByIdMiniImportation("name",$product_id);
			        			$center_leader_ids = $this->northbridge_model->getMiniImportationCenterLeaderUserIds($product_id);


			        			if(is_array($center_leader_ids) && count($center_leader_ids) > 0){
			        				for($i = 0; $i < count($center_leader_ids); $i++){
			        					$center_leader_id = $center_leader_ids[$i];
			        					if($this->northbridge_model->checkIfThisCenterLeaderAndProductIdIsForThisDispatcher($user_id,$center_leader_id,$product_id)){
				        					$j++;
				        					
				        					$center_leader_user_name = $this->northbridge_model->getUserNameById($center_leader_id);

				        					$quantity = $this->northbridge_model->getMiniImportationProductQuantityComingToCenterLeader($product_id,$center_leader_id);
				        					$center_leader_state = $this->northbridge_model->getUserParamById("state_id",$center_leader_id);
				        					$center_leader_local_govt = $this->northbridge_model->getUserParamById("local_government",$center_leader_id);
				        					$center_leader_slug = $this->northbridge_model->getUserParamById("slug",$center_leader_id);

				        					$center_leader_local_govt = $this->northbridge_model->getLocalGovernmentByStateIdAndId($center_leader_state,$center_leader_local_govt);
				        					$center_leader_state = $this->northbridge_model->getStateById($center_leader_state);

				        					$current_status = $this->northbridge_model->getMiniImportationOrderCurrentStatus($center_leader_id,$product_id);

				        					$sent_to_dispatcher_date = $this->northbridge_model->getMiniImportationOrderParamByCenterLeaderIdAndProductId("sent_to_dispatcher_date",$center_leader_id,$product_id);

				        					$sent_to_dispatcher_time = $this->northbridge_model->getMiniImportationOrderParamByCenterLeaderIdAndProductId("sent_to_dispatcher_time",$center_leader_id,$product_id);

				        					if($current_status == ""){
				        						$current_status = "No Status Entered Here";
				        					}

				        					$response_arr['messages'] .= '<tr onclick="loadCenterLeaderProductInfo(this,event)" data-product-id="'.$product_id.'" data-center-leader="'.$center_leader_id.'">';
				        					$response_arr['messages'] .= '<td>'.$j.'</td>';
				        					$response_arr['messages'] .= '<td>'.$product_name.'</td>';
				        					$response_arr['messages'] .= '<td>'.$quantity.'</td>';
				        					$response_arr['messages'] .= '<td><a target="_blank" href="'.site_url('northbridge/'.$center_leader_slug).'">'.$center_leader_user_name.'</a></td>';
				        					$response_arr['messages'] .= '<td>'.$center_leader_state.'</td>';
				        					$response_arr['messages'] .= '<td>'.$center_leader_local_govt.'</td>';
				        					$response_arr['messages'] .= '<td>'.$current_status.'</td>';
				        					$response_arr['messages'] .= '<td>'.$sent_to_dispatcher_date. ' ' . $sent_to_dispatcher_time .'</td>';

				        					$response_arr['messages'] .= '</tr>';
				        				}	

			        				}
			        			}

			        		}


			        		$response_arr['messages'] .= '</tbody>';
			        		$response_arr['messages'] .= '</table>';
			        		$response_arr['messages'] .= '</div>';
			        	}else{
			        		$response_arr['messages'] .= '<h4 class="text-warning">No Data To Display Here</h4>';
			        	}
			        }
			        echo json_encode($response_arr);
			    }
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "get_users_who_used_you_as_center_leader" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					$response_arr = array('success' => false,'messages' => '');
					if($this->input->post('show_records') && $this->input->post('type')){
						$response_arr['success'] = true;
						$type = $this->input->post('type');
						if($type == "undelivered"){
							$order_codes = $this->northbridge_model->getCenterLeaderRequestsOrderCodesForUserUndelivered($user_id);
						}else{
							$order_codes = $this->northbridge_model->getCenterLeaderRequestsOrderCodesForUserDelivered($user_id);
						}
						if(is_array($order_codes) && count($order_codes) > 0){
							$j = 0;

							$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="">';
			        		$response_arr['messages'] .= '<table class="table table-striped table-bordered nowrap hover display" id="center-leader-requests-table" cellspacing="0" width="100%" style="width:100%">';
			        		$response_arr['messages'] .= '<thead>';
			        		$response_arr['messages'] .= '<tr>';
			        		$response_arr['messages'] .= '<th>#</th>';
			        		$response_arr['messages'] .= '<th>Order Code</th>';
			        		$response_arr['messages'] .= '<th>Date Of Order</th>';
			        		$response_arr['messages'] .= '<th>Number Of Delivered Products</th>';
			        		$response_arr['messages'] .= '<th>Number Of UnDelivered Products</th>';
			        		$response_arr['messages'] .= '<th>Users Full Name</th>';
			        		$response_arr['messages'] .= '<th>Users Phone Number</th>';
			        		
			        		$response_arr['messages'] .= '</tr>';
			        		$response_arr['messages'] .= '<tbody>';

			        		for($i = 0; $i < count($order_codes); $i++){
			        			$j++;
			        			$order_code = $order_codes[$i];

			        			$date_of_order = $this->northbridge_model->getMiniImportationOrderParamByOrderCode("check_out_date",$order_code);
								$time_of_order = $this->northbridge_model->getMiniImportationOrderParamByOrderCode("check_out_time",$order_code);
								$undelivered_products_num = $this->northbridge_model->getMiniImportationUndeliveredProductsNumByOrderCode($order_code);
								$delivered_products_num = $this->northbridge_model->getMiniImportationDeliveredProductsNumByOrderCode($order_code);
								$product_owners_user_id = $this->northbridge_model->getMiniImportationOrderParamByOrderCode("user_id",$order_code);
								$product_owners_full_name = $this->northbridge_model->getUserFullNameById($user_id);
								$product_owners_phone_code = $this->northbridge_model->getUserPhoneCodeByUserId($user_id);
								$product_owners_phone_number = $this->northbridge_model->getUserPhoneNumberByUserId($user_id);

								$response_arr['messages'] .= '<tr onclick="loadCenterLeaderUsersOrderInfoByOrderCode(this,event)" data-order-code="'.$order_code.'">';
								$response_arr['messages'] .= '<td>'.$j.'</td>';
								$response_arr['messages'] .= '<td>'.$order_code.'</td>';
								$response_arr['messages'] .= '<td>'.$date_of_order . ' ' . $time_of_order .'</td>';
								$response_arr['messages'] .= '<td>'.$delivered_products_num.'</td>';
								$response_arr['messages'] .= '<td>'.$undelivered_products_num.'</td>';
								$response_arr['messages'] .= '<td>'.$product_owners_full_name.'</td>';
								$response_arr['messages'] .= '<td>+'.$product_owners_phone_code . '' . $product_owners_phone_number .'</td>';
								$response_arr['messages'] .= '</tr>';
			        		}

			        		$response_arr['messages'] .= '</tbody>';
			        		$response_arr['messages'] .= '</table>';
			        		$response_arr['messages'] .= '</div>';
			        	}else{
			        		if($type == "undelivered"){
				        		$response_arr['messages'] .= '<h4 class="text-warning">No Undelivered Center Leader Requests Yet. Once You Are Selected As Center Leader, It Appears Here.</h4>';
				        	}else{
				        		$response_arr['messages'] .= '<h4 class="text-warning">No Delivered Center Leader Requests Yet. Once You Are Selected As Center Leader, It Appears Here.</h4>';
				        	}
			        	}
		        	}
					
					echo json_encode($response_arr);
				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "credit_wallet" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					$response_arr = array('success' => false,'url' => '');
					if($this->input->post('credit_wallet')){
						if(is_numeric($this->input->post('credit_wallet')) && $this->input->post('credit_wallet') >= 200){

							$reference_code = substr(bin2hex($this->encryption->create_key(8)),4);
							$total_amount = $this->input->post('credit_wallet');
							$total_amount = $total_amount * 100;
							$email = $this->northbridge_model->getUserEmailByUserId($user_id);
							$token = $this->northbridge_model->getUserTokenByUserId($user_id);
							
							$name = $this->northbridge_model->getUserFullNameByUserId($user_id);
							
							$redirect_url = site_url('northbridge/process_credit_wallet_payment/');
							
		            		$auth_url = $this->paystack->init($reference_code, $total_amount,$email,[
					            'name' => $name
					        ],$redirect_url);
					        if (filter_var($auth_url, FILTER_VALIDATE_URL)){
					        	$response_arr['success'] = true;
					        	$response_arr['url'] = $auth_url;
						    }
							
						}
					}
					echo json_encode($response_arr);
				}
			}

			else if($addition == "process_credit_wallet_payment"){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data = array('success' => false);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = strtolower(url_title($second_addition));
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['phone_code'] = $user->phone_code;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}
					if(isset($_GET['reference'])){ 
				        
				        $ver_info = $this->paystack->verifyTransaction($_GET['reference']);
				        
				        if(is_object($ver_info)){
				          if($ver_info->message == "Verification successful" && $ver_info->data->status == "success"){
				            $data['success'] = true;					            
				            
				          }else{
				            $data['unverified'] = true;
				          }
				        }else{
				          $data['unverified'] = true;
				        }
				    }
					$this->load->view("pages/process_credit_wallet_payment",$data);
				}	
			} 

			else if($addition == "verify_credit_wallet_payment"){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data = array('success' => false);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['phone_code'] = $user->phone_code;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}
					if(isset($_GET['reference'])){ 
						$response_arr = array('success' => false);
				        $ver_info = $this->paystack->verifyTransaction($_GET['reference']);
				        if(is_object($ver_info)){
				          if($ver_info->message == "Verification successful" && $ver_info->data->status == "success"){
				          	$amount = $ver_info->data->amount;
				          	$reference = $ver_info->data->reference;
				          	$amount = $amount / 100;
				          	$date = date("j M Y");
							$time = date("h:i:sa");

							if($this->northbridge_model->checkIfThisReferenceHasNotBeenUsedBeforeCreditAccount($reference)){
				          	
					          	if($this->northbridge_model->creditUser($user_id,$amount)){
					          		$form_array = array(
					          			'user_id' => $user_id,
					          			'amount' => $amount,
					          			'date' => $date,
					          			'time' => $time,
					          			'reference' => $reference
					          		);
					          		if($this->northbridge_model->addNewAccountCreditHistory($form_array)){
						          		$response_arr['success'] = true;
						          		$this->session->set_flashdata("credit_success",true);
						          		$this->session->set_flashdata("amount",$amount);
										$response_arr['url'] = site_url("northbridge/earnings");
									}
								}	
							}
				            
				          }
				        }
				        echo json_encode($response_arr);
				    }
					
				}	
			} 

			else if($addition == "process_content_leader_payment" && is_null($second_addition)){
				
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data = array('success' => false);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = strtolower(url_title($second_addition));
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['phone_code'] = $user->phone_code;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}
					if(isset($_GET['reference'])){ 
				        
				        $ver_info = $this->paystack->verifyTransaction($_GET['reference']);
				        
				        if(is_object($ver_info)){
				          if($ver_info->message == "Verification successful" && $ver_info->data->status == "success"){
				            $data['success'] = true;					            
				            
				          }else{
				            $data['unverified'] = true;
				          }
				        }else{
				          $data['unverified'] = true;
				        }
				    }
					$this->load->view("pages/process_content_leader_payment",$data);
				}	
			} 


			//Admin Functionalities Page
			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $this->northbridge_model->checkIfUserIsAdmin() && $addition == "admin_funcs" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					
					$this->load->view('includes/admin_header',$data);
		            $this->load->view('pages/admin_func',$data);
		            $this->load->view('includes/admin_footer',$data);	

				}
			}

			//Admin Functionalities Page
			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $this->northbridge_model->checkIfUserIsAdmin() && $addition == "recharge_combo_requests" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					
					$this->load->view('includes/admin_header',$data);
		            $this->load->view('pages/recharge_combo_requests',$data);
		            $this->load->view('includes/admin_footer',$data);	

				}
			}

			//Admin Functionalities Page
			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $this->northbridge_model->checkIfUserIsAdmin() && $addition == "send_prepaid_token" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					
					$this->load->view('includes/admin_header',$data);
		            $this->load->view('pages/send_prepaid_token',$data);
		            $this->load->view('includes/admin_footer',$data);	

				}
			}

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $this->northbridge_model->checkIfUserIsAdmin() && $addition == "enter_meter_token" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					
					

					if($this->input->post('meter_token') && $this->input->post('id')){
						$meter_token = $this->input->post('meter_token');
						$id = $this->input->post('id');
						$response_arr = array('success' => false);
						$request = $this->northbridge_model->getPrepaidRequestById($id);
                  		if(is_array($request)){
                    
                  			foreach($request as $row){
		                      
		                      	$id = $row->id;
		                      	$vtu_id = $row->vtu_id;
		                      	$phone_number = $row->phone_number;
		                      	$email = $row->email;
		                      	$user_id = $this->northbridge_model->getVtuTransactionParamById("user_id",$vtu_id);
								$user_name = $this->northbridge_model->getUserNameById($user_id);
								if($phone_number == ""){
									$phone_number = $this->northbridge_model->getFullMobileNoByUserName($user_name);
								}

								if($email == ""){
									$email = $this->northbridge_model->getUserParamById("email",$user_id);
								}
			                    $user_name = $this->northbridge_model->getUserParamById("user_name",$user_id);
			                    $full_name = $this->northbridge_model->getUserFullNameByUserId($user_id);
			                    $slug = $this->northbridge_model->getUserParamById("slug",$user_id);
			                    
			                    $order_id = $this->northbridge_model->getVtuTransactionParamById("order_id",$vtu_id);
			                    $disco = $this->northbridge_model->getVtuTransactionParamById("sub_type",$vtu_id);
			                    $meter_no = $this->northbridge_model->getVtuTransactionParamById("number",$vtu_id);
			                    $amount = $this->northbridge_model->getVtuTransactionParamById("amount",$vtu_id);
			                    $date = date("j M Y");
								$time = date("h:i:sa");
								$date_time = $this->northbridge_model->getVtuTransactionParamById("date",$vtu_id) . "  " . $this->northbridge_model->getVtuTransactionParamById("time",$vtu_id);

								if($this->northbridge_model->sendMeterTokenForPrepaidToUserByNotifAfterApproval($id,$date_time,$user_id,$date,$time,$order_id,$disco,$meter_no,$amount,$phone_number,$email,$meter_token)){
									$response_arr['success'] = true;
								}
							}
						}

						echo json_encode($response_arr);
					}

				}
			}


			//Messages Page
			elseif($this->northbridge_model->getUserById($addition) !== false && $this->northbridge_model->confirmLoggedIn() == TRUE && $second_addition == "messaging" && is_null($third_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					
					$this->load->view('includes/admin_header',$data);
		            $this->load->view('pages/messaging',$data);
		            $this->load->view('includes/admin_footer',$data);	

				}
			}		

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "get_status" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$email = $user->email;
						$phone = $user->phone;
						$country_id = $user->country_id;
						$state_id = $user->state_id;
						$address = $user->address;
						$user_slug = $user->slug;
						$date = $user->date;
						$time = $user->time;
						$logo = $user->logo;
						$cover_photo = $user->cover_photo;
						$bio = $user->bio;
					}
					// echo $this->input->post('offset');
					if($this->input->post('user_id') && $this->input->post('get_status')){

						$response_arr = array('success' => false,'messages' => '','offset' => '','online_status' => false);
						$partner_id = $this->input->post('user_id');
						$offset = $this->input->post('offset');
						if($this->northbridge_model->getIfUserIdIsValid($partner_id) && $partner_id !== $user_id){
							$user_info = $this->northbridge_model->getUserInfoByUserId($partner_id);
							if(is_array($user_info)){

								foreach($user_info as $user){
									$partner_user_name = $user->user_name;
									$partner_email = $user->email;
									$partner_phone = $user->phone;
									$partner_country_id = $user->country_id;
									$partner_state_id = $user->state_id;
									$partner_address = $user->address;
									$partner_user_slug = $user->slug;
									$partner_date = $user->date;
									$partner_time = $user->time;
									$partner_logo = $user->logo;
									$partner_cover_photo = $user->cover_photo;
									$partner_bio = $user->bio;
								}
								$response_arr['success'] = true;
								$messages = $this->northbridge_model->getSubsequentChatMessages($user_id,$partner_id,$offset);
									if(is_array($messages)){								
										
										$id_arr = array();
										foreach($messages as $row){
											$id = $row->id;
											$id_arr[] .= $id;
											$you = false;
											$sender = $row->sender;
											$receiver = $row->receiver;
											$message = $row->message;
											$chat_date = $row->date;
											$curr_year = date("Y");
											$time = $row->time;
											$curr_date = date("j M Y");
											$curr_time = date("h:i:sa");
											if($sender == $user_id){											
												$you = true;
											}
											$year = substr($chat_date, -4);
											$mon_day = substr($chat_date,0, -4);

											//if its not the same year
											if($curr_year > $year){
												$t_stamp = $chat_date . ' ' . $time;
											}else{
												if($curr_date == $chat_date){
													$t_stamp = $time;
												}else{
													$t_stamp = $mon_day . ' ' .$time;
												}
												
											}
											// echo $partner_id;
											if(is_null($logo)){
												$logo_url = base_url('assets/images/avatar.jpg');
											}else{
												$logo_url = base_url('assets/images/'.$logo);
											}

											if(is_null($partner_logo)){
												$partner_logo_url = base_url('assets/images/avatar.jpg');
											}else{
												$partner_logo_url = base_url('assets/images/'.$partner_logo);
											}

											if($you){
												$who = 'self';
												$display_name = 'you';
											}else{
												$who = 'other';
												$display_name = $partner_user_name;
											}
											
											$response_arr['messages'] .= "<li class='".$who."'><div class='messages' id='".$id."'><p>".$message."</p><time datetime=".$chat_date . "".$time.">".$display_name." • ".$t_stamp."</time></div></li>";
											$this->northbridge_model->updateMessageAsRead($id);
										}
										
										$response_arr['offset'] = max($id_arr);
										

									}else{
										$response_arr['offset'] = 0;
									}
									$response_arr['online_status'] = $this->northbridge_model->getUserOnlineStatus($partner_id);
								}
							
						}
						echo json_encode($response_arr);
					}
				}
			}		

			//User Profile Page
			elseif($this->northbridge_model->getUserBySlug($addition) !== false && $this->northbridge_model->confirmLoggedIn() == TRUE && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['main_user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] = $user->cover_photo;
						$data['bio'] = $user->bio;
					}
					
					$this->load->view('includes/admin_header',$data);
		            $this->load->view('pages/user_profile_page',$data);
		            $this->load->view('includes/admin_footer',$data);	

				}
			}		         

		
			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "process-payment" && is_null($third_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_id'] = $user_id;
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
					}
					
					
		            if(isset($_GET['reference'] ) && get_cookie('reference',true) !== NULL){ 
		            	// echo $second_addition;
				        if($second_addition == "new_nigeria" || $second_addition == "great_nigeria"){
				        	// echo "string";
					        $ver_info = $this->paystack->verifyTransaction($_GET['reference']);
					        if($second_addition == "new_nigeria"){
					        	$amount = 2800;
					        }elseif($second_addition == "great_nigeria"){
					        	$amount = 5300;
					        }

					        $amount = $amount * 100;

					        // if(is_object($ver_info)){
					        	// print_r($ver_info);
						        // if($ver_info->message == "Verification successful" && $ver_info->data->status == "success" && $ver_info->data->amount == $amount){
						          	$date = date("j M Y");
									$time = date("h:i:sa");	
									$referred_by = get_cookie('reference');
									// delete_cookie("reference");
									if($referred_by !== $user_id){

							           	if($second_addition == "new_nigeria"){
							           		if($this->northbridge_model->performAddingOneNigeria1($user_id,$referred_by,$date,$time)){
							           			$this->session->set_flashdata('success',true);
							           			// redirect('northbridge/start-earning');
							           		}
							           	}elseif($second_addition == "great_nigeria"){
							           		if($this->northbridge_model->performAddingGreatNigeria1($user_id,$referred_by,$date,$time)){
							           			$this->session->set_flashdata('success',true);
							           			redirect('northbridge/start-earning');
							           		}
							           	}					          
						         	}  					            
						     //    }else{
						     //       	$this->session->set_flashdata('unsucessful_verification',true);
							    //     redirect('northbridge/start-earning');
						     //    }
					      //   }else{
					      //     	$this->session->set_flashdata('unsucessful_verification',true);
							    // redirect('northbridge/start-earning');
					      //   }
					    }
				    } 
			    }
			} 

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "check_if_there_is_space_resubscription" && is_null($third_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_id'] = $user_id;
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$full_name = $user->full_name;
						$bank_name = $user->bank_name;
						$account_number = $user->account_number;
						$recepient_code = $user->recepient_code;
					}
					$data = array('success' => false,'no_space' => true);
					
					if($this->input->post('type')){	
						$type = $this->input->post('type');
						if($type == "new_nigeria" || $type == "great_nigeria"){
							if($this->northbridge_model->checkIfThereIsActiveResubscription($type)){
								
							}else{
								$data['success'] = true;
								$data['no_space'] = false;
							}
						}
					}
					
					echo json_encode($data);
			    }
			} 

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "exit_active_sub" && is_null($third_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_id'] = $user_id;
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$full_name = $user->full_name;
						$bank_name = $user->bank_name;
						$account_number = $user->account_number;
						$recepient_code = $user->recepient_code;
					}
					$data = array('success' => false);
					
					if($this->input->post('type') && $this->input->post('exit_active_sub')){	
						$type = $this->input->post('type');
						if($type == "new_nigeria" || $type == "great_nigeria"){
							$date = date("j M Y");
							$time = date("h:i:sa");
							
							if($this->northbridge_model->cancelActiveResub($user_id,$type)){
								$this->session->set_userdata('cancel_success',$type);
								$data['success'] = true;
							}
						}
					}
					
					echo json_encode($data);
			    }
			} 

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "set_resubscription" && is_null($third_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_id'] = $user_id;
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$full_name = $user->full_name;
						$bank_name = $user->bank_name;
						$account_number = $user->account_number;
						$recepient_code = $user->recepient_code;
					}
					$data = array('success' => false,'messages' => '','bouyant' => false);
					
					if($this->input->post('type')){	
						$type = $this->input->post('type');
						if($type == "new_nigeria" || $type == "great_nigeria"){
							$this->form_validation->set_rules('choose_interval','Choose Interval','trim|required|in_list[biweekly,monthly]',array('required' => 'This Field Is Required','in_list' => 'Please Do Not Mess With This Form'));
							
							$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
							if($this->form_validation->run() == TRUE){
								$interval = $this->input->post('choose_interval');
								if($type == "new_nigeria"){
									$amount = 2500;
								}else if($type == "great_nigeria"){
									$amount = 5000;
								}
								$referred_by = "none";
								$date = date("j M Y");
								$time = date("h:i:sa");
								if($this->northbridge_model->checkIfserIsBouyant1($user_id,$amount)){
									$data['bouyant'] = true;
									if($type == "new_nigeria"){
										if($this->northbridge_model->performAddingOneNigeria1($user_id,$referred_by,$date,$time)){
						           			if($this->northbridge_model->debitUser($user_id,2500)){
							           			if($this->northbridge_model->activateResubscription($user_id,$type,$interval)){
								           			$data['success'] = true;
								           			$this->session->set_userdata('success',true);
								           		}
							           		}
						           		}
						           	}else if($type == "great_nigeria"){
						           		if($this->northbridge_model->performAddingGreatNigeria1($user_id,$referred_by,$date,$time)){
						           			if($this->northbridge_model->debitUser($user_id,5000)){
							           			if($this->northbridge_model->activateResubscription($user_id,$type,$interval)){
								           			$data['success'] = true;
								           			$this->session->set_userdata('success',true);
								           		}
							           		}
						           		}
						           	}
								}

							}else{
								foreach($_POST as $key => $value){
									$data['messages'][$key] = form_error($key);
								}
							}
						}
					}
					
					echo json_encode($data);
			    }
			} 

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "transfer_funds" && is_null($third_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_id'] = $user_id;
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$full_name = $user->full_name;
						$bank_name = $user->bank_name;
						$account_number = $user->account_number;
						$recepient_code = $user->recepient_code;
					}
					$data = array('success' => false,'bouyant' => false);
					if($recepient_code !== 0){
						if($this->input->post('amount')){							
							$funds_amount = $this->input->post('amount');
							$amount = $funds_amount + 200;
							if($this->northbridge_model->checkIfserIsBouyant1($user_id,$amount)){
								$data['bouyant'] = true;
								// if($this->northbridge_model->checkIfUserHasReferredAnyOne($user_id)){
									$funds_amount = $funds_amount * 100;
								// 	echo $funds_amount;
									$data['no_refer'] = false;
									$post_data = [
										'source' => 'balance',
										'reason' => 'Withdrawal Of Funds',
										'amount' => $funds_amount,
										'currency' => 'NGN',
										'recipient' => $recepient_code
									];
									$initiate_transfer = $this->paystack->curl("https://api.paystack.co/transfer",TRUE,$post_data);
								// 	echo $initiate_transfer;
    
									$initiate_transfer = json_decode($initiate_transfer);
									if(is_object($initiate_transfer)){
										if($initiate_transfer->status == TRUE){
											if($this->northbridge_model->debitUser($user_id,$amount)){
												$this->session->set_userdata('amount',$amount);
												$this->session->set_userdata('withdrawal_success',true);
												$data['success'] = true;
											}
										}
									}
								// }
							}							
						}
					}
					echo json_encode($data);
			    }
			} 

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "withdraw_funds_cont" && is_null($second_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				
				if(is_array($user_info)){
					foreach($user_info as $row){
						$id = $row->id;
						$created = $row->created;
						$created_date = $row->created_date;
						$created_time = $row->created_time;
						$sms_enabled = $row->sms_enabled;
						$notif_enabled = $row->notif_enabled;
						$email_enabled = $row->email_enabled;
						$admin_sms_enabled = $row->admin_sms_enabled;
						$admin_email_enabled = $row->admin_email_enabled;
						$followers = $row->followers;
						$following = $row->following;
						$user_name = $row->user_name;
						$sponsor_income = $row->sponsor_income;
						$withdrawn = $row->withdrawn;
						$admin_vat_total = $row->admin_vat_total;
						$total_basic_withdrawn = $row->total_basic_withdrawn;
						$total_basic_income = $row->total_basic_income;
						$total_business_income = $row->total_business_income;
						$total_business_withdrawn = $row->total_business_withdrawn;
						$total_income = $row->total_income;
						$admin_mlm_withdrawn = $row->admin_mlm_withdrawn;
						$last_activity = $row->last_activity;
						$full_name = $row->full_name;
						$hashed = $row->hashed;
						$token = $row->token;
						$email = $row->email;
						$phone = $row->phone;
						$phone_code = $row->phone_code;
						$logo = $row->logo;
						$cover_photo = $row->cover_photo;
						$bio = $row->bio;
						$country_id = $row->country_id;
						$state_id = $row->state_id;
						$local_government = $row->local_government;
						$city = $row->city;
						$address = $row->address;
						$place_of_use = $row->place_of_use;
						$whatsapp_user = $row->whatsapp_user;
						$center_leader = $row->center_leader;
						$slug = $row->slug;
						$register = $row->register;
						$is_admin = $row->is_admin;
						$date = $row->date;
						$time = $row->time;
						$user_bank_name = $row->bank_name;
						$account_number = $row->account_number;
						$recepient_code = $row->recepient_code;
						$referred_by = $row->referred_by;
						$dispatcher = $row->dispatcher;
						$center_leader_selection_income = $row->center_leader_selection_income;
						$admin_center_leader_selection_income = $row->admin_center_leader_selection_income;
						$mlm_withdrawn = $row->mlm_withdrawn;
					}
					
					$data = array('success' => false,'messages' => '','bank_details' => "",'account_name' => '','invalid_account' => false);
					
					$this->form_validation->set_rules('bank_name','Bank Name','trim|required|numeric',array('required' => 'This Field Is Required'));
					$this->form_validation->set_rules('account_number','Account Number','trim|required|numeric',array('required' => 'This Field Is Required'));
					$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
					if($this->form_validation->run() == TRUE){
						
						$bank_name = $this->input->post('bank_name');
						$account_number = $this->input->post('account_number');
						
						$account_number_test = $this->paystack->curl("https://api.paystack.co/bank/resolve?account_number=".$account_number."&bank_code=".$bank_name,FALSE);

						$account_number_test = json_decode($account_number_test);
						if(is_object($account_number_test)){
							// echo "string";
							if($account_number_test->status == "true"){
								$post_data = [
									"type" =>  "nuban",
						             "name" => $full_name,
						             // "description" => "Payment For ".$health_facility_name,
						             "account_number" => $account_number,
						             "bank_code" => $bank_name,
						             "currency" => "NGN"
								];

								$create_transfer_recipient = $this->paystack->curl("https://api.paystack.co/transferrecipient",TRUE,$post_data);
								$create_transfer_recipient = json_decode($create_transfer_recipient);
								if(is_object($create_transfer_recipient)){
									
									if($create_transfer_recipient->status == TRUE){

										$recepient_code = $create_transfer_recipient->data->recipient_code;
										$form_array = array(
											'bank_name' => $bank_name,
											'account_number' => $account_number,
											'recepient_code' => $recepient_code
										);
										if($this->northbridge_model->updateUserTable($form_array,$user_id)){
											$data['account_name'] = $account_number_test->data->account_name;
											$data['success'] = true;
										}
									}
								}	
							}else{
								$data['invalid_account'] = true;
							}
						}
						
					}else{
						foreach($_POST as $key => $value){
							$data['messages'][$key] = form_error($key);
						}
					}
					echo json_encode($data);					
							
			    }
			} 

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "withdraw_funds" && is_null($third_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_id'] = $user_id;
						$user_name = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$bank_name = $user->bank_name;
						$account_number = $user->account_number;
					}
					// if($this->input->post('withdraw_funds')){
						$data = array('success' => false,'no_refer' => true,'messages' => '','first_time' => true,'bouyant' => false,'bank_details' => "",'amount' => 0,'mobile_no' => '');
						$this->form_validation->set_rules('withdraw_funds','Funds Amount','trim|required|numeric',array('required' => 'This Field Is Required'));
						$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
						if($this->form_validation->run() == TRUE){
							$funds_amount = $this->input->post('withdraw_funds');
							$data['amount'] = $funds_amount;
							$amount = $funds_amount + 200;
							if($this->northbridge_model->checkIfserIsBouyant1($user_id,$amount)){
								$data['bouyant'] = true;
								if($this->northbridge_model->checkIfUserHasReferredAnyOne($user_id)){
									$data['no_refer'] = false;
									$mobile_no = $this->northbridge_model->getFullMobileNoByUserName($user_name);
									$response_arr['mobile_no'] = $mobile_no;
									if($this->northbridge_model->checkIfMobileNoIsForUser($user_id,$mobile_no)){
										$otp = substr(bin2hex($this->encryption->create_key(16)),0,6);
										$user_name = "Meet%20Global%20Resources";
										$password = "44precious44";
										$message = "Your%20Otp%20Is:%20".$otp.".%20Thanks%20For%20Using%20";
										$response = $this->northbridge_model->curl("http://goldsms247.com/components/com_spc/smsapi.php?username=". $user_name ."&password=". $password ."&sender=Meet&recipient=". $mobile_no ."&message=".$message,FALSE);
										if($response !== "" && $response !== "2904" && $response !== "2905" && $response !== "2906"&& $response !== "2907" && $response !== "2908" && $response !== "2909"){
											$user_name = $this->northbridge_model->getUserNameById($user_id);
											$data['success'] = true;
											// $data['otp'] = $otp;
											$this->session->set_userdata('withdrawal_otp',$otp);
										}
									}	
									
								}
							}
						}else{
							foreach($_POST as $key => $value){
								$data['messages'][$key] = form_error($key);
							}
						}
						echo json_encode($data);					
					// }
			    }
			} 

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "process_withdraw_otp" && is_null($third_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_id'] = $user_id;
						$user_name = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$bank_name = $user->bank_name;
						$account_number = $user->account_number;
					}
					if($this->input->post('otp')){
						$otp = $this->input->post('otp');
						$response_arr = array('success' => false,'no_refer' => true,'messages' => '','first_time' => true,'bouyant' => false,'bank_details' => "",'incorrect' => true,'amount' => 0,'mobile_no' => '','expired' => true);
						
						$funds_amount = $this->input->post('amount');
						$response_arr['amount'] = $funds_amount;
						$amount = $funds_amount + 200;
						if($this->northbridge_model->checkIfserIsBouyant1($user_id,$amount)){
							$response_arr['bouyant'] = true;
							if($this->northbridge_model->checkIfUserHasReferredAnyOne($user_id)){
								$response_arr['no_refer'] = false;
								$mobile_no = $this->northbridge_model->getFullMobileNoByUserName($user_name);
								$response_arr['mobile_no'] = $mobile_no;
								if($this->northbridge_model->checkIfMobileNoIsForUser($user_id,$mobile_no)){
									if(isset($_SESSION['withdrawal_otp'])){
										$withdrawal_otp = $_SESSION['withdrawal_otp'];
										$response_arr['expired'] = false;
										if($otp == $withdrawal_otp){
											$response_arr['success'] = true;
											$this->session->set_userdata('withdrawal_cont',true);
										}else{
											$response_arr['incorrect'] = true;
										}	
									}
								}	
								
							}
						}
						
						
					}
					echo json_encode($response_arr);					
			    }
			} 

			elseif($this->northbridge_model->confirmLoggedIn() == TRUE && $addition == "process-payment-existing" && is_null($third_addition)){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_id'] = $user_id;
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
					}
					
					
		            if(get_cookie('reference',true) !== NULL){ 
		            	$data = array('success' => false,'bouyant' => false);
				        if($second_addition == "new_nigeria" || $second_addition == "great_nigeria"){
				        	
					        if($second_addition == "new_nigeria"){
					        	$amount = 2498;
					        }elseif($second_addition == "great_nigeria"){
					        	$amount = 5000;
					        }

				          	$date = date("j M Y");
							$time = date("h:i:sa");	
							$referred_by = get_cookie('reference');
							delete_cookie("reference");
							if($referred_by !== $user_id){

					           	if($second_addition == "new_nigeria"){
					           		if($this->northbridge_model->checkIfserIsBouyant($second_addition,$user_id)){
										
						           		if($this->northbridge_model->performAddingOneNigeria1($user_id,$referred_by,$date,$time)){
						           			if($this->northbridge_model->debitUser($user_id,2498)){
							           			$data['bouyant'] = true;
							           			$data['success'] = true;
							           			$this->session->set_userdata('success',true);
							           		}
						           		}
						           	}	
					           	}elseif($second_addition == "great_nigeria"){
					           		if($this->northbridge_model->checkIfserIsBouyant($second_addition,$user_id)){
										
						           		if($this->northbridge_model->performAddingGreatNigeria1($user_id,$referred_by,$date,$time)){
						           			if($this->northbridge_model->debitUser($user_id,5000)){
							           			$data['bouyant'] = true;
							           			$data['success'] = true;
							           			$this->session->set_userdata('success',true);
							           		}
						           		}
						           	}
					           	}		          
				           	}  					            
					        
					    }
					    echo json_encode($data);
				    } 
			    }
			} 


	
			elseif($addition == "sign_up_as_patient" && is_null($second_addition)){

				$data['all_countries'] = $this->northbridge_model->getCountries();
				$data['first_regions'] = $this->northbridge_model->getFirstRegionsByCountryId();
				$data['first_cities'] = $this->northbridge_model->getFirstCitiesByRegionAndCountryId();

				$this->load->view('includes/header');
				$this->load->view('pages/sign_up_patient',$data);
				$this->load->view('includes/footer');
			}

			elseif($addition == "swal_input_form"){
				$response_arr['message'] = "Post Data Received. Its: " .$second_addition;
				$response_arr['success'] = true;
				echo json_encode($response_arr);
			}


			elseif($addition == "verify_user_forgot_password_otp" && is_null($second_addition)){
				$date = date("j M Y");
				$time = date("h:i:sa");
				// echo "string";
				$response_arr = array('success' => false,'expired' => false,'otp_not_present' => false,'incorrect_otp' => false);
				if(isset($_SESSION['otp']) && isset($_SESSION['forgot_pass_first_step'])){
					$user_name = $_SESSION['forgot_pass_first_step'];
					$session_otp = $_SESSION['otp'];

					if($this->northbridge_model->checkIfUserNameExists($user_name)){

						if($this->input->post('otp_input')){
							$otp = $this->input->post('otp_input');
							if($otp == $session_otp){
								// $this->session->set_userdata('otp',$otp);
								$_SESSION['forgot_pass_second_step'] = $user_name;
								$response_arr['success'] = true;
								$response_arr['user_name'] = $user_name;
								// $response_arr['url'] = site_url('northbridge/index/change_password_reset');
								

							}else{
								$response_arr['incorrect_otp'] = true;
							}
						}else{
							$response_arr['otp_not_present'] = true;
						}
					}		
				}else{
					$response_arr['expired'] = true;
				}
				echo json_encode($response_arr);
				
			}

			elseif($addition == "change_password_reset" && is_null($second_addition)){
				$date = date("j M Y");
				$time = date("h:i:sa");
				// echo "string";
				$response_arr = array('success' => false,'expired' => false,'new_password_absent' => false);

				if(isset($_SESSION['forgot_pass_second_step'])){
					$user_name = $_SESSION['forgot_pass_second_step'];
					
					if($this->northbridge_model->checkIfUserNameExists($user_name)){
						$response_arr['user_name'] = $user_name;
						
						if($this->input->post('new_password')){
							$new_password = $this->input->post('new_password');
							$token = bin2hex($this->encryption->create_key(16));
							$user_id = $this->northbridge_model->getUserIdByName($user_name);
							if($this->northbridge_model->onRegister($user_id,$token)){
								if($this->northbridge_model->changeUserPassword($user_id,$token,$new_password)){
									
									session_unset();
									$this->session->set_flashdata('password_resetted',true);
									$response_arr['success'] = true;
									$response_arr['url'] = site_url('northbridge/');
								} 
							}
						}else{
							$response_arr['new_password_absent'] = true;
						}
	
					}		
				}else{
					$response_arr['expired'] = true;
				}
				echo json_encode($response_arr);
				
			}

			elseif($addition == "verify_user_registration_step_2_otp" && is_null($second_addition)){
				if(isset($_POST['user_name'])){
					$user_name = $_POST['user_name'];
					if($this->northbridge_model->checkIfUserNameExists($user_name)){
						$second_addition = $user_name;
						$user_id = $this->northbridge_model->getUserIdByName($second_addition);
						$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
						$data = array('success' => false);
						$data['user_id'] = $user_id;
						$data['addition'] = $addition;
						$data['second_addition'] = $second_addition;
						if(is_array($user_info)){
							foreach($user_info as $user){
								$data['user_name'] = $user->user_name;
								$data['email'] = $user->email;
								$data['phone'] = $user->phone;
								$data['phone_code'] = $user->phone_code;
								$data['country_id'] = $user->country_id;
								$data['state_id'] = $user->state_id;
								$data['address'] = $user->address;
								$data['user_slug'] = $user->slug;
								$data['date'] = $user->date;
								$data['time'] = $user->time;
								$data['logo'] = $user->logo;
								$data['cover_photo'] =  $user->cover_photo;
							}
							
							if($this->northbridge_model->getUserParamById("created",$user_id) == 0){
								$response_arr = array('success' => false);
						       
					          	$user_id = $this->northbridge_model->getUserIdByName($second_addition);
					          	$date = date("j M Y");
								$time = date("h:i:sa");

					          	$form_array = array(
					          		'created' => 1,
					          		'created_date' => $date,
					          		'created_time' => $time
					          	);
					          	if(isset($_GET['id'])){
					          		if($this->northbridge_model->checkIfUserNameExists($_GET['id'])){
					          			$sponsor_id = $this->northbridge_model->getUserIdByName($_GET['id']);
					          			$form_array['referred_by'] = $sponsor_id;

					          		}
					          	}

					          	
					          	if($this->northbridge_model->updateUserTable($form_array,$user_id)){
					          		if($this->northbridge_model->registerUserInMlm($user_id,$sponsor_id,$date,$time,1,0)){
					          			// echo "string";
						          		$token = $this->northbridge_model->getUserTokenByUserId($user_id);
										if($this->northbridge_model->onRegister($user_id,$token)){
											$this->northbridge_model->sendRegistrationEmail();
											$response_arr['success'] = true;
											$response_arr['url'] = site_url("northbridge/admin_page");
										}
									}
								}
								
						            
						        
						        echo json_encode($response_arr);
						    }
						    
							
						}	
					}
				}
				
			}


			elseif($addition == "verify_user_registration_step_2_otp_placement_selected" && is_null($second_addition)){
				if(isset($_POST['user_name'])){
					$user_name = $this->northbridge_model->getUserNameBySlug($_POST['user_name']);
					if($this->northbridge_model->checkIfUserNameExists($user_name)){

						$second_addition = $user_name;
						$user_id = $this->northbridge_model->getUserIdByName($second_addition);

						if($this->northbridge_model->getUserParamById("created",$user_id) == 0){
							$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
							$data = array('success' => false);
							$data['user_id'] = $user_id;
							$data['addition'] = $addition;
							$data['second_addition'] = $second_addition;
							if(is_array($user_info)){
								foreach($user_info as $user){
									$data['user_name'] = $user->user_name;
									$data['email'] = $user->email;
									$data['phone'] = $user->phone;
									$data['phone_code'] = $user->phone_code;
									$data['country_id'] = $user->country_id;
									$data['state_id'] = $user->state_id;
									$data['address'] = $user->address;
									$data['user_slug'] = $user->slug;
									$data['date'] = $user->date;
									$data['time'] = $user->time;
									$data['logo'] = $user->logo;
									$data['cover_photo'] =  $user->cover_photo;
								}
								$date_created = date("j M Y");
								$time_created = date("h:i:sa");
								if(isset($_POST['sponsor_id']) && isset($_POST['placement_id']) && isset($_POST['positioning'])){ 
									$response_arr = array('success' => false);
							       
						        	$sponsor_id = $this->input->post('sponsor_id');
									$sponsor_username = $sponsor_id;

									$sponsor_id = $this->northbridge_model->getUserIdByName($sponsor_id);
									$sponsor_id = $this->northbridge_model->getUsersFirstMlmDbId($sponsor_id);
						        	$placement_id = $_POST['placement_id'];
						        	$package = 1;
						        	$positioning = $_POST['positioning'];
						        	
						        	if($this->northbridge_model->checkIfUserNameExists($sponsor_username)){
							          	$date = date("j M Y");
										$time = date("h:i:sa");
					          			$package = 1;
					          			$package_str = "Basic";
						          		
						          		if($positioning == "left" || $positioning == "right"){
						          			if($this->northbridge_model->checkIfMlmDbIdIsValid($sponsor_id) && $this->northbridge_model->checkIfMlmDbIdIsValid($placement_id)){
									          	
												if($positioning == "left"){
													$next_available_position = "right";
												}else{
													$next_available_position = "left";
												}

												

												if($this->northbridge_model->checkIfThisPlacementPositionIsAvailable($placement_id,$positioning)){
													// echo "string";
									          	
									          		if($this->northbridge_model->registerUserInMlm2($user_id,$sponsor_id,$placement_id,$positioning,$date,$time,$package,0)){
									          			
											          	$form_array = array(
											          		'created' => 1,
											          		'created_date' => $date_created,
											          		'created_time' => $time_created
											          	);
										          		
									          			$sponsor_user_id = $this->northbridge_model->getUserIdByName($sponsor_username);
									          			$form_array['referred_by'] = $sponsor_user_id;

											          	if($this->northbridge_model->updateUserTable($form_array,$user_id)){
											          		
											          			// echo "string";
											          		$token = $this->northbridge_model->getUserTokenByUserId($user_id);
															if($this->northbridge_model->onRegister($user_id,$token)){
																$this->northbridge_model->sendRegistrationEmail();
																$response_arr['success'] = true;
																$response_arr['url'] = site_url("northbridge/admin_page");
															}
															
														}
													}
												}else if($this->northbridge_model->checkIfThisPlacementPositionIsAvailable($placement_id,$next_available_position)){
													if($this->northbridge_model->registerUserInMlm2($user_id,$sponsor_id,$placement_id,$next_available_position,$date,$time,$package,0)){
									          			// echo "string";
										          		
														$form_array = array(
											          		'created' => 1,
											          		'created_date' => $date_created,
											          		'created_time' => $time_created
											          	);
											          	
										          		
									          			$sponsor_user_id = $this->northbridge_model->getUserIdByName($sponsor_username);
									          			$form_array['referred_by'] = $sponsor_user_id;

											          	if($this->northbridge_model->updateUserTable($form_array,$user_id)){
											          		
											          			// echo "string";
											          		$token = $this->northbridge_model->getUserTokenByUserId($user_id);
															if($this->northbridge_model->onRegister($user_id,$token)){
																$this->northbridge_model->sendRegistrationEmail();
																$response_arr['success'] = true;
																$response_arr['url'] = site_url("northbridge/admin_page");
															}
															
														}
														
													}
												}else{
													if($this->northbridge_model->registerUserInMlm3($user_id,$sponsor_id,$date,$time,$package,0)){
														
														$your_mlm_db_id = $this->northbridge_model->getMlmDbIdByDateAndTime($user_id,$date,$time);
														$placement_id = $this->northbridge_model->getMlmDbParamById("under",$your_mlm_db_id);
														$placement_user_id = $this->northbridge_model->getMlmDbParamById("user_id",$placement_id);
														$placement_user_name = $this->northbridge_model->getUserNameById($placement_user_id);
														$placement_acc = $placement_user_name . " (" . $this->northbridge_model->getMlmIdsIndexNumber($placement_id) . ")";
														$form_array = array(
											          		'created' => 1,
											          		'created_date' => $date_created,
											          		'created_time' => $time_created
											          	);
											          	
										          		
									          			$sponsor_user_id = $this->northbridge_model->getUserIdByName($sponsor_username);
									          			$form_array['referred_by'] = $sponsor_user_id;

											          	if($this->northbridge_model->updateUserTable($form_array,$user_id)){
											          		
											          			// echo "string";
											          		$token = $this->northbridge_model->getUserTokenByUserId($user_id);
															if($this->northbridge_model->onRegister($user_id,$token)){
																$this->northbridge_model->sendRegistrationEmail();
																$response_arr['success'] = true;
																$response_arr['url'] = site_url("northbridge/admin_page");
															}
															
														}
													}
												}
												
											}
										}
										
									}
							        echo json_encode($response_arr);
							    }
								
							}
						}
					}
				}
			}

			else if($addition == "process_registration_payment_placement_selected" && $this->northbridge_model->getUserNameBySlug($second_addition)){
				// $second_addition = $this->northbridge_model->getUserNameByToken($second_addition);
				$second_addition = $this->northbridge_model->getUserNameBySlug($second_addition);
				$user_id = $this->northbridge_model->getUserIdByName($second_addition);
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data = array('success' => false);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = strtolower(url_title($second_addition));
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['phone_code'] = $user->phone_code;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}
					if(isset($_GET['reference']) && isset($_GET['sponsor_id']) && isset($_GET['placement_id']) && isset($_GET['package']) && isset($_GET['positioning']) && isset($_GET['date']) && isset($_GET['time']) && isset($_GET['sponsor_username'])){ 
				        
				        $ver_info = $this->paystack->verifyTransaction($_GET['reference']);
				        
				        if(is_object($ver_info)){
				          if($ver_info->message == "Verification successful" && $ver_info->data->status == "success"){
				            $data['success'] = true;					            
				            
				          }else{
				            $data['unverified'] = true;
				          }
				        }else{
				          $data['unverified'] = true;
				        }
				        $this->load->view("pages/process_registration_payment_placement_selected",$data);
				    }
					
				}	
			}

			else if($addition == "verify_registration_payment_placement_selected" && $this->northbridge_model->getUserNameBySlug($second_addition)){
				$second_addition = $this->northbridge_model->getUserNameBySlug($second_addition);
				$user_id = $this->northbridge_model->getUserIdByName($second_addition);
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data = array('success' => false);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['phone_code'] = $user->phone_code;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}
					$date_created = date("j M Y");
					$time_created = date("h:i:sa");
					if(isset($_GET['reference']) && isset($_GET['sponsor_id']) && isset($_GET['placement_id']) && isset($_GET['package']) && isset($_GET['positioning']) && isset($_GET['date']) && isset($_GET['time']) && isset($_GET['sponsor_username'])){ 
						$response_arr = array('success' => false);
				        $ver_info = $this->paystack->verifyTransaction($_GET['reference']);
				        if(is_object($ver_info)){
				        	$sponsor_id = $_GET['sponsor_id'];
				        	$sponsor_username = $_GET['sponsor_username'];
				        	$placement_id = $_GET['placement_id'];
				        	$package = 1;
				        	$positioning = $_GET['positioning'];
				        	$date = $_GET['date'];
				        	$time = $_GET['time'];
				        	if($this->northbridge_model->checkIfUserNameExists($sponsor_username)){
					          	if($ver_info->message == "Verification successful" && $ver_info->data->status == "success"){
						          	$amount_paid = $ver_info->data->amount;
						          	$reference = $ver_info->data->reference;
						          	if($amount_paid == 350000 || 650000){
						          		if($amount_paid == 350000){
						          			$package = 1;
						          			$package_str = "Basic";
						          		}else{
						          			$package = 2;
						          			$package_str = "Business";
						          		}
						          		if(!$this->northbridge_model->confirmThisPaymentReferenceHasNotBeenUsedBefore($reference)){
							          		if($positioning == "left" || $positioning == "right"){
							          			if($this->northbridge_model->checkIfMlmDbIdIsValid($sponsor_id) && $this->northbridge_model->checkIfMlmDbIdIsValid($placement_id)){
										          	

													if($positioning == "left"){
														$next_available_position = "right";
													}else{
														$next_available_position = "left";
													}

													if($this->northbridge_model->makeSureNoAccountOfThisUserIsWithThisDateAndTime($user_id,$date,$time)){

														if($this->northbridge_model->checkIfThisPlacementPositionIsAvailable($placement_id,$positioning)){
															// echo "string";
											          	
											          		if($this->northbridge_model->registerUserInMlm2($user_id,$sponsor_id,$placement_id,$positioning,$date,$time,$package,0,$reference)){
											          			
													          	$form_array = array(
													          		'created' => 1,
													          		'created_date' => $date_created,
													          		'created_time' => $time_created
													          	);
												          		
											          			$sponsor_user_id = $this->northbridge_model->getUserIdByName($sponsor_username);
											          			$form_array['referred_by'] = $sponsor_user_id;

													          	if($this->northbridge_model->updateUserTable($form_array,$user_id)){
													          		
													          			// echo "string";
													          		$token = $this->northbridge_model->getUserTokenByUserId($user_id);
																	if($this->northbridge_model->onRegister($user_id,$token)){
																		$this->northbridge_model->sendRegistrationEmail();
																		$response_arr['success'] = true;
																		$response_arr['url'] = site_url("northbridge/admin_page");
																	}
																	
																}
															}
														}else if($this->northbridge_model->checkIfThisPlacementPositionIsAvailable($placement_id,$next_available_position)){
															if($this->northbridge_model->registerUserInMlm2($user_id,$sponsor_id,$placement_id,$next_available_position,$date,$time,$package,0,$reference)){
											          			// echo "string";
												          		
																$form_array = array(
													          		'created' => 1,
													          		'created_date' => $date_created,
													          		'created_time' => $time_created
													          	);
													          	
												          		
											          			$sponsor_user_id = $this->northbridge_model->getUserIdByName($sponsor_username);
											          			$form_array['referred_by'] = $sponsor_user_id;

													          	if($this->northbridge_model->updateUserTable($form_array,$user_id)){
													          		
													          			// echo "string";
													          		$token = $this->northbridge_model->getUserTokenByUserId($user_id);
																	if($this->northbridge_model->onRegister($user_id,$token)){
																		$this->northbridge_model->sendRegistrationEmail();
																		$response_arr['success'] = true;
																		$response_arr['url'] = site_url("northbridge/admin_page");
																	}
																	
																}
																
															}
														}else{
															if($this->northbridge_model->registerUserInMlm3($user_id,$sponsor_id,$date,$time,$package,0,$reference)){
																
																$your_mlm_db_id = $this->northbridge_model->getMlmDbIdByDateAndTime($user_id,$date,$time);
																$placement_id = $this->northbridge_model->getMlmDbParamById("under",$your_mlm_db_id);
																$placement_user_id = $this->northbridge_model->getMlmDbParamById("user_id",$placement_id);
																$placement_user_name = $this->northbridge_model->getUserNameById($placement_user_id);
																$placement_acc = $placement_user_name . " (" . $this->northbridge_model->getMlmIdsIndexNumber($placement_id) . ")";
																$form_array = array(
													          		'created' => 1,
													          		'created_date' => $date_created,
													          		'created_time' => $time_created
													          	);
													          	
												          		
											          			$sponsor_user_id = $this->northbridge_model->getUserIdByName($sponsor_username);
											          			$form_array['referred_by'] = $sponsor_user_id;

													          	if($this->northbridge_model->updateUserTable($form_array,$user_id)){
													          		
													          			// echo "string";
													          		$token = $this->northbridge_model->getUserTokenByUserId($user_id);
																	if($this->northbridge_model->onRegister($user_id,$token)){
																		$this->northbridge_model->sendRegistrationEmail();
																		$response_arr['success'] = true;
																		$response_arr['url'] = site_url("northbridge/admin_page");
																	}
																	
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
				        }
				        echo json_encode($response_arr);
				    }
					
				}	
			} 

			elseif($addition == "verify_user_registrar_otp" && is_null($second_addition)){
				$date = date("j M Y");
				$time = date("h:i:sa");
				// echo "string";
				if(isset($_POST["code"]) && isset($_POST["state"]) && isset($_POST['user_name'])){
					$user_name = $this->northbridge_model->getUserNameBySlug($_POST['user_name']);
					$user_id = $this->northbridge_model->getUserIdByName($user_name);
					$session_phone =  $this->northbridge_model->getUserPhoneNumberByUserId($user_id);
					$session_phone_code = $this->northbridge_model->getUserPhoneCodeByUserId($user_id);
					// echo $session_phone;
					// echo $session_phone_code;
					$data = array('success' => false); 
				  // session_start();
					$code = $_POST["code"];
					$state = $_POST["state"];
					$ch = curl_init();
					// Set url elements
					$fb_app_id = '320429851941197';
					$ak_secret = '7e3c153a0bebd2061377a09a3679a149';
					$token = 'AA|'.$fb_app_id.'|'.$ak_secret;
					// Get access token
					$url = 'https://graph.accountkit.com/v1.0/access_token?grant_type=authorization_code&code='.$_POST["code"].'&access_token='.$token;
					curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
					curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
					curl_setopt($ch, CURLOPT_URL,$url);
					$result=curl_exec($ch);
					$info = json_decode($result);
					// var_dump($info);
					if(isset($info->access_token)){
						
						// Get account information
						$url = 'https://graph.accountkit.com/v1.0/me/?access_token='.$info->access_token;
						curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
						curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
						curl_setopt($ch, CURLOPT_URL,$url);
						$result=curl_exec($ch);
						curl_close($ch);
						$final = json_decode($result);  
						// print_r($final);
						// var_dump($final);
						if(isset($final->phone->national_number)){
							$phone_code = $final->phone->country_prefix;
							$phone = $final->phone->national_number;
							if($phone[0] == "0"){
								$phone = substr($phone, 1);
							}
							// $data['phone'] = $phone;
							// $data['phone_code'] = $phone_code;

							// $data['session_phone'] = $session_phone;
							// $data['session_phone_code'] = $session_phone_code;

							if($phone == $session_phone && $phone_code == $session_phone_code){
					        	$data['success'] = true;
							}else{
								$data['phone_change'] = true;
							}
							
						}else{
							$data['no_number'] = true;
						}
					}else{
						$data['access_token'] = false;
					}
					echo json_encode($data);
				}
				
			}

			elseif($addition == "verify_user_registrar_otp_placement_selected" && is_null($second_addition)){
				$date = date("j M Y");
				$time = date("h:i:sa");
				// echo "string";
				if(isset($_POST["code"]) && isset($_POST["state"]) && isset($_POST['user_name']) && isset($_POST['sponsor_id']) && isset($_POST['placement_id'])  && isset($_POST['positioning']) && isset($_POST['package']) ){
					$sponsor_id = $_POST['sponsor_id'];
		        	
		        	$placement_id = $_POST['placement_id'];
		        	$package = 1;
		        	$positioning = $_POST['positioning'];

					$user_name = $this->northbridge_model->getUserNameBySlug($_POST['user_name']);
					$user_id = $this->northbridge_model->getUserIdByName($user_name);
					$session_phone =  $this->northbridge_model->getUserPhoneNumberByUserId($user_id);
					$session_phone_code = $this->northbridge_model->getUserPhoneCodeByUserId($user_id);
					// echo $session_phone;
					// echo $session_phone_code;
					$data = array('success' => false); 
					$sponsor_user_id = $this->northbridge_model->getUserIdByName($sponsor_id);
					$data['sponsor_id'] = $this->northbridge_model->getUsersFirstMlmDbId($sponsor_user_id);
					$data['sponsor_username'] = $sponsor_id;
					$data['placement_id'] = $placement_id;
					$data['package'] = $package;
					$data['positioning'] = $positioning;
					$data['date'] = $date;
					$data['time'] = $time;
				  // session_start();
					$code = $_POST["code"];
					$state = $_POST["state"];
					$ch = curl_init();
					// Set url elements
					$fb_app_id = '320429851941197';
					$ak_secret = '7e3c153a0bebd2061377a09a3679a149';
					$token = 'AA|'.$fb_app_id.'|'.$ak_secret;
					// Get access token
					$url = 'https://graph.accountkit.com/v1.0/access_token?grant_type=authorization_code&code='.$_POST["code"].'&access_token='.$token;
					curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
					curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
					curl_setopt($ch, CURLOPT_URL,$url);
					$result=curl_exec($ch);
					$info = json_decode($result);
					// var_dump($info);
					if(isset($info->access_token)){
						
						// Get account information
						$url = 'https://graph.accountkit.com/v1.0/me/?access_token='.$info->access_token;
						curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
						curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
						curl_setopt($ch, CURLOPT_URL,$url);
						$result=curl_exec($ch);
						curl_close($ch);
						$final = json_decode($result);  
						// print_r($final);
						// var_dump($final);
						if(isset($final->phone->national_number)){
							$phone_code = $final->phone->country_prefix;
							$phone = $final->phone->national_number;
							if($phone[0] == "0"){
								$phone = substr($phone, 1);
							}
							// $data['phone'] = $phone;
							// $data['phone_code'] = $phone_code;

							// $data['session_phone'] = $session_phone;
							// $data['session_phone_code'] = $session_phone_code;

							if($phone == $session_phone && $phone_code == $session_phone_code){
					        	$data['success'] = true;
							}else{
								$data['phone_change'] = true;
							}
							
						}else{
							$data['no_number'] = true;
						}
					}else{
						$data['access_token'] = false;
					}
					echo json_encode($data);
				}
				
			}

			else if($addition == "verify_registration_payment_placement_selected_1" && $this->northbridge_model->getUserNameBySlug($second_addition)){
				$second_addition = $this->northbridge_model->getUserNameBySlug($second_addition);
				$user_id = $this->northbridge_model->getUserIdByName($second_addition);
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data = array('success' => false);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['phone_code'] = $user->phone_code;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}
					$date_created = date("j M Y");
					$time_created = date("h:i:sa");
					if(isset($_GET['sponsor_id']) && isset($_GET['placement_id']) && isset($_GET['package']) && isset($_GET['positioning']) && isset($_GET['date']) && isset($_GET['time'])){ 

						$response_arr = array('success' => false,'not_enough_money' => false);
				        
			        	$sponsor_id = $_GET['sponsor_id'];
			        	$sponsor_username = $this->northbridge_model->getUserNameById($this->northbridge_model->getMlmDbParamById("user_id",$sponsor_id));
			        	$placement_id = $_GET['placement_id'];
			        	$package = 1;
			        	$positioning = $_GET['positioning'];
			        	$date = $_GET['date'];
			        	$time = $_GET['time'];
			        	if($this->northbridge_model->checkIfUserNameExists($sponsor_username)){
				          	
					        $registrar_user_name = $this->input->post('registrar_user_name');
							$registrar_user_id = $this->northbridge_model->getUserIdByName($registrar_user_name);
						    $registrar_total_amount = $this->northbridge_model->getUserTotalAmountByUse($registrar_user_id);
							if($registrar_total_amount >= 3500){  
								if($this->northbridge_model->debitUser($registrar_user_id,3500)){ 
				          			$package = 1;
				          			$package_str = "Basic";
				          			$reference = NULL;
				          		
					          		if($positioning == "left" || $positioning == "right"){
					          			if($this->northbridge_model->checkIfMlmDbIdIsValid($sponsor_id) && $this->northbridge_model->checkIfMlmDbIdIsValid($placement_id)){
								          	

											if($positioning == "left"){
												$next_available_position = "right";
											}else{
												$next_available_position = "left";
											}

											if($this->northbridge_model->makeSureNoAccountOfThisUserIsWithThisDateAndTime($user_id,$date,$time)){

												if($this->northbridge_model->checkIfThisPlacementPositionIsAvailable($placement_id,$positioning)){
													// echo "string";
									          	
									          		if($this->northbridge_model->registerUserInMlm2($user_id,$sponsor_id,$placement_id,$positioning,$date,$time,$package,0,$reference)){
									          			
											          	$form_array = array(
											          		'created' => 1,
											          		'created_date' => $date_created,
											          		'created_time' => $time_created
											          	);
										          		
									          			$sponsor_user_id = $this->northbridge_model->getUserIdByName($sponsor_username);
									          			$form_array['referred_by'] = $sponsor_user_id;

											          	if($this->northbridge_model->updateUserTable($form_array,$user_id)){
											          		
											          			// echo "string";
											          		$token = $this->northbridge_model->getUserTokenByUserId($user_id);
															if($this->northbridge_model->onRegister($user_id,$token)){
																$response_arr['success'] = true;
																$response_arr['url'] = site_url("northbridge/admin_page");
															}
															
														}
													}
												}else if($this->northbridge_model->checkIfThisPlacementPositionIsAvailable($placement_id,$next_available_position)){
													if($this->northbridge_model->registerUserInMlm2($user_id,$sponsor_id,$placement_id,$next_available_position,$date,$time,$package,0,$reference)){
									          			// echo "string";
										          		
														$form_array = array(
											          		'created' => 1,
											          		'created_date' => $date_created,
											          		'created_time' => $time_created
											          	);
											          	
										          		
									          			$sponsor_user_id = $this->northbridge_model->getUserIdByName($sponsor_username);
									          			$form_array['referred_by'] = $sponsor_user_id;

											          	if($this->northbridge_model->updateUserTable($form_array,$user_id)){
											          		
											          			// echo "string";
											          		$token = $this->northbridge_model->getUserTokenByUserId($user_id);
															if($this->northbridge_model->onRegister($user_id,$token)){
																$response_arr['success'] = true;
																$response_arr['url'] = site_url("northbridge/admin_page");
															}
															
														}
														
													}
												}else{
													if($this->northbridge_model->registerUserInMlm3($user_id,$sponsor_id,$date,$time,$package,0,$reference)){
														
														$your_mlm_db_id = $this->northbridge_model->getMlmDbIdByDateAndTime($user_id,$date,$time);
														$placement_id = $this->northbridge_model->getMlmDbParamById("under",$your_mlm_db_id);
														$placement_user_id = $this->northbridge_model->getMlmDbParamById("user_id",$placement_id);
														$placement_user_name = $this->northbridge_model->getUserNameById($placement_user_id);
														$placement_acc = $placement_user_name . " (" . $this->northbridge_model->getMlmIdsIndexNumber($placement_id) . ")";
														$form_array = array(
											          		'created' => 1,
											          		'created_date' => $date_created,
											          		'created_time' => $time_created
											          	);
											          	
										          		
									          			$sponsor_user_id = $this->northbridge_model->getUserIdByName($sponsor_username);
									          			$form_array['referred_by'] = $sponsor_user_id;

											          	if($this->northbridge_model->updateUserTable($form_array,$user_id)){
											          		
											          			// echo "string";
											          		$token = $this->northbridge_model->getUserTokenByUserId($user_id);
															if($this->northbridge_model->onRegister($user_id,$token)){
																$response_arr['success'] = true;
																$response_arr['url'] = site_url("northbridge/admin_page");
															}
															
														}
													}
												}
											}
										}
									}
								}
							}else{
								$response_arr['not_enough_money'] = true;
							}
						}
				        
				        echo json_encode($response_arr);
				    }
					
				}	
			} 

			else if($addition == "verify_registration_payment_registrar" && $this->northbridge_model->getUserNameBySlug($second_addition)){
				$second_addition = $this->northbridge_model->getUserNameBySlug($second_addition);
				$user_id = $this->northbridge_model->getUserIdByName($second_addition);
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data = array('success' => false);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['phone_code'] = $user->phone_code;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}

					if($this->input->post('registrar_user_name')){
					 
						$response_arr = array('success' => false);
						$registrar_user_name = $this->input->post('registrar_user_name');
						$registrar_user_id = $this->northbridge_model->getUserIdByName($registrar_user_name);
					    $registrar_total_amount = $this->northbridge_model->getUserTotalAmountByUse($registrar_user_id);
						if($registrar_total_amount >= 3500){  
							if($this->northbridge_model->debitUser($registrar_user_id,3500)){ 
					          	$user_id = $this->northbridge_model->getUserIdByName($second_addition);

					          	$date = date("j M Y");
								$time = date("h:i:sa");
					          	$form_array = array(
					          		'created' => 1,
					          		'created_date' => $date,
					          		'created_time' => $time
					          	);
					          	if(isset($_GET['id'])){
					          		$sponsor_id = $this->northbridge_model->getUserIdByName($_GET['id']);
					          		if($this->northbridge_model->checkIfUserNameExists($_GET['id'])){
					          			$form_array['referred_by'] = $this->northbridge_model->getUserIdByName($_GET['id']);
					          			
							          	if($this->northbridge_model->updateUserTable($form_array,$user_id)){
							          		if($this->northbridge_model->registerUserInMlm($user_id,$sponsor_id,$date,$time,1,0)){
							          			// echo "string";
								          		$token = $this->northbridge_model->getUserTokenByUserId($user_id);
												if($this->northbridge_model->onRegister($user_id,$token)){
													$response_arr['success'] = true;
													$response_arr['url'] = site_url("northbridge/admin_page");
												}
											}
										}
										
					          			
					          		}
					          	}
							}	
						}
						echo json_encode($response_arr);
					}	
				}	
			}

			elseif($addition == "process_user_sign_up_cont" && is_null($second_addition)){
				$date = date("j M Y");
				$time = date("h:i:sa");
				$data = array('success' => false,'expired' => false,'sponsor_does_not_exist' => false,'incorrect_otp' => false,'phone_used' => false); 
				if(isset($_POST['otp_input'])){
					if(isset($_SESSION['otp'])){
						$session_otp = $_SESSION['otp'];
						$otp_input = $_POST['otp_input'];
						
						$proceed = false;

						if($session_otp == $otp_input){

							$password = $this->session->password;
							$user_name = $this->session->user_name;
							$full_name = $this->session->full_name;
							$token = $this->session->token;
							$email = $this->session->email;
							$hashed = $this->session->hashed;
							$slug = $this->session->slug;
							$phone_code = $this->session->code;
							$phone = $this->session->phone_number;

							if(isset($_SESSION['sponsor_user_name'])){
								$sponsor_user_name = $_SESSION['sponsor_user_name'];
					
								if(!$this->northbridge_model->checkIfUserNameExists($sponsor_user_name)){
									$sponsor_user_name = "admin";
								}
							}else{
								$sponsor_user_name = "admin";
							}

							
							if($phone[0] == "0"){
								$phone = substr($phone, 1);
							}
							
							if($this->northbridge_model->phone_unique($phone_code,$phone)){

								if($_SERVER['SERVER_NAME'] == "localhost"){
									$country_code = "ng";
								}else{
									$url = "https://restcountries.eu/rest/v2/callingcode/".$phone_code;
									$ch = curl_init();
									curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
									curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
									curl_setopt($ch, CURLOPT_URL,$url);
									$country_info=curl_exec($ch);
									// echo $country_info;
									if($this->northbridge_model->isJson($country_info)){
										$country_info = json_decode($country_info);
										if(is_array($country_info)){
									  		$country_code = $country_info[0]->alpha2Code;
									  	}
									} 
								}

								
								$country_id = $this->northbridge_model->getCountryIdByCountryCode(strtolower($country_code));
								
								$encrypted_pass = $this->encryption->encrypt($password);

								$user_array = array(
									'encrypted_pass' => $encrypted_pass,
									'created' => 1,
									'created_date' => $date,
									'created_time' => $time,
									'user_name' => $user_name,
									'full_name' => $full_name,
									'hashed' => $hashed,
									'token' => $token,
									'phone' => $phone,
									'phone_code' => $phone_code,
									'email' => $email,
									'country_id' => $country_id,
									'slug' => $slug,
									'date' => $date,
									'time' => $time
								);

								if(isset($_GET['id'])){
									// echo "string";
									$id = $_GET['id'];
									// echo $id;
									if($this->northbridge_model->getUserIdByName($id) !== false){
										$id = $this->northbridge_model->getUserIdByName($id);
										$user_array = array_merge($user_array,array('referred_by' => $id));
									}
								}	

								if($this->northbridge_model->createUser($user_array)){
									$user_id = $this->northbridge_model->getUserIdByToken($token);
									// if($this->northbridge_model->onRegister($user_id,$token)){
										$admin_id = $this->northbridge_model->getAdminId();

										if(isset($sponsor_user_name)){
											
											$this->northbridge_model->performMlmRegistrationForFirstTimeUsersWithOutPlacement($user_id,$sponsor_user_name,$date,$time);
										}

										
										if($this->northbridge_model->onRegister($user_id,$token)){
											$data['success'] = true;
											
											$data['url'] = site_url("northbridge/");
											
											$this->session->set_flashdata('account_created_success',true);
										}
										
									// }
								}
								
							}else{
								$data['phone_used'] = true;
							}
							
						}else{
							$data['incorrect_otp'] = true;
						}
							
						
					}else{
						$data['expired'] = true;
					}
				}	
				echo json_encode($data);
				
			}

			elseif($addition == "process_user_sign_up" && is_null($second_addition)){

				if($this->input->post('user_name_sign_up')){
					$user_name_sign_up = $this->input->post('user_name_sign_up');

					$data = array('success' => false,'messages' => array(),'half_registered' => false,'already_registered' => false);
					if(!$this->northbridge_model->checkIfUserHasHalfRegistered($user_name_sign_up)){
						
						$this->form_validation->set_rules('phone','Phone Number','trim|required|numeric|max_length[15]|callback_phone_unique');						
						$this->form_validation->set_rules('email','Email Address','trim|required|valid_email|max_length[50]',array('is_unique' => 'This Email Address Has Been Used By Another User.'));						
						$this->form_validation->set_rules('full_name','Full Name','trim|required|min_length[5]|max_length[100]');
						$this->form_validation->set_rules('user_name_sign_up','User Name','trim|required|min_length[4]|max_length[15]|is_unique[users.user_name]|callback__usernameRegex',array('is_unique' => 'This User Name Has Been Used By Another User.'));
						$this->form_validation->set_rules('password_sign_up','Password','trim|required|min_length[5]');
						$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
						if($this->form_validation->run() == FALSE){
							// redirect('northbridge/account_created');
							foreach($_POST as $key => $value){
								$data['messages'][$key] = form_error($key);
							}
						}else{
							session_unset();

							$ip_address = $this->input->ip_address();
							if($ip_address == "::1"){
								$ip_address = "197.211.60.81";
							}
										
							// if($this->input->valid_ip($ip_address)){
							// 	$location_info = $this->northbridge_model->custom_curl("http://api.ipstack.com/" . $ip_address . "?access_key=04b8933ab2331d1a31e653053f909b43",TRUE);
								
							// 	$location_info = json_decode($location_info);
							// 	if(is_object($location_info)){
									
							// 		$calling_code = $location_info->location->calling_code;
							// 		$country_id = $this->northbridge_model->getCountryIdByCountryCode(strtolower($location_info->country_code));
									
									// $this->session->set_userdata('country_id',$country_id);
									
								// }else{
									$calling_code = "234";
									
									$country_id = 151;
									$this->session->set_userdata('country_id',$country_id);
								// }


								$password = $this->input->post('password_sign_up');
								$user_name = strtolower($this->input->post('user_name_sign_up'));
								$full_name = $this->input->post('full_name');
								$token = bin2hex($this->encryption->create_key(16));
								$phone = $this->input->post('phone');
								$email = $this->input->post('email');							
								$phone_code = $calling_code;
								$hashed = sha1($password);
								$slug = url_title($user_name);
								$date = date("j M Y");
								$time = date("h:i:sa");

								$this->session->set_userdata('password',$password);
								$this->session->set_userdata('user_name',$user_name);
								$this->session->set_userdata('full_name',$full_name);
								$this->session->set_userdata('token',$token);
								$this->session->set_userdata('email',$email);
								
								$this->session->set_userdata('hashed',$hashed);
								$this->session->set_userdata('slug',$slug);
								$this->session->set_userdata('code',$phone_code);
								$this->session->set_userdata('phone_number',$phone);

								

								if(isset($_GET['id'])){
									$sponsor_user_name = $_GET['id'];
									

									$this->session->set_userdata('placement_selected',true);
									$this->session->set_userdata('sponsor_user_name',$sponsor_user_name);
								}else{
									$this->session->set_userdata('placement_selected',false);
								}

								$data['code'] = $phone_code;
								if(substr($phone, 0,1) == "0"){
									$phone = substr($phone, 1);
								}
								$data['phone_number'] = $phone;
								$data['email'] = $email;

								$mobile_no = "+" . $phone_code . "" . $phone;
								$data['test'] = $mobile_no;
								$otp = rand ( 10000 , 99999 );
								$email_arr = array($email);
								if($this->northbridge_model->sendOtpEmail($email_arr,$otp)){
									$this->session->set_userdata('otp',$otp);
									//Change This Once In Production
									if($_SERVER['SERVER_NAME'] == "localhost"){
										$data['otp'] = $otp;
									}
									$data['success'] = true;
								}
									
							// }	
							
						}
					}else{
						if($this->northbridge_model->checkIfUserHasHalfRegistered($user_name_sign_up)){
							$data['half_registered'] = true;
							$data['user_name'] = $user_name_sign_up;
							$user_name_sign_up = strtolower(url_title($user_name_sign_up));
							if(isset($_GET['id'])){
								$data['url'] = site_url('northbridge/index/registration_step_2/'.$user_name_sign_up.'?id='+$_GET['id']);
							}else{
								$data['url'] = site_url('northbridge/index/registration_step_2/'.$user_name_sign_up);
							}
						}
					}
					
					echo json_encode($data);
				}
			}

			else if($addition == "process_registration_payment" && $this->northbridge_model->getUserByTokenBoolean($second_addition)){
				$second_addition = $this->northbridge_model->getUserNameByToken($second_addition);
				$user_id = $this->northbridge_model->getUserIdByName($second_addition);
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data = array('success' => false);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = strtolower(url_title($second_addition));
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['phone_code'] = $user->phone_code;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}
					if(isset($_GET['reference'])){ 
				        
				        $ver_info = $this->paystack->verifyTransaction($_GET['reference']);
				        
				        if(is_object($ver_info)){
				          if($ver_info->message == "Verification successful" && $ver_info->data->status == "success"){
				            $data['success'] = true;					            
				            
				          }else{
				            $data['unverified'] = true;
				          }
				        }else{
				          $data['unverified'] = true;
				        }
				    }
					$this->load->view("pages/process_registration_payment",$data);
				}	
			} 


			else if($addition == "verify_registration_payment" && $this->northbridge_model->getUserNameBySlug($second_addition)){
				$second_addition = $this->northbridge_model->getUserNameBySlug($second_addition);
				$user_id = $this->northbridge_model->getUserIdByName($second_addition);
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data = array('success' => false);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['phone_code'] = $user->phone_code;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}
					if(isset($_GET['reference'])){ 
						if($this->northbridge_model->getUserParamById("created",$user_id) == 0){
							$response_arr = array('success' => false);
					        $ver_info = $this->paystack->verifyTransaction($_GET['reference']);
					        if(is_object($ver_info)){
					          if($ver_info->message == "Verification successful" && $ver_info->data->status == "success"){
					          	$reference = $ver_info->data->reference;
					          	$user_id = $this->northbridge_model->getUserIdByName($second_addition);
					          	$date = date("j M Y");
								$time = date("h:i:sa");

					          	$form_array = array(
					          		'created' => 1,
					          		'created_date' => $date,
					          		'created_time' => $time
					          	);
					          	if(isset($_GET['id'])){
					          		if($this->northbridge_model->checkIfUserNameExists($_GET['id'])){
					          			$sponsor_id = $this->northbridge_model->getUserIdByName($_GET['id']);
					          			$form_array['referred_by'] = $sponsor_id;

					          		}
					          	}

					          	if(!$this->northbridge_model->confirmThisPaymentReferenceHasNotBeenUsedBefore($reference)){
						          	if($this->northbridge_model->updateUserTable($form_array,$user_id)){
						          		if($this->northbridge_model->registerUserInMlm($user_id,$sponsor_id,$date,$time,1,0,$reference)){
						          			// echo "string";
							          		$token = $this->northbridge_model->getUserTokenByUserId($user_id);
											if($this->northbridge_model->onRegister($user_id,$token)){
												$this->northbridge_model->sendRegistrationEmail();
												$response_arr['success'] = true;
												$response_arr['url'] = site_url("northbridge/admin_page");
											}
										}
									}
								}	
					            
					          }
					        }
					        echo json_encode($response_arr);
					    }
				    }
					
				}	
			} 



			else if($addition == "load_users_basic_accounts" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_name = $this->northbridge_model->getUserNameById($user_id);
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data = array('success' => false);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['phone_code'] = $user->phone_code;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}

					if($this->input->post('show_records')){
						$response_arr = array('success' => true,'messages' => '','add_another_account' => false);
						$users_basic_accounts = $this->northbridge_model->getUsersBasicAccounts($user_id);
						
						if($this->northbridge_model->checkIfUserIsValidForCreatingNewMlmAccount($user_id)){
							$response_arr['add_another_account'] = true;
						}
						$i = 0;
						$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="">';
	            		$response_arr['messages'] .= '<table class="table table-striped table-bordered nowrap hover display" id="users-basic-accounts-table" cellspacing="0" width="100%" style="width:100%">';
	            		$response_arr['messages'] .= '<thead>';
	            		$response_arr['messages'] .= '<tr>';
	            		$response_arr['messages'] .= '<th>#</th>';
	            		$response_arr['messages'] .= '<th>Account Name</th>';
	            		$response_arr['messages'] .= '<th>Date Of Registration</th>';
	            		$response_arr['messages'] .= '<th>Time Of Registration</th>';
	            		// $response_arr['messages'] .= '<th>Package</th>';
	            		
	            		
	            		$response_arr['messages'] .= '<th>Actions</th>';
	            		
	            		$response_arr['messages'] .= '</tr>';
	            		$response_arr['messages'] .= '<tbody>';
	            		if(is_array($users_basic_accounts)){
							foreach($users_basic_accounts as $row){
								$i++;
								$id = $row->id;
								$user_id = $row->user_id;
								$package = $row->package;
								$sponsor = $row->sponsor;
								$under = $row->under;
								$stage = $row->stage;
								$positioning = $row->positioning;
								$date_created = $row->date_created;
								$time_created = $row->time_created;

								$total_earnings = $this->northbridge_model->getThisAccountsTotalBasicEarnings($id);
								$index = $this->northbridge_model->getMlmIdsIndexNumber($id);
								

								$response_arr['messages'] .= '<tr>';

								$response_arr['messages'] .= '<td>'.$i.'</td>';
								$response_arr['messages'] .= '<td>'.$user_name. ' (' . $index . ')</td>';
								$response_arr['messages'] .= '<td class="date">'.$date_created.'</td>';
								$response_arr['messages'] .= '<td class="time">'.$time_created.'</td>';
								// $response_arr['messages'] .= '<td class="package">'.$package_str.'</td>';
								// $response_arr['messages'] .= '<td>₦'.number_format($total_earnings,2).'</td>';


								$response_arr['messages'] .= '<td class="td-actions">';
			                   	$response_arr['messages'] .= '<button type="button" rel="tooltip" title="View Genealogy Tree" class="btn btn-success  btn-lg genealogy-btn" data-package="basic" onclick="viewGenealogyTree(this,event,'.$id.')">';
			                   	$response_arr['messages'] .= '<img style="width: 25px; height: 25px;" src="'.base_url('assets/images/genealogy_tree.png').'"></img>';
			                    $response_arr['messages'] .= '<div class="ripple-container"></div>';
			                    $response_arr['messages'] .= '</button>';

			                    $response_arr['messages'] .= '<button type="button" rel="tooltip" title="View Sponsor Tree" class="btn btn-info btn-lg sponsor-btn" data-package="basic" onclick="viewSponsorTree(this,event,'.$id.')">';
			                   	$response_arr['messages'] .= '<img style="width: 25px; height: 25px;" src="'.base_url('assets/images/sponsor.png').'"></img>';
			                    $response_arr['messages'] .= '<div class="ripple-container"></div>';
			                    $response_arr['messages'] .= '</button>';

			                    if($package == 1){
			                    	$response_arr['messages'] .= '<button type="button" rel="tooltip" title="Upgrade To Business Package" class="btn btn-primary btn-lg upgrade-to-business-btn" onclick="updgradeToBusiness(this,event,'.$id.')">';
				                   	$response_arr['messages'] .= '<i class="fas fa-user-plus font-awesome"></i>';
				                    $response_arr['messages'] .= '<div class="ripple-container"></div>';
				                    $response_arr['messages'] .= '</button>';
			                    }
			                    $response_arr['messages'] .= '</td>';

								$response_arr['messages'] .= '</tr>';

							}
						}
						$response_arr['messages'] .= '</tbody>';
						$response_arr['messages'] .= '</table>';
						$response_arr['messages'] .= '</div>';

						// $response_arr['messages'] .= '<div class="container">';

						// $total_basic_income = $this->northbridge_model->getUserParamById("total_basic_income",$user_id);
						// $total_basic_withdrawn = $this->northbridge_model->getUserParamById("total_basic_withdrawn",$user_id);
						// $total_basic_withdrawable_balance = $total_basic_income - $total_basic_withdrawn;

						// $response_arr['messages'] .= '<h4>Total Basic Income: <em>₦'.number_format($total_basic_income,2).'</em></h4>';
						// $response_arr['messages'] .= '<h4>Total Basic Withdrawn: <em>₦'.number_format($total_basic_withdrawn,2).'</em></h4>';
						// $response_arr['messages'] .= '<h4>Total Basic Withdrawable Balance: <em>₦'.number_format($total_basic_withdrawable_balance,2).'</em></h4>';
						// $response_arr['messages'] .= '</div>';
						echo json_encode($response_arr);
					}
				}
			}

			else if($addition == "view_account_credit_history" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_name = $this->northbridge_model->getUserNameById($user_id);
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data = array('success' => false);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['phone_code'] = $user->phone_code;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}

					if($this->input->post('show_records')){
						$response_arr = array('success' => true,'messages' => '');
						$account_credit_history = $this->northbridge_model->getUsersMainAccountCreditHistory($user_id);
						
						$i = 0;
						$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="">';
	            		$response_arr['messages'] .= '<table class="table table-striped table-bordered nowrap hover display" id="account-credit-history-table"" cellspacing="0" width="100%" style="width:100%">';
	            		$response_arr['messages'] .= '<thead>';
	            		$response_arr['messages'] .= '<tr>';
	            		$response_arr['messages'] .= '<th>#</th>';
	            		$response_arr['messages'] .= '<th>Amount</th>';
	            		$response_arr['messages'] .= '<th>Date</th>';
	            		$response_arr['messages'] .= '<th>Time</th>';
	            		
	            		
	            		$response_arr['messages'] .= '</tr>';
	            		$response_arr['messages'] .= '<tbody>';
	            		if(is_array($account_credit_history)){
	            			$account_credit_history = array_values(array_reverse($account_credit_history));
							foreach($account_credit_history as $row){
								$i++;
								$id = $row->id;
								$amount = $row->amount;
								$date = $row->date;
								$time = $row->time;
								$reference = $row->reference;


								$response_arr['messages'] .= '<tr>';

								$response_arr['messages'] .= '<td>'.$i.'</td>';
								$response_arr['messages'] .= '<td>₦'.number_format($amount,2).'</td>';
								$response_arr['messages'] .= '<td class="date">'.$date.'</td>';
								$response_arr['messages'] .= '<td class="time">'.$time.'</td>';

								$response_arr['messages'] .= '</tr>';

							}
						}
						$response_arr['messages'] .= '</tbody>';
						$response_arr['messages'] .= '</table>';
						$response_arr['messages'] .= '</div>';

						// $response_arr['messages'] .= '<div class="container">';

						// $total_basic_income = $this->northbridge_model->getUserParamById("total_basic_income",$user_id);
						// $total_basic_withdrawn = $this->northbridge_model->getUserParamById("total_basic_withdrawn",$user_id);
						// $total_basic_withdrawable_balance = $total_basic_income - $total_basic_withdrawn;

						// $response_arr['messages'] .= '<h4>Total Basic Income: <em>₦'.number_format($total_basic_income,2).'</em></h4>';
						// $response_arr['messages'] .= '<h4>Total Basic Withdrawn: <em>₦'.number_format($total_basic_withdrawn,2).'</em></h4>';
						// $response_arr['messages'] .= '<h4>Total Basic Withdrawable Balance: <em>₦'.number_format($total_basic_withdrawable_balance,2).'</em></h4>';
						// $response_arr['messages'] .= '</div>';
						echo json_encode($response_arr);
					}
				}
			}

			else if($addition == "view_account_transfer_history" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_name = $this->northbridge_model->getUserNameById($user_id);
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data = array('success' => false);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['phone_code'] = $user->phone_code;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}

					if($this->input->post('show_records')){
						$response_arr = array('success' => true,'messages' => '');
						$account_transfer_history = $this->northbridge_model->getUsersMainAccountTransferHistory($user_id);
						
						$i = 0;
						$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="">';
	            		$response_arr['messages'] .= '<table class="table table-striped table-bordered nowrap hover display" id="account-transfer-history-table" cellspacing="0" width="100%" style="width:100%">';
	            		$response_arr['messages'] .= '<thead>';
	            		$response_arr['messages'] .= '<tr>';
	            		$response_arr['messages'] .= '<th>#</th>';
	            		$response_arr['messages'] .= '<th>Sender</th>';
	            		$response_arr['messages'] .= '<th>Recipient</th>';
	            		$response_arr['messages'] .= '<th>Amount</th>';
	            		$response_arr['messages'] .= '<th>Date</th>';
	            		$response_arr['messages'] .= '<th>Time</th>';
	            		
	            		
	            		$response_arr['messages'] .= '</tr>';
	            		$response_arr['messages'] .= '<tbody>';
	            		if(is_array($account_transfer_history)){
	            			$account_transfer_history = array_values(array_reverse($account_transfer_history));
							foreach($account_transfer_history as $row){
								$i++;
								$id = $row->id;
								$amount = $row->amount;
								$date = $row->date;
								$time = $row->time;
								$sender = $row->sender;
								$recepient = $row->recepient;

								if($sender == $user_id){
									$sender = "you";
								}else{
									$sender_username = $this->northbridge_model->getUserNameById($sender);
									$sender_slug = $this->northbridge_model->getUserParamById("slug",$sender);
									$sender = "<a target='_blank' href='".site_url('northbridge/'.$sender_slug)."'>".$sender_username."</a>";
								}

								if($recepient == $user_id){
									$recepient = "you";
								}else{
									$recepient_username = $this->northbridge_model->getUserNameById($recepient);
									$recepient_slug = $this->northbridge_model->getUserParamById("slug",$recepient);
									$recepient = "<a target='_blank' href='".site_url('northbridge/'.$recepient_slug)."'>".$recepient_username."</a>";
								}


								$response_arr['messages'] .= '<tr>';

								$response_arr['messages'] .= '<td>'.$i.'</td>';
								$response_arr['messages'] .= '<td>'.$sender.'</td>';
								$response_arr['messages'] .= '<td>'.$recepient.'</td>';
								$response_arr['messages'] .= '<td>₦'.number_format($amount,2).'</td>';
								$response_arr['messages'] .= '<td class="date">'.$date.'</td>';
								$response_arr['messages'] .= '<td class="time">'.$time.'</td>';

								$response_arr['messages'] .= '</tr>';

							}
						}
						$response_arr['messages'] .= '</tbody>';
						$response_arr['messages'] .= '</table>';
						$response_arr['messages'] .= '</div>';

						// $response_arr['messages'] .= '<div class="container">';

						// $total_basic_income = $this->northbridge_model->getUserParamById("total_basic_income",$user_id);
						// $total_basic_withdrawn = $this->northbridge_model->getUserParamById("total_basic_withdrawn",$user_id);
						// $total_basic_withdrawable_balance = $total_basic_income - $total_basic_withdrawn;

						// $response_arr['messages'] .= '<h4>Total Basic Income: <em>₦'.number_format($total_basic_income,2).'</em></h4>';
						// $response_arr['messages'] .= '<h4>Total Basic Withdrawn: <em>₦'.number_format($total_basic_withdrawn,2).'</em></h4>';
						// $response_arr['messages'] .= '<h4>Total Basic Withdrawable Balance: <em>₦'.number_format($total_basic_withdrawable_balance,2).'</em></h4>';
						// $response_arr['messages'] .= '</div>';
						echo json_encode($response_arr);
					}
				}
			}

			else if($addition == "view_vtu_transaction_history" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_name = $this->northbridge_model->getUserNameById($user_id);
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data = array('success' => false);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['phone_code'] = $user->phone_code;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}

					if($this->input->post('show_records')){
						$response_arr = array('success' => true,'messages' => '');
						$transaction_history = $this->northbridge_model->getUsersVtuTransactionHistory($user_id);
						
						$i = 0;
						$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="">';
	            		$response_arr['messages'] .= '<table class="table table-striped table-bordered nowrap hover display" id="transaction-history-table" cellspacing="0" width="100%" style="width:100%">';
	            		$response_arr['messages'] .= '<thead>';
	            		$response_arr['messages'] .= '<tr>';
	            		$response_arr['messages'] .= '<th>#</th>';
	            		$response_arr['messages'] .= '<th>Actions</th>';
	            		$response_arr['messages'] .= '<th>Type</th>';
	            		$response_arr['messages'] .= '<th>Sub Type</th>';
	            		$response_arr['messages'] .= '<th>Amount</th>';
	            		$response_arr['messages'] .= '<th>Number</th>';
	            		$response_arr['messages'] .= '<th>Order Id</th>';
	            		$response_arr['messages'] .= '<th>Date</th>';
	            		$response_arr['messages'] .= '<th>Time</th>';
	            		
	            		
	            		
	            		$response_arr['messages'] .= '</tr>';
	            		$response_arr['messages'] .= '<tbody>';
	            		if(is_array($transaction_history)){
	            			$transaction_history = array_values(array_reverse($transaction_history));
							foreach($transaction_history as $row){
								$i++;
								$id = $row->id;
								$amount = $row->amount;
								$date = $row->date;
								$time = $row->time;
								$type = $row->type;
								$sub_type = $row->sub_type;
								$order_id = $row->order_id;
								$number = $row->number;

								


								$response_arr['messages'] .= '<tr>';

								$response_arr['messages'] .= '<td>'.$i.'</td>';

								$response_arr['messages'] .= '<td class="td-actions">';

								$order_id_cut = substr($order_id, 0,2);
								if($order_id_cut == "PS"){

				                   	$response_arr['messages'] .= '<button type="button" class="btn btn-success" data-package="business" onclick="trackThisOrderPayscribe(this,event)" data-order-id="'.$order_id.'">';
				                   	$response_arr['messages'] .= 'Track';
				                    $response_arr['messages'] .= '</button>';

				                }

			                    $response_arr['messages'] .= '</td>';
								$response_arr['messages'] .= '<td style="text-transform: capitalize;">'.$type.'</td>';
								$response_arr['messages'] .= '<td>'.$sub_type.'</td>';
								$response_arr['messages'] .= '<td>₦'.number_format($amount,2).'</td>';
								$response_arr['messages'] .= '<td>'.$number.'</td>';
								$response_arr['messages'] .= '<td><em class="text-primary">'.$order_id.'</em></td>';
								$response_arr['messages'] .= '<td class="date">'.$date.'</td>';
								$response_arr['messages'] .= '<td class="time">'.$time.'</td>';

								


								$response_arr['messages'] .= '</tr>';

							}
						}
						$response_arr['messages'] .= '</tbody>';
						$response_arr['messages'] .= '</table>';
						$response_arr['messages'] .= '</div>';

						// $response_arr['messages'] .= '<div class="container">';

						// $total_basic_income = $this->northbridge_model->getUserParamById("total_basic_income",$user_id);
						// $total_basic_withdrawn = $this->northbridge_model->getUserParamById("total_basic_withdrawn",$user_id);
						// $total_basic_withdrawable_balance = $total_basic_income - $total_basic_withdrawn;

						// $response_arr['messages'] .= '<h4>Total Basic Income: <em>₦'.number_format($total_basic_income,2).'</em></h4>';
						// $response_arr['messages'] .= '<h4>Total Basic Withdrawn: <em>₦'.number_format($total_basic_withdrawn,2).'</em></h4>';
						// $response_arr['messages'] .= '<h4>Total Basic Withdrawable Balance: <em>₦'.number_format($total_basic_withdrawable_balance,2).'</em></h4>';
						// $response_arr['messages'] .= '</div>';
						echo json_encode($response_arr);
					}
				}
			}

			else if($addition == "load_users_business_accounts" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_name = $this->northbridge_model->getUserNameById($user_id);
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data = array('success' => false);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['phone_code'] = $user->phone_code;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}

					if($this->input->post('show_records')){
						$response_arr = array('success' => true,'messages' => '','add_another_account' => false);
						$users_business_accounts = $this->northbridge_model->getUsersBusinessAccounts($user_id);
						
						if($this->northbridge_model->checkIfUserIsValidForCreatingNewMlmAccount($user_id)){
							$response_arr['add_another_account'] = true;
						}
						$i = 0;
						$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="">';
	            		$response_arr['messages'] .= '<table class="table table-striped table-bordered nowrap hover display" id="users-business-accounts-table" cellspacing="0" width="100%" style="width:100%">';
	            		$response_arr['messages'] .= '<thead>';
	            		$response_arr['messages'] .= '<tr>';
	            		$response_arr['messages'] .= '<th>#</th>';
	            		$response_arr['messages'] .= '<th>Account Name</th>';
	            		$response_arr['messages'] .= '<th>Date Of Registration</th>';
	            		$response_arr['messages'] .= '<th>Time Of Registration</th>';
	            		// $response_arr['messages'] .= '<th>Car Award Funds</th>';
	            		// $response_arr['messages'] .= '<th>Total Business Earnings</th>';
	            		
	            		$response_arr['messages'] .= '<th>Actions</th>';
	            		
	            		$response_arr['messages'] .= '</tr>';
	            		$response_arr['messages'] .= '<tbody>';
	            		if(is_array($users_business_accounts)){
							foreach($users_business_accounts as $row){
								$i++;
								$id = $row->id;
								$user_id = $row->user_id;
								$package = $row->package;
								$sponsor = $row->sponsor;
								$under = $row->under;
								$stage = $row->stage;
								$positioning = $row->positioning;
								$date_created = $row->date_created;
								$time_created = $row->time_created;

								$total_earnings = $this->northbridge_model->getThisAccountsTotalBusinessEarnings($id);

								$car_award_funds = $this->northbridge_model->getThisAccountsCarAwardFunds($id);			
								$index = $this->northbridge_model->getMlmIdsIndexNumber($id);
								

								$response_arr['messages'] .= '<tr>';

								$response_arr['messages'] .= '<td>'.$i.'</td>';
								$response_arr['messages'] .= '<td>'.$user_name. ' (' . $index . ')</td>';
								$response_arr['messages'] .= '<td class="date">'.$date_created.'</td>';
								$response_arr['messages'] .= '<td class="time">'.$time_created.'</td>';
								// $response_arr['messages'] .= '<td>₦'.number_format($car_award_funds,2).'</td>';
								// $response_arr['messages'] .= '<td>₦'.number_format($total_earnings,2).'</td>';


								$response_arr['messages'] .= '<td class="td-actions">';
			                   	$response_arr['messages'] .= '<button type="button" rel="tooltip" title="View Genealogy Tree" class="btn btn-success  btn-lg genealogy-btn" data-package="business" onclick="viewGenealogyTree(this,event,'.$id.')">';
			                   	$response_arr['messages'] .= '<img style="width: 25px; height: 25px;" src="'.base_url('assets/images/genealogy_tree.png').'"></img>';
			                    $response_arr['messages'] .= '<div class="ripple-container"></div>';
			                    $response_arr['messages'] .= '</button>';

			                    $response_arr['messages'] .= '<button type="button" rel="tooltip" title="View Sponsor Tree" class="btn btn-info btn-lg sponsor-btn" data-package="business" onclick="viewSponsorTree(this,event,'.$id.')">';
			                   	$response_arr['messages'] .= '<img style="width: 25px; height: 25px;" src="'.base_url('assets/images/sponsor.png').'"></img>';
			                    $response_arr['messages'] .= '<div class="ripple-container"></div>';
			                    $response_arr['messages'] .= '</button>';
			                    $response_arr['messages'] .= '</td>';

								$response_arr['messages'] .= '</tr>';

							}
						}
						$response_arr['messages'] .= '</tbody>';
						$response_arr['messages'] .= '</table>';
						$response_arr['messages'] .= '</div>';

						// $response_arr['messages'] .= '<div class="container">';

						// $total_business_income = $this->northbridge_model->getUserParamById("total_business_income",$user_id);
						// $total_business_withdrawn = $this->northbridge_model->getUserParamById("total_business_withdrawn",$user_id);
						// $total_business_withdrawable_balance = $total_business_income - $total_business_withdrawn;

						// $response_arr['messages'] .= '<h4>Total Business Income: <em>₦'.number_format($total_business_income,2).'</em></h4>';
						// $response_arr['messages'] .= '<h4>Total Business Withdrawn: <em>₦'.number_format($total_business_withdrawn,2).'</em></h4>';
						// $response_arr['messages'] .= '<h4>Total Business Withdrawable Balance: <em>₦'.number_format($total_business_withdrawable_balance,2).'</em></h4>';
						// $response_arr['messages'] .= '</div>';
						echo json_encode($response_arr);
					}
				}
			}

			else if($addition == "verify_take_another_slot_northbridge_account" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				// $second_addition = $this->northbridge_model->getUserNameBySlug($second_addition);
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data = array('success' => false);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['phone_code'] = $user->phone_code;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}
					if(isset($_POST['sponsor_id']) && isset($_POST['placement_id']) && isset($_POST['package']) && isset($_POST['positioning'])){ 
						$response_arr = array('success' => false,'not_enough_money' => true);
						$date = date("j M Y");
						$time = date("h:i:sa");
						$user_total_amount = $this->northbridge_model->getUserTotalAmountByUse($user_id);
						if($user_total_amount >= 3500){
							$response_arr['not_enough_money'] = false;
							if($this->northbridge_model->debitUser($user_id,3500)){
					        	$sponsor_id = $_POST['sponsor_id'];
					        	$placement_id = $_POST['placement_id'];
					        	$package = 1;
					        	$positioning = $_POST['positioning'];
					        	$package_str = "Basic";
					        	
				          		if($positioning == "left" || $positioning == "right"){
				          			if($this->northbridge_model->checkIfMlmDbIdIsValid($sponsor_id) && $this->northbridge_model->checkIfMlmDbIdIsValid($placement_id)){
							          	

										if($positioning == "left"){
											$next_available_position = "right";
										}else{
											$next_available_position = "left";
										}

										

										if($this->northbridge_model->checkIfThisPlacementPositionIsAvailable($placement_id,$positioning)){
							          	
							          		if($this->northbridge_model->registerUserInMlm2($user_id,$sponsor_id,$placement_id,$positioning,$date,$time,$package,0)){
							          			// echo "string";
								          		
												$response_arr['success'] = true;
												$this->session->set_flashdata("new_account_created_successful",true);
												$this->session->set_flashdata("package_str",$package_str);
												// $response_arr['url'] = site_url("northbridge/affiliate-plans-benefits");
												
											}
										}else if($this->northbridge_model->checkIfThisPlacementPositionIsAvailable($placement_id,$next_available_position)){
											if($this->northbridge_model->registerUserInMlm2($user_id,$sponsor_id,$placement_id,$next_available_position,$date,$time,$package,0)){
							          			// echo "string";
								          		
												$response_arr['success'] = true;
												$this->session->set_flashdata("new_account_created_successful",true);
												$this->session->set_flashdata("package_str",$package_str);
												// $response_arr['url'] = site_url("northbridge/affiliate-plans-benefits");
												
											}
										}else{
											if($this->northbridge_model->registerUserInMlm3($user_id,$sponsor_id,$date,$time,$package,0)){
												$response_arr['success'] = true;
												$your_mlm_db_id = $this->northbridge_model->getMlmDbIdByDateAndTime($user_id,$date,$time);
												$placement_id = $this->northbridge_model->getMlmDbParamById("under",$your_mlm_db_id);
												$placement_user_id = $this->northbridge_model->getMlmDbParamById("user_id",$placement_id);
												$placement_user_name = $this->northbridge_model->getUserNameById($placement_user_id);
												$placement_acc = $placement_user_name . " (" . $this->northbridge_model->getMlmIdsIndexNumber($placement_id) . ")";
												$this->session->set_flashdata("new_account_created_successful",true);
												$this->session->set_flashdata("package_str",$package_str);
												$this->session->set_flashdata("placement_acc",$placement_acc);
												// $response_arr['url'] = site_url("northbridge/affiliate-plans-benefits");
											}
										}
										
									}
								}
							}
						}	
						
				        echo json_encode($response_arr);
				    }
					
				}	
			} 

			else if($addition == "mark_combo_record_as_recharged" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['phone_code'] = $user->phone_code;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}

					$date = date("j M Y");
					$time = date("h:i:sa");

					if($this->input->post('id')){
						$id = $this->input->post('id');
						$response_arr = array('success' => false);

						$form_array = array(
							'credited' => 1,
							'credited_date' => $date,
							'credited_time' => $time
						);
						

						if($this->northbridge_model->markComboRecordAsRecharged($form_array,$id,$date,$time)){
							$response_arr['success'] = true;
						}
						echo json_encode($response_arr);
					}
				}
			}


			else if($addition == "upgrade_mlm_account_to_business" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data = array('success' => false);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['phone_code'] = $user->phone_code;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}

					if($this->input->post('mlm_db_id')){
						$mlm_db_id = $this->input->post('mlm_db_id');
						$response_arr = array('success' => false,'url' => '');
						if($this->northbridge_model->checkIfMlmDbIdBelongsToUser($mlm_db_id,$user_id) && ($this->northbridge_model->getMlmDbParamById("package",$mlm_db_id) == 1)){
							$reference_code = substr(bin2hex($this->encryption->create_key(8)),4);
							$total_amount = 6500;
							$total_amount = $total_amount * 100;
							$email = $this->northbridge_model->getUserEmailByUserId($user_id);
							$token = $this->northbridge_model->getUserTokenByUserId($user_id);
							
							$name = $this->northbridge_model->getUserFullNameByUserId($user_id);
							
							$redirect_url = site_url('northbridge/process_mlm_business_upgrade_payment/?mlm_db_id='.$mlm_db_id);
							
							
		            		$auth_url = $this->paystack->init($reference_code, $total_amount,$email,[
					            'name' => $name
					        ],$redirect_url);
					        if (filter_var($auth_url, FILTER_VALIDATE_URL)){
					        	$response_arr['success'] = true;
					        	$response_arr['url'] = $auth_url;
						    }
						}
						echo json_encode($response_arr);
					}
				}
			}

			else if($addition == "process_mlm_business_upgrade_payment" && is_null($second_addition) && isset($_GET['mlm_db_id'])){
				$mlm_db_id = $_GET['mlm_db_id'];
				if($this->northbridge_model->getMlmDbParamById("package",$mlm_db_id) == 1){
					$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
					$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
					$data = array('success' => false);
					$data['user_id'] = $user_id;
					$data['addition'] = $addition;
					$data['second_addition'] = strtolower(url_title($second_addition));
					if(is_array($user_info)){
						foreach($user_info as $user){
							$data['user_name'] = $user->user_name;
							$data['email'] = $user->email;
							$data['phone'] = $user->phone;
							$data['phone_code'] = $user->phone_code;
							$data['country_id'] = $user->country_id;
							$data['state_id'] = $user->state_id;
							$data['address'] = $user->address;
							$data['user_slug'] = $user->slug;
							$data['date'] = $user->date;
							$data['time'] = $user->time;
							$data['logo'] = $user->logo;
							$data['cover_photo'] =  $user->cover_photo;
						}
						if(isset($_GET['reference'])){ 
					        
					        $ver_info = $this->paystack->verifyTransaction($_GET['reference']);
					        
					        if(is_object($ver_info)){
					          if($ver_info->message == "Verification successful" && $ver_info->data->status == "success"){
					            $data['success'] = true;					            
					            
					          }else{
					            $data['unverified'] = true;
					          }
					        }else{
					          $data['unverified'] = true;
					        }
					    }
						$this->load->view("pages/process_mlm_business_upgrade_payment",$data);
					}
				}	
			} 

			else if($addition == "verify_mlm_business_upgrade_payment" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data = array('success' => false);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['phone_code'] = $user->phone_code;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}
					if(isset($_GET['reference']) && isset($_GET['mlm_db_id'])){ 
						$response_arr = array('success' => false);
						$mlm_db_id = $_GET['mlm_db_id'];
						if($this->northbridge_model->getMlmDbParamById("package",$mlm_db_id) == 1){
					        $ver_info = $this->paystack->verifyTransaction($_GET['reference']);
					        if(is_object($ver_info)){
					          if($ver_info->message == "Verification successful" && $ver_info->data->status == "success"){
					          	$reference = $ver_info->data->reference;
					          	$date = date("j M Y");
								$time = date("h:i:sa");

					          	if(!$this->northbridge_model->confirmThisPaymentReferenceHasNotBeenUsedBefore($reference)){
						          	if($this->northbridge_model->upgradeMlmAccountToBusiness($mlm_db_id,$user_id,$date,$time,$reference)){
						          		
										$response_arr['success'] = true;
										$this->session->set_flashdata("mlm_business_upgrade_successful",true);
										$response_arr['url'] = site_url("northbridge/affiliate-plans-benefits");
										
									}
								}	
					            
					          }
					        }
					    }
				        echo json_encode($response_arr);
				    }
					
				}	
			} 

			else if($addition == "upgrade_mlm_account_to_business_through_northbridge_account" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data = array('success' => false);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['phone_code'] = $user->phone_code;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}

					$date = date("j M Y");
					$time = date("h:i:sa");

					if($this->input->post('mlm_db_id')){
						$mlm_db_id = $this->input->post('mlm_db_id');
						$response_arr = array('success' => false,'date' => '','time' => '','insuffecient_funds' => '');
						if($this->northbridge_model->checkIfMlmDbIdBelongsToUser($mlm_db_id,$user_id) && ($this->northbridge_model->getMlmDbParamById("package",$mlm_db_id) == 1)){
							$amount = 6500;
							
							$amount_to_debit_user = $amount;
							$user_total_amount = $this->northbridge_model->getUserTotalAmountByUse($user_id);
							// echo $user_total_amount;
							// echo $amount;

							if($amount_to_debit_user <= $user_total_amount){
								if($this->northbridge_model->debitUser($user_id,$amount_to_debit_user)){

									if($this->northbridge_model->upgradeMlmAccountToBusiness($mlm_db_id,$user_id,$date,$time)){
										$response_arr['success'] = true;
										$response_arr['date'] = $date;
										$response_arr['time'] = $time;
									}
								}
							}else{
								$response_arr['insuffecient_funds'] = true;
							}	
						}
						echo json_encode($response_arr);
					}
				}
			}


			else if($addition == "get_user_name_mlm_accounts_for_this_user_sponsor" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data = array('success' => false);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['phone_code'] = $user->phone_code;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}

					if($this->input->post('show_records') && $this->input->post('val')){
						$val = $this->input->post('val');
						$response_arr = array('success' => false,'messages' => '','invalid_username' => true);

						if($this->northbridge_model->checkIfUserNameExists($val)){
							$response_arr['invalid_username'] = false;
							$sponsors_id = $this->northbridge_model->getUserIdByName($val);
							$sponsors_logo = $this->northbridge_model->getUserParamById("logo",$sponsors_id);
							$sponsors_slug = $this->northbridge_model->getUserParamById("slug",$sponsors_id);
							$sponsors_full_name = $this->northbridge_model->getUserParamById("full_name",$sponsors_id);
							$sponsors_phone_number = "+" . $this->northbridge_model->getUserParamById("phone_code",$sponsors_id) . " " . $this->northbridge_model->getUserParamById("phone",$sponsors_id);
							if(is_null($sponsors_logo)){
								$sponsors_logo = "avatar21.jpg";
							}
							$all_mlm_ids = $this->northbridge_model->getAllUsersMlmDbIds($sponsors_id);
							if(is_array($all_mlm_ids)){
								$response_arr['success'] = true;
								$response_arr['messages'] .= "<div class='container'>";
								$response_arr['messages'] .= "<div class='card'>";
								$response_arr['messages'] .= "<div class='card-header'>";
								$response_arr['messages'] .= "<h4 class='card-title text-center'>User Info</h4>";
								$response_arr['messages'] .= "</div>";
								$response_arr['messages'] .= "<div class='card-body'>";
								$response_arr['messages'] .= "<div class='row'>";

								$response_arr['messages'] .= "<div class='col-4'>";
								$response_arr['messages'] .= "<img src='".base_url('assets/images/'.$sponsors_logo)."' style='width: 70px; height: 70px; border-radius:50%;'>";
								$response_arr['messages'] .= "</div>";

								$response_arr['messages'] .= "<div class='col-8'>";
								$response_arr['messages'] .= "<p>User Name: <a target='_blank' href='".site_url('northbridge/'.$sponsors_slug)."'>".$val."</a></p>";
								$response_arr['messages'] .= "<p>Full Name: <em class='text-primary'>".$sponsors_full_name."</em></p>";

								$response_arr['messages'] .= "<p>Phone Number: <em class='text-primary'>".$sponsors_phone_number."</em></p>";


								$response_arr['messages'] .= "</div>";

								$response_arr['messages'] .= "</div>";
								$response_arr['messages'] .= "</div>";
								$response_arr['messages'] .= "</div>";

								$response_arr['messages'] .= "<h4 class='text-primary'>Click To Select ".$val."'s Mlm Account To Use As Sponsor.</h4>";
								$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="">';
			            		$response_arr['messages'] .= '<table class="table table-striped table-bordered nowrap hover display" id="select-sponsor-table" cellspacing="0" width="100%" style="width:100%">';
			            		$response_arr['messages'] .= '<thead>';
			            		$response_arr['messages'] .= '<tr>';
			            		$response_arr['messages'] .= '<th>#</th>';
			            		$response_arr['messages'] .= '<th>Mlm Account</th>';
			            		
			            		
			            		$response_arr['messages'] .= '</tr>';
			            		$response_arr['messages'] .= '<tbody>';


								for($i = 0; $i < count($all_mlm_ids); $i++){
									$j = $i + 1;
									$mlm_db_id = $all_mlm_ids[$i];
									$mlm_db_id = (Integer) $mlm_db_id;
									// var_dump($mlm_db_id);
									$response_arr['messages'] .= '<tr data-str="'.$val. ' ('.$j.')' .'"  data-mlm-db-id="'.$mlm_db_id.'" onclick="selectThisUserAsSponsor(this,event)">';
									$response_arr['messages'] .= '<td>'.$j.'</td>';
									$response_arr['messages'] .= '<td>'.$val. ' ('.$j.')' .'</td>';
									$response_arr['messages'] .= '</tr>';
								}
								$response_arr['messages'] .= '</tbody>';
								$response_arr['messages'] .= '</table>';
								$response_arr['messages'] .= "</div>";
								$response_arr['messages'] .= "</div>";
							}
						}

						echo json_encode($response_arr);
					}
				}
			}

			else if($addition == "get_user_name_mlm_accounts_for_this_user_placement" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data = array('success' => false);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['phone_code'] = $user->phone_code;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}

					if($this->input->post('show_records') && $this->input->post('val')){
						$val = $this->input->post('val');
						$response_arr = array('success' => false,'messages' => '','invalid_username' => true);

						if($this->northbridge_model->checkIfUserNameExists($val)){
							$response_arr['invalid_username'] = false;
							$sponsors_id = $this->northbridge_model->getUserIdByName($val);
							$sponsors_logo = $this->northbridge_model->getUserParamById("logo",$sponsors_id);
							$sponsors_slug = $this->northbridge_model->getUserParamById("slug",$sponsors_id);
							$sponsors_full_name = $this->northbridge_model->getUserParamById("full_name",$sponsors_id);
							$sponsors_phone_number = "+" . $this->northbridge_model->getUserParamById("phone_code",$sponsors_id) . " " . $this->northbridge_model->getUserParamById("phone",$sponsors_id);
							if(is_null($sponsors_logo)){
								$sponsors_logo = "avatar21.jpg";
							}
							$all_mlm_ids = $this->northbridge_model->getAllUsersMlmDbIds($sponsors_id);
							if(is_array($all_mlm_ids)){
								$response_arr['success'] = true;
								$response_arr['messages'] .= "<div class='container'>";
								$response_arr['messages'] .= "<div class='card'>";
								$response_arr['messages'] .= "<div class='card-header'>";
								$response_arr['messages'] .= "<h4 class='card-title text-center'>User Info</h4>";
								$response_arr['messages'] .= "</div>";
								$response_arr['messages'] .= "<div class='card-body'>";
								$response_arr['messages'] .= "<div class='row'>";

								$response_arr['messages'] .= "<div class='col-4'>";
								$response_arr['messages'] .= "<img src='".base_url('assets/images/'.$sponsors_logo)."' style='width: 70px; height: 70px; border-radius:50%;'>";
								$response_arr['messages'] .= "</div>";

								$response_arr['messages'] .= "<div class='col-8'>";
								$response_arr['messages'] .= "<p>User Name: <a target='_blank' href='".site_url('northbridge/'.$sponsors_slug)."'>".$val."</a></p>";
								$response_arr['messages'] .= "<p>Full Name: <em class='text-primary'>".$sponsors_full_name."</em></p>";

								$response_arr['messages'] .= "<p>Phone Number: <em class='text-primary'>".$sponsors_phone_number."</em></p>";


								$response_arr['messages'] .= "</div>";

								$response_arr['messages'] .= "</div>";
								$response_arr['messages'] .= "</div>";
								$response_arr['messages'] .= "</div>";

								$response_arr['messages'] .= "<div class='select-placement-table-div'>";
								$response_arr['messages'] .= "<h4 class='text-primary'>Click To Select ".$val."'s Mlm Account To Use As Placement.</h4>";
								$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="">';
			            		$response_arr['messages'] .= '<table class="table table-striped table-bordered nowrap hover display" id="select-placement-table" cellspacing="0" width="100%" style="width:100%">';
			            		$response_arr['messages'] .= '<thead>';
			            		$response_arr['messages'] .= '<tr>';
			            		$response_arr['messages'] .= '<th>#</th>';
			            		$response_arr['messages'] .= '<th>Mlm Account</th>';
			            		
			            		
			            		$response_arr['messages'] .= '</tr>';
			            		$response_arr['messages'] .= '<tbody>';


								for($i = 0; $i < count($all_mlm_ids); $i++){
									$j = $i + 1;
									$mlm_db_id = $all_mlm_ids[$i];
									$mlm_db_id = (Integer) $mlm_db_id;
									// var_dump($mlm_db_id);
									$response_arr['messages'] .= '<tr data-str="'.$val. ' ('.$j.')' .'"  data-mlm-db-id="'.$mlm_db_id.'" onclick="selectThisUserAsPlacement(this,event)">';
									$response_arr['messages'] .= '<td>'.$j.'</td>';
									$response_arr['messages'] .= '<td>'.$val. ' ('.$j.')' .'</td>';
									$response_arr['messages'] .= '</tr>';
								}
								$response_arr['messages'] .= '</tbody>';
								$response_arr['messages'] .= '</table>';
								$response_arr['messages'] .= "</div>";
								$response_arr['messages'] .= "</div>";

								$response_arr['messages'] .= "<div class='select-placement-position-table-div' style='display: none;'>";

								$response_arr['messages'] .= "</div>";
								$response_arr['messages'] .= "</div>";
							}
						}

						echo json_encode($response_arr);
					}
				}
			}

			else if($addition == "get_user_name_mlm_accounts_for_this_user_placement_new_user"  && $this->northbridge_model->getUserNameBySlug($second_addition)){
				$second_addition = $this->northbridge_model->getUserNameBySlug($second_addition);
				$user_id = $this->northbridge_model->getUserIdByName($second_addition);
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data = array('success' => false);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['phone_code'] = $user->phone_code;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}

					if($this->input->post('show_records') && $this->input->post('val')){
						$val = $this->input->post('val');
						$response_arr = array('success' => false,'messages' => '','invalid_username' => true);

						if($this->northbridge_model->checkIfUserNameExists($val)){
							$response_arr['invalid_username'] = false;
							$sponsors_id = $this->northbridge_model->getUserIdByName($val);
							$sponsors_logo = $this->northbridge_model->getUserParamById("logo",$sponsors_id);
							$sponsors_slug = $this->northbridge_model->getUserParamById("slug",$sponsors_id);
							$sponsors_full_name = $this->northbridge_model->getUserParamById("full_name",$sponsors_id);
							$sponsors_phone_number = "+" . $this->northbridge_model->getUserParamById("phone_code",$sponsors_id) . " " . $this->northbridge_model->getUserParamById("phone",$sponsors_id);
							if(is_null($sponsors_logo)){
								$sponsors_logo = "avatar21.jpg";
							}
							$all_mlm_ids = $this->northbridge_model->getAllUsersMlmDbIds($sponsors_id);
							if(is_array($all_mlm_ids)){
								$response_arr['success'] = true;
								$response_arr['messages'] .= "<div class='container'>";
								$response_arr['messages'] .= "<div class='card'>";
								$response_arr['messages'] .= "<div class='card-header'>";
								$response_arr['messages'] .= "<h4 class='card-title text-center'>User Info</h4>";
								$response_arr['messages'] .= "</div>";
								$response_arr['messages'] .= "<div class='card-body'>";
								$response_arr['messages'] .= "<div class='row'>";

								$response_arr['messages'] .= "<div class='col-4'>";
								$response_arr['messages'] .= "<img src='".base_url('assets/images/'.$sponsors_logo)."' style='width: 70px; height: 70px; border-radius:50%;'>";
								$response_arr['messages'] .= "</div>";

								$response_arr['messages'] .= "<div class='col-8'>";
								$response_arr['messages'] .= "<p>User Name: <a target='_blank' href='".site_url('northbridge/'.$sponsors_slug)."'>".$val."</a></p>";
								$response_arr['messages'] .= "<p>Full Name: <em class='text-primary'>".$sponsors_full_name."</em></p>";

								$response_arr['messages'] .= "<p>Phone Number: <em class='text-primary'>".$sponsors_phone_number."</em></p>";


								$response_arr['messages'] .= "</div>";

								$response_arr['messages'] .= "</div>";
								$response_arr['messages'] .= "</div>";
								$response_arr['messages'] .= "</div>";

								$response_arr['messages'] .= "<div class='select-placement-table-div'>";
								$response_arr['messages'] .= "<p>Click To Select ".$val."'s Mlm Account To Use As Placement.</p>";
								$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="">';
			            		$response_arr['messages'] .= '<table class="table table-striped table-bordered nowrap hover display" id="select-placement-table" cellspacing="0" width="100%" style="width:100%">';
			            		$response_arr['messages'] .= '<thead>';
			            		$response_arr['messages'] .= '<tr>';
			            		$response_arr['messages'] .= '<th>#</th>';
			            		$response_arr['messages'] .= '<th>Mlm Account</th>';
			            		
			            		
			            		$response_arr['messages'] .= '</tr>';
			            		$response_arr['messages'] .= '<tbody>';


								for($i = 0; $i < count($all_mlm_ids); $i++){
									$j = $i + 1;
									$mlm_db_id = $all_mlm_ids[$i];
									$mlm_db_id = (Integer) $mlm_db_id;
									// var_dump($mlm_db_id);
									$response_arr['messages'] .= '<tr data-str="'.$val. ' ('.$j.')' .'"  data-mlm-db-id="'.$mlm_db_id.'" onclick="selectThisUserAsPlacement(this,event)">';
									$response_arr['messages'] .= '<td>'.$j.'</td>';
									$response_arr['messages'] .= '<td>'.$val. ' ('.$j.')' .'</td>';
									$response_arr['messages'] .= '</tr>';
								}
								$response_arr['messages'] .= '</tbody>';
								$response_arr['messages'] .= '</table>';
								$response_arr['messages'] .= "</div>";
								$response_arr['messages'] .= "</div>";

								$response_arr['messages'] .= "<div class='select-placement-position-table-div' style='display: none;'>";

								$response_arr['messages'] .= "</div>";
								$response_arr['messages'] .= "</div>";
							}
						}

						echo json_encode($response_arr);
					}
				}
			}

			else if($addition == "select_positioning_for_mlm"  && $this->northbridge_model->getUserNameBySlug($second_addition)){
				$second_addition = $this->northbridge_model->getUserNameBySlug($second_addition);
				$user_id = $this->northbridge_model->getUserIdByName($second_addition);
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data = array('success' => false);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['phone_code'] = $user->phone_code;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}

					if($this->input->post('show_records') && $this->input->post('id')){
						$mlm_db_id = $this->input->post('id');
						if($this->northbridge_model->checkIfMlmDbIdIsValid($mlm_db_id)){

							$response_arr = array('success' => false,'messages' => '','no_available_position' => false);
							if($this->northbridge_model->checkIfMlmDbIdHasNoAvailablePositionUnderHim($mlm_db_id)){
								$response_arr['no_available_position'] = true;
							}else{
								$available = $this->northbridge_model->getAvailablePositionUnderMlmDbId($mlm_db_id);
								if($available == "left"){
									$response_arr['success'] = true;
									// $response_arr['messages'] .= '<button class="btn btn-warning btn-round reselect-placement" onclick="reselectPlacement(this,event)">Reselect Placement</button>';

									$response_arr['messages'] .= "<h4 class='text-primary'>Click To Select Position.</h4>";
									$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="">';
				            		$response_arr['messages'] .= '<table class="table table-striped table-bordered nowrap hover display" id="select-placement-position-table" cellspacing="0" width="100%" style="width:100%">';
				            		$response_arr['messages'] .= '<thead>';
				            		$response_arr['messages'] .= '<tr>';
				            		$response_arr['messages'] .= '<th>#</th>';
				            		$response_arr['messages'] .= '<th>Available Positions</th>';
				            		
				            		$response_arr['messages'] .= '</tr>';
				            		$response_arr['messages'] .= '<tbody>';
				            		$response_arr['messages'] .= '<tr onclick="selectThisPositionPlacement(this,event)" data-mlm-db-id="'.$mlm_db_id.'" data-position="left">';
				            		$response_arr['messages'] .= '<td>1</td>';
				            		$response_arr['messages'] .= '<td>Left</td>';
				            		$response_arr['messages'] .= '</tr>';
				            		$response_arr['messages'] .= '</tbody>';
				            		$response_arr['messages'] .= '</table>';
				            		$response_arr['messages'] .= '</div>';

								}else if($available == "right"){
									$response_arr['success'] = true;
									// $response_arr['messages'] .= '<button class="btn btn-warning btn-round reselect-placement" onclick="reselectPlacement(this,event)" >Reselect Placement</button>';

									$response_arr['messages'] .= "<h4 class='text-primary'>Click To Select Position.</h4>";
									$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="">';
				            		$response_arr['messages'] .= '<table class="table table-striped table-bordered nowrap hover display" id="select-placement-position-table" cellspacing="0" width="100%" style="width:100%">';
				            		$response_arr['messages'] .= '<thead>';
				            		$response_arr['messages'] .= '<tr>';
				            		$response_arr['messages'] .= '<th>#</th>';
				            		$response_arr['messages'] .= '<th>Available Positions</th>';
				            		
				            		$response_arr['messages'] .= '</tr>';
				            		$response_arr['messages'] .= '<tbody>';
				            		$response_arr['messages'] .= '<tr onclick="selectThisPositionPlacement(this,event)" data-mlm-db-id="'.$mlm_db_id.'" data-position="right">';
				            		$response_arr['messages'] .= '<td>1</td>';
				            		$response_arr['messages'] .= '<td>Right</td>';
				            		$response_arr['messages'] .= '</tr>';
				            		$response_arr['messages'] .= '</tbody>';
				            		$response_arr['messages'] .= '</table>';
				            		$response_arr['messages'] .= '</div>';


								}else if($available == "both"){
									$response_arr['success'] = true;
									// $response_arr['messages'] .= '<button class="btn btn-warning btn-round reselect-placement" onclick="reselectPlacement(this,event)" >Reselect Placement</button>';

									$response_arr['messages'] .= "<h4 class='text-primary'>Click To Select Position.</h4>";
									$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="">';
				            		$response_arr['messages'] .= '<table class="table table-striped table-bordered nowrap hover display" id="select-placement-position-table" cellspacing="0" width="100%" style="width:100%">';
				            		$response_arr['messages'] .= '<thead>';
				            		$response_arr['messages'] .= '<tr>';
				            		$response_arr['messages'] .= '<th>#</th>';
				            		$response_arr['messages'] .= '<th>Available Positions</th>';
				            		
				            		$response_arr['messages'] .= '</tr>';
				            		$response_arr['messages'] .= '<tbody>';
				            		$response_arr['messages'] .= '<tr onclick="selectThisPositionPlacement(this,event)" data-mlm-db-id="'.$mlm_db_id.'" data-position="left">';
				            		$response_arr['messages'] .= '<td>1</td>';
				            		$response_arr['messages'] .= '<td>Left</td>';
				            		$response_arr['messages'] .= '</tr>';

				            		$response_arr['messages'] .= '<tr onclick="selectThisPositionPlacement(this,event)" data-mlm-db-id="'.$mlm_db_id.'" data-position="right">';
				            		$response_arr['messages'] .= '<td>2</td>';
				            		$response_arr['messages'] .= '<td>Right</td>';
				            		$response_arr['messages'] .= '</tr>';
				            		$response_arr['messages'] .= '</tbody>';
				            		$response_arr['messages'] .= '</table>';
				            		$response_arr['messages'] .= '</div>';


								}else{

								}
							}
							echo json_encode($response_arr);
						}
					}	
				}
			}


			else if($addition == "online_payment_take_another_slot_choosing" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data = array('success' => false);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['phone_code'] = $user->phone_code;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}

					

					if($this->input->post('sponsor_id') && $this->input->post('placement_id') && $this->input->post('positioning')){ 
						$response_arr = array('success' => false,'limit_reached' => true);

						$no_of_accounts = $this->northbridge_model->getNoOfAccountsOwnedByUser($user_id);

						if($no_of_accounts < 1){
							$response_arr['limit_reached'] = false;
				        
				        	$sponsor_id = $this->input->post('sponsor_id');
				        	$placement_id = $this->input->post('placement_id');
				        	$package = 1;
				        	$positioning = $this->input->post('positioning');
				        	$date = date("j M Y");
							$time = date("h:i:sa");
				          	
		          			$package = 1;
		          			$package_str = "Basic";
					          		
					          		
			          		if($positioning == "left" || $positioning == "right"){
			          			if($this->northbridge_model->checkIfMlmDbIdIsValid($sponsor_id) && $this->northbridge_model->checkIfMlmDbIdIsValid($placement_id)){
						          	

									if($positioning == "left"){
										$next_available_position = "right";
									}else{
										$next_available_position = "left";
									}

									
									if($this->northbridge_model->checkIfThisPlacementPositionIsAvailable($placement_id,$positioning)){
						          	
						          		if($this->northbridge_model->registerUserInMlm2($user_id,$sponsor_id,$placement_id,$positioning,$date,$time,$package,0)){
						          			// echo "string";
							          		
											$response_arr['success'] = true;
											$this->session->set_flashdata("new_account_created_successful",true);
											$this->session->set_flashdata("package_str",$package_str);
											$response_arr['url'] = site_url("northbridge/affiliate-plans-benefits");
											
										}
									}else if($this->northbridge_model->checkIfThisPlacementPositionIsAvailable($placement_id,$next_available_position)){
										if($this->northbridge_model->registerUserInMlm2($user_id,$sponsor_id,$placement_id,$next_available_position,$date,$time,$package,0)){
						          			// echo "string";
							          		
											$response_arr['success'] = true;
											$this->session->set_flashdata("new_account_created_successful",true);
											$this->session->set_flashdata("package_str",$package_str);
											$response_arr['url'] = site_url("northbridge/affiliate-plans-benefits");
											
										}
									}else{
										if($this->northbridge_model->registerUserInMlm3($user_id,$sponsor_id,$date,$time,$package,0)){
											$response_arr['success'] = true;
											$your_mlm_db_id = $this->northbridge_model->getMlmDbIdByDateAndTime($user_id,$date,$time);
											$placement_id = $this->northbridge_model->getMlmDbParamById("under",$your_mlm_db_id);
											$placement_user_id = $this->northbridge_model->getMlmDbParamById("user_id",$placement_id);
											$placement_user_name = $this->northbridge_model->getUserNameById($placement_user_id);
											$placement_acc = $placement_user_name . " (" . $this->northbridge_model->getMlmIdsIndexNumber($placement_id) . ")";
											$this->session->set_flashdata("new_account_created_successful",true);
											$this->session->set_flashdata("package_str",$package_str);
											$this->session->set_flashdata("placement_acc",$placement_acc);
											$response_arr['url'] = site_url("northbridge/affiliate-plans-benefits");
										}
									}
									
								}
							}
									
				        }
				        echo json_encode($response_arr);
				    }
				}
			}

			else if($addition == "process_take_another_slot_online_payment" && is_null($second_addition)){
				// $second_addition = $this->northbridge_model->getUserNameByToken($second_addition);
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data = array('success' => false);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = strtolower(url_title($second_addition));
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['phone_code'] = $user->phone_code;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}
					if(isset($_GET['reference']) && isset($_GET['sponsor_id']) && isset($_GET['placement_id']) && isset($_GET['package']) && isset($_GET['positioning']) && isset($_GET['date']) && isset($_GET['time'])){ 
				        
				        $ver_info = $this->paystack->verifyTransaction($_GET['reference']);
				        
				        if(is_object($ver_info)){
				          if($ver_info->message == "Verification successful" && $ver_info->data->status == "success"){
				            $data['success'] = true;					            
				            
				          }else{
				            $data['unverified'] = true;
				          }
				        }else{
				          $data['unverified'] = true;
				        }
				        $this->load->view("pages/process_take_another_slot_online_payment",$data);
				    }
					
				}	
			} 

			else if($addition == "verify_take_another_slot_online_payment" && is_null($second_addition)){
				// $second_addition = $this->northbridge_model->getUserNameBySlug($second_addition);
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data = array('success' => false);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['phone_code'] = $user->phone_code;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}
					if(isset($_GET['reference']) && isset($_GET['sponsor_id']) && isset($_GET['placement_id']) && isset($_GET['package']) && isset($_GET['positioning']) && isset($_GET['date']) && isset($_GET['time'])){ 
						$response_arr = array('success' => false);
				        $ver_info = $this->paystack->verifyTransaction($_GET['reference']);
				        if(is_object($ver_info)){
				        	$sponsor_id = $_GET['sponsor_id'];
				        	$placement_id = $_GET['placement_id'];
				        	$package = 1;
				        	$positioning = $_GET['positioning'];
				        	$date = $_GET['date'];
				        	$time = $_GET['time'];
				          	if($ver_info->message == "Verification successful" && $ver_info->data->status == "success"){
					          	$amount_paid = $ver_info->data->amount;
					          	$reference = $ver_info->data->reference;
					          	if($amount_paid == 350000 || 650000){
					          		if($amount_paid == 350000){
					          			$package = 1;
					          			$package_str = "Basic";
					          		}else{
					          			$package = 2;
					          			$package_str = "Business";
					          		}
					          		if(!$this->northbridge_model->confirmThisPaymentReferenceHasNotBeenUsedBefore($reference)){
						          		if($positioning == "left" || $positioning == "right"){
						          			if($this->northbridge_model->checkIfMlmDbIdIsValid($sponsor_id) && $this->northbridge_model->checkIfMlmDbIdIsValid($placement_id)){
									          	

												if($positioning == "left"){
													$next_available_position = "right";
												}else{
													$next_available_position = "left";
												}

												if($this->northbridge_model->makeSureNoAccountOfThisUserIsWithThisDateAndTime($user_id,$date,$time)){

													if($this->northbridge_model->checkIfThisPlacementPositionIsAvailable($placement_id,$positioning)){
										          	
										          		if($this->northbridge_model->registerUserInMlm2($user_id,$sponsor_id,$placement_id,$positioning,$date,$time,$package,0,$reference)){
										          			// echo "string";
											          		
															$response_arr['success'] = true;
															$this->session->set_flashdata("new_account_created_successful",true);
															$this->session->set_flashdata("package_str",$package_str);
															$response_arr['url'] = site_url("northbridge/affiliate-plans-benefits");
															
														}
													}else if($this->northbridge_model->checkIfThisPlacementPositionIsAvailable($placement_id,$next_available_position)){
														if($this->northbridge_model->registerUserInMlm2($user_id,$sponsor_id,$placement_id,$next_available_position,$date,$time,$package,0,$reference)){
										          			// echo "string";
											          		
															$response_arr['success'] = true;
															$this->session->set_flashdata("new_account_created_successful",true);
															$this->session->set_flashdata("package_str",$package_str);
															$response_arr['url'] = site_url("northbridge/affiliate-plans-benefits");
															
														}
													}else{
														if($this->northbridge_model->registerUserInMlm3($user_id,$sponsor_id,$date,$time,$package,0,$reference)){
															$response_arr['success'] = true;
															$your_mlm_db_id = $this->northbridge_model->getMlmDbIdByDateAndTime($user_id,$date,$time);
															$placement_id = $this->northbridge_model->getMlmDbParamById("under",$your_mlm_db_id);
															$placement_user_id = $this->northbridge_model->getMlmDbParamById("user_id",$placement_id);
															$placement_user_name = $this->northbridge_model->getUserNameById($placement_user_id);
															$placement_acc = $placement_user_name . " (" . $this->northbridge_model->getMlmIdsIndexNumber($placement_id) . ")";
															$this->session->set_flashdata("new_account_created_successful",true);
															$this->session->set_flashdata("package_str",$package_str);
															$this->session->set_flashdata("placement_acc",$placement_acc);
															$response_arr['url'] = site_url("northbridge/affiliate-plans-benefits");
														}
													}
												}
											}
										}
									}
								}
							}
				        }
				        echo json_encode($response_arr);
				    }
					
				}	
			} 		

			else if($addition == "select_positioning_for_mlm" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data = array('success' => false);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['phone_code'] = $user->phone_code;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}

					if($this->input->post('show_records') && $this->input->post('id')){
						$mlm_db_id = $this->input->post('id');
						if($this->northbridge_model->checkIfMlmDbIdIsValid($mlm_db_id)){

							$response_arr = array('success' => false,'messages' => '','no_available_position' => false);
							if($this->northbridge_model->checkIfMlmDbIdHasNoAvailablePositionUnderHim($mlm_db_id)){
								$response_arr['no_available_position'] = true;
							}else{
								$available = $this->northbridge_model->getAvailablePositionUnderMlmDbId($mlm_db_id);
								if($available == "left"){
									$response_arr['success'] = true;
									$response_arr['messages'] .= '<button class="btn btn-warning btn-round reselect-placement" onclick="reselectPlacement(this,event)">Reselect Placement</button>';

									$response_arr['messages'] .= "<h4 class='text-primary'>Click To Select Position.</h4>";
									$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="">';
				            		$response_arr['messages'] .= '<table class="table table-striped table-bordered nowrap hover display" id="select-placement-position-table" cellspacing="0" width="100%" style="width:100%">';
				            		$response_arr['messages'] .= '<thead>';
				            		$response_arr['messages'] .= '<tr>';
				            		$response_arr['messages'] .= '<th>#</th>';
				            		$response_arr['messages'] .= '<th>Available Positions</th>';
				            		
				            		$response_arr['messages'] .= '</tr>';
				            		$response_arr['messages'] .= '<tbody>';
				            		$response_arr['messages'] .= '<tr onclick="selectThisPositionPlacement(this,event)" data-mlm-db-id="'.$mlm_db_id.'" data-position="left">';
				            		$response_arr['messages'] .= '<td>1</td>';
				            		$response_arr['messages'] .= '<td>Left</td>';
				            		$response_arr['messages'] .= '</tr>';
				            		$response_arr['messages'] .= '</tbody>';
				            		$response_arr['messages'] .= '</table>';
				            		$response_arr['messages'] .= '</div>';

								}else if($available == "right"){
									$response_arr['success'] = true;
									$response_arr['messages'] .= '<button class="btn btn-warning btn-round reselect-placement" onclick="reselectPlacement(this,event)" >Reselect Placement</button>';

									$response_arr['messages'] .= "<h4 class='text-primary'>Click To Select Position.</h4>";
									$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="">';
				            		$response_arr['messages'] .= '<table class="table table-striped table-bordered nowrap hover display" id="select-placement-position-table" cellspacing="0" width="100%" style="width:100%">';
				            		$response_arr['messages'] .= '<thead>';
				            		$response_arr['messages'] .= '<tr>';
				            		$response_arr['messages'] .= '<th>#</th>';
				            		$response_arr['messages'] .= '<th>Available Positions</th>';
				            		
				            		$response_arr['messages'] .= '</tr>';
				            		$response_arr['messages'] .= '<tbody>';
				            		$response_arr['messages'] .= '<tr onclick="selectThisPositionPlacement(this,event)" data-mlm-db-id="'.$mlm_db_id.'" data-position="right">';
				            		$response_arr['messages'] .= '<td>1</td>';
				            		$response_arr['messages'] .= '<td>Right</td>';
				            		$response_arr['messages'] .= '</tr>';
				            		$response_arr['messages'] .= '</tbody>';
				            		$response_arr['messages'] .= '</table>';
				            		$response_arr['messages'] .= '</div>';


								}else if($available == "both"){
									$response_arr['success'] = true;
									$response_arr['messages'] .= '<button class="btn btn-warning btn-round reselect-placement" onclick="reselectPlacement(this,event)" >Reselect Placement</button>';

									$response_arr['messages'] .= "<h4 class='text-primary'>Click To Select Position.</h4>";
									$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="">';
				            		$response_arr['messages'] .= '<table class="table table-striped table-bordered nowrap hover display" id="select-placement-position-table" cellspacing="0" width="100%" style="width:100%">';
				            		$response_arr['messages'] .= '<thead>';
				            		$response_arr['messages'] .= '<tr>';
				            		$response_arr['messages'] .= '<th>#</th>';
				            		$response_arr['messages'] .= '<th>Available Positions</th>';
				            		
				            		$response_arr['messages'] .= '</tr>';
				            		$response_arr['messages'] .= '<tbody>';
				            		$response_arr['messages'] .= '<tr onclick="selectThisPositionPlacement(this,event)" data-mlm-db-id="'.$mlm_db_id.'" data-position="left">';
				            		$response_arr['messages'] .= '<td>1</td>';
				            		$response_arr['messages'] .= '<td>Left</td>';
				            		$response_arr['messages'] .= '</tr>';

				            		$response_arr['messages'] .= '<tr onclick="selectThisPositionPlacement(this,event)" data-mlm-db-id="'.$mlm_db_id.'" data-position="right">';
				            		$response_arr['messages'] .= '<td>2</td>';
				            		$response_arr['messages'] .= '<td>Right</td>';
				            		$response_arr['messages'] .= '</tr>';
				            		$response_arr['messages'] .= '</tbody>';
				            		$response_arr['messages'] .= '</table>';
				            		$response_arr['messages'] .= '</div>';


								}else{

								}
							}
							echo json_encode($response_arr);
						}
					}	
				}
			}		



			else if($addition == "view_your_sponsor_tree" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data = array('success' => false);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['phone_code'] = $user->phone_code;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}

					if($this->input->post('show_records') && $this->input->post('mlm_db_id')){
						$mlm_db_id = $this->input->post('mlm_db_id');
						$response_arr = array('success' => false,'messages' => '');
						
						if($this->northbridge_model->checkIfMlmDbIdBelongsToUser($mlm_db_id,$user_id)){
							$response_arr['success'] = true;

							$response_arr['messages'] .= '<div class="tf-tree example">';

							$level = 20;
							$parentID = $mlm_db_id;
							$stage = 4;
							$user_id = $this->northbridge_model->getMlmDbParamById("user_id",$parentID);
							$logo = $this->northbridge_model->getUserParamById("logo",$user_id);
					        $user_name = $this->northbridge_model->getUserParamById("user_name",$user_id);
					        $full_name = $this->northbridge_model->getUserParamById("full_name",$user_id);
					        $package = $this->northbridge_model->getMlmDbParamById("package",$parentID);
					        if(is_null($logo)){
					        	$logo = "avatar21.jpg";
					        }

					        if($package == 1){
					        	$package = "basic";
					        }else{
					        	$package = "business";
					        }
					        if(is_null($logo)){
					        	$logo = "avatar21.jpg";
					        }
							$response_arr['messages'] .= '<ul>';
						    $response_arr['messages'] .= '<li>';
					    	$response_arr['messages'] .= '<div class="tf-nc ' . $package . '">';
					    	$response_arr['messages'] .= '<img class="" src="'.base_url('assets/images/'.$logo).'" style="width: 100%; border-radius: 50%; height: 40%;" alt="">';
							$response_arr['messages'] .= '<p >'.$full_name.'</p>';
							$response_arr['messages'] .= '<p class="user-name">'.$user_name.'</p>';
							$response_arr['messages'] .= '<p class="package">'.$package.'</p>';
					        // echo '<span class="tf-nc">'.$currentID.'</span>';
					        $response_arr['messages'] .= '</div>';
									            
				            
							$response_arr['messages'] .= $this->northbridge_model->printSponsorTree($level, $parentID,$stage);
							$response_arr['messages'] .= '</li>';
							$response_arr['messages'] .= '</ul>';

							$response_arr['messages'] .= '</div>';
						}
						echo json_encode($response_arr);
					}
				}
			}	
			
	

			else if($addition == "verify_content_leader_payment" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data = array('success' => false);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['phone_code'] = $user->phone_code;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}
					if(isset($_GET['reference'])){ 
						$response_arr = array('success' => false);
				        $ver_info = $this->paystack->verifyTransaction($_GET['reference']);
				        if(is_object($ver_info)){
				          if($ver_info->message == "Verification successful" && $ver_info->data->status == "success"){
				          	
				          	$date = date("j M Y");
							$time = date("h:i:sa");
							if($this->northbridge_model->getUserParamById("center_leader",$user_id) == 0){
					          	$form_array = array(
					          		'center_leader' => 1
					          	);
					          	if($this->northbridge_model->updateUserTable($form_array,$user_id)){

					          		$sponsor_income = $this->northbridge_model->getCenterLeaderSponsorIncome();
					      			$sponsor_income_vat = $this->northbridge_model->getCenterLeaderSponsorIncomeVat();
					      			$sponsor_income_vat_perc = $sponsor_income_vat / 100;
					      			$sponsor_income_vat_val = ($sponsor_income_vat_perc * $sponsor_income);
					      			$real_sponsor_income = $sponsor_income - ($sponsor_income_vat_perc * $sponsor_income);
					      			$your_first_mlm_db_id = $this->northbridge_model->getUsersFirstMlmDbId($user_id);
					      			$sponsors_mlm_db_id = $this->northbridge_model->getMlmDbParamById("sponsor",$your_first_mlm_db_id);
					      			$sponsor_user_id = $this->northbridge_model->getMlmDbParamById("user_id",$sponsors_mlm_db_id);
					      			$charge_type = 7;
					          		if($this->northbridge_model->creditUserSponsorIncomeCenterLeader($user_id,$sponsor_user_id,$sponsor_income,$sponsor_income_vat,$real_sponsor_income,$sponsors_mlm_db_id,$charge_type,$date,$time,$sponsor_income_vat_val)){

					          			$placement_income = $this->northbridge_model->getCenterLeaderPlacementBonus();
						      			$placement_income_vat = $this->northbridge_model->getCenterLeaderPlacementBonusVat();
						      			$charge_type = 12;
						      		
						      			$placement_income_vat_perc = $placement_income_vat / 100;
						      			$placement_income_vat_val = ($placement_income_vat_perc * $placement_income);
						      			$real_placement_income = $placement_income - ($placement_income_vat_perc * $placement_income);

					          			$this->northbridge_model->creditUserPlacementIncome($your_first_mlm_db_id,$placement_income,$placement_income_vat,$real_placement_income,$charge_type,$date,$time,$placement_income_vat_val);

										$response_arr['success'] = true;
										$this->session->set_flashdata("center_leader_successful",true);
										$response_arr['url'] = site_url("northbridge/mini_importation");
									}
								}
							}	
				          }
				        }
				        echo json_encode($response_arr);
				    }
					
				}	
			} 

			else if($addition == "center_leader_payment_existing_funds" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data = array('success' => false);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['phone_code'] = $user->phone_code;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}
					if($this->input->post('show_records')){ 
						$response_arr = array('success' => false,'funds_not_enough' => false);
				        $user_total_amount = $this->northbridge_model->getUserTotalAmountByUse($user_id);
				        if($user_total_amount >= 1500){
				        	$form_array = array(
				        		'center_leader' => 1
				        	);
				        	if($this->northbridge_model->updateUserTable($form_array,$user_id)){
				        		if($this->northbridge_model->debitUser($user_id,1500)){
					        		$this->session->set_flashdata("center_leader_successful",true);
					        		$response_arr['success'] = true;
					        	}
				        	}
				        }else{
				        	$response_arr['funds_not_enough'] = true;
				        }
				        echo json_encode($response_arr);
				    }
					
				}	
			} 

			elseif($addition == "get_sponsor_info_registration"){
				
					
				if($this->input->post('sponsor_user_name')){
					$response_arr = array('success' => false,'user_name_does_not_exist' => false,'user_profile_img' => '','sponsor_full_name' => '','sponsor_phone_num' => '','sponsor_email_address' => '');

					$sponsor_user_name = $this->input->post('sponsor_user_name');
					
					if($this->northbridge_model->checkIfUserNameExists($sponsor_user_name)){
						$response_arr['success'] = true;
						$sponsor_id = $this->northbridge_model->getUserIdByName($sponsor_user_name);
						$user_profile_img = $this->northbridge_model->getUserParamById("logo",$sponsor_id);
						if(is_null($user_profile_img)){
							$user_profile_img = "avatar.jpg";
						}
						$response_arr['user_profile_img'] = "<img class='col-sm-4' src='".base_url('assets/images/'.$user_profile_img)."' style='border-radius: 50%; width: 100px; height: 100px;' alt='Sponsor Profile Image'>";
						$sponsor_full_name = $this->northbridge_model->getUserParamById("full_name",$sponsor_id);
						$response_arr['sponsor_full_name'] = $sponsor_full_name;

						$sponsor_phone_code = $this->northbridge_model->getUserParamById("phone_code",$sponsor_id);
						$sponsor_phone_num = $this->northbridge_model->getUserParamById("phone",$sponsor_id);
						$sponsor_email_address = $this->northbridge_model->getUserParamById("email",$sponsor_id);
						$response_arr['sponsor_email_address'] = $sponsor_email_address;
						$response_arr['sponsor_phone_num'] = "+" . $sponsor_phone_code . "" . $sponsor_phone_num;
					}else{
						$response_arr['user_name_does_not_exist'] = true;
					}
					
					echo json_encode($response_arr);
				}
				
			}

			elseif($addition == "get_placement_mlm_account_registration"){
				
					
				if($this->input->post('placement_user_name')){
					$response_arr = array('success' => false,'user_name_does_not_exist' => false,'messages' => '');

					$placement_user_name = $this->input->post('placement_user_name');
					
					if($this->northbridge_model->checkIfUserNameExists($placement_user_name)){
						$response_arr['success'] = true;
						$sponsor_id = $this->northbridge_model->getUserIdByName($placement_user_name);
						
						$all_mlm_ids = $this->northbridge_model->getAllUsersMlmDbIds($sponsor_id);
						if(is_array($all_mlm_ids)){
							$response_arr['success'] = true;
							$response_arr['messages'] .= "<div class='container'>";
							$response_arr['messages'] .= "<button type='button' class='btn btn-warning btn-round' onclick='goBackFromSelectPlacementMlmAccount(this,event)'> < < Go Back</button>";

							$response_arr['messages'] .= "<div class='select-placement-table-div'>";
							$response_arr['messages'] .= "<p>Click To Select ".$placement_user_name."'s Mlm Account To Use As Placement.</p>";
							$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="">';
		            		$response_arr['messages'] .= '<table class="table table-striped table-bordered nowrap hover display" id="select-placement-table" cellspacing="0" width="100%" style="width:100%">';
		            		$response_arr['messages'] .= '<thead>';
		            		$response_arr['messages'] .= '<tr>';
		            		$response_arr['messages'] .= '<th>#</th>';
		            		$response_arr['messages'] .= '<th>Mlm Account</th>';
		            		
		            		
		            		$response_arr['messages'] .= '</tr>';
		            		$response_arr['messages'] .= '<tbody>';


							for($i = 0; $i < count($all_mlm_ids); $i++){
								$j = $i + 1;
								$mlm_db_id = $all_mlm_ids[$i];
								$mlm_db_id = (Integer) $mlm_db_id;
								// var_dump($mlm_db_id);
								$response_arr['messages'] .= '<tr style="cursor:pointer;" data-str="'.$placement_user_name. ' ('.$j.')' .'"  data-mlm-db-id="'.$mlm_db_id.'" onclick="selectThisUserAsPlacement(this,event)">';
								$response_arr['messages'] .= '<td>'.$j.'</td>';
								$response_arr['messages'] .= '<td>'.$placement_user_name. ' ('.$j.')' .'</td>';
								$response_arr['messages'] .= '</tr>';
							}
							$response_arr['messages'] .= '</tbody>';
							$response_arr['messages'] .= '</table>';
							$response_arr['messages'] .= "</div>";
							$response_arr['messages'] .= "</div>";

							$response_arr['messages'] .= "<div class='select-placement-position-table-div' style='display: none;'>";

							$response_arr['messages'] .= "</div>";
							$response_arr['messages'] .= "</div>";
						}
					}else{
						$response_arr['user_name_does_not_exist'] = true;
					}
					
					echo json_encode($response_arr);
				}
				
			}

			else if($addition == "select_positioning_for_mlm_registration"){
				
				if($this->input->post('mlm_db_id')){
					$mlm_db_id = $this->input->post('mlm_db_id');
					if($this->northbridge_model->checkIfMlmDbIdIsValid($mlm_db_id)){

						$response_arr = array('success' => false,'messages' => '','no_available_position' => false);
						if($this->northbridge_model->checkIfMlmDbIdHasNoAvailablePositionUnderHim($mlm_db_id)){
							$response_arr['no_available_position'] = true;
						}else{
							$available = $this->northbridge_model->getAvailablePositionUnderMlmDbId($mlm_db_id);
							if($available == "left"){
								$response_arr['success'] = true;
								$response_arr['messages'] .= '<button type="button" class="btn btn-warning btn-round" onclick="goBackFromSelectPlacementPosition(this,event)"> < < Go Back</button>';

								$response_arr['messages'] .= "<h4 class='text-primary'>Click To Select Position.</h4>";
								$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="">';
			            		$response_arr['messages'] .= '<table class="table table-striped table-bordered nowrap hover display" id="select-placement-position-table" cellspacing="0" width="100%" style="width:100%">';
			            		$response_arr['messages'] .= '<thead>';
			            		$response_arr['messages'] .= '<tr>';
			            		$response_arr['messages'] .= '<th>#</th>';
			            		$response_arr['messages'] .= '<th>Available Positions</th>';
			            		
			            		$response_arr['messages'] .= '</tr>';
			            		$response_arr['messages'] .= '<tbody>';
			            		$response_arr['messages'] .= '<tr style="cursor:pointer;" onclick="selectThisPositionPlacement(this,event)" data-mlm-db-id="'.$mlm_db_id.'" data-position="left">';
			            		$response_arr['messages'] .= '<td>1</td>';
			            		$response_arr['messages'] .= '<td>Left</td>';
			            		$response_arr['messages'] .= '</tr>';
			            		$response_arr['messages'] .= '</tbody>';
			            		$response_arr['messages'] .= '</table>';
			            		$response_arr['messages'] .= '</div>';

							}else if($available == "right"){
								$response_arr['success'] = true;
								$response_arr['messages'] .= '<button type="button" class="btn btn-warning btn-round" onclick="goBackFromSelectPlacementPosition(this,event)"> < < Go Back</button>';

								$response_arr['messages'] .= "<h4 class='text-primary'>Click To Select Position.</h4>";
								$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="">';
			            		$response_arr['messages'] .= '<table class="table table-striped table-bordered nowrap hover display" id="select-placement-position-table" cellspacing="0" width="100%" style="width:100%">';
			            		$response_arr['messages'] .= '<thead>';
			            		$response_arr['messages'] .= '<tr>';
			            		$response_arr['messages'] .= '<th>#</th>';
			            		$response_arr['messages'] .= '<th>Available Positions</th>';
			            		
			            		$response_arr['messages'] .= '</tr>';
			            		$response_arr['messages'] .= '<tbody>';
			            		$response_arr['messages'] .= '<tr style="cursor:pointer;" onclick="selectThisPositionPlacement(this,event)" data-mlm-db-id="'.$mlm_db_id.'" data-position="right">';
			            		$response_arr['messages'] .= '<td>1</td>';
			            		$response_arr['messages'] .= '<td>Right</td>';
			            		$response_arr['messages'] .= '</tr>';
			            		$response_arr['messages'] .= '</tbody>';
			            		$response_arr['messages'] .= '</table>';
			            		$response_arr['messages'] .= '</div>';


							}else if($available == "both"){
								$response_arr['success'] = true;
								$response_arr['messages'] .= '<button type="button" class="btn btn-warning btn-round" onclick="goBackFromSelectPlacementPosition(this,event)"> < < Go Back</button>';

								$response_arr['messages'] .= "<h4 class='text-primary'>Click To Select Position.</h4>";
								$response_arr['messages'] .= '<div class="table-div material-datatables table-responsive" style="">';
			            		$response_arr['messages'] .= '<table class="table table-striped table-bordered nowrap hover display" id="select-placement-position-table" cellspacing="0" width="100%" style="width:100%">';
			            		$response_arr['messages'] .= '<thead>';
			            		$response_arr['messages'] .= '<tr>';
			            		$response_arr['messages'] .= '<th>#</th>';
			            		$response_arr['messages'] .= '<th>Available Positions</th>';
			            		
			            		$response_arr['messages'] .= '</tr>';
			            		$response_arr['messages'] .= '<tbody>';
			            		$response_arr['messages'] .= '<tr style="cursor:pointer;" onclick="selectThisPositionPlacement(this,event)" data-mlm-db-id="'.$mlm_db_id.'" data-position="left">';
			            		$response_arr['messages'] .= '<td>1</td>';
			            		$response_arr['messages'] .= '<td>Left</td>';
			            		$response_arr['messages'] .= '</tr>';

			            		$response_arr['messages'] .= '<tr style="cursor:pointer;" onclick="selectThisPositionPlacement(this,event)" data-mlm-db-id="'.$mlm_db_id.'" data-position="right">';
			            		$response_arr['messages'] .= '<td>2</td>';
			            		$response_arr['messages'] .= '<td>Right</td>';
			            		$response_arr['messages'] .= '</tr>';
			            		$response_arr['messages'] .= '</tbody>';
			            		$response_arr['messages'] .= '</table>';
			            		$response_arr['messages'] .= '</div>';


							}else{

							}
						}
						echo json_encode($response_arr);
					}
				}	
				
			}

			else if($addition == "registration_step_2" && $this->northbridge_model->getUserNameBySlug($second_addition)){
				$second_addition = $this->northbridge_model->getUserNameBySlug($second_addition);
				$user_id = $this->northbridge_model->getUserIdByName($second_addition);
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['phone_code'] = $user->phone_code;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}
					$this->load->view("pages/registration_step_2",$data);
				}	
			}

			

			else if($addition == "get_cities" && $this->input->post("change_country_id_cities") && $this->input->post("change_country_id_cities") == true && $this->input->post('country_id_cities')){
			
				$country_id = $this->input->post('country_id_cities');
				$first_state_array = $this->northbridge_model->getFirstStateByCountryId($country_id);
				print_r($first_state_array);
				if(is_array($first_state_array)){
					foreach($first_state_array as $first_state){
						$id = $first_state->id;
					}
					$set_of_cities_by_first_state = $this->northbridge_model->getCitiesByFirstStateId($id);
					if(is_array($set_of_cities_by_first_state)){
						foreach($set_of_cities_by_first_state as $city){
							$city_name = $city->name;
							$country_id = $city->country_id;
							$city_id = $city->id;
					?>
						<option style="text-transform: capitalize;" value="<?php echo $city_id ?>"><?php echo $city_name; ?></option>
					<?php		
						}
					}
				}

			}		
			else if($addition == "get_regions" && $this->input->post("change_country_id") && $this->input->post("change_country_id") == true && $this->input->post('country_id')){
					
				$country_id = $this->input->post('country_id');
				$regions_by_country_id = $this->northbridge_model->getRegionsByCountryId($country_id);
				if(is_array($regions_by_country_id)){
					foreach($regions_by_country_id as $region){
						$region_name = $region->name;
						$country_id = $region->country_id;
						$region_id = $region->id;
				?>
					<option style="text-transform: capitalize;" value="<?php echo $region_id ?>"><?php echo $region_name; ?></option>
				<?php
					}
				}
			}


			//Process Change Password
			elseif($addition == "process_change_password" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}
					if($this->input->post('change_password')){
						$response_arr = array('success' => false,'messages' => '','wrong_password' => false);
						$this->form_validation->set_rules('old_password','Old Password','trim|required|min_length[4]');
						$this->form_validation->set_rules('new_password','New Password','trim|required|min_length[4]');
						$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
						if($this->form_validation->run()){
							$data['success'] = true;
							$old_password = $this->input->post('old_password');
							$new_password = $this->input->post('new_password');
							$old_hashed = $this->northbridge_model->getUserHashedById($data['user_id']);
							if($old_hashed == sha1($old_password)){
								$form_array = array(
									'hashed' => sha1($new_password)
								);		
								if($this->northbridge_model->updateUserTable($form_array,$data['user_id'])){
									$this->session->set_flashdata('password_changed',true);
									$response_arr['success'] = true;
								}
							}else{
								$response_arr['wrong_password'] = true;
							}
							
						}else{
							foreach($_POST as $key => $value){
								$response_arr['messages'][$key] = form_error($key);
							}
						}
						echo json_encode($response_arr);	
						
					}
				}	
			}

			//Change Password
			elseif($addition == "change_password" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}
					$this->load->view('includes/admin_header',$data);
		            $this->load->view('pages/change_password',$data);
		            $this->load->view('includes/admin_footer',$data);	
				}	
			}

			//Settings Page
			elseif($addition == "settings" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}
					$this->load->view('includes/admin_header',$data);
		            $this->load->view('pages/settings',$data);
		            $this->load->view('includes/admin_footer',$data);	
				}	
			}

			//Become Center Leader Page
			elseif($addition == "become_center_leader" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}
					$this->load->view('includes/admin_header',$data);
		            $this->load->view('pages/become_center_leader',$data);
		            $this->load->view('includes/admin_footer',$data);	
				}	
			}

			//Settings Page
			


			//Settings Page
			elseif($addition == "admin_earnings" && is_null($second_addition) && $this->northbridge_model->checkIfUserIsAdmin()  && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}
					$this->load->view('includes/admin_header',$data);
		            $this->load->view('pages/admin_earnings',$data);
		            $this->load->view('includes/admin_footer',$data);	
				}	
			}

			//Save Settings
			elseif($addition == "save_settings" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}
					$response_arr = array('success' => false);
					$post_array = $_POST;
					$admin_post = $this->input->post('admin');
					if(is_array($post_array)){
						// echo $admin_post;
						// var_dump($admin_post);
						if($admin_post == "false"){
							// echo "string";
							unset($_POST['admin']);
							foreach($_POST as $key => $value){
								$this->northbridge_model->saveSetting($key,$value);
							}
							$response_arr['success'] = true;
						}else{
							if($this->northbridge_model->checkIfUserIsAdmin()){
								unset($_POST['admin']);
								foreach($_POST as $key => $value){
									$this->northbridge_model->saveSetting($key,$value);
								}
								$response_arr['success'] = true;
							}
						}
					}

					echo json_encode($response_arr);
				}	
			}

			//Mark Notif As Read
			elseif($addition == "mark_notif_as_read" && isset($_GET['callback_url']) && isset($_GET['id']) && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}

					$this->load->view('includes/admin_header',$data);
					$this->load->view('pages/mark_notif_as_read',$data);
					$this->load->view('includes/admin_footer',$data);
				}
			}

			//Mark Notif As Read
			elseif($addition == "mark_notif_as_read_notif" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}
					$response_arr = array('success' => false);
					if($this->input->post('id')){
						$id = $this->input->post('id');
						if($this->northbridge_model->markNotifAsRead($id,$user_id)){
							$response_arr['success'] = true;
						}
					}
					echo json_encode($response_arr);
				}
			}	

			//Admins Send Email
			elseif($addition == "admin_send_email" && is_null($second_addition) && $this->northbridge_model->checkIfUserIsAdmin() && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}
					$response_arr = array('success' => false,'users_num' => '');
					
					if($this->input->post('users') && $this->input->post('subject') && $this->input->post('message')){
						$subject = $this->input->post('subject');
						$message = $this->input->post('message');
						if($this->input->post('users') == "all"){
							$users_num = $this->northbridge_model->getTotalNoOfRrgisteredUsers();
							$all_emails = $this->northbridge_model->getAllUsersEmails();
							// print_r($all_emails);
							if($this->northbridge_model->sendEmail($all_emails,$subject,$message)){
								$response_arr['success'] = true;
								$response_arr['users_num'] = $users_num;
							}
							$response_arr['success'] = true;
							$response_arr['users_num'] = $users_num;
						}elseif(is_array($this->input->post('users'))){
							$emails = $this->input->post('users');
							if($this->northbridge_model->sendEmail($emails,$subject,$message)){
								$response_arr['success'] = true;
							}
							$response_arr['success'] = true;
						}
					}

					echo json_encode($response_arr);
				}	
			}

			elseif($addition == "get_all_users" && is_null($second_addition)){
				$response_arr = array('success' => false,'users_json' => array());
					
				if($this->input->post('get_users')){
					$users_json = $this->northbridge_model->getAllUsersInfoJson();
					if($users_json){
						$response_arr['success'] = true;
						$response_arr['users_json'] = $users_json;
					}
				}

				echo json_encode($response_arr);
			}

			//Get All Users Json
			elseif($addition == "get_all_users_json" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn()){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				$data['addition'] = $addition;
				$data['second_addition'] = $second_addition;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$data['user_name'] = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
						$data['cover_photo'] =  $user->cover_photo;
					}
					$response_arr = array('success' => false,'users_json' => array());
					
					if($this->input->post('get_users')){
						$users_json = $this->northbridge_model->getAllUsersInfoJson();
						if($users_json){
							$response_arr['success'] = true;
							$response_arr['users_json'] = $users_json;
						}
					}

					echo json_encode($response_arr);
				}	
			}

			//For Edit Health Facility Profile Page
			else if($addition == "get_regions_for_edit_profile" && $this->northbridge_model->getFacilityBySlug($second_addition) && $this->input->post("change_country_id") && $this->input->post("change_country_id") == true && $this->input->post('country_id')){
				$data['curr_health_facility_arr'] = $this->northbridge_model->getHealthFacilityInfoBySlug($second_addition);
				if(is_array($data['curr_health_facility_arr'])){
	              	foreach($data['curr_health_facility_arr'] as $row){
	              		$health_facility_id = $row->id;
	                	$health_facility_name = $row->name;
	               		$health_facility_logo = $row->logo;
	               		$health_facility_structure = $row->facility_structure;
		                $health_facility_email = $row->email;
		                $health_facility_phone = $row->phone;
		                $health_facility_country = $row->country;
		                $health_facility_state = $row->state;
		                $health_facility_address = $row->address;
		                $health_facility_table_name = $row->table_name;
		                $health_facility_date = $row->date;
		                $health_facility_time = $row->time;
		                $health_facility_slug = $row->slug;
		              }

					$country_id = $this->input->post('country_id');
					$regions_by_country_id = $this->northbridge_model->getRegionsByCountryId($country_id);
					if(is_array($regions_by_country_id)){
					?>
					 <label for="facility-state" style="margin-bottom: 20px;">Facility State:</label>
		              <select name="facility_state" id="facility-state" class="form-control selectpicker" data-style="btn btn-link" required>
					<?php
						foreach($regions_by_country_id as $region){
							$region_name = $region->name;
							$country_id = $region->country_id;
							$region_id = $region->id;
					?>
						<option style="text-transform: capitalize;" value="<?php echo $region_id ?>" <?php if($region_id == $health_facility_state){ echo "selected"; } ?>><?php echo $region_name; ?></option>
					<?php
						}
					?>
						</select>
		              	<span class="form-error"><?php echo form_error('facility_state'); ?></span>
					<?php	
					}   
				}            
			}



			else if($addition == "get_cities" && $this->input->post("get_cities") && $this->input->post("get_cities") == true && $this->input->post('state_id')){
					
				$state_id = $this->input->post('state_id');
				$cities_by_state_id = $this->northbridge_model->getCitiesByStateId($state_id);
				if(is_array($cities_by_state_id)){
					foreach($cities_by_state_id as $state){
						$state_name = $state->name;
						$country_id = $state->country_id;
						$state_id = $state->id;
				?>
					<option style="text-transform: capitalize;" value="<?php echo $state_id ?>"><?php echo $state_name; ?></option>
				<?php
					}
				}
			}



			elseif($addition == "process_sign_in"){
				$response_arr = array('success' => false,'messages' => '','test' => 0,'user_exists' => true,'wrong_password' => false,'user_deactivated' => false,'user_info' => array(),'half_registered' => false);
				$this->form_validation->set_rules('user_name_login',"User Name","required|trim|max_length[40]");
				$this->form_validation->set_rules('password_login','Password','required|trim|min_length[5]');
				$this->form_validation->set_error_delimiters('<p class="form-error">','</p>');
				if($this->form_validation->run() == FALSE){

					foreach($_POST as $key => $value){
						$response_arr['messages'][$key] = form_error($key);
					}
				}else{

					$user_name = $this->input->post('user_name_login');
					$hashed = sha1($this->input->post('password_login'));
					if($this->northbridge_model->userExists($user_name)){
						
						$response_arr['test'] = 1;
						if($this->northbridge_model->password_verify($user_name,$hashed)){
							
							$user_info = $this->northbridge_model->getUserInfoByUserName($user_name);
							if(is_array($user_info)){
								foreach($user_info as $user){
									$user_id = $user->id;
									$user_token = $user->token;
									$active = $user->active;
								}
								if($active == 1){
									
									if($this->northbridge_model->onRegister($user_id,$user_token)){
										$this->northbridge_model->updateUserLastActivity($user_id);
										$this->session->set_flashdata('login',true);
										$response_arr['success'] = true;
										
										$response_arr['url'] = site_url("northbridge/");
										
										if(!is_null($this->input->post('android'))){
											$response_arr['user_info'] = $this->northbridge_model->getAllUserInfo($user_id);
										}									
									}
								}else{
									$response_arr['user_deactivated'] = true;
								}	
							}
						}else{
							$response_arr['wrong_password'] = true;
						}
					}else{
						$response_arr['user_exists'] = false;
					}
				}
				echo json_encode($response_arr);
			}


			//Get All Names
			elseif($addition == "cl_admin" && $second_addition == "get_all_names" && $this->northbridge_model->confirmLoggedIn() == TRUE){
				if($this->northbridge_model->getUserIdWhenLoggedIn() !== FALSE){
					$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
					$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
					if(is_array($user_info)){
						foreach($user_info as $user){
							$data['user_name'] = $user->user_name;
							$data['email'] = $user->email;
							$data['phone'] = $user->phone;
							$data['country_id'] = $user->country_id;
							$data['state_id'] = $user->state_id;
							$data['address'] = $user->address;
							$data['user_slug'] = $user->slug;
							$data['date'] = $user->date;
							$data['time'] = $user->time;
							$data['logo'] = $user->logo;
						}
						if($this->input->post('get_all_names') && $this->input->post('search_val')){
							$search_val = $this->input->post('search_val');
							$vals = $this->northbridge_model->getUsersAndHealthFacilities($search_val);
							$ret_arr = array('array' => array(),'success' => false,'error' => true);
							if(is_array($vals)){
								$ret_arr['success'] = true; 
								$ret_arr['error'] = false;
								foreach($vals as $row){
									$name = $this->northbridge_model->custom_echo(ucwords($row->name),40);
									$user_name = $this->northbridge_model->custom_echo(ucfirst($row->user_name),30);
									
									$array[] = $name;
									$array[] .= $user_name;
									$ret_arr['array'][] = $name;
									$ret_arr['array'][] .= $user_name;
									$ret_arr['array'] = array_unique($ret_arr['array']);
								}							
							}
							echo json_encode($ret_arr); 
						}
					}
				}
			}


			//Get User Info
			elseif($addition == "get_user_info" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn() == TRUE){
				if($this->northbridge_model->getUserIdWhenLoggedIn() !== FALSE){
					$data['user_id'] = $this->northbridge_model->getUserIdWhenLoggedIn();
					$response_arr = array('user_info' => array());
					$response_arr['user_info'] = $this->northbridge_model->getAllUserInfo($user_id);
					
					echo json_encode($response_arr);
				}
			}


			//Get User Posts For Front Page
			elseif($addition == "get_front_page_posts" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn() == TRUE){
				if($this->northbridge_model->getUserIdWhenLoggedIn() !== FALSE){
					$data['user_id'] = $this->northbridge_model->getUserIdWhenLoggedIn();
					$response_arr = array('posts_and_comments' => array());
					$response_arr['posts_and_comments'] = $this->northbridge_model->getUserFrontPagePostsAndComments($user_id);
					echo json_encode($response_arr);
				}
			}					


			//Get User Posts For Front Page
			elseif($addition == "get_front_page_posts_subsequent" && is_null($second_addition) && $this->northbridge_model->confirmLoggedIn() == TRUE){
				if($this->northbridge_model->getUserIdWhenLoggedIn() !== FALSE && $this->input->post('offset') && $this->input->post('last_id')){
					$data['user_id'] = $this->northbridge_model->getUserIdWhenLoggedIn();
					$offset = $this->input->post('offset');
					$last_id = $this->input->post('last_id');
					$response_arr = array('posts_and_comments' => array());
					$response_arr['posts_and_comments'] = $this->northbridge_model->getUserFrontPageSubsequentPostsAndComments($user_id,$offset,$last_id);
					echo json_encode($response_arr);
				}
			}					



			//Search App Page
			elseif($addition == "search" && $second_addition == "top" && $this->northbridge_model->confirmLoggedIn() == TRUE){
				if($this->northbridge_model->getUserIdWhenLoggedIn() !== FALSE){
					$data['user_id'] = $this->northbridge_model->getUserIdWhenLoggedIn();
					$user_info = $this->northbridge_model->getUserInfoByUserId($data['user_id']);
					if(is_array($user_info)){
						foreach($user_info as $user){
							$data['user_name'] = $user->user_name;
							$data['email'] = $user->email;
							$data['phone'] = $user->phone;
							$data['country_id'] = $user->country_id;
							$data['state_id'] = $user->state_id;
							$data['address'] = $user->address;
							$data['user_slug'] = $user->slug;
							$data['date'] = $user->date;
							$data['time'] = $user->time;
							$data['logo'] = $user->logo;
						}
						if(!is_null($third_addition)){
							$data['search_val'] = urldecode($third_addition);
						}else{
							$data['search_val'] = urldecode($_GET['my-input']);
						}
						$this->load->view('includes/admin_header',$data);
						$this->load->view('pages/search_results_page',$data);
						$this->load->view('includes/admin_footer',$data);
					}
				}
			}			

			//Read Notif Page
			elseif($addition == "notifications" && $this->northbridge_model->checkIfNotifExistsById($second_addition) && is_null($third_addition) && is_null($fourth_addition) && is_null($fivth_addition) && $this->northbridge_model->confirmLoggedIn() == TRUE){
				if($this->northbridge_model->getUserIdWhenLoggedIn() !== FALSE){
					$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
					$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
					if(is_array($user_info)){
						foreach($user_info as $user){
							$data['user_name'] = $user->user_name;
							$data['email'] = $user->email;
							$data['phone'] = $user->phone;
							$data['country_id'] = $user->country_id;
							$data['state_id'] = $user->state_id;
							$data['address'] = $user->address;
							$data['user_slug'] = $user->slug;
							$data['date'] = $user->date;
							$data['time'] = $user->time;
							$data['logo'] = $user->logo;
						}
						$data['second_addition'] = $second_addition;
						if($this->northbridge_model->checkIfUserOwnsThisMessage($second_addition,$data['user_name'])){
							$data['title'] = "Admin Page";
							$date = date("j M Y");
							$time = date("h:i:sa");
							$form_array = array(
								'date_received' => $date,
								'time_received' => $time,
								'received' => 1
							);
							if($this->northbridge_model->updateNotif($form_array,$second_addition)){
								$data['notif_array'] = $this->northbridge_model->getNotifById($second_addition);
								$this->load->view('includes/admin_header',$data);
								$this->load->view('pages/view_notif_page',$data);
								$this->load->view('includes/admin_footer',$data);
							}
							
						}else{
							redirect('northbridge/cl_admin');
						}
						
					}
				}
			}			

			
					

			//Get The All Tab
			elseif($addition == "get_all_tab"  && $this->northbridge_model->confirmLoggedIn() == TRUE){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
					}
					if($this->input->post('get_all_tab') && $this->input->post('search_val')){
					 $search_val = $this->input->post('search_val');                    
                     $first_facilities = $this->northbridge_model->getFirstHealthFacilities($search_val);
                        if(is_array($first_facilities)){
                          // print_r($first_facilities);
                          $i = 0;
                          // $show_more = false;
                      ?>
                      <h3 class="text-center">Health Facilities</h3>
                      <table class="table table-test table-striped table-bordered dt-responsive nowrap hover display" id="first-facilities-table" cellspacing="0" width="100%" style="width:100%">
                        
                          <thead style="display: none;">
                            <tr>
                              <th>#</th>
                              <th>Logo</th>
                              <th>Facility Name</th>
                              <th>Location</th>
                              <th>Facility Structure</th>
                              <th>Action</th>
                            </tr>
                          </thead>
                          <tbody>
                          <?php
                            foreach($first_facilities as $row){
                              $i++;
                               $hospital_id = $row->id;
                                $hospital_name = $row->name;
                                $hospital_logo = $row->logo;
                                $hopsital_email = $row->email;
                                $hospital_phone = $row->phone;
                                $hospital_country = $this->northbridge_model->getCountryById($row->country);
                                $hospital_state = $this->northbridge_model->getStateById($row->state);
                                $hospital_address = $row->address;
                                $hospital_slug = $row->slug;
                                $hospital_table_name = $row->table_name;
                                $facility_structure = $row->facility_structure;
                                $color = $row->color;
                                if($this->northbridge_model->checkIfUserIsRegisteredOnThisFacility($hospital_table_name,$user_name,$hospital_name,$user_id)){
                                  $registered = true;
                                }else{
                                  $registered = false;
                                }
                               if(is_null($hospital_logo)){
                                   $hospital_logo = "<img width='30'  style='width:30px; height:30px;' class='round' avatar='".$hospital_name."' col='".$color."'>";
                                }else{
                                  $logo_url = base_url('assets/images/'.$hospital_logo);
                                  $hospital_logo = '<img src="'.$logo_url.'" alt="" width="30" style="width:30px; height:30px;" class="img-round">';
                                }
                          ?>
                            <tr>
                              <td><?php echo $i; ?>.</td>
                              <td><?php echo $hospital_logo; ?></td>
                              <td><a href="<?php echo site_url('northbridge/index/'.$hospital_slug) ?>" id="edit-test-card-link" class="text-primary list-group-item list-group-item-action"><?php echo $this->northbridge_model->custom_echo($hospital_name,35); ?></a></td>
                              <td><?php echo $hospital_state.', '.$hospital_country; ?></td>
                              <td class="text-capital1"><?php echo $facility_structure; ?></td>
                              <td class="td-actions text-right">
                                <?php if(!$registered){ ?>
                                <button class="btn btn-primary btn-link" rel="tooltip" data-hospital-name1="<?php echo $hospital_table_name; ?>" data-hospital-name="<?php echo $hospital_name ?>" data-hosid="<?php echo $hospital_id;?>" onclick="return registerPatient(this)">
                                  <i class="fas fa-user-plus font-awesome"></i>
                                  
                                </button>
                                <?php }else{ ?>
                                <button class="btn btn-danger btn-link" rel="tooltip" data-original-title="Unregister" data-hospital-name1="<?php echo $hospital_table_name; ?>" data-hospital-name="<?php echo $hospital_name ?>" data-hosid="<?php echo $hospital_id;?>" onclick="return unRegisterPatient(this)">
                                  <i class="fas fa-user-minus font-awesome"></i>
                                  
                                </button>
                                <?php } ?>
                              </td>
                            </tr>
                          
                          <?php    
                            
                          }
                         
                          ?>
                        </tbody>
                       
                      </table>
                      <?php } ?>


                      <?php
                         $first_users = $this->northbridge_model->getFirstUsers($search_val);
                            if(is_array($first_users)){
                              $i = 0;
                              
                      ?>
                      <h3 class="text-center">Users</h3>
                      <table class="table table-test table-striped table-bordered dt-responsive nowrap hover display" id="user-results-table" cellspacing="0" width="100%" style="width:100%">
                        <thead style="display: none;">
                          <tr>
                            <th>#</th>
                            <th>Profile Picture</th>
                            <th>Name</th>
                            <th>Location</th>
                            <th>Position</th>
                            <th>Num Of Affiliated Facilities</th>
                          </tr>
                        </thead>
                        <tbody>
                          <?php
                            foreach($first_users as $user){
                              $i++;
                              
                                $user_name = $user->user_name;
                                $email = $user->email;
                                $phone = $user->phone;
                               $hospital_country = $this->northbridge_model->getCountryById($user->country_id);
                                $hospital_state = $this->northbridge_model->getStateById($user->state_id);
                                $address = $user->address;
                                $user_slug = $user->slug;
                                $date = $user->date;
                                $time = $user->time;
                                $logo = $user->logo;
                                $is_patient = $user->is_patient;
                                $is_admin = $user->is_admin;
                                $affiliated_facilities = $user->affiliated_facilities;
                                $real_affiliated_facilities = $this->northbridge_model->custom_echo($this->northbridge_model->getRealAffiliatedFacilities($affiliated_facilities),100);
                                if($affiliated_facilities !== ""){
                                  $affiliated_facilities_num = explode(",", $affiliated_facilities);
                                  $affiliated_facilities_num = count($affiliated_facilities_num);
                                }
                                if(is_null($logo)){
                                  $logo = "avatar.jpg";
                                }
                          ?>
                            <tr>
                              <td><?php echo $i; ?>.</td>
                              <td><img src="<?php echo base_url('assets/images/'.$logo); ?>" alt="" width="30" class='img-round'></td>
                              <td><a href="<?php echo site_url('northbridge/index/'.$user_slug) ?>" id="edit-test-card-link" class="text-primary list-group-item list-group-item-action"><?php echo $this->northbridge_model->custom_echo($user_name,35); ?></a></td>
                              <td><?php echo $hospital_state.', '.$hospital_country; ?></td>
                              <td class="text-capital1"><?php if($is_patient == 1){ echo "patient"; } elseif($is_admin == 1){ echo "admin"; }  ?></td>
                              <td class="text-capital1 pointer-cursor" <?php if($is_patient == 1 && $is_admin == 0 && $affiliated_facilities !== ""){ echo 'rel="tooltip" data-original-title="'.$real_affiliated_facilities.'"'; } ?> >
                                <?php if($is_patient == 1 && $affiliated_facilities !== ""){ echo $affiliated_facilities_num . " affiliated facilities" ; } ?>
                              </td>
                            </tr>
                          
                          <?php    
                            
                          }
                         ?>
                        </tbody>
                       
                      </table>
                      <?php }
					}
				}
			}

			//Get Patients Tab
			elseif($addition == "get_patients_tab"  && $this->northbridge_model->confirmLoggedIn() == TRUE){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
					}
					if($this->input->post('get_patients_tab') && $this->input->post('search_val')){
					  $search_val = $this->input->post('search_val');	                   	
                         $first_users = $this->northbridge_model->getFirstPatients($search_val);

                            if(is_array($first_users)){
                              $i = 0;
                              
                      ?>
                      <h3 class="text-center">Patients</h3>
                      <table class="table table-test table-striped table-bordered dt-responsive nowrap hover display" id="full-patients-results-table" cellspacing="0" width="100%" style="width:100%">
                        <thead style="display: none;">
                          <tr>
                            <th>#</th>
                            <th>Profile Picture</th>
                            <th>Name</th>
                            <th>Location</th>
                            
                            <th>Num Of Affiliated Facilities</th>
                          </tr>
                        </thead>
                        <tbody>
                          <?php
                            foreach($first_users as $user){
                              $i++;
                              
                                $user_name = $user->user_name;
                                $email = $user->email;
                                $phone = $user->phone;
                               $hospital_country = $this->northbridge_model->getCountryById($user->country_id);
                                $hospital_state = $this->northbridge_model->getStateById($user->state_id);
                                $address = $user->address;
                                $user_slug = $user->slug;
                                $date = $user->date;
                                $time = $user->time;
                                $logo = $user->logo;
                                $is_patient = $user->is_patient;
                                $is_admin = $user->is_admin;
                                $affiliated_facilities = $user->affiliated_facilities;
                                $real_affiliated_facilities = $this->northbridge_model->custom_echo($this->northbridge_model->getRealAffiliatedFacilities($affiliated_facilities),100);
                                if($affiliated_facilities !== ""){
                                  $affiliated_facilities_num = explode(",", $affiliated_facilities);
                                  $affiliated_facilities_num = count($affiliated_facilities_num);
                                }
                                if(is_null($logo)){
                                  $logo = "avatar.jpg";
                                }
                          ?>
                            <tr>
                              <td><?php echo $i; ?>.</td>
                              <td><img src="<?php echo base_url('assets/images/'.$logo); ?>" alt="" width="30" class='img-round'></td>
                              <td><a href="<?php echo site_url('northbridge/index/'.$user_slug) ?>" id="edit-test-card-link" class="text-primary list-group-item list-group-item-action"><?php echo $this->northbridge_model->custom_echo($user_name,35); ?></a></td>
                              <td><?php echo $hospital_state.', '.$hospital_country; ?></td>
                              
                              <td class="text-capital1 pointer-cursor" <?php if($is_patient == 1 && $is_admin == 0 && $affiliated_facilities !== ""){ echo 'rel="tooltip" data-original-title="'.$real_affiliated_facilities.'"'; } ?> >
                                <?php if($is_patient == 1 && $affiliated_facilities !== ""){ echo $affiliated_facilities_num . " affiliated facilities" ; } ?>
                              </td>
                            </tr>
                          
                          <?php    
                            
                          }
                         ?>
                        </tbody>
                       
                      </table>
                      <?php
                       } 
					}
				}
			}

			//Get Users Tab
			elseif($addition == "get_users_tab"  && $this->northbridge_model->confirmLoggedIn() == TRUE){
				$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
				$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
				$data['user_id'] = $user_id;
				if(is_array($user_info)){
					foreach($user_info as $user){
						$user_name = $user->user_name;
						$data['email'] = $user->email;
						$data['phone'] = $user->phone;
						$data['country_id'] = $user->country_id;
						$data['state_id'] = $user->state_id;
						$data['address'] = $user->address;
						$data['user_slug'] = $user->slug;
						$data['date'] = $user->date;
						$data['time'] = $user->time;
						$data['logo'] = $user->logo;
					}
					if($this->input->post('get_users_tab') && $this->input->post('search_val')){
					  $search_val = $this->input->post('search_val');	                   	
                      $first_users = $this->northbridge_model->getFirstUsers($search_val);
	                    if(is_array($first_users)){
	                      $i = 0;
                              
                      ?>
                      <h3 class="text-center">Users</h3>
                      <table class="table table-test table-striped table-bordered dt-responsive nowrap hover display" id="full-user-results-table" cellspacing="0" width="100%" style="width:100%">
                        <thead style="display: none;">
                          <tr>
                            <th>#</th>
                            <th>Profile Picture</th>
                            <th>Name</th>
                            <th>Location</th>
                            <th>Position</th>
                            
                          </tr>
                        </thead>
                        <tbody>
                          <?php
                            foreach($first_users as $user){
                              $i++;
                              
                                $user_name = $user->user_name;
                                $email = $user->email;
                                $phone = $user->phone;
                               $hospital_country = $this->northbridge_model->getCountryById($user->country_id);
                                $hospital_state = $this->northbridge_model->getStateById($user->state_id);
                                $address = $user->address;
                                $user_slug = $user->slug;
                                $date = $user->date;
                                $time = $user->time;
                                $logo = $user->logo;
                                $is_patient = $user->is_patient;
                                $is_admin = $user->is_admin;
                                
                                if(is_null($logo)){
                                  $logo = "avatar.jpg";
                                }
                          ?>
                            <tr>
                              <td><?php echo $i; ?>.</td>
                              <td><img src="<?php echo base_url('assets/images/'.$logo); ?>" alt="" width="30" class='img-round'></td>
                              <td><a href="<?php echo site_url('northbridge/index/'.$user_name) ?>" id="edit-test-card-link" class="text-primary list-group-item list-group-item-action"><?php echo $this->northbridge_model->custom_echo($user_name,35); ?></a></td>
                              <td><?php echo $hospital_state.', '.$hospital_country; ?></td>
                              <td class="text-capital1"><?php if($is_patient == 1){ echo "patient"; } elseif($is_admin == 1){ echo "admin"; }  ?></td>
                              
                            </tr>
                          
                          <?php    
                            
                          }
                         ?>
                        </tbody>
                       
                      </table>
                      <?php
                       } 
					}
				}
			}




			//Edit User Profile

			elseif($this->northbridge_model->getUserBySlug($addition) == true && $second_addition == "edit-profile"  && $this->northbridge_model->confirmLoggedIn() == TRUE  && is_null($third_addition)){

				if($this->northbridge_model->getUserIdWhenLoggedIn() !== FALSE){
					$data['form_error'] = false;
					
						$user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
						$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
						$data['addition'] = $addition;
						if(is_array($user_info)){
							foreach($user_info as $user){
								$data['user_name'] = $user->user_name;
								$data['email'] = $user->email;
								$data['phone'] = $user->phone;
								$data['country_id'] = $user->country_id;
								$data['state_id'] = $user->state_id;
								$data['address'] = $user->address;
								$data['slug'] = $user->slug;
								$data['date'] = $user->date;
								$data['time'] = $user->time;
								$data['logo'] = $user->logo;
								$data['phone'] = $user->phone;
								$data['bio'] = $user->bio;
								$data['phone_code'] = $user->phone_code;
								if($data['phone'] == 0){
									$data['phone'] = "";
								}
							}
							if($data['user_name'] == $this->northbridge_model->getUserNameBySlug($addition)){
								$data['title'] = "Admin Page";
								
								
								$this->load->view('includes/admin_header',$data);
								$this->load->view('pages/edit_user_profile',$data);
								$this->load->view('includes/admin_footer',$data);
							}else{
								redirect('northbridge/cl_admin');
							}	
						}	
						
				}
			}

			

			elseif($this->northbridge_model->getFacilityBySlug($addition) == true && $second_addition == "save_receipt"){
				$curr_health_facility_arr = $this->northbridge_model->getHealthFacilityInfoBySlug($addition);
				if(is_array($curr_health_facility_arr)){
	              	foreach($curr_health_facility_arr as $row){
	              		$health_facility_id = $row->id;
	                	$health_facility_name = $row->name;
	               		$health_facility_logo = $row->logo;
	               		$health_facility_structure = $row->facility_structure;
		                $health_facility_email = $row->email;
		                $health_facility_phone = $row->phone;
		                $health_facility_country = $row->country;
		                $health_facility_state = $row->state;
		                $health_facility_address = $row->address;
		                $health_facility_table_name = $row->table_name;
		                $health_facility_date = $row->date;
		                $health_facility_time = $row->time;
		                $health_facility_slug = $row->slug;
		            }
		            $health_facility_test_result_table = $this->northbridge_model->createTestResultTableHeaderString($health_facility_id,$health_facility_name);
		            if($this->input->post('data') && $this->input->post('lab_id')){
		            	$lab_id = $this->input->post('lab_id');
		            	$data = base64_decode($this->input->post('data'));
		          		$initiated_patient_info = $this->northbridge_model->getInitiatedPatientByLabId($health_facility_test_result_table,$lab_id);
		          		if(is_array($initiated_patient_info)){
		          			foreach($initiated_patient_info as $row){
		          				$id = $row->id;
		          				$initiation_code = $row->initiation_code;
		          				$test_id = $row->test_id;
		          				$patient_name = $row->patient_name;
		          				$patient_username = $row->patient_username;
		          				$date_paid = $row->date_paid;
		          				$time_paid = $row->time_paid;
		          			}
		          			if(is_null($patient_username)){
				            	$file_name = $lab_id . '_receipt.pdf';
						        if(file_put_contents( "./assets/images/".$file_name, $data)){
						        	$form_array = array(
						        		'receipt_file' => $file_name
						        	);
						        	if($this->northbridge_model->updateTestRecordsFieldsDemo($form_array,$lab_id,$health_facility_test_result_table)){
							        	echo "successful";
							        }
						        }
						    }else{
						    	$file_name = $lab_id . '_receipt.pdf';
						        if(file_put_contents( "./assets/images/".$file_name, $data)){
						        	$form_array = array(
						        		'receipt_file' => $file_name
						        	);
						        	if($this->northbridge_model->updateTestRecordsFieldsDemo($form_array,$lab_id,$health_facility_test_result_table)){
						        		$pdf_url = base_url('assets/images/') . $lab_id . '_receipt.pdf';
						        		$title = "Notice Of Test Receipt";
						        		$message = "This Is To Show You The Receipt For The Test(s) You Paid For In ".$health_facility_name." On " . $date_paid . " At " .$time_paid ." Is Available<br>. <a href='".$pdf_url."'>Click Here To Download</a>";
						        		$date =	date("j M Y");
										$time = date("H:i:s");

										$form_array = array(
											'sender' => $health_facility_name,
											'receiver' => $patient_username,
											'title' => $title,
											'message' => $message,
											'date_sent' => $date,
											'time_sent' => $time 
										);

						        		if($this->northbridge_model->sendMessage($form_array)){
						        			echo "successful";
						        		}	
							        }
						        }
						    }
					    }
		            }
		        }      
			}

			elseif($this->northbridge_model->getFacilityBySlug($addition) == true && $this->northbridge_model->getDeptBooleanBySlug($second_addition) && $this->northbridge_model->getSubDeptBooleanBySlug($third_addition) && $this->northbridge_model->getPersonnelBooleanBySlug($fourth_addition) && $fivth_addition == "save_receipt"){
				$curr_health_facility_arr = $this->northbridge_model->getHealthFacilityInfoBySlug($addition);
				if(is_array($curr_health_facility_arr)){
	              	foreach($curr_health_facility_arr as $row){
	              		$health_facility_id = $row->id;
	                	$health_facility_name = $row->name;
	               		$health_facility_logo = $row->logo;
	               		$health_facility_structure = $row->facility_structure;
		                $health_facility_email = $row->email;
		                $health_facility_phone = $row->phone;
		                $health_facility_country = $row->country;
		                $health_facility_state = $row->state;
		                $health_facility_address = $row->address;
		                $health_facility_table_name = $row->table_name;
		                $health_facility_date = $row->date;
		                $health_facility_time = $row->time;
		                $health_facility_slug = $row->slug;
		            }
		            $health_facility_test_result_table = $this->northbridge_model->createTestResultTableHeaderString($health_facility_id,$health_facility_name);
		            if($this->input->post('data') && $this->input->post('lab_id')){
		            	$response_arr = array('success' => false);
		            	$lab_id = $this->input->post('lab_id');
		            	$data = base64_decode($this->input->post('data'));
		          		$initiated_patient_info = $this->northbridge_model->getInitiatedPatientByLabId($health_facility_test_result_table,$lab_id);
		          		if(is_array($initiated_patient_info)){
		          			foreach($initiated_patient_info as $row){
		          				$id = $row->id;
		          				$initiation_code = $row->initiation_code;
		          				$test_id = $row->test_id;
		          				$patient_name = $row->patient_name;
		          				$patient_username = $row->patient_username;
		          				$date_paid = $row->date_paid;
		          				$time_paid = $row->time_paid;
		          			}
		          			if(is_null($patient_username)){
				            	$file_name = $lab_id . '_receipt.pdf';
						        if(file_put_contents( "./assets/images/".$file_name, $data)){
						        	$form_array = array(
						        		'receipt_file' => $file_name
						        	);
						        	if($this->northbridge_model->updateTestRecordsFieldsDemo($form_array,$lab_id,$health_facility_test_result_table)){
							        	$response_arr['success'] = true;
							        }
						        }
						    }else{
						    	$file_name = $lab_id . '_receipt.pdf';
						        if(file_put_contents( "./assets/images/".$file_name, $data)){
						        	$form_array = array(
						        		'receipt_file' => $file_name
						        	);
						        	if($this->northbridge_model->updateTestRecordsFieldsDemo($form_array,$lab_id,$health_facility_test_result_table)){
						        		$pdf_url = base_url('assets/images/') . $lab_id . '_receipt.pdf';
						        		$title = "Notice Of Test Receipt";
						        		$message = "This Is To Show You The Receipt For The Test(s) You Paid For In ".$health_facility_name." On " . $date_paid . " At " .$time_paid ." Is Available<br>. <a href='".$pdf_url."'>Click Here To Download</a>";
						        		$date =	date("j M Y");
										$time = date("H:i:s");

										$form_array = array(
											'sender' => $health_facility_name,
											'receiver' => $patient_username,
											'title' => $title,
											'message' => $message,
											'date_sent' => $date,
											'time_sent' => $time 
										);

						        		if($this->northbridge_model->sendMessage($form_array)){
						        			$response_arr['success'] = true;
						        		}	
							        }
						        }
						    }
					    }
					    echo json_encode($response_arr);
		            }
		        }      
			}
			

			elseif($this->northbridge_model->getFacilityBySlug($addition) == true && $second_addition == "mark_paid_tests"){
				$curr_health_facility_arr = $this->northbridge_model->getHealthFacilityInfoBySlug($addition);
				if(is_array($curr_health_facility_arr)){

	              	foreach($curr_health_facility_arr as $row){
	              		$health_facility_id = $row->id;
	                	$health_facility_name = $row->name;
	               		$health_facility_logo = $row->logo;
	               		$health_facility_structure = $row->facility_structure;
		                $health_facility_email = $row->email;
		                $health_facility_phone = $row->phone;
		                $health_facility_country =$this->northbridge_model->getCountryById($row->country);
                        $health_facility_state = $this->northbridge_model->getStateById($row->state);
		                $health_facility_address = $row->address;
		                $health_facility_table_name = $row->table_name;
		                $health_facility_date = $row->date;
		                $health_facility_time = $row->time;
		                $health_facility_slug = $row->slug;
		              }
		            $user_id = $this->northbridge_model->getUserIdWhenLoggedIn();
					$user_info = $this->northbridge_model->getUserInfoByUserId($user_id);
					
					if(is_array($user_info)){
						foreach($user_info as $user){
							$user_name = $user->user_name;
							$email = $user->email;
							$phone = $user->phone;
							$country_id = $user->country_id;
							$state_id = $user->state_id;
							$address = $user->address;
							$user_slug = $user->slug;
							$date = $user->date;
							$time = $user->time;
							$logo = $user->logo;
						}
			            $data = array('lab_id' => false,'success' => false);
			            $new_lab_id = false;
			            
		            	$health_facility_test_result_table = $this->northbridge_model->createTestResultTableHeaderString($health_facility_id,$health_facility_name);
						
						$initiation_code = get_cookie('initiation_code',true);
						$patient_bio_data_table = $this->northbridge_model->createpatientBioDataTableString($health_facility_id,$health_facility_name);
						$patient_name = $this->northbridge_model->getPatientName($patient_bio_data_table,$user_id,$user_name);
						$ids = $this->northbridge_model->getPaidTestsIdsByInitiationCode($health_facility_test_result_table,$initiation_code,$user_name);
						$total_price = $this->northbridge_model->getPatientsTotalCostByInitiationCode($health_facility_test_result_table,$initiation_code,$user_name);
						$date = date("j M Y");
						$time = date("h:i:sa");
						
						if($last_row_of_test_result = $this->northbridge_model->getLastRowTestResult($health_facility_test_result_table,$health_facility_name)){
							foreach($last_row_of_test_result as $row){
								$last_row_of_test_result_lab_id = $row->lab_id;
							}
							$year = date('y');
							if(is_null($last_row_of_test_result_lab_id)){
								$last_row_of_test_result_lab_id = "1000-".$year;
							}
							$real_last_row_of_test_result_lab_id = substr($last_row_of_test_result_lab_id, 0,-3);
							
							$new_test_result_lab_id = $real_last_row_of_test_result_lab_id + 1;
							$new_test_result_lab_id .=  '-' . $year;
							$new_lab_id = $new_test_result_lab_id;
							$data['success'] = true;
							
						}

						for($i = 0; $i < count($ids); $i++){
							$n = $ids[$i];
							$id = $n;
							$form_array = array(
								'lab_id' => $new_lab_id,
								'paid' => 1,
								'date_paid' => $date,
								'time_paid' => $time
							);
							if($this->northbridge_model->markPaidTests($n,$form_array,$health_facility_name,$health_facility_test_result_table)){
								$data['success'] = true;
							}
						}
						if($data['success'] == true){
							$curr_date = date("j M Y") . ' ' .date("h:i:sa");
							$receipt_number = substr(bin2hex($this->encryption->create_key(8)),4);
							$sum = $this->northbridge_model->getTotalPatientTestAmount($health_facility_test_result_table,$initiation_code,$user_name);
							$response_arr = array('lab_id' => '','initiation_code' => $initiation_code,'patient_name' => $patient_name,'receipt_number' => $receipt_number,'facility_state' => $health_facility_state,'facility_country' => $health_facility_country,'date' => $curr_date,'sum' => $sum);
							$health_facility_patient_db_table = $this->northbridge_model->createTestPatientTableHeaderString($health_facility_id,$health_facility_name);
							$patient_bio_data_table = $this->northbridge_model->createpatientBioDataTableString($health_facility_id,$health_facility_name);
							$patient_bio_data = $this->northbridge_model->getPatientBioDataTable($patient_bio_data_table,$user_id,$user_name);
		                    if(is_array($patient_bio_data)){
		                      foreach($patient_bio_data as $row){
		                        $id = $row->id;
		                        $first_name = $row->firstname;
		                        $last_name = $row->lastname;
		                        $dob = $row->dob;
		                        $age = $row->age;
		                        $age_unit = $row->age_unit;
		                        $sex = $row->sex;
		                        $fasting = $row->fasting;
		                        $race = $row->race;
		                        $mobile = $row->mobile_no;
		                        $email = $row->email;
		                        $present_medications = $row->present_medications;
		                        $height = $row->height;
		                        $weight = $row->weight;
		                        $address = $row->address;
		                        $date = $row->date;
		                        $time = $row->time;
		                      }
		                      $date = date("j M Y");
		                      $time = date("h:i:sa");
		                      $form_array = array(
								'initiation_code' => $initiation_code,
								'lab_id' => $new_lab_id,
								'firstname' => $first_name,
								'surname' => $last_name,
								'dob' => $dob,
								'sex' => $sex,
								'age' => $age,
								'age_unit' => $age_unit,
								'race' => $race,
								'mobile_no' => $mobile,
								'email' => $email,
								'height' => $height,
								'weight' => $weight,
								'fasting' => $fasting,
								'present_medications' => $present_medications,
								'address' => $address,
								'created' => 1,
								'date_created' => $date,
								'time_created' => $time,
								'patient_name' => $first_name . " " . $last_name
							);
							if($this->northbridge_model->addPatientRecord($health_facility_patient_db_table,$form_array)){
								$response_arr['lab_id'] = $new_lab_id;
								// if($this->northbridge_model->deletePatientBioDataHealthFacility($patient_bio_data_table,$user_id)){
									echo json_encode($response_arr);
								// }
							}
							}
						}
							
					}		
				}	
			}

			elseif($this->northbridge_model->getFacilityBySlug($addition) == true && $this->northbridge_model->getDeptBooleanBySlug($second_addition) && $this->northbridge_model->getSubDeptBooleanBySlug($third_addition) && $this->northbridge_model->getPersonnelBooleanBySlug($fourth_addition) && $fivth_addition == "mark_paid_tests"){
				$curr_health_facility_arr = $this->northbridge_model->getHealthFacilityInfoBySlug($addition);
				if(is_array($curr_health_facility_arr)){

	              	foreach($curr_health_facility_arr as $row){
	              		$health_facility_id = $row->id;
	                	$health_facility_name = $row->name;
	               		$health_facility_logo = $row->logo;
	               		$health_facility_structure = $row->facility_structure;
		                $health_facility_email = $row->email;
		                $health_facility_phone = $row->phone;
		                $health_facility_country =$this->northbridge_model->getCountryById($row->country);
                        $health_facility_state = $this->northbridge_model->getStateById($row->state);
		                $health_facility_address = $row->address;
		                $health_facility_table_name = $row->table_name;
		                $health_facility_date = $row->date;
		                $health_facility_time = $row->time;
		                $health_facility_slug = $row->slug;
		              }
		            $data = array('lab_id' => false,'success' => false);
		            $new_lab_id = false;
		            if($this->input->post('select')){
						$id = $_POST['select'];
						$initiation_code = $this->session->initiation_code;
						$patient_name = $this->session->patient_name;
						$total_price = $this->session->total_price;
						$date = date("j M Y");
						$time = date("h:i:sa");
						$health_facility_test_result_table = $this->northbridge_model->createTestResultTableHeaderString($health_facility_id,$health_facility_name);
						if($last_row_of_test_result = $this->northbridge_model->getLastRowTestResult($health_facility_test_result_table,$health_facility_name)){
							foreach($last_row_of_test_result as $row){
								$last_row_of_test_result_lab_id = $row->lab_id;
							}
							$year = date('y');
							if(is_null($last_row_of_test_result_lab_id)){
								$last_row_of_test_result_lab_id = "1000-".$year;
							}
							$real_last_row_of_test_result_lab_id = substr($last_row_of_test_result_lab_id, 0,-3);
							
							$new_test_result_lab_id = $real_last_row_of_test_result_lab_id + 1;
							$new_test_result_lab_id .=  '-' . $year;
							$new_lab_id = $new_test_result_lab_id;
							$data['success'] = true;
							
						}
						foreach($id as $key => $n){
							$id = $n;
							$form_array = array(
								'lab_id' => $new_lab_id,
								'paid' => 1,
								'date_paid' => $date,
								'time_paid' => $time
							);
							if($this->northbridge_model->markPaidTests($n,$form_array,$health_facility_name,$health_facility_test_result_table)){
								$data['success'] = true;
							}
						}
						if($data['success'] == true){
							$curr_date = date("j M Y") . ' ' .date("h:i:sa");
							$receipt_number = substr(bin2hex($this->encryption->create_key(8)),4);
							$response_arr = array('lab_id' => '','initiation_code' => $initiation_code,'patient_name' => $patient_name,'receipt_number' => $receipt_number,'facility_state' => $health_facility_state,'facility_country' => $health_facility_country,'date' => $curr_date);
							$health_facility_patient_db_table = $this->northbridge_model->createTestPatientTableHeaderString($health_facility_id,$health_facility_name);
								$dept_id = $this->northbridge_model->getDeptIdBySlug($second_addition);
								$sub_dept_id = $this->northbridge_model->getSubDeptIdBySlugAndDeptId($third_addition,$dept_id);
								$personnel_id = $this->northbridge_model->getPersonnelIdBySlugDeptIdAndSubDeptId($fourth_addition,$dept_id,$sub_dept_id);
								$form_array = array(
									
									'initiation_code' => $initiation_code,
									'lab_id' => $new_lab_id,
									'patient_name' => $patient_name
								);
								if($this->northbridge_model->addPatientRecord($health_facility_patient_db_table,$form_array)){
									$response_arr['lab_id'] = $new_lab_id;
									echo json_encode($response_arr);
								}
							
						}
					}		
				}	
			}

			
			elseif($this->northbridge_model->getFacilityBySlug($addition) == true && $second_addition == "get_pdf_tests" && $this->northbridge_model->confirmLoggedIn() == TRUE ){
				$curr_health_facility_arr = $this->northbridge_model->getHealthFacilityInfoBySlug($addition);
				if(is_array($curr_health_facility_arr)){
	              	foreach($curr_health_facility_arr as $row){
	              		$health_facility_id = $row->id;
	                	$health_facility_name = $row->name;
	               		$health_facility_logo = $row->logo;
	               		$health_facility_structure = $row->facility_structure;
		                $health_facility_email = $row->email;
		                $health_facility_phone = $row->phone;
		                $health_facility_country = $row->country;
		                $health_facility_state = $row->state;
		                $health_facility_address = $row->address;
		                $health_facility_table_name = $row->table_name;
		                $health_facility_date = $row->date;
		                $health_facility_time = $row->time;
		                $health_facility_slug = $row->slug;
		            }
		            if($this->input->post('get_pdf_tests') && $this->input->post('lab_id')){
		            	$row_array = array();
		            	$lab_id = $this->input->post('lab_id');
		            	$health_facility_test_result_table = $this->northbridge_model->createTestResultTableHeaderString($health_facility_id,$health_facility_name);
		            	$all_test_results = $this->northbridge_model->getPdfTestsRows($health_facility_test_result_table,$lab_id);
		            	if(is_array($all_test_results)){
		            		$i = 0;
		            		$cost_total = 0;
		            		$proceed = false;
		            		foreach($all_test_results as $row){
		            			$i++;

		            			$id = $row->id;
		            			$test_id = $row->test_id;
		            			$test_name = $this->northbridge_model->custom_echo($row->test_name,50);
		            			$price = $row->price;
		            			$cost_total += $price;
		            			// $row_array = array(
		            			// 	'testid' => $test_id,
		            			// 	'testname' => $test_name,
		            			// 	'testcost' => $price
		            			// );
		            			// $row_str .= json_encode($row_array).',';
		            			// set_cookie('total_price',$cost_total,100);
		            			$proceed = true;
		            			$row = array(
		            				'i' => $i,
		            				'testid' => $test_id,
		            				'testname' => $test_name,
		            				'testcost' => number_format($price)
		            			);
		            			$row_array[] = $row;
		            		}
		            		if($proceed == true){
			            		print json_encode($row_array);
			            	}else{
			            		print json_encode(array('error' => false));
			            	}
		            	}

		            }
		        }
		    } 

			elseif($this->northbridge_model->getFacilityBySlug($addition) == true && $this->northbridge_model->getDeptBooleanBySlug($second_addition) && $this->northbridge_model->getSubDeptBooleanBySlug($third_addition) && $this->northbridge_model->getPersonnelBooleanBySlug($fourth_addition) && $fivth_addition == "get_pdf_tests" && $this->northbridge_model->confirmLoggedIn() == TRUE ){
				$curr_health_facility_arr = $this->northbridge_model->getHealthFacilityInfoBySlug($addition);
				if(is_array($curr_health_facility_arr)){
	              	foreach($curr_health_facility_arr as $row){
	              		$health_facility_id = $row->id;
	                	$health_facility_name = $row->name;
	               		$health_facility_logo = $row->logo;
	               		$health_facility_structure = $row->facility_structure;
		                $health_facility_email = $row->email;
		                $health_facility_phone = $row->phone;
		                $health_facility_country = $row->country;
		                $health_facility_state = $row->state;
		                $health_facility_address = $row->address;
		                $health_facility_table_name = $row->table_name;
		                $health_facility_date = $row->date;
		                $health_facility_time = $row->time;
		                $health_facility_slug = $row->slug;
		            }
		            if($this->input->post('get_pdf_tests') && $this->input->post('lab_id')){
		            	$row_array = array();
		            	$lab_id = $this->input->post('lab_id');
		            	$health_facility_test_result_table = $this->northbridge_model->createTestResultTableHeaderString($health_facility_id,$health_facility_name);
		            	$all_test_results = $this->northbridge_model->getPdfTestsRows($health_facility_test_result_table,$lab_id);
		            	if(is_array($all_test_results)){
		            		$i = 0;
		            		$cost_total = 0;
		            		$proceed = false;
		            		foreach($all_test_results as $row){
		            			$i++;

		            			$id = $row->id;
		            			$test_id = $row->test_id;
		            			$test_name = $this->northbridge_model->custom_echo($row->test_name,50);
		            			$price = $row->price;
		            			$cost_total += $price;
		            			// $row_array = array(
		            			// 	'testid' => $test_id,
		            			// 	'testname' => $test_name,
		            			// 	'testcost' => $price
		            			// );
		            			// $row_str .= json_encode($row_array).',';
		            			// set_cookie('total_price',$cost_total,100);
		            			$proceed = true;
		            			$row = array(
		            				'i' => $i,
		            				'testid' => $test_id,
		            				'testname' => $test_name,
		            				'testcost' => number_format($price)
		            			);
		            			$row_array[] = $row;
		            		}
		            		if($proceed == true){
			            		print json_encode($row_array);
			            	}else{
			            		print json_encode(array('error' => false));
			            	}
		            	}

		            }
		        }
		    }        

			elseif($addition == "logout"){
				if($this->northbridge_model->confirmLoggedIn() == TRUE){
					delete_cookie('northbridgerem');
					if($_SERVER['SERVER_NAME'] == "localhost"){
						redirect('northbridge/login_page');
					}else{
						redirect("http://northbridge.com");
					}
				}
			}

			else{
				if($_SERVER['SERVER_NAME'] == "localhost"){
					redirect('northbridge/login_page');
				}else{
					// redirect("https://northbridge.com/login_page");
					redirect('northbridge/login_page');
				}
			}
		}
	}
